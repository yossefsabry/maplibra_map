class o{constructor(e,t,s,n=[]){this.map=e,this.layerManager=t,this.locations=s,this.searchIndex=(s||[]).map(i=>({loc:i,name:i?.details?.name||"",nameLower:(i?.details?.name||"").toLowerCase()})),this.floorLookup=new Map,n.forEach(i=>{const r=i.properties?.details?.name||`Level ${i.properties?.elevation??""}`.trim();this.floorLookup.set(i.properties.id,r)}),this.selectedResultIndex=-1,this.searchResults=[]}init(){this.createSearchUI(),this.setupEventListeners()}createSearchUI(){const e=document.createElement("div");e.className="search-container",e.innerHTML=`
            <div class="search-input-wrapper">
                <span class="search-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </span>
                <input type="text" class="search-input" placeholder="Search..." aria-label="Search map">
                <button class="search-clear-btn" style="display: none;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="search-results" style="display: none;"></div>
        `,document.body.appendChild(e),this.input=e.querySelector(".search-input"),this.resultsContainer=e.querySelector(".search-results"),this.clearBtn=e.querySelector(".search-clear-btn")}setupEventListeners(){this.debounce=(e,t)=>{let s;return(...n)=>{clearTimeout(s),s=setTimeout(()=>e.apply(this,n),t)}},this.input.addEventListener("input",e=>{const t=e.target.value.toLowerCase();this.clearBtn.style.display=t?"block":"none",this.debouncedSearch||(this.debouncedSearch=this.debounce(s=>this.handleSearch(s),300)),this.debouncedSearch(t)}),this.clearBtn.addEventListener("click",()=>{this.input.value="",this.clearBtn.style.display="none",this.resultsContainer.style.display="none",this.input.focus()}),this.input.addEventListener("keydown",e=>{e.key==="ArrowDown"?(e.preventDefault(),this.navigateResults(1)):e.key==="ArrowUp"?(e.preventDefault(),this.navigateResults(-1)):e.key==="Enter"&&this.selectedResultIndex>=0&&this.searchResults[this.selectedResultIndex]&&(this.selectResult(this.searchResults[this.selectedResultIndex]),this.input.blur())}),document.addEventListener("click",e=>{this.input.closest(".search-container").contains(e.target)||(this.resultsContainer.style.display="none")})}handleSearch(e){if(!e.trim()){this.resultsContainer.style.display="none";return}const t=e.trim();this.searchResults=this.searchIndex.filter(s=>s.nameLower.includes(t)).slice(0,10).map(s=>s.loc),this.renderResults()}renderResults(){if(this.resultsContainer.innerHTML="",this.selectedResultIndex=-1,this.searchResults.length===0)this.resultsContainer.innerHTML='<div class="no-results">No results found</div>';else{const e=document.createDocumentFragment();this.searchResults.forEach((t,s)=>{const n=document.createElement("div");n.className="search-result-item";let i="";const r=t.geometryAnchors&&t.geometryAnchors.length>0?t.geometryAnchors[0]:null;r&&(i=this.getFloorLabel(r.floorId)),n.innerHTML=`
                    <div class="result-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity:0.7"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                    </div>
                    <div class="result-info">
                        <div class="result-name">${t.details.name}</div>
                        <div class="result-floor">${i}</div>
                    </div>
                `,n.addEventListener("click",()=>{this.selectResult(t)}),e.appendChild(n)}),this.resultsContainer.appendChild(e)}this.resultsContainer.style.display="block"}navigateResults(e){const t=this.resultsContainer.querySelectorAll(".search-result-item");if(t.length===0)return;this.selectedResultIndex+=e,this.selectedResultIndex>=t.length&&(this.selectedResultIndex=0),this.selectedResultIndex<0&&(this.selectedResultIndex=t.length-1),t.forEach(n=>n.classList.remove("selected"));const s=t[this.selectedResultIndex];s.classList.add("selected"),s.scrollIntoView({block:"nearest"})}selectResult(e){this.input.value=e.details.name,this.resultsContainer.style.display="none";const t=e.geometryAnchors[0];if(!t)return;const s=t.centroid||[0,0],n=t.geometryId,i=t.floorId;window.dispatchEvent(new CustomEvent("floor-changed",{detail:{floorId:i}}));let r=s;this.layerManager.locationMap&&this.layerManager.locationMap.has(n)&&(r=this.layerManager.locationMap.get(n).coords),this.map.flyTo({center:r,zoom:20,pitch:45,essential:!0}),window.dispatchEvent(new CustomEvent("location-clicked",{detail:{name:e.details.name,coords:r,floorId:i,locationId:n}}))}getFloorLabel(e){return this.floorLookup.has(e)?this.floorLookup.get(e):"Floor"}}export{o as SearchBox};
