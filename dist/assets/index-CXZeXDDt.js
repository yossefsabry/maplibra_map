(function(){const I=document.createElement("link").relList;if(I&&I.supports&&I.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))E(S);new MutationObserver(S=>{for(const P of S)if(P.type==="childList")for(const b of P.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&E(b)}).observe(document,{childList:!0,subtree:!0});function T(S){const P={};return S.integrity&&(P.integrity=S.integrity),S.referrerPolicy&&(P.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?P.credentials="include":S.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function E(S){if(S.ep)return;S.ep=!0;const P=T(S);fetch(S.href,P)}})();const Jy="modulepreload",Qy=function(A){return"/"+A},xm={},tv=function(I,T,E){let S=Promise.resolve();if(T&&T.length>0){let $=function(G){return Promise.all(G.map(V=>Promise.resolve(V).then(K=>({status:"fulfilled",value:K}),K=>({status:"rejected",reason:K}))))};var b=$;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),N=o?.nonce||o?.getAttribute("nonce");S=$(T.map(G=>{if(G=Qy(G),G in xm)return;xm[G]=!0;const V=G.endsWith(".css"),K=V?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${G}"]${K}`))return;const q=document.createElement("link");if(q.rel=V?"stylesheet":Jy,V||(q.as="script"),q.crossOrigin="",q.href=G,N&&q.setAttribute("nonce",N),document.head.appendChild(q),V)return new Promise((Y,J)=>{q.addEventListener("load",Y),q.addEventListener("error",()=>J(new Error(`Unable to preload CSS for ${G}`)))})}))}function P(o){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=o,window.dispatchEvent(N),!N.defaultPrevented)throw o}return S.then(o=>{for(const N of o||[])N.status==="rejected"&&P(N.reason);return I().catch(P)})};var xh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pf(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var Ch={exports:{}};var ev=Ch.exports,bm;function nv(){return bm||(bm=1,(function(A,I){(function(T,E){A.exports=E()})(ev,(function(){var T={},E={};function S(b,o,N){if(E[b]=N,b==="index"){var $="var sharedModule = {}; ("+E.shared+")(sharedModule); ("+E.worker+")(sharedModule);",G={};return E.shared(G),E.index(T,G),typeof window<"u"&&T.setWorkerUrl(window.URL.createObjectURL(new Blob([$],{type:"text/javascript"}))),T}}S("shared",["exports"],(function(b){function o(i,t,n,a){return new(n||(n=Promise))((function(u,h){function f(M){try{x(a.next(M))}catch(L){h(L)}}function y(M){try{x(a.throw(M))}catch(L){h(L)}}function x(M){var L;M.done?u(M.value):(L=M.value,L instanceof n?L:new n((function(z){z(L)}))).then(f,y)}x((a=a.apply(i,t||[])).next())}))}function N(i,t){this.x=i,this.y=t}function $(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var G,V;typeof SuppressedError=="function"&&SuppressedError,N.prototype={clone(){return new N(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,t){return this.clone()._rotateAround(i,t)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult(i){const t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const t=Math.cos(i),n=Math.sin(i),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround(i,t){const n=Math.cos(i),a=Math.sin(i),u=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:N},N.convert=function(i){if(i instanceof N)return i;if(Array.isArray(i))return new N(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new N(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var K=(function(){if(V)return G;function i(t,n,a,u){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=a,this.p2y=u}return V=1,G=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,u=0;u<8;u++){var h=this.sampleCurveX(a)-t;if(Math.abs(h)<n)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=h/f}var y=0,x=1;for(a=t,u=0;u<20&&(h=this.sampleCurveX(a),!(Math.abs(h-t)<n));u++)t>h?y=a:x=a,a=.5*(x-y)+y;return a},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},G})(),q=$(K);let Y,J;function W(){return Y==null&&(Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Y}function at(){if(J==null&&(J=!1,W())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<25;a++){const u=4*a;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&n[a]!==a){J=!0;break}}}return J||!1}var ut=1e-6,dt=typeof Float32Array<"u"?Float32Array:Array;function Lt(){var i=new dt(9);return dt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function kt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function jt(){var i=new dt(3);return dt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Mt(i){var t=i[0],n=i[1],a=i[2];return Math.sqrt(t*t+n*n+a*a)}function Wt(i,t,n){var a=new dt(3);return a[0]=i,a[1]=t,a[2]=n,a}function Ot(i,t,n){return i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2],i}function Kt(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}function ge(i,t,n){var a=t[0],u=t[1],h=t[2],f=n[0],y=n[1],x=n[2];return i[0]=u*x-h*y,i[1]=h*f-a*x,i[2]=a*y-u*f,i}var Et,Ht=Mt;function tt(i,t,n){var a=t[0],u=t[1],h=t[2],f=t[3];return i[0]=n[0]*a+n[4]*u+n[8]*h+n[12]*f,i[1]=n[1]*a+n[5]*u+n[9]*h+n[13]*f,i[2]=n[2]*a+n[6]*u+n[10]*h+n[14]*f,i[3]=n[3]*a+n[7]*u+n[11]*h+n[15]*f,i}function Jt(){var i=new dt(4);return dt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ze(i,t,n,a){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",h=Math.PI/360;t*=h,a*=h,n*=h;var f=Math.sin(t),y=Math.cos(t),x=Math.sin(n),M=Math.cos(n),L=Math.sin(a),z=Math.cos(a);switch(u){case"xyz":i[0]=f*M*z+y*x*L,i[1]=y*x*z-f*M*L,i[2]=y*M*L+f*x*z,i[3]=y*M*z-f*x*L;break;case"xzy":i[0]=f*M*z-y*x*L,i[1]=y*x*z-f*M*L,i[2]=y*M*L+f*x*z,i[3]=y*M*z+f*x*L;break;case"yxz":i[0]=f*M*z+y*x*L,i[1]=y*x*z-f*M*L,i[2]=y*M*L-f*x*z,i[3]=y*M*z+f*x*L;break;case"yzx":i[0]=f*M*z+y*x*L,i[1]=y*x*z+f*M*L,i[2]=y*M*L-f*x*z,i[3]=y*M*z-f*x*L;break;case"zxy":i[0]=f*M*z-y*x*L,i[1]=y*x*z+f*M*L,i[2]=y*M*L+f*x*z,i[3]=y*M*z-f*x*L;break;case"zyx":i[0]=f*M*z-y*x*L,i[1]=y*x*z+f*M*L,i[2]=y*M*L-f*x*z,i[3]=y*M*z+f*x*L;break;default:throw new Error("Unknown angle order "+u)}return i}function te(){var i=new dt(2);return dt!=Float32Array&&(i[0]=0,i[1]=0),i}function Ne(i,t){var n=new dt(2);return n[0]=i,n[1]=t,n}jt(),Et=new dt(4),dt!=Float32Array&&(Et[0]=0,Et[1]=0,Et[2]=0,Et[3]=0),jt(),Wt(1,0,0),Wt(0,1,0),Jt(),Jt(),Lt(),te();const he=8192;function _e(i,t,n){return t*(he/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Zt(i,t){return(i%t+t)%t}function Xt(i,t,n){return i*(1-n)+t*n}function Ge(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,n=t*i;return 4*(i<.5?n:3*(i-t)+n-.75)}function ye(i,t,n,a){const u=new q(i,t,n,a);return h=>u.solve(h)}const Pe=ye(.25,.1,.25,1);function _n(i,t,n){return Math.min(n,Math.max(t,i))}function Pn(i,t,n){const a=n-t,u=((i-t)%a+a)%a+t;return u===t?n:u}function Gt(i,...t){for(const n of t)for(const a in n)i[a]=n[a];return i}let bn=1;function sn(i,t,n){const a={};for(const u in i)a[u]=t.call(this,i[u],u,i);return a}function Be(i,t,n){const a={};for(const u in i)t.call(this,i[u],u,i)&&(a[u]=i[u]);return a}function Dt(i){return Array.isArray(i)?i.map(Dt):typeof i=="object"&&i?sn(i,Dt):i}const $n={};function et(i){$n[i]||(typeof console<"u"&&console.warn(i),$n[i]=!0)}function fe(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function de(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Pt=null;function bt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Te(i,t,n,a,u){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(i,{timestamp:0});try{const f=h?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const y=f.startsWith("BGR"),x=new Uint8ClampedArray(a*u*4);if(yield h.copyTo(x,(function(M,L,z,F,j){const U=4*Math.max(-L,0),H=(Math.max(0,z)-z)*F*4+U,rt=4*F,ct=Math.max(0,L),It=Math.max(0,z);return{rect:{x:ct,y:It,width:Math.min(M.width,L+F)-ct,height:Math.min(M.height,z+j)-It},layout:[{offset:H,stride:rt}]}})(i,t,n,a,u)),y)for(let M=0;M<x.length;M+=4){const L=x[M];x[M]=x[M+2],x[M+2]=L}return x}finally{h.close()}}))}let Ee,Qt;function Re(i,t,n,a){return i.addEventListener(t,n,a),{unsubscribe:()=>{i.removeEventListener(t,n,a)}}}function be(i){return i*Math.PI/180}function Ce(i){return i/Math.PI*180}const Je={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},kn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Oe="AbortError";function li(){return new Error(Oe)}const ln={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ye(i){return ln.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ar="global-dispatcher";class yn extends Error{constructor(t,n,a,u){super(`AJAXError: ${n} (${t}): ${a}`),this.status=t,this.statusText=n,this.url=a,this.body=u}}const Mi=()=>de(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,wt=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const a=Ye(i.url);if(a)return a(i,t);if(de(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ar},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Mi())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,u){return o(this,void 0,void 0,(function*(){const h=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Mi(),signal:u.signal});let f,y;a.type!=="json"||h.headers.has("Accept")||h.headers.set("Accept","application/json");try{f=yield fetch(h)}catch(M){throw new yn(0,M.message,a.url,new Blob)}if(!f.ok){const M=yield f.blob();throw new yn(f.status,f.statusText,a.url,M)}y=a.type==="arrayBuffer"||a.type==="image"?f.arrayBuffer():a.type==="json"?f.json():f.text();const x=yield y;if(u.signal.aborted)throw li();return{data:x,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}}))})(i,t);if(de(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ar},t)}var n;return(function(a,u){return new Promise(((h,f)=>{var y;const x=new XMLHttpRequest;x.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(x.responseType="arraybuffer");for(const M in a.headers)x.setRequestHeader(M,a.headers[M]);a.type==="json"&&(x.responseType="text",!((y=a.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=a.credentials==="include",x.onerror=()=>{f(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let M=x.response;if(a.type==="json")try{M=JSON.parse(x.response)}catch(L){return void f(L)}h({data:M,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const M=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});f(new yn(x.status,x.statusText,a.url,M))}},u.signal.addEventListener("abort",(()=>{x.abort(),f(li())})),x.send(a.body)}))})(i,t)};function nt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function st(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function lt(i,t,n){if(n&&n[i]){const a=n[i].indexOf(t);a!==-1&&n[i].splice(a,1)}}class xt{constructor(t,n={}){Gt(this,n),this.type=t}}class Rt extends xt{constructor(t,n={}){super("error",Gt({error:t},n))}}class $t{on(t,n){return this._listeners=this._listeners||{},st(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return lt(t,n,this._listeners),lt(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},st(t,n,this._oneTimeListeners),this):new Promise((a=>this.once(t,a)))}fire(t,n){typeof t=="string"&&(t=new xt(t,n||{}));const a=t.type;if(this.listens(a)){t.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,t);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)lt(a,y,this._oneTimeListeners),y.call(this,t);const f=this._eventedParent;f&&(Gt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof Rt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function le(i,t){const n={};for(const a in i)a!=="ref"&&(n[a]=i[a]);return Ut.forEach((a=>{a in t&&(n[a]=t[a])})),n}function ue(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!ue(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!ue(i[n],t[n]))return!1;return!0}return i===t}function ce(i,t){i.push(t)}function se(i,t,n){ce(n,{command:"addSource",args:[i,t[i]]})}function Xe(i,t,n){ce(t,{command:"removeSource",args:[i]}),n[i]=!0}function an(i,t,n,a){Xe(i,n,a),se(i,t,n)}function jn(i,t,n){let a;for(a in i[n])if(Object.prototype.hasOwnProperty.call(i[n],a)&&a!=="data"&&!ue(i[n][a],t[n][a]))return!1;for(a in t[n])if(Object.prototype.hasOwnProperty.call(t[n],a)&&a!=="data"&&!ue(i[n][a],t[n][a]))return!1;return!0}function vn(i,t,n,a,u,h){i=i||{},t=t||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(ue(i[f],t[f])||n.push({command:h,args:[a,f,t[f],u]}));for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(ue(i[f],t[f])||n.push({command:h,args:[a,f,t[f],u]}))}function En(i){return i.id}function zn(i,t){return i[t.id]=t,i}class we{constructor(t,n,a,u){this.message=(t?`${t}: `:"")+a,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function Gn(i,...t){for(const n of t)for(const a in n)i[a]=n[a];return i}class An extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class di{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[a,u]of n)this.bindings[a]=u}concat(t){return new di(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Nn={kind:"null"},ke={kind:"number"},je={kind:"string"},Qe={kind:"boolean"},Pi={kind:"color"},or={kind:"projectionDefinition"},Kn={kind:"object"},rn={kind:"value"},mr={kind:"collator"},Fr={kind:"formatted"},Jn={kind:"padding"},Tr={kind:"colorArray"},Is={kind:"numberArray"},es={kind:"resolvedImage"},Br={kind:"variableAnchorOffsetCollection"};function qi(i,t){return{kind:"array",itemType:i,N:t}}function Dn(i){if(i.kind==="array"){const t=Dn(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const sl=[Nn,ke,je,Qe,Pi,or,Fr,Kn,qi(rn),Jn,Is,Tr,es,Br];function Vr(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Vr(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of sl)if(!Vr(n,t))return null}}return`Expected ${Dn(i)} but found ${Dn(t)} instead.`}function Zi(i,t){return t.some((n=>n.kind===i.kind))}function Rn(i,t){return t.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function jr(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const ds=.96422,fs=.82521,ao=4/29,Us=6/29,al=3*Us*Us,oo=Us*Us*Us,ol=Math.PI/180,ua=180/Math.PI;function Gr(i){return(i%=360)<0&&(i+=360),i}function ns([i,t,n,a]){let u,h;const f=ps((.2225045*(i=Oa(i))+.7168786*(t=Oa(t))+.0606169*(n=Oa(n)))/1);i===t&&t===n?u=h=f:(u=ps((.4360747*i+.3850649*t+.1430804*n)/ds),h=ps((.0139322*i+.0971045*t+.7141733*n)/fs));const y=116*f-16;return[y<0?0:y,500*(u-f),200*(f-h),a]}function Oa(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ps(i){return i>oo?Math.pow(i,1/3):i/al+ao}function ll([i,t,n,a]){let u=(i+16)/116,h=isNaN(t)?u:u+t/500,f=isNaN(n)?u:u-n/200;return u=1*uo(u),h=ds*uo(h),f=fs*uo(f),[lo(3.1338561*h-1.6168667*u-.4906146*f),lo(-.9787684*h+1.9161415*u+.033454*f),lo(.0719453*h-.2289914*u+1.4052427*f),a]}function lo(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function uo(i){return i>Us?i*i*i:al*(i-ao)}const ul=Object.hasOwn||function(i,t){return Object.prototype.hasOwnProperty.call(i,t)};function Ur(i,t){return ul(i,t)?i[t]:void 0}function ms(i){return parseInt(i.padEnd(2,i),16)/255}function co(i,t){return qr(t?i/100:i,0,1)}function qr(i,t,n){return Math.min(Math.max(t,i),n)}function ho(i){return!i.some(Number.isNaN)}const hu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Zr(i,t,n){return i+n*(t-i)}function Ln(i,t,n){return i.map(((a,u)=>Zr(a,t[u],n)))}class un{constructor(t,n,a,u=1,h=!0){this.r=t,this.g=n,this.b=a,this.a=u,h||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,a,u]))}static parse(t){if(t instanceof un)return t;if(typeof t!="string")return;const n=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Ur(hu,a);if(u){const[f,y,x]=u;return[f/255,y/255,x/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const f=a.length<6?1:2;let y=1;return[ms(a.slice(y,y+=f)),ms(a.slice(y,y+=f)),ms(a.slice(y,y+=f)),ms(a.slice(y,y+f)||"ff")]}if(a.startsWith("rgb")){const f=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[y,x,M,L,z,F,j,U,H,rt,ct,It]=f,ft=[L||" ",j||" ",rt].join("");if(ft==="  "||ft==="  /"||ft===",,"||ft===",,,"){const _t=[M,F,H].join(""),Bt=_t==="%%%"?100:_t===""?255:0;if(Bt){const Vt=[qr(+x/Bt,0,1),qr(+z/Bt,0,1),qr(+U/Bt,0,1),ct?co(+ct,It):1];if(ho(Vt))return Vt}}return}}const h=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[f,y,x,M,L,z,F,j,U]=h,H=[x||" ",L||" ",F].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const rt=[+y,qr(+M,0,100),qr(+z,0,100),j?co(+j,U):1];if(ho(rt))return(function([ct,It,ft,_t]){function Bt(Vt){const re=(Vt+ct/30)%12,xe=It*Math.min(ft,1-ft);return ft-xe*Math.max(-1,Math.min(re-3,9-re,1))}return ct=Gr(ct),It/=100,ft/=100,[Bt(0),Bt(8),Bt(4),_t]})(rt)}}})(t);return n?new un(...n,!1):void 0}get rgb(){const{r:t,g:n,b:a,a:u}=this,h=u||1/0;return this.overwriteGetter("rgb",[t/h,n/h,a/h,u])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,a,u,h]=ns(t),f=Math.sqrt(a*a+u*u);return[Math.round(1e4*f)?Gr(Math.atan2(u,a)*ua):NaN,f,n,h]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ns(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,a,u]=this.rgb;return`rgba(${[t,n,a].map((h=>Math.round(255*h))).join(",")},${u})`}static interpolate(t,n,a,u="rgb"){switch(u){case"rgb":{const[h,f,y,x]=Ln(t.rgb,n.rgb,a);return new un(h,f,y,x,!1)}case"hcl":{const[h,f,y,x]=t.hcl,[M,L,z,F]=n.hcl;let j,U;if(isNaN(h)||isNaN(M))isNaN(h)?isNaN(M)?j=NaN:(j=M,y!==1&&y!==0||(U=L)):(j=h,z!==1&&z!==0||(U=f));else{let ft=M-h;M>h&&ft>180?ft-=360:M<h&&h-M>180&&(ft+=360),j=h+a*ft}const[H,rt,ct,It]=(function([ft,_t,Bt,Vt]){return ft=isNaN(ft)?0:ft*ol,ll([Bt,Math.cos(ft)*_t,Math.sin(ft)*_t,Vt])})([j,U??Zr(f,L,a),Zr(y,z,a),Zr(x,F,a)]);return new un(H,rt,ct,It,!1)}case"lab":{const[h,f,y,x]=ll(Ln(t.lab,n.lab,a));return new un(h,f,y,x,!1)}}}}un.black=new un(0,0,0,1),un.white=new un(1,1,1,1),un.transparent=new un(0,0,0,0),un.red=new un(1,0,0,1);class gr{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const wn=["bottom","center","top"];class _i{constructor(t,n,a,u,h,f){this.text=t,this.image=n,this.scale=a,this.fontStack=u,this.textColor=h,this.verticalAlign=f}}class Cn{constructor(t){this.sections=t}static fromString(t){return new Cn([new _i(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Cn?t:Cn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class yi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof yi)return t;if(typeof t=="number")return new yi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new yi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,a){return new yi(Ln(t.values,n.values,a))}}class Oi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Oi)return t;if(typeof t=="number")return new Oi([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new Oi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,a){return new Oi(Ln(t.values,n.values,a))}}class vi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof vi)return t;if(typeof t=="string"){const a=un.parse(t);return a?new vi([a]):void 0}if(!Array.isArray(t))return;const n=[];for(const a of t){if(typeof a!="string")return;const u=un.parse(a);if(!u)return;n.push(u)}return new vi(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,a,u="rgb"){const h=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let f=0;f<t.values.length;f++)h.push(un.interpolate(t.values[f],n.values[f],a,u));return new vi(h)}}class On extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Ts=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof $i)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const a=t[n],u=t[n+1];if(typeof a!="string"||!Ts.has(a)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new $i(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,a){const u=t.values,h=n.values;if(u.length!==h.length)throw new On(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const f=[];for(let y=0;y<u.length;y+=2){if(u[y]!==h[y])throw new On(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${h[y]}`);f.push(u[y]);const[x,M]=u[y+1],[L,z]=h[y+1];f.push([Zr(x,L,a),Zr(M,z,a)])}return new $i(f)}}class Wi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Wi({name:t,available:!1}):null}}class cn{constructor(t,n,a){this.from=t,this.to=n,this.transition=a}static interpolate(t,n,a){return new cn(t,n,a)}static parse(t){return t instanceof cn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new cn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new cn(t.from,t.to,t.transition):typeof t=="string"?new cn(t,t,1):void 0}}function Sr(i,t,n,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,n,a]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $r(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof cn||i instanceof un||i instanceof gr||i instanceof Cn||i instanceof yi||i instanceof Oi||i instanceof vi||i instanceof $i||i instanceof Wi)return!0;if(Array.isArray(i)){for(const t of i)if(!$r(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!$r(i[t]))return!1;return!0}return!1}function Un(i){if(i===null)return Nn;if(typeof i=="string")return je;if(typeof i=="boolean")return Qe;if(typeof i=="number")return ke;if(i instanceof un)return Pi;if(i instanceof cn)return or;if(i instanceof gr)return mr;if(i instanceof Cn)return Fr;if(i instanceof yi)return Jn;if(i instanceof Oi)return Is;if(i instanceof vi)return Tr;if(i instanceof $i)return Br;if(i instanceof Wi)return es;if(Array.isArray(i)){const t=i.length;let n;for(const a of i){const u=Un(a);if(n){if(n===u)continue;n=rn;break}n=u}return qi(n||rn,t)}return Kn}function Wr(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof un||i instanceof cn||i instanceof Cn||i instanceof yi||i instanceof Oi||i instanceof vi||i instanceof $i||i instanceof Wi?i.toString():JSON.stringify(i)}class is{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!$r(t[1]))return n.error("invalid value");const a=t[1];let u=Un(a);const h=n.expectedType;return u.kind!=="array"||u.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(u=h),new is(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const xi={string:je,number:ke,boolean:Qe,object:Kn};class Xi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,u=1;const h=t[0];if(h==="array"){let y,x;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in xi)||M==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=xi[M],u++}else y=rn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}a=qi(y,x)}else{if(!xi[h])throw new Error(`Types doesn't contain name = ${h}`);a=xi[h]}const f=[];for(;u<t.length;u++){const y=n.parse(t[u],u,rn);if(!y)return null;f.push(y)}return new Xi(a,f)}evaluate(t){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(t);if(!Vr(this.type,Un(a)))return a;if(n===this.args.length-1)throw new On(`Expected value to be of type ${Dn(this.type)}, but found ${Dn(Un(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Fn={"to-boolean":Qe,"to-color":Pi,"to-number":ke,"to-string":je};class Er{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[0];if(!Fn[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=Fn[a],h=[];for(let f=1;f<t.length;f++){const y=n.parse(t[f],f,rn);if(!y)return null;h.push(y)}return new Er(u,h)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,a;for(const u of this.args){if(n=u.evaluate(t),a=null,n instanceof un)return n;if(typeof n=="string"){const h=t.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Sr(n[0],n[1],n[2],n[3]),!a))return new un(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new On(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const a of this.args){n=a.evaluate(t);const u=yi.parse(n);if(u)return u}throw new On(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const a of this.args){n=a.evaluate(t);const u=Oi.parse(n);if(u)return u}throw new On(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const a of this.args){n=a.evaluate(t);const u=vi.parse(n);if(u)return u}throw new On(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const a of this.args){n=a.evaluate(t);const u=$i.parse(n);if(u)return u}throw new On(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const a of this.args){if(n=a.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new On(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Cn.fromString(Wr(this.args[0].evaluate(t)));case"resolvedImage":return Wi.fromString(Wr(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Wr(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Tn=["Unknown","Point","LineString","Polygon"];class mn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=un.parse(t),this._parseColorCache.set(t,n)),n}}class Ss{constructor(t,n,a=[],u,h=new di,f=[]){this.registry=t,this.path=a,this.key=a.map((y=>`[${y}]`)).join(""),this.scope=h,this.errors=f,this.expectedType=u,this._isConstant=n}parse(t,n,a,u,h={}){return n?this.concat(n,a,u)._parse(t,h):this._parse(t,h)}_parse(t,n){function a(u,h,f){return f==="assert"?new Xi(h,[u]):f==="coerce"?new Er(h,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[u];if(h){let f=h.parse(t,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,x=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))f=a(f,y,n.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else f=a(f,y,n.typeAnnotation||"assert")}if(!(f instanceof is)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const y=new mn;try{f=new is(f.type,f.evaluate(y))}catch(x){return this.error(x.message),null}}return f}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){const u=typeof t=="number"?this.path.concat(t):this.path,h=a?this.scope.concat(a):this.scope;return new Ss(this.registry,this._isConstant,u,n||null,h,this.errors)}error(t,...n){const a=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new An(a,t))}checkSubtype(t,n){const a=Vr(t,n);return a&&this.error(a),a}}class dn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let h=1;h<t.length-1;h+=2){const f=t[h];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,h);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=n.parse(t[h+1],h+1);if(!y)return null;a.push([f,y])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return u?new dn(a,u):null}outputDefined(){return this.result.outputDefined()}}class rs{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=t[1];return n.scope.has(a)?new rs(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class kr{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ke),u=n.parse(t[2],2,qi(n.expectedType||rn));return a&&u?new kr(u.type.itemType,a,u):null}evaluate(t){const n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new On(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new On(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new On(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Fi{constructor(t,n){this.type=Qe,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,rn),u=n.parse(t[2],2,rn);return a&&u?Zi(a.type,[Qe,je,ke,Nn,rn])?new Fi(a,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(a.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!Rn(n,["boolean","string","number","null"]))throw new On(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(Un(n))} instead.`);if(!Rn(a,["string","array"]))throw new On(`Expected second argument to be of type array or string, but found ${Dn(Un(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class _r{constructor(t,n,a){this.type=ke,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,rn),u=n.parse(t[2],2,rn);if(!a||!u)return null;if(!Zi(a.type,[Qe,je,ke,Nn,rn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(a.type)} instead`);if(t.length===4){const h=n.parse(t[3],3,ke);return h?new _r(a,u,h):null}return new _r(a,u)}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Rn(n,["boolean","string","number","null"]))throw new On(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(Un(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),Rn(a,["string"])){const h=a.indexOf(n,u);return h===-1?-1:[...a.slice(0,h)].length}if(Rn(a,["array"]))return a.indexOf(n,u);throw new On(`Expected second argument to be of type array or string, but found ${Dn(Un(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Fa{constructor(t,n,a,u,h,f){this.inputType=t,this.type=n,this.input=a,this.cases=u,this.outputs=h,this.otherwise=f}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const h={},f=[];for(let M=2;M<t.length-1;M+=2){let L=t[M];const z=t[M+1];Array.isArray(L)||(L=[L]);const F=n.concat(M);if(L.length===0)return F.error("Expected at least one branch label.");for(const U of L){if(typeof U!="number"&&typeof U!="string")return F.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,Un(U)))return null}else a=Un(U);if(h[String(U)]!==void 0)return F.error("Branch labels must be unique.");h[String(U)]=f.length}const j=n.parse(z,M,u);if(!j)return null;u=u||j.type,f.push(j)}const y=n.parse(t[1],1,rn);if(!y)return null;const x=n.parse(t[t.length-1],t.length-1,u);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new Fa(a,u,y,h,f,x):null}evaluate(t){const n=this.input.evaluate(t);return(Un(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Xr{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const u=[];for(let f=1;f<t.length-1;f+=2){const y=n.parse(t[f],f,Qe);if(!y)return null;const x=n.parse(t[f+1],f+1,a);if(!x)return null;u.push([y,x]),a=a||x.type}const h=n.parse(t[t.length-1],t.length-1,a);if(!h)return null;if(!a)throw new Error("Can't infer output type");return new Xr(a,u,h)}evaluate(t){for(const[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class qs{constructor(t,n,a,u){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,rn),u=n.parse(t[2],2,ke);if(!a||!u)return null;if(!Zi(a.type,[qi(rn),je,rn]))return n.error(`Expected first argument to be of type array or string, but found ${Dn(a.type)} instead`);if(t.length===4){const h=n.parse(t[3],3,ke);return h?new qs(a.type,a,u,h):null}return new qs(a.type,a,u)}evaluate(t){const n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),Rn(n,["string"]))return[...n].slice(a,u).join("");if(Rn(n,["array"]))return n.slice(a,u);throw new On(`Expected first argument to be of type array or string, but found ${Dn(Un(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ss(i,t){const n=i.length-1;let a,u,h=0,f=n,y=0;for(;h<=f;)if(y=Math.floor((h+f)/2),a=i[y],u=i[y+1],a<=t){if(y===n||t<u)return y;h=y+1}else{if(!(a>t))throw new On("Input is not a number.");f=y-1}return 0}class Zs{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,h]of a)this.labels.push(u),this.outputs.push(h)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(t[1],1,ke);if(!a)return null;const u=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let f=1;f<t.length;f+=2){const y=f===1?-1/0:t[f],x=t[f+1],M=f,L=f+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const z=n.parse(x,L,h);if(!z)return null;h=h||z.type,u.push([y,z])}return new Zs(h,a,u)}evaluate(t){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return a[0].evaluate(t);const h=n.length;return u>=n[h-1]?a[h-1].evaluate(t):a[ss(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Mr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Pr,Ri,Ba=(function(){if(Ri)return Pr;function i(t,n,a,u){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=a,this.p2y=u}return Ri=1,Pr=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,u=0;u<8;u++){var h=this.sampleCurveX(a)-t;if(Math.abs(h)<n)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=h/f}var y=0,x=1;for(a=t,u=0;u<20&&(h=this.sampleCurveX(a),!(Math.abs(h-t)<n));u++)t>h?y=a:x=a,a=.5*(x-y)+y;return a},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Pr})(),cl=Mr(Ba);class zi{constructor(t,n,a,u,h){this.type=t,this.operator=n,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[f,y]of h)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(t,n,a,u){let h=0;if(t.name==="exponential")h=fi(n,t.base,a,u);else if(t.name==="linear")h=fi(n,1,a,u);else if(t.name==="cubic-bezier"){const f=t.controlPoints;h=new cl(f[0],f[1],f[2],f[3]).solve(fi(n,1,a,u))}return h}static parse(t,n){let[a,u,h,...f]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some((L=>typeof L!="number"||L<0||L>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,ke),!h)return null;const y=[];let x=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||n.expectedType==Tr?n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType):x=Pi;for(let M=0;M<f.length;M+=2){const L=f[M],z=f[M+1],F=M+3,j=M+4;if(typeof L!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(y.length&&y[y.length-1][0]>=L)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const U=n.parse(z,j,x);if(!U)return null;x=x||U.type,y.push([L,U])}return jr(x,ke)||jr(x,or)||jr(x,Pi)||jr(x,Jn)||jr(x,Is)||jr(x,Tr)||jr(x,Br)||jr(x,qi(ke))?new zi(x,a,u,h,y):n.error(`Type ${Dn(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return a[0].evaluate(t);const h=n.length;if(u>=n[h-1])return a[h-1].evaluate(t);const f=ss(n,u),y=zi.interpolationFactor(this.interpolation,u,n[f],n[f+1]),x=a[f].evaluate(t),M=a[f+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Zr(x,M,y);case"color":return un.interpolate(x,M,y);case"padding":return yi.interpolate(x,M,y);case"colorArray":return vi.interpolate(x,M,y);case"numberArray":return Oi.interpolate(x,M,y);case"variableAnchorOffsetCollection":return $i.interpolate(x,M,y);case"array":return Ln(x,M,y);case"projectionDefinition":return cn.interpolate(x,M,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return un.interpolate(x,M,y,"hcl");case"colorArray":return vi.interpolate(x,M,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return un.interpolate(x,M,y,"lab");case"colorArray":return vi.interpolate(x,M,y,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function fi(i,t,n,a){const u=a-n,h=i-n;return u===0?0:t===1?h/u:(Math.pow(t,h)-1)/(Math.pow(t,u)-1)}const Cr={color:un.interpolate,number:Zr,padding:yi.interpolate,numberArray:Oi.interpolate,colorArray:vi.interpolate,variableAnchorOffsetCollection:$i.interpolate,array:Ln};class $s{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a=null;const u=n.expectedType;u&&u.kind!=="value"&&(a=u);const h=[];for(const y of t.slice(1)){const x=n.parse(y,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,h.push(x)}if(!a)throw new Error("No output type");const f=u&&h.some((y=>Vr(u,y.type)));return new $s(f?rn:a,h)}evaluate(t){let n,a=null,u=0;for(const h of this.args)if(u++,a=h.evaluate(t),a&&a instanceof Wi&&!a.available&&(n||(n=a.name),a=null,u===this.args.length&&(a=n)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function as(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ki(i,t,n,a){return a.compare(t,n)===0}function Ar(i,t,n){const a=i!=="=="&&i!=="!=";return class cg{constructor(h,f,y){this.type=Qe,this.lhs=h,this.rhs=f,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||f.type.kind==="value"}static parse(h,f){if(h.length!==3&&h.length!==4)return f.error("Expected two or three arguments.");const y=h[0];let x=f.parse(h[1],1,rn);if(!x)return null;if(!as(y,x.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${Dn(x.type)}'.`);let M=f.parse(h[2],2,rn);if(!M)return null;if(!as(y,M.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${Dn(M.type)}'.`);if(x.type.kind!==M.type.kind&&x.type.kind!=="value"&&M.type.kind!=="value")return f.error(`Cannot compare types '${Dn(x.type)}' and '${Dn(M.type)}'.`);a&&(x.type.kind==="value"&&M.type.kind!=="value"?x=new Xi(M.type,[x]):x.type.kind!=="value"&&M.type.kind==="value"&&(M=new Xi(x.type,[M])));let L=null;if(h.length===4){if(x.type.kind!=="string"&&M.type.kind!=="string"&&x.type.kind!=="value"&&M.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(L=f.parse(h[3],3,mr),!L)return null}return new cg(x,M,L)}evaluate(h){const f=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){const x=Un(f),M=Un(y);if(x.kind!==M.kind||x.kind!=="string"&&x.kind!=="number")throw new On(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${M.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=Un(f),M=Un(y);if(x.kind!=="string"||M.kind!=="string")return t(h,f,y)}return this.collator?n(h,f,y,this.collator.evaluate(h)):t(h,f,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const ca=Ar("==",(function(i,t,n){return t===n}),Ki),fo=Ar("!=",(function(i,t,n){return t!==n}),(function(i,t,n,a){return!Ki(0,t,n,a)})),po=Ar("<",(function(i,t,n){return t<n}),(function(i,t,n,a){return a.compare(t,n)<0})),mo=Ar(">",(function(i,t,n){return t>n}),(function(i,t,n,a){return a.compare(t,n)>0})),Ws=Ar("<=",(function(i,t,n){return t<=n}),(function(i,t,n,a){return a.compare(t,n)<=0})),ha=Ar(">=",(function(i,t,n){return t>=n}),(function(i,t,n,a){return a.compare(t,n)>=0}));class Qn{constructor(t,n,a){this.type=mr,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const u=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Qe);if(!u)return null;const h=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Qe);if(!h)return null;let f=null;return a.locale&&(f=n.parse(a.locale,1,je),!f)?null:new Qn(u,h,f)}evaluate(t){return new gr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class da{constructor(t,n,a,u,h){this.type=je,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const a=n.parse(t[1],1,ke);if(!a)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let h=null;if(u.locale&&(h=n.parse(u.locale,1,je),!h))return null;let f=null;if(u.currency&&(f=n.parse(u.currency,1,je),!f))return null;let y=null;if(u["min-fraction-digits"]&&(y=n.parse(u["min-fraction-digits"],1,ke),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=n.parse(u["max-fraction-digits"],1,ke),!x)?null:new da(a,h,f,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class bi{constructor(t){this.type=Fr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const u=[];let h=!1;for(let f=1;f<=t.length-1;++f){const y=t[f];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,ke),!x))return null;let M=null;if(y["text-font"]&&(M=n.parse(y["text-font"],1,qi(je)),!M))return null;let L=null;if(y["text-color"]&&(L=n.parse(y["text-color"],1,Pi),!L))return null;let z=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!wn.includes(y["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(z=n.parse(y["vertical-align"],1,je),!z)return null}const F=u[u.length-1];F.scale=x,F.font=M,F.textColor=L,F.verticalAlign=z}else{const x=n.parse(t[f],1,rn);if(!x)return null;const M=x.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new bi(u)}evaluate(t){return new Cn(this.sections.map((n=>{const a=n.content.evaluate(t);return Un(a)===es?new _i("",a,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new _i(Wr(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Es{constructor(t){this.type=es,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const a=n.parse(t[1],1,je);return a?new Es(a):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),a=Wi.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class fa{constructor(t){this.type=ke,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=n.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Dn(a.type)} instead.`):new fa(a):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new On(`Expected value to be of type string or array, but found ${Dn(Un(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Lr=8192;function hl(i,t){const n=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*Lr),Math.round(a*u*Lr)]}function Va(i,t){const n=Math.pow(2,t.z);return[(u=(i[0]/Lr+t.x)/n,360*u-180),(a=(i[1]/Lr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,u}function ks(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function gs(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function du(i,t,n){const a=i[0]-t[0],u=i[1]-t[1],h=i[0]-n[0],f=i[1]-n[1];return a*f-h*u==0&&a*h<=0&&u*f<=0}function pa(i,t,n,a){return(u=[a[0]-n[0],a[1]-n[1]])[0]*(h=[t[0]-i[0],t[1]-i[1]])[1]-u[1]*h[0]!=0&&!(!go(i,t,n,a)||!go(n,a,i,t));var u,h}function dl(i,t,n){for(const a of n)for(let u=0;u<a.length-1;++u)if(pa(i,t,a[u],a[u+1]))return!0;return!1}function Xs(i,t,n=!1){let a=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(du(i,y[x],y[x+1]))return n;(h=y[x])[1]>(u=i)[1]!=(f=y[x+1])[1]>u[1]&&u[0]<(f[0]-h[0])*(u[1]-h[1])/(f[1]-h[1])+h[0]&&(a=!a)}var u,h,f;return a}function fl(i,t){for(const n of t)if(Xs(i,n))return!0;return!1}function pl(i,t){for(const n of i)if(!Xs(n,t))return!1;for(let n=0;n<i.length-1;++n)if(dl(i[n],i[n+1],t))return!1;return!0}function fu(i,t){for(const n of t)if(pl(i,n))return!0;return!1}function go(i,t,n,a){const u=a[0]-n[0],h=a[1]-n[1],f=(i[0]-n[0])*h-u*(i[1]-n[1]),y=(t[0]-n[0])*h-u*(t[1]-n[1]);return f>0&&y<0||f<0&&y>0}function _o(i,t,n){const a=[];for(let u=0;u<i.length;u++){const h=[];for(let f=0;f<i[u].length;f++){const y=hl(i[u][f],n);ks(t,y),h.push(y)}a.push(h)}return a}function yo(i,t,n){const a=[];for(let u=0;u<i.length;u++){const h=_o(i[u],t,n);a.push(h)}return a}function vo(i,t,n,a){if(i[0]<n[0]||i[0]>n[2]){const u=.5*a;let h=i[0]-n[0]>u?-a:n[0]-i[0]>u?a:0;h===0&&(h=i[0]-n[2]>u?-a:n[2]-i[0]>u?a:0),i[0]+=h}ks(t,i)}function xo(i,t,n,a){const u=Math.pow(2,a.z)*Lr,h=[a.x*Lr,a.y*Lr],f=[];for(const y of i)for(const x of y){const M=[x.x+h[0],x.y+h[1]];vo(M,t,n,u),f.push(M)}return f}function bo(i,t,n,a){const u=Math.pow(2,a.z)*Lr,h=[a.x*Lr,a.y*Lr],f=[];for(const x of i){const M=[];for(const L of x){const z=[L.x+h[0],L.y+h[1]];ks(t,z),M.push(z)}f.push(M)}if(t[2]-t[0]<=u/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of f)for(const M of x)vo(M,t,n,u)}var y;return f}class Ms{constructor(t,n){this.type=Qe,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if($r(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const u=[];for(const h of a.features){const{type:f,coordinates:y}=h.geometry;f==="Polygon"&&u.push(y),f==="MultiPolygon"&&u.push(...y)}if(u.length)return new Ms(a,{type:"MultiPolygon",coordinates:u})}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ms(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ms(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,a){const u=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(a.type==="Polygon"){const y=_o(a.coordinates,h,f),x=xo(n.geometry(),u,h,f);if(!gs(u,h))return!1;for(const M of x)if(!Xs(M,y))return!1}if(a.type==="MultiPolygon"){const y=yo(a.coordinates,h,f),x=xo(n.geometry(),u,h,f);if(!gs(u,h))return!1;for(const M of x)if(!fl(M,y))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,a){const u=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(a.type==="Polygon"){const y=_o(a.coordinates,h,f),x=bo(n.geometry(),u,h,f);if(!gs(u,h))return!1;for(const M of x)if(!pl(M,y))return!1}if(a.type==="MultiPolygon"){const y=yo(a.coordinates,h,f),x=bo(n.geometry(),u,h,f);if(!gs(u,h))return!1;for(const M of x)if(!fu(M,y))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ml=class{constructor(i=[],t=(n,a)=>n<a?-1:n>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,a=t[i];for(;i>0;){const u=i-1>>1,h=t[u];if(n(a,h)>=0)break;t[i]=h,i=u}t[i]=a}_down(i){const{data:t,compare:n}=this,a=this.length>>1,u=t[i];for(;i<a;){let h=1+(i<<1);const f=h+1;if(f<this.length&&n(t[f],t[h])<0&&(h=f),n(t[h],u)>=0)break;t[i]=t[h],i=h}t[i]=u}};function gl(i,t,n=0,a=i.length-1,u=ga){for(;a>n;){if(a-n>600){const x=a-n+1,M=t-n+1,L=Math.log(x),z=.5*Math.exp(2*L/3),F=.5*Math.sqrt(L*z*(x-z)/x)*(M-x/2<0?-1:1);gl(i,t,Math.max(n,Math.floor(t-M*z/x+F)),Math.min(a,Math.floor(t+(x-M)*z/x+F)),u)}const h=i[t];let f=n,y=a;for(ma(i,n,t),u(i[a],h)>0&&ma(i,n,a);f<y;){for(ma(i,f,y),f++,y--;u(i[f],h)<0;)f++;for(;u(i[y],h)>0;)y--}u(i[n],h)===0?ma(i,n,y):(y++,ma(i,y,a)),y<=t&&(n=y+1),t<=y&&(a=y-1)}}function ma(i,t,n){const a=i[t];i[t]=i[n],i[n]=a}function ga(i,t){return i<t?-1:i>t?1:0}function Ys(i,t){if(i.length<=1)return[i];const n=[];let a,u;for(const h of i){const f=pu(h);f!==0&&(h.area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(a&&n.push(a),a=[h]):a.push(h))}if(a&&n.push(a),t>1)for(let h=0;h<n.length;h++)n[h].length<=t||(gl(n[h],t,1,n[h].length-1,_l),n[h]=n[h].slice(0,t));return n}function _l(i,t){return t.area-i.area}function pu(i){let t=0;for(let n,a,u=0,h=i.length,f=h-1;u<h;f=u++)n=i[u],a=i[f],t+=(a.x-n.x)*(n.y+a.y);return t}const wo=1/298.257223563,Hs=wo*(2-wo),Io=Math.PI/180;class ja{constructor(t){const n=6378.137*Io*1e3,a=Math.cos(t*Io),u=1/(1-Hs*(1-a*a)),h=Math.sqrt(u);this.kx=n*h*a,this.ky=n*h*u*(1-Hs)}distance(t,n){const a=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(a*a+u*u)}pointOnLine(t,n){let a,u,h,f,y=1/0;for(let x=0;x<t.length-1;x++){let M=t[x][0],L=t[x][1],z=this.wrap(t[x+1][0]-M)*this.kx,F=(t[x+1][1]-L)*this.ky,j=0;z===0&&F===0||(j=(this.wrap(n[0]-M)*this.kx*z+(n[1]-L)*this.ky*F)/(z*z+F*F),j>1?(M=t[x+1][0],L=t[x+1][1]):j>0&&(M+=z/this.kx*j,L+=F/this.ky*j)),z=this.wrap(n[0]-M)*this.kx,F=(n[1]-L)*this.ky;const U=z*z+F*F;U<y&&(y=U,a=M,u=L,h=x,f=j)}return{point:[a,u],index:h,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function To(i,t){return t[0]-i[0]}function _a(i){return i[1]-i[0]+1}function Yr(i,t){return i[1]>=i[0]&&i[1]<t}function _s(i,t){if(i[0]>i[1])return[null,null];const n=_a(i);if(t){if(n===2)return[i,null];const u=Math.floor(n/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(n===1)return[i,null];const a=Math.floor(n/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function So(i,t){if(!Yr(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)ks(n,i[a]);return n}function Ga(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const a of n)ks(t,a);return t}function Ji(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function yr(i,t,n){if(!Ji(i)||!Ji(t))return NaN;let a=0,u=0;return i[2]<t[0]&&(a=t[0]-i[2]),i[0]>t[2]&&(a=i[0]-t[2]),i[1]>t[3]&&(u=i[1]-t[3]),i[3]<t[1]&&(u=t[1]-i[3]),n.distance([0,0],[a,u])}function m(i,t,n){const a=n.pointOnLine(t,i);return n.distance(i,a.point)}function s(i,t,n,a,u){const h=Math.min(m(i,[n,a],u),m(t,[n,a],u)),f=Math.min(m(n,[i,t],u),m(a,[i,t],u));return Math.min(h,f)}function l(i,t,n,a,u){if(!Yr(t,i.length)||!Yr(a,n.length))return 1/0;let h=1/0;for(let f=t[0];f<t[1];++f){const y=i[f],x=i[f+1];for(let M=a[0];M<a[1];++M){const L=n[M],z=n[M+1];if(pa(y,x,L,z))return 0;h=Math.min(h,s(y,x,L,z,u))}}return h}function p(i,t,n,a,u){if(!Yr(t,i.length)||!Yr(a,n.length))return NaN;let h=1/0;for(let f=t[0];f<=t[1];++f)for(let y=a[0];y<=a[1];++y)if(h=Math.min(h,u.distance(i[f],n[y])),h===0)return h;return h}function w(i,t,n){if(Xs(i,t,!0))return 0;let a=1/0;for(const u of t){const h=u[0],f=u[u.length-1];if(h!==f&&(a=Math.min(a,m(i,[f,h],n)),a===0))return a;const y=n.pointOnLine(u,i);if(a=Math.min(a,n.distance(i,y.point)),a===0)return a}return a}function D(i,t,n,a){if(!Yr(t,i.length))return NaN;for(let h=t[0];h<=t[1];++h)if(Xs(i[h],n,!0))return 0;let u=1/0;for(let h=t[0];h<t[1];++h){const f=i[h],y=i[h+1];for(const x of n)for(let M=0,L=x.length,z=L-1;M<L;z=M++){const F=x[z],j=x[M];if(pa(f,y,F,j))return 0;u=Math.min(u,s(f,y,F,j,a))}}return u}function B(i,t){for(const n of i)for(const a of n)if(Xs(a,t,!0))return!0;return!1}function Q(i,t,n,a=1/0){const u=Ga(i),h=Ga(t);if(a!==1/0&&yr(u,h,n)>=a)return a;if(gs(u,h)){if(B(i,t))return 0}else if(B(t,i))return 0;let f=1/0;for(const y of i)for(let x=0,M=y.length,L=M-1;x<M;L=x++){const z=y[L],F=y[x];for(const j of t)for(let U=0,H=j.length,rt=H-1;U<H;rt=U++){const ct=j[rt],It=j[U];if(pa(z,F,ct,It))return 0;f=Math.min(f,s(z,F,ct,It,n))}}return f}function ht(i,t,n,a,u,h){if(!h)return;const f=yr(So(a,h),u,n);f<t&&i.push([f,h,[0,0]])}function vt(i,t,n,a,u,h,f){if(!h||!f)return;const y=yr(So(a,h),So(u,f),n);y<t&&i.push([y,h,f])}function Yt(i,t,n,a,u=1/0){let h=Math.min(a.distance(i[0],n[0][0]),u);if(h===0)return h;const f=new ml([[0,[0,i.length-1],[0,0]]],To),y=Ga(n);for(;f.length>0;){const x=f.pop();if(x[0]>=h)continue;const M=x[1],L=t?50:100;if(_a(M)<=L){if(!Yr(M,i.length))return NaN;if(t){const z=D(i,M,n,a);if(isNaN(z)||z===0)return z;h=Math.min(h,z)}else for(let z=M[0];z<=M[1];++z){const F=w(i[z],n,a);if(h=Math.min(h,F),h===0)return 0}}else{const z=_s(M,t);ht(f,h,a,i,y,z[0]),ht(f,h,a,i,y,z[1])}}return h}function ne(i,t,n,a,u,h=1/0){let f=Math.min(h,u.distance(i[0],n[0]));if(f===0)return f;const y=new ml([[0,[0,i.length-1],[0,n.length-1]]],To);for(;y.length>0;){const x=y.pop();if(x[0]>=f)continue;const M=x[1],L=x[2],z=t?50:100,F=a?50:100;if(_a(M)<=z&&_a(L)<=F){if(!Yr(M,i.length)&&Yr(L,n.length))return NaN;let j;if(t&&a)j=l(i,M,n,L,u),f=Math.min(f,j);else if(t&&!a){const U=i.slice(M[0],M[1]+1);for(let H=L[0];H<=L[1];++H)if(j=m(n[H],U,u),f=Math.min(f,j),f===0)return f}else if(!t&&a){const U=n.slice(L[0],L[1]+1);for(let H=M[0];H<=M[1];++H)if(j=m(i[H],U,u),f=Math.min(f,j),f===0)return f}else j=p(i,M,n,L,u),f=Math.min(f,j)}else{const j=_s(M,t),U=_s(L,a);vt(y,f,u,i,n,j[0],U[0]),vt(y,f,u,i,n,j[0],U[1]),vt(y,f,u,i,n,j[1],U[0]),vt(y,f,u,i,n,j[1],U[1])}}return f}function Se(i){return i.type==="MultiPolygon"?i.coordinates.map((t=>({type:"Polygon",coordinates:t}))):i.type==="MultiLineString"?i.coordinates.map((t=>({type:"LineString",coordinates:t}))):i.type==="MultiPoint"?i.coordinates.map((t=>({type:"Point",coordinates:t}))):[i]}class Ve{constructor(t,n){this.type=ke,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if($r(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new Ve(a,a.features.map((u=>Se(u.geometry))).flat());if(a.type==="Feature")return new Ve(a,Se(a.geometry));if("type"in a&&"coordinates"in a)return new Ve(a,Se(a))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,a){const u=n.geometry(),h=u.flat().map((x=>Va([x.x,x.y],n.canonical)));if(u.length===0)return NaN;const f=new ja(h[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,ne(h,!1,[x.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,ne(h,!1,x.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Yt(h,!1,x.coordinates,f,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,a){const u=n.geometry(),h=u.flat().map((x=>Va([x.x,x.y],n.canonical)));if(u.length===0)return NaN;const f=new ja(h[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,ne(h,!0,[x.coordinates],!1,f,y));break;case"LineString":y=Math.min(y,ne(h,!0,x.coordinates,!0,f,y));break;case"Polygon":y=Math.min(y,Yt(h,!0,x.coordinates,f,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,a){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const h=Ys(u,0).map((x=>x.map((M=>M.map((L=>Va([L.x,L.y],n.canonical))))))),f=new ja(h[0][0][0][1]);let y=1/0;for(const x of a)for(const M of h){switch(x.type){case"Point":y=Math.min(y,Yt([x.coordinates],!1,M,f,y));break;case"LineString":y=Math.min(y,Yt(x.coordinates,!0,M,f,y));break;case"Polygon":y=Math.min(y,Q(M,x.coordinates,f,y))}if(y===0)return y}return y})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class $e{constructor(t){this.type=rn,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=t[1];return a==null?n.error("Global state property must be defined."):typeof a!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new $e(a)}evaluate(t){var n;const a=(n=t.globals)===null||n===void 0?void 0:n.globalState;return a&&Object.keys(a).length!==0?Ur(a,this.key):null}eachChild(){}outputDefined(){return!1}}const tn={"==":ca,"!=":fo,">":mo,"<":po,">=":ha,"<=":Ws,array:Xi,at:kr,boolean:Xi,case:Xr,coalesce:$s,collator:Qn,format:bi,image:Es,in:Fi,"index-of":_r,interpolate:zi,"interpolate-hcl":zi,"interpolate-lab":zi,length:fa,let:dn,literal:is,match:Fa,number:Xi,"number-format":da,object:Xi,slice:qs,step:Zs,string:Xi,"to-boolean":Er,"to-color":Er,"to-number":Er,"to-string":Er,var:rs,within:Ms,distance:Ve,"global-state":$e};class fn{constructor(t,n,a,u){this.name=t,this.type=n,this._evaluate=a,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const a=t[0],u=fn.definitions[a];if(!u)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=f.filter((([M])=>!Array.isArray(M)||M.length===t.length-1));let x=null;for(const[M,L]of y){x=new Ss(n.registry,Hr,n.path,null,n.scope);const z=[];let F=!1;for(let j=1;j<t.length;j++){const U=t[j],H=Array.isArray(M)?M[j-1]:M.type,rt=x.parse(U,1+z.length,H);if(!rt){F=!0;break}z.push(rt)}if(!F)if(Array.isArray(M)&&M.length!==z.length)x.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let j=0;j<z.length;j++){const U=Array.isArray(M)?M[j]:M.type,H=z[j];x.concat(j+1).checkSubtype(U,H.type)}if(x.errors.length===0)return new fn(a,h,L,z)}}if(y.length===1)n.errors.push(...x.errors);else{const M=(y.length?y:f).map((([z])=>{return F=z,Array.isArray(F)?`(${F.map(Dn).join(", ")})`:`(${Dn(F.type)}...)`;var F})).join(" | "),L=[];for(let z=1;z<t.length;z++){const F=n.parse(t[z],1+L.length);if(!F)return null;L.push(Dn(F.type))}n.error(`Expected arguments of type ${M}, but found (${L.join(", ")}) instead.`)}return null}static register(t,n){fn.definitions=n;for(const a in n)t[a]=fn}}function Sn(i,[t,n,a,u]){t=t.evaluate(i),n=n.evaluate(i),a=a.evaluate(i);const h=u?u.evaluate(i):1,f=Sr(t,n,a,h);if(f)throw new On(f);return new un(t/255,n/255,a/255,h,!1)}function Bn(i,t){return i in t}function wi(i,t){const n=t[i];return n===void 0?null:n}function ni(i){return{type:i}}function Hr(i){if(i instanceof rs)return Hr(i.boundExpression);if(i instanceof fn&&i.name==="error"||i instanceof Qn||i instanceof Ms||i instanceof Ve||i instanceof $e)return!1;const t=i instanceof Er||i instanceof Xi;let n=!0;return i.eachChild((a=>{n=t?n&&Hr(a):n&&a instanceof is})),!!n&&ys(i)&&ya(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ys(i){if(i instanceof fn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ms||i instanceof Ve)return!1;let t=!0;return i.eachChild((n=>{t&&!ys(n)&&(t=!1)})),t}function Ks(i){if(i instanceof fn&&i.name==="feature-state")return!1;let t=!0;return i.eachChild((n=>{t&&!Ks(n)&&(t=!1)})),t}function ya(i,t){if(i instanceof fn&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((a=>{n&&!ya(a,t)&&(n=!1)})),n}function Eo(i){return{result:"success",value:i}}function Ps(i){return{result:"error",value:i}}function Cs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ko(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function va(i){return!!i.expression&&i.expression.interpolated}function gn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function yl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Un(i)===Kn}function Gh(i){return i}function yc(i,t){const n=i.stops&&typeof i.stops[0][0]=="object",a=n||!(n||i.property!==void 0),u=i.type||(va(t)?"exponential":"interval"),h=(function(L){switch(L.type){case"color":return un.parse;case"padding":return yi.parse;case"numberArray":return Oi.parse;case"colorArray":return vi.parse;default:return null}})(t);if(h&&((i=Gn({},i)).stops&&(i.stops=i.stops.map((L=>[L[0],h(L[1])]))),i.default=h(i.default?i.default:t.default)),i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;const y=(function(L){switch(L){case"exponential":return vc;case"interval":return Uh;case"categorical":return mu;case"identity":return qh;default:throw new Error(`Unknown function type "${L}"`)}})(u);let x,M;if(u==="categorical"){x=Object.create(null);for(const L of i.stops)x[L[0]]=L[1];M=typeof i.stops[0][0]}if(n){const L={},z=[];for(let U=0;U<i.stops.length;U++){const H=i.stops[U],rt=H[0].zoom;L[rt]===void 0&&(L[rt]={zoom:rt,type:i.type,property:i.property,default:i.default,stops:[]},z.push(rt)),L[rt].stops.push([H[0].value,H[1]])}const F=[];for(const U of z)F.push([L[U].zoom,yc(L[U],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:zi.interpolationFactor.bind(void 0,j),zoomStops:F.map((U=>U[0])),evaluate:({zoom:U},H)=>vc({stops:F,base:i.base},t,U).evaluate(U,H)}}if(a){const L=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:zi.interpolationFactor.bind(void 0,L),zoomStops:i.stops.map((z=>z[0])),evaluate:({zoom:z})=>y(i,t,z,x,M)}}return{kind:"source",evaluate(L,z){const F=z&&z.properties?z.properties[i.property]:void 0;return F===void 0?Mo(i.default,t.default):y(i,t,F,x,M)}}}function Mo(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function mu(i,t,n,a,u){return Mo(typeof n===u?a[n]:void 0,i.default,t.default)}function Uh(i,t,n){if(gn(n)!=="number")return Mo(i.default,t.default);const a=i.stops.length;if(a===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[a-1][0])return i.stops[a-1][1];const u=ss(i.stops.map((h=>h[0])),n);return i.stops[u][1]}function vc(i,t,n){const a=i.base!==void 0?i.base:1;if(gn(n)!=="number")return Mo(i.default,t.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const h=ss(i.stops.map((L=>L[0])),n),f=(function(L,z,F,j){const U=j-F,H=L-F;return U===0?0:z===1?H/U:(Math.pow(z,H)-1)/(Math.pow(z,U)-1)})(n,a,i.stops[h][0],i.stops[h+1][0]),y=i.stops[h][1],x=i.stops[h+1][1],M=Cr[t.type]||Gh;return typeof y.evaluate=="function"?{evaluate(...L){const z=y.evaluate.apply(void 0,L),F=x.evaluate.apply(void 0,L);if(z!==void 0&&F!==void 0)return M(z,F,f,i.colorSpace)}}:M(y,x,f,i.colorSpace)}function qh(i,t,n){switch(t.type){case"color":n=un.parse(n);break;case"formatted":n=Cn.fromString(n.toString());break;case"resolvedImage":n=Wi.fromString(n.toString());break;case"padding":n=yi.parse(n);break;case"colorArray":n=vi.parse(n);break;case"numberArray":n=Oi.parse(n);break;default:gn(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Mo(n,i.default,t.default)}fn.register(tn,{error:[{kind:"error"},[je],(i,[t])=>{throw new On(t.evaluate(i))}],typeof:[je,[rn],(i,[t])=>Dn(Un(t.evaluate(i)))],"to-rgba":[qi(ke,4),[Pi],(i,[t])=>{const[n,a,u,h]=t.evaluate(i).rgb;return[255*n,255*a,255*u,h]}],rgb:[Pi,[ke,ke,ke],Sn],rgba:[Pi,[ke,ke,ke,ke],Sn],has:{type:Qe,overloads:[[[je],(i,[t])=>Bn(t.evaluate(i),i.properties())],[[je,Kn],(i,[t,n])=>Bn(t.evaluate(i),n.evaluate(i))]]},get:{type:rn,overloads:[[[je],(i,[t])=>wi(t.evaluate(i),i.properties())],[[je,Kn],(i,[t,n])=>wi(t.evaluate(i),n.evaluate(i))]]},"feature-state":[rn,[je],(i,[t])=>wi(t.evaluate(i),i.featureState||{})],properties:[Kn,[],i=>i.properties()],"geometry-type":[je,[],i=>i.geometryType()],id:[rn,[],i=>i.id()],zoom:[ke,[],i=>i.globals.zoom],"heatmap-density":[ke,[],i=>i.globals.heatmapDensity||0],elevation:[ke,[],i=>i.globals.elevation||0],"line-progress":[ke,[],i=>i.globals.lineProgress||0],accumulated:[rn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ke,ni(ke),(i,t)=>{let n=0;for(const a of t)n+=a.evaluate(i);return n}],"*":[ke,ni(ke),(i,t)=>{let n=1;for(const a of t)n*=a.evaluate(i);return n}],"-":{type:ke,overloads:[[[ke,ke],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[ke],(i,[t])=>-t.evaluate(i)]]},"/":[ke,[ke,ke],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[ke,[ke,ke],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[ke,[ke],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[ke,[ke],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[ke,[ke],(i,[t])=>Math.log(t.evaluate(i))],log2:[ke,[ke],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[ke,[ke],(i,[t])=>Math.sin(t.evaluate(i))],cos:[ke,[ke],(i,[t])=>Math.cos(t.evaluate(i))],tan:[ke,[ke],(i,[t])=>Math.tan(t.evaluate(i))],asin:[ke,[ke],(i,[t])=>Math.asin(t.evaluate(i))],acos:[ke,[ke],(i,[t])=>Math.acos(t.evaluate(i))],atan:[ke,[ke],(i,[t])=>Math.atan(t.evaluate(i))],min:[ke,ni(ke),(i,t)=>Math.min(...t.map((n=>n.evaluate(i))))],max:[ke,ni(ke),(i,t)=>Math.max(...t.map((n=>n.evaluate(i))))],abs:[ke,[ke],(i,[t])=>Math.abs(t.evaluate(i))],round:[ke,[ke],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[ke,[ke],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[ke,[ke],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Qe,[je,rn],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[Qe,[rn],(i,[t])=>i.id()===t.value],"filter-type-==":[Qe,[je],(i,[t])=>i.geometryType()===t.value],"filter-<":[Qe,[je,rn],(i,[t,n])=>{const a=i.properties()[t.value],u=n.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Qe,[rn],(i,[t])=>{const n=i.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[Qe,[je,rn],(i,[t,n])=>{const a=i.properties()[t.value],u=n.value;return typeof a==typeof u&&a>u}],"filter-id->":[Qe,[rn],(i,[t])=>{const n=i.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[Qe,[je,rn],(i,[t,n])=>{const a=i.properties()[t.value],u=n.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Qe,[rn],(i,[t])=>{const n=i.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[Qe,[je,rn],(i,[t,n])=>{const a=i.properties()[t.value],u=n.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Qe,[rn],(i,[t])=>{const n=i.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[Qe,[rn],(i,[t])=>t.value in i.properties()],"filter-has-id":[Qe,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Qe,[qi(je)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Qe,[qi(rn)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Qe,[je,qi(rn)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Qe,[je,qi(rn)],(i,[t,n])=>(function(a,u,h,f){for(;h<=f;){const y=h+f>>1;if(u[y]===a)return!0;u[y]>a?f=y-1:h=y+1}return!1})(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Qe,overloads:[[[Qe,Qe],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[ni(Qe),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Qe,overloads:[[[Qe,Qe],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[ni(Qe),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[Qe,[Qe],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Qe,[je],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[je,[je],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[je,[je],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[je,ni(rn),(i,t)=>t.map((n=>Wr(n.evaluate(i)))).join("")],"resolved-locale":[je,[mr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class vl{constructor(t,n,a){this.expression=t,this._warningHistory={},this._evaluator=new mn,this._defaultValue=n?(function(u){if(u.type==="color"&&yl(u.default))return new un(0,0,0,0);switch(u.type){case"color":return un.parse(u.default)||null;case"padding":return yi.parse(u.default)||null;case"numberArray":return Oi.parse(u.default)||null;case"colorArray":return vi.parse(u.default)||null;case"variableAnchorOffsetCollection":return $i.parse(u.default)||null;case"projectionDefinition":return cn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=a}evaluateWithoutErrorHandling(t,n,a,u,h,f){return this._globalState&&(t=Ua(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,u,h,f){this._globalState&&(t=Ua(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new On(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function xl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in tn}function bl(i,t,n){const a=new Ss(tn,Hr,[],t?(function(h){const f={color:Pi,string:je,number:ke,enum:je,boolean:Qe,formatted:Fr,padding:Jn,numberArray:Is,colorArray:Tr,projectionDefinition:or,resolvedImage:es,variableAnchorOffsetCollection:Br};return h.type==="array"?qi(f[h.value]||rn,h.length):f[h.type]})(t):void 0),u=a.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Eo(new vl(u,t,n)):Ps(a.errors)}class xa{constructor(t,n,a){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Ks(n.expression),this.globalStateRefs=Sl(n.expression),this._globalState=a}evaluateWithoutErrorHandling(t,n,a,u,h,f){return this._globalState&&(t=Ua(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,a,u,h,f)}evaluate(t,n,a,u,h,f){return this._globalState&&(t=Ua(t,this._globalState)),this._styleExpression.evaluate(t,n,a,u,h,f)}}class wl{constructor(t,n,a,u,h){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Ks(n.expression),this.globalStateRefs=Sl(n.expression),this.interpolationType=u,this._globalState=h}evaluateWithoutErrorHandling(t,n,a,u,h,f){return this._globalState&&(t=Ua(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,a,u,h,f)}evaluate(t,n,a,u,h,f){return this._globalState&&(t=Ua(t,this._globalState)),this._styleExpression.evaluate(t,n,a,u,h,f)}interpolationFactor(t,n,a){return this.interpolationType?zi.interpolationFactor(this.interpolationType,t,n,a):0}}function xc(i,t,n){const a=bl(i,t,n);if(a.result==="error")return a;const u=a.value.expression,h=ys(u);if(!h&&!Cs(t))return Ps([new An("","data expressions not supported")]);const f=ya(u,["zoom"]);if(!f&&!ko(t))return Ps([new An("","zoom expressions not supported")]);const y=Tl(u);return y||f?y instanceof An?Ps([y]):y instanceof zi&&!va(t)?Ps([new An("",'"interpolate" expressions cannot be used with this property')]):Eo(y?new wl(h?"camera":"composite",a.value,y.labels,y instanceof zi?y.interpolation:void 0,n):new xa(h?"constant":"source",a.value,n)):Ps([new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Il{constructor(t,n){this._parameters=t,this._specification=n,Gn(this,yc(this._parameters,this._specification))}static deserialize(t){return new Il(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Tl(i){let t=null;if(i instanceof dn)t=Tl(i.result);else if(i instanceof $s){for(const n of i.args)if(t=Tl(n),t)break}else(i instanceof Zs||i instanceof zi)&&i.input instanceof fn&&i.input.name==="zoom"&&(t=i);return t instanceof An||i.eachChild((n=>{const a=Tl(n);a instanceof An?t=a:!t&&a?t=new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new An("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Sl(i,t=new Set){return i instanceof $e&&t.add(i.key),i.eachChild((n=>{Sl(n,t)})),t}function Ua(i,t){const{zoom:n,heatmapDensity:a,elevation:u,lineProgress:h,isSupportedScript:f,accumulated:y}=i??{};return{zoom:n,heatmapDensity:a,elevation:u,lineProgress:h,isSupportedScript:f,accumulated:y,globalState:t}}function El(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!El(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const bc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Po(i,t){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};El(i)||(i=Co(i));const n=bl(i,bc,t);if(n.result==="error")throw new Error(n.value.map((a=>`${a.key}: ${a.message}`)).join(", "));return{filter:(a,u,h)=>n.value.evaluate(a,u,{},h),needGeometry:gu(i),getGlobalStateRefs:()=>Sl(n.value.expression)}}function Zh(i,t){return i<t?-1:i>t?1:0}function gu(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(gu(i[t]))return!0;return!1}function Co(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?kl(i[1],i[2],"=="):t==="!="?Ml(kl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?kl(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(Co))):t==="all"?["all"].concat(i.slice(1).map(Co)):t==="none"?["all"].concat(i.slice(1).map(Co).map(Ml)):t==="in"?wc(i[1],i.slice(2)):t==="!in"?Ml(wc(i[1],i.slice(2))):t==="has"?Ic(i[1]):t!=="!has"||Ml(Ic(i[1]));var n}function kl(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function wc(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",i,["literal",t.sort(Zh)]]:["filter-in-small",i,["literal",t]]}}function Ic(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ml(i){return["!",i]}function _u(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const h of i)u+=`${_u(h)},`;return`${u}]`}const n=Object.keys(i).sort();let a="{";for(let u=0;u<n.length;u++)a+=`${JSON.stringify(n[u])}:${_u(i[n[u]])},`;return`${a}}`}function Tc(i){let t="";for(const n of Ut)t+=`/${_u(i[n])}`;return t}function yu(i){const t=i.value;return t?[new we(i.key,t,"constants have been deprecated as of v8")]:[]}function ii(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function As(i){if(Array.isArray(i))return i.map(As);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=As(i[n]);return t}return ii(i)}function vr(i){const t=i.key,n=i.value,a=i.valueSpec||{},u=i.objectElementValidators||{},h=i.style,f=i.styleSpec,y=i.validateSpec;let x=[];const M=gn(n);if(M!=="object")return[new we(t,n,`object expected, ${M} found`)];for(const L in n){const z=L.split(".")[0],F=Ur(a,z)||a["*"];let j;if(Ur(u,z))j=u[z];else if(Ur(a,z))j=y;else if(u["*"])j=u["*"];else{if(!a["*"]){x.push(new we(t,n[L],`unknown property "${L}"`));continue}j=y}x=x.concat(j({key:(t&&`${t}.`)+L,value:n[L],valueSpec:F,style:h,styleSpec:f,object:n,objectKey:L,validateSpec:y},n))}for(const L in a)u[L]||a[L].required&&a[L].default===void 0&&n[L]===void 0&&x.push(new we(t,n,`missing required property "${L}"`));return x}function Ao(i){const t=i.value,n=i.valueSpec,a=i.style,u=i.styleSpec,h=i.key,f=i.arrayElementValidator||i.validateSpec;if(gn(t)!=="array")return[new we(h,t,`array expected, ${gn(t)} found`)];if(n.length&&t.length!==n.length)return[new we(h,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new we(h,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values};u.$version<7&&(y.function=n.function),gn(n.value)==="object"&&(y=n.value);let x=[];for(let M=0;M<t.length;M++)x=x.concat(f({array:t,arrayIndex:M,value:t[M],valueSpec:y,validateSpec:i.validateSpec,style:a,styleSpec:u,key:`${h}[${M}]`}));return x}function ba(i){const t=i.key,n=i.value,a=i.valueSpec;let u=gn(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new we(t,n,`number expected, ${u} found`)]:"minimum"in a&&n<a.minimum?[new we(t,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new we(t,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function Sc(i){const t=i.valueSpec,n=ii(i.value.type);let a,u,h,f={};const y=n!=="categorical"&&i.value.property===void 0,x=!y,M=gn(i.value.stops)==="array"&&gn(i.value.stops[0])==="array"&&gn(i.value.stops[0][0])==="object",L=vr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(j){if(n==="identity")return[new we(j.key,j.value,'identity function may not have a "stops" property')];let U=[];const H=j.value;return U=U.concat(Ao({key:j.key,value:H,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:z})),gn(H)==="array"&&H.length===0&&U.push(new we(j.key,H,"array must have at least one stop")),U},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return n==="identity"&&y&&L.push(new we(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||L.push(new we(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!va(i.valueSpec)&&L.push(new we(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!Cs(i.valueSpec)?L.push(new we(i.key,i.value,"property functions not supported")):y&&!ko(i.valueSpec)&&L.push(new we(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!M||i.value.property!==void 0||L.push(new we(i.key,i.value,'"property" property is required')),L;function z(j){let U=[];const H=j.value,rt=j.key;if(gn(H)!=="array")return[new we(rt,H,`array expected, ${gn(H)} found`)];if(H.length!==2)return[new we(rt,H,`array length 2 expected, length ${H.length} found`)];if(M){if(gn(H[0])!=="object")return[new we(rt,H,`object expected, ${gn(H[0])} found`)];if(H[0].zoom===void 0)return[new we(rt,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new we(rt,H,"object stop key must have value")];if(h&&h>ii(H[0].zoom))return[new we(rt,H[0].zoom,"stop zoom values must appear in ascending order")];ii(H[0].zoom)!==h&&(h=ii(H[0].zoom),u=void 0,f={}),U=U.concat(vr({key:`${rt}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:ba,value:F}}))}else U=U.concat(F({key:`${rt}[0]`,value:H[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},H));return xl(As(H[1]))?U.concat([new we(`${rt}[1]`,H[1],"expressions are not allowed in function stops.")]):U.concat(j.validateSpec({key:`${rt}[1]`,value:H[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function F(j,U){const H=gn(j.value),rt=ii(j.value),ct=j.value!==null?j.value:U;if(a){if(H!==a)return[new we(j.key,ct,`${H} stop domain type must match previous stop domain type ${a}`)]}else a=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new we(j.key,ct,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&n!=="categorical"){let It=`number expected, ${H} found`;return Cs(t)&&n===void 0&&(It+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new we(j.key,ct,It)]}return n!=="categorical"||H!=="number"||isFinite(rt)&&Math.floor(rt)===rt?n!=="categorical"&&H==="number"&&u!==void 0&&rt<u?[new we(j.key,ct,"stop domain values must appear in ascending order")]:(u=rt,n==="categorical"&&rt in f?[new we(j.key,ct,"stop domain values must be unique")]:(f[rt]=!0,[])):[new we(j.key,ct,`integer expected, found ${rt}`)]}}function qa(i){const t=(i.expressionContext==="property"?xc:bl)(As(i.value),i.valueSpec);if(t.result==="error")return t.value.map((a=>new we(`${i.key}${a.key}`,i.value,a.message)));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new we(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ks(n))return[new we(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ks(n))return[new we(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ya(n,["zoom","feature-state"]))return[new we(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ys(n))return[new we(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vu(i){const t=i.key,n=i.value,a=gn(n);return a!=="string"?[new we(t,n,`color expected, ${a} found`)]:un.parse(String(n))?[]:[new we(t,n,`color expected, "${n}" found`)]}function Lo(i){const t=i.key,n=i.value,a=i.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(ii(n))===-1&&u.push(new we(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(ii(n))===-1&&u.push(new we(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function xu(i){return El(As(i.value))?qa(Gn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ec(i)}function Ec(i){const t=i.value,n=i.key;if(gn(t)!=="array")return[new we(n,t,`array expected, ${gn(t)} found`)];const a=i.styleSpec;let u,h=[];if(t.length<1)return[new we(n,t,"filter array must have at least 1 element")];switch(h=h.concat(Lo({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),ii(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ii(t[1])==="$type"&&h.push(new we(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&h.push(new we(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=gn(t[1]),u!=="string"&&h.push(new we(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let f=2;f<t.length;f++)u=gn(t[f]),ii(t[1])==="$type"?h=h.concat(Lo({key:`${n}[${f}]`,value:t[f],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&h.push(new we(`${n}[${f}]`,t[f],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)h=h.concat(Ec({key:`${n}[${f}]`,value:t[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=gn(t[1]),t.length!==2?h.push(new we(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&h.push(new we(`${n}[1]`,t[1],`string expected, ${u} found`))}return h}function bu(i,t){const n=i.key,a=i.validateSpec,u=i.style,h=i.styleSpec,f=i.value,y=i.objectKey,x=h[`${t}_${i.layerType}`];if(!x)return[];const M=y.match(/^(.*)-transition$/);if(t==="paint"&&M&&x[M[1]]&&x[M[1]].transition)return a({key:n,value:f,valueSpec:h.transition,style:u,styleSpec:h});const L=i.valueSpec||x[y];if(!L)return[new we(n,f,`unknown property "${y}"`)];let z;if(gn(f)==="string"&&Cs(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(f)))return[new we(n,f,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&y==="text-font"&&yl(As(f))&&ii(f.type)==="identity"&&F.push(new we(n,f,'"text-font" does not support identity functions')),F.concat(a({key:i.key,value:f,valueSpec:L,style:u,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:y}))}function wu(i){return bu(i,"paint")}function Do(i){return bu(i,"layout")}function kc(i){let t=[];const n=i.value,a=i.key,u=i.style,h=i.styleSpec;if(gn(n)!=="object")return[new we(a,n,`object expected, ${gn(n)} found`)];n.type||n.ref||t.push(new we(a,n,'either "type" or "ref" is required'));let f=ii(n.type);const y=ii(n.ref);if(n.id){const x=ii(n.id);for(let M=0;M<i.arrayIndex;M++){const L=u.layers[M];ii(L.id)===x&&t.push(new we(a,n.id,`duplicate layer id "${n.id}", previously used at line ${L.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach((M=>{M in n&&t.push(new we(a,n[M],`"${M}" is prohibited for ref layers`))})),u.layers.forEach((M=>{ii(M.id)===y&&(x=M)})),x?x.ref?t.push(new we(a,n.ref,"ref cannot reference another ref layer")):f=ii(x.type):t.push(new we(a,n.ref,`ref layer "${y}" not found`))}else if(f!=="background")if(n.source){const x=u.sources&&u.sources[n.source],M=x&&ii(x.type);x?M==="vector"&&f==="raster"?t.push(new we(a,n.source,`layer "${n.id}" requires a raster source`)):M!=="raster-dem"&&f==="hillshade"||M!=="raster-dem"&&f==="color-relief"?t.push(new we(a,n.source,`layer "${n.id}" requires a raster-dem source`)):M==="raster"&&f!=="raster"?t.push(new we(a,n.source,`layer "${n.id}" requires a vector source`)):M!=="vector"||n["source-layer"]?M==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?t.push(new we(a,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!n.paint||!n.paint["line-gradient"]||M==="geojson"&&x.lineMetrics||t.push(new we(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new we(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new we(a,n.source,`source "${n.source}" not found`))}else t.push(new we(a,n,'missing required property "source"'));return t=t.concat(vr({key:a,value:n,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:n.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:xu,layout:x=>vr({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":M=>Do(Gn({layerType:f},M))}}),paint:x=>vr({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":M=>wu(Gn({layerType:f},M))}})}})),t}function Js(i){const t=i.value,n=i.key,a=gn(t);return a!=="string"?[new we(n,t,`string expected, ${a} found`)]:[]}const Iu={promoteId:function({key:i,value:t}){if(gn(t)==="string")return Js({key:i,value:t});{const n=[];for(const a in t)n.push(...Js({key:`${i}.${a}`,value:t[a]}));return n}}};function Mc(i){const t=i.value,n=i.key,a=i.styleSpec,u=i.style,h=i.validateSpec;if(!t.type)return[new we(n,t,'"type" is required')];const f=ii(t.type);let y;switch(f){case"vector":case"raster":return y=vr({key:n,value:t,valueSpec:a[`source_${f.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Iu,validateSpec:h}),y;case"raster-dem":return y=(function(x){var M;const L=(M=x.sourceName)!==null&&M!==void 0?M:"",z=x.value,F=x.styleSpec,j=F.source_raster_dem,U=x.style;let H=[];const rt=gn(z);if(z===void 0)return H;if(rt!=="object")return H.push(new we("source_raster_dem",z,`object expected, ${rt} found`)),H;const ct=ii(z.encoding)==="custom",It=["redFactor","greenFactor","blueFactor","baseShift"],ft=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const _t in z)!ct&&It.includes(_t)?H.push(new we(_t,z[_t],`In "${L}": "${_t}" is only valid when "encoding" is set to "custom". ${ft} encoding found`)):j[_t]?H=H.concat(x.validateSpec({key:_t,value:z[_t],valueSpec:j[_t],validateSpec:x.validateSpec,style:U,styleSpec:F})):H.push(new we(_t,z[_t],`unknown property "${_t}"`));return H})({sourceName:n,value:t,style:i.style,styleSpec:a,validateSpec:h}),y;case"geojson":if(y=vr({key:n,value:t,valueSpec:a.source_geojson,style:u,styleSpec:a,validateSpec:h,objectElementValidators:Iu}),t.cluster)for(const x in t.clusterProperties){const[M,L]=t.clusterProperties[x],z=typeof M=="string"?[M,["accumulated"],["get",x]]:M;y.push(...qa({key:`${n}.${x}.map`,value:L,expressionContext:"cluster-map"})),y.push(...qa({key:`${n}.${x}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return y;case"video":return vr({key:n,value:t,valueSpec:a.source_video,style:u,validateSpec:h,styleSpec:a});case"image":return vr({key:n,value:t,valueSpec:a.source_image,style:u,validateSpec:h,styleSpec:a});case"canvas":return[new we(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lo({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Tu(i){const t=i.value,n=i.styleSpec,a=n.light,u=i.style;let h=[];const f=gn(t);if(t===void 0)return h;if(f!=="object")return h=h.concat([new we("light",t,`object expected, ${f} found`)]),h;for(const y in t){const x=y.match(/^(.*)-transition$/);h=h.concat(x&&a[x[1]]&&a[x[1]].transition?i.validateSpec({key:y,value:t[y],valueSpec:n.transition,validateSpec:i.validateSpec,style:u,styleSpec:n}):a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new we(y,t[y],`unknown property "${y}"`)])}return h}function Su(i){const t=i.value,n=i.styleSpec,a=n.sky,u=i.style,h=gn(t);if(t===void 0)return[];if(h!=="object")return[new we("sky",t,`object expected, ${h} found`)];let f=[];for(const y in t)f=f.concat(a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],style:u,styleSpec:n}):[new we(y,t[y],`unknown property "${y}"`)]);return f}function Za(i){const t=i.value,n=i.styleSpec,a=n.terrain,u=i.style;let h=[];const f=gn(t);if(t===void 0)return h;if(f!=="object")return h=h.concat([new we("terrain",t,`object expected, ${f} found`)]),h;for(const y in t)h=h.concat(a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new we(y,t[y],`unknown property "${y}"`)]);return h}function Pc(i){let t=[];const n=i.value,a=i.key;if(Array.isArray(n)){const u=[],h=[];for(const f in n)n[f].id&&u.includes(n[f].id)&&t.push(new we(a,n,`all the sprites' ids must be unique, but ${n[f].id} is duplicated`)),u.push(n[f].id),n[f].url&&h.includes(n[f].url)&&t.push(new we(a,n,`all the sprites' URLs must be unique, but ${n[f].url} is duplicated`)),h.push(n[f].url),t=t.concat(vr({key:`${a}[${f}]`,value:n[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Js({key:a,value:n})}function Cc(i){return t=i.value,t&&t.constructor===Object?[]:[new we(i.key,i.value,`object expected, ${gn(i.value)} found`)];var t}const Ac={"*":()=>[],array:Ao,boolean:function(i){const t=i.value,n=i.key,a=gn(t);return a!=="boolean"?[new we(n,t,`boolean expected, ${a} found`)]:[]},number:ba,color:vu,constants:yu,enum:Lo,filter:xu,function:Sc,layer:kc,object:vr,source:Mc,light:Tu,sky:Su,terrain:Za,projection:function(i){const t=i.value,n=i.styleSpec,a=n.projection,u=i.style,h=gn(t);if(t===void 0)return[];if(h!=="object")return[new we("projection",t,`object expected, ${h} found`)];let f=[];for(const y in t)f=f.concat(a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],style:u,styleSpec:n}):[new we(y,t[y],`unknown property "${y}"`)]);return f},projectionDefinition:function(i){const t=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const a=gn(n);return a!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(a)?[]:[new we(t,n,`projection expected, invalid type "${a}" found`)]:[new we(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Js,formatted:function(i){return Js(i).length===0?[]:qa(i)},resolvedImage:function(i){return Js(i).length===0?[]:qa(i)},padding:function(i){const t=i.key,n=i.value;if(gn(n)==="array"){if(n.length<1||n.length>4)return[new we(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const a={type:"number"};let u=[];for(let h=0;h<n.length;h++)u=u.concat(i.validateSpec({key:`${t}[${h}]`,value:n[h],validateSpec:i.validateSpec,valueSpec:a}));return u}return ba({key:t,value:n,valueSpec:{}})},numberArray:function(i){const t=i.key,n=i.value;if(gn(n)==="array"){const a={type:"number"};if(n.length<1)return[new we(t,n,"array length at least 1 expected, length 0 found")];let u=[];for(let h=0;h<n.length;h++)u=u.concat(i.validateSpec({key:`${t}[${h}]`,value:n[h],validateSpec:i.validateSpec,valueSpec:a}));return u}return ba({key:t,value:n,valueSpec:{}})},colorArray:function(i){const t=i.key,n=i.value;if(gn(n)==="array"){if(n.length<1)return[new we(t,n,"array length at least 1 expected, length 0 found")];let a=[];for(let u=0;u<n.length;u++)a=a.concat(vu({key:`${t}[${u}]`,value:n[u]}));return a}return vu({key:t,value:n})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,a=gn(n),u=i.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new we(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let f=0;f<n.length;f+=2)h=h.concat(Lo({key:`${t}[${f}]`,value:n[f],valueSpec:u.layout_symbol["text-anchor"]})),h=h.concat(Ao({key:`${t}[${f+1}]`,value:n[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return h},sprite:Pc,state:Cc};function Pl(i){const t=i.value,n=i.valueSpec,a=i.styleSpec;return i.validateSpec=Pl,n.expression&&yl(ii(t))?Sc(i):n.expression&&xl(As(t))?qa(i):n.type&&Ac[n.type]?Ac[n.type](i):vr(Gn({},i,{valueSpec:n.type?a[n.type]:n}))}function Lc(i){const t=i.value,n=i.key,a=Js(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new we(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new we(n,t,'"glyphs" url must include a "{range}" token'))),a}function Kr(i,t=pt){let n=[];return n=n.concat(Pl({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Pl,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),i.constants&&(n=n.concat(yu({key:"constants",value:i.constants}))),$a(n)}function lr(i){return function(t){return i(Object.assign({},t,{validateSpec:Pl}))}}function $a(i){return[].concat(i).sort(((t,n)=>t.line-n.line))}function ui(i){return function(...t){return $a(i.apply(this,t))}}Kr.source=ui(lr(Mc)),Kr.sprite=ui(lr(Pc)),Kr.glyphs=ui(lr(Lc)),Kr.light=ui(lr(Tu)),Kr.sky=ui(lr(Su)),Kr.terrain=ui(lr(Za)),Kr.state=ui(lr(Cc)),Kr.layer=ui(lr(kc)),Kr.filter=ui(lr(xu)),Kr.paintProperty=ui(lr(wu)),Kr.layoutProperty=ui(lr(Do));const Ro=pt,wa=Kr,$h=wa.light,Wh=wa.sky,zo=wa.paintProperty,Dc=wa.layoutProperty;function Cl(i,t){let n=!1;if(t&&t.length)for(const a of t)i.fire(new Rt(new Error(a.message))),n=!0;return n}class No{constructor(t,n,a){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(n=f[1])+2*(a=f[2]);for(let x=0;x<this.d*this.d;x++){const M=f[3+x],L=f[3+x+1];u.push(M===L?null:f.subarray(M,L))}const y=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],y),this.bboxes=f.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let f=0;f<this.d*this.d;f++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=a,this.scale=n/t,this.uid=0;const h=a/n*t;this.min=-h,this.max=t+h}insert(t,n,a,u,h){this._forEachCell(n,a,u,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,a,u,h,f){this.cells[h].push(f)}query(t,n,a,u,h){const f=this.min,y=this.max;if(t<=f&&n<=f&&y<=a&&y<=u&&!h)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,a,u,this._queryCell,x,{},h),x}}_queryCell(t,n,a,u,h,f,y,x){const M=this.cells[h];if(M!==null){const L=this.keys,z=this.bboxes;for(let F=0;F<M.length;F++){const j=M[F];if(y[j]===void 0){const U=4*j;(x?x(z[U+0],z[U+1],z[U+2],z[U+3]):t<=z[U+2]&&n<=z[U+3]&&a>=z[U+0]&&u>=z[U+1])?(y[j]=!0,f.push(L[j])):y[j]=!1}}}}_forEachCell(t,n,a,u,h,f,y,x){const M=this._convertToCellCoord(t),L=this._convertToCellCoord(n),z=this._convertToCellCoord(a),F=this._convertToCellCoord(u);for(let j=M;j<=z;j++)for(let U=L;U<=F;U++){const H=this.d*U+j;if((!x||x(this._convertFromCellCoord(j),this._convertFromCellCoord(U),this._convertFromCellCoord(j+1),this._convertFromCellCoord(U+1)))&&h.call(this,t,n,a,u,H,f,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let a=0;for(let f=0;f<this.cells.length;f++)a+=this.cells[f].length;const u=new Int32Array(n+a+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let h=n;for(let f=0;f<t.length;f++){const y=t[f];u[3+f]=h,u.set(y,h),h+=y.length}return u[3+t.length]=h,u.set(this.keys,h),h+=this.keys.length,u[3+t.length+1]=h,u.set(this.bboxes,h),h+=this.bboxes.length,u.buffer}static serialize(t,n){const a=t.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(t){return new No(t.buffer)}}const os={};function Ue(i,t,n={}){if(os[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),os[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ue("Object",Object),Ue("Set",Set),Ue("TransferableGridIndex",No),Ue("Color",un),Ue("Error",Error),Ue("AJAXError",yn),Ue("ResolvedImage",Wi),Ue("StylePropertyFunction",Il),Ue("StyleExpression",vl,{omit:["_evaluator"]}),Ue("ZoomDependentExpression",wl),Ue("ZoomConstantExpression",xa),Ue("CompoundExpression",fn,{omit:["_evaluate"]});for(const i in tn)tn[i]._classRegistryKey||Ue(`Expression_${i}`,tn[i]);function Wa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Eu(i){return i.$name||i.constructor._classRegistryKey}function Rc(i){return!(function(t){if(t===null||typeof t!="object")return!1;const n=Eu(t);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Wa(i)||bt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Oo(i,t){if(Rc(i))return(Wa(i)||bt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const h=[];for(const f of i)h.push(Oo(f,t));return h}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Eu(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!os[n])throw new Error(`${n} is not registered.`);const{klass:a}=os[n],u=a.serialize?a.serialize(i,t):{};if(a.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||os[n].omit.indexOf(h)>=0)continue;const f=i[h];u[h]=os[n].shallow.indexOf(h)>=0?f:Oo(f,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function Ls(i){if(Rc(i))return i;if(Array.isArray(i))return i.map(Ls);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Eu(i)||"Object";if(!os[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=os[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const a=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const h=i[u];a[u]=os[t].shallow.indexOf(u)>=0?h:Ls(h)}return a}class ku{constructor(){this.first=!0}update(t,n){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}function Xh(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Xa(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function zc(i){return/\s/u.test(String.fromCodePoint(i))}function Fo(i){for(const t of i)if(Xa(t.codePointAt(0)))return!0;return!1}function Al(i){for(const t of i)if(!Oc(t.codePointAt(0)))return!1;return!0}function Mu(i){const t=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const Nc=Mu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Oc(i){return!Nc.test(String.fromCodePoint(i))}function Pu(i){return!(Xa(i)||(t=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}const Cu=Mu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Au(i){return Cu.test(String.fromCodePoint(i))}function Yh(i,t){return!(!t&&Au(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Fc(i){for(const t of i)if(Au(t.codePointAt(0)))return!0;return!1}const Qs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Qs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,t){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,a=new Promise((h=>{this.loadScriptResolve=h}));t(n);const u=new Promise((h=>setTimeout((()=>h()),this.TIMEOUT)));if(yield Promise.race([a,u]),this.isParsed()){const h={pluginStatus:"loaded",pluginURL:n};return this.setState(h),h}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class qn{constructor(t,n){this.isSupportedScript=Hh,this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new ku,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ku,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}function Hh(i){return(function(t,n){for(const a of t)if(!Yh(a.codePointAt(0),n))return!1;return!0})(i,Qs.getRTLTextPluginStatus()==="loaded")}const Bo="-transition";class Vo{constructor(t,n,a){this.property=t,this.value=n,this.expression=(function(u,h,f){if(yl(u))return new Il(u,h);if(xl(u)){const y=xc(u,h,f);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return h.type==="color"&&typeof u=="string"?y=un.parse(u):h.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?h.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?h.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=$i.parse(u):h.type==="projectionDefinition"&&typeof u=="string"&&(y=cn.parse(u)):y=vi.parse(u):y=Oi.parse(u):y=yi.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(n===void 0?t.specification.default:n,t.specification,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class Lu{constructor(t,n){this.property=t,this.value=new Vo(t,void 0,n)}transitioned(t,n){return new Du(this.property,this.value,n,Gt({},t.transition,this.transition),t.now)}untransitioned(){return new Du(this.property,this.value,null,{},0)}}class Bc{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=n}getValue(t){return Dt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Lu(this._values[t].property,this._globalState)),this._values[t].value=new Vo(this._values[t].property,n===null?void 0:Dt(n),this._globalState)}getTransition(t){return Dt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Lu(this._values[t].property,this._globalState)),this._values[t].transition=Dt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(t[n]=a);const u=this.getTransition(n);u!==void 0&&(t[`${n}${Bo}`]=u)}return t}transitioned(t,n){const a=new Ru(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(t,n._values[u]);return a}untransitioned(){const t=new Ru(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Du{constructor(t,n,a,u,h){this.property=t,this.value=n,this.begin=h+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){const u=t.now||0,h=this.value.possiblyEvaluate(t,n,a),f=this.prior;if(f){if(u>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(u<this.begin)return f.possiblyEvaluate(t,n,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,n,a),h,Ge(y))}}return h}}class Ru{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){const u=new Ia(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(t,n,a);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Vc{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=n}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Dt(this._values[t].value)}setValue(t,n){this._values[t]=new Vo(this._values[t].property,n===null?void 0:Dt(n),this._globalState)}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){const u=new Ia(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(t,n,a);return u}}class ls{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,a,u){return this.property.evaluate(this.value,this.parameters,t,n,a,u)}}class Ia{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class We{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,a){const u=Cr[this.specification.type];return u?u(t,n,a):t}}class en{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,u){return new ls(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},a,u)}:t.expression,n)}interpolate(t,n,a){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new ls(this,{kind:"constant",value:void 0},t.parameters);const u=Cr[this.specification.type];if(u){const h=u(t.value.value,n.value.value,a);return new ls(this,{kind:"constant",value:h},t.parameters)}return t}evaluate(t,n,a,u,h,f){return t.kind==="constant"?t.value:t.evaluate(n,a,u,h,f)}}class jo extends en{possiblyEvaluate(t,n,a,u){if(t.value===void 0)return new ls(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const h=t.expression.evaluate(n,null,{},a,u),f=t.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,y=this._calculate(f,f,f,n);return new ls(this,{kind:"constant",value:y},n)}if(t.expression.kind==="camera"){const h=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new ls(this,{kind:"constant",value:h},n)}return new ls(this,t.expression,n)}evaluate(t,n,a,u,h,f){if(t.kind==="source"){const y=t.evaluate(n,a,u,h,f);return this._calculate(y,y,y,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},a,u),t.evaluate({zoom:Math.floor(n.zoom)},a,u),t.evaluate({zoom:Math.floor(n.zoom)+1},a,u),n):t.value}_calculate(t,n,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class jc{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const h=t.expression.evaluate(n,null,{},a,u);return this._calculate(h,h,h,n)}return this._calculate(t.expression.evaluate(new qn(Math.floor(n.zoom-1),n)),t.expression.evaluate(new qn(Math.floor(n.zoom),n)),t.expression.evaluate(new qn(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class Go{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,u){return!!t.expression.evaluate(n,null,{},a,u)}interpolate(){return!1}}class Qi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const a=t[n];a.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Vo(a,void 0,void 0),h=this.defaultTransitionablePropertyValues[n]=new Lu(a,void 0);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}Ue("DataDrivenProperty",en),Ue("DataConstantProperty",We),Ue("CrossFadedDataDrivenProperty",jo),Ue("CrossFadedProperty",jc),Ue("ColorRampProperty",Go);class Jr extends $t{constructor(t,n,a){if(super(),this.id=t.id,this.type=t.type,this._globalState=a,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Po(t.filter,a)),n.layout&&(this._unevaluatedLayout=new Vc(n.layout,a)),n.paint)){this._transitionablePaint=new Bc(n.paint,a);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ia(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=Po(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const a=this._unevaluatedLayout._values[n];for(const u of a.getGlobalStateRefs())t.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}getPaintAffectingGlobalStateRefs(){var t;const n=new globalThis.Map;if(this._transitionablePaint)for(const a in this._transitionablePaint._values){const u=this._transitionablePaint._values[a].value;for(const h of u.getGlobalStateRefs()){const f=(t=n.get(h))!==null&&t!==void 0?t:[];f.push({name:a,value:u.value}),n.set(h,f)}}return n}setLayoutProperty(t,n,a={}){n!=null&&this._validate(Dc,`layers.${this.id}.layout.${t}`,t,n,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Bo)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(n!=null&&this._validate(zo,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(t.endsWith(Bo))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],h=u.property.specification["property-type"]==="cross-faded-data-driven",f=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||f||h||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t,n=!1){return!!(this.minzoom&&t<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Be(t,((n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length)))}_validate(t,n,a,u,h={}){return(!h||h.validate!==!1)&&Cl(this,t.call(wa,{key:n,layerType:this.type,objectKey:a,value:u,styleSpec:pt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof ls&&Cs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Gc;var Kh={get paint(){return Gc=Gc||new Qi({"raster-opacity":new We(pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new We(pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new We(pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new We(pt.paint_raster["raster-brightness-max"]),"raster-saturation":new We(pt.paint_raster["raster-saturation"]),"raster-contrast":new We(pt.paint_raster["raster-contrast"]),"raster-resampling":new We(pt.paint_raster["raster-resampling"]),"raster-fade-duration":new We(pt.paint_raster["raster-fade-duration"])})}};class Jh extends Jr{constructor(t,n){super(t,Kh,n)}}const Qh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Uo{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function pi(i,t=1){let n=0,a=0;return{members:i.map((u=>{const h=Qh[u.type].BYTES_PER_ELEMENT,f=n=Uc(n,Math.max(t,h)),y=u.components||1;return a=Math.max(a,h),n+=h*y,{name:u.name,type:u.type,components:y,offset:f}})),size:Uc(n,Math.max(a,t)),alignment:t}}function Uc(i,t){return Math.ceil(i/t)*t}class qo extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=a,t}}qo.prototype.bytesPerElement=4,Ue("StructArrayLayout2i4",qo);class Zo extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const h=3*t;return this.int16[h+0]=n,this.int16[h+1]=a,this.int16[h+2]=u,t}}Zo.prototype.bytesPerElement=6,Ue("StructArrayLayout3i6",Zo);class zu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,a,u)}emplace(t,n,a,u,h){const f=4*t;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=u,this.int16[f+3]=h,t}}zu.prototype.bytesPerElement=8,Ue("StructArrayLayout4i8",zu);class Nu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,h,f)}emplace(t,n,a,u,h,f,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=u,this.int16[x+3]=h,this.int16[x+4]=f,this.int16[x+5]=y,t}}Nu.prototype.bytesPerElement=12,Ue("StructArrayLayout2i4i12",Nu);class Ds extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,h,f)}emplace(t,n,a,u,h,f,y){const x=4*t,M=8*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.uint8[M+4]=u,this.uint8[M+5]=h,this.uint8[M+6]=f,this.uint8[M+7]=y,t}}Ds.prototype.bytesPerElement=8,Ue("StructArrayLayout2i4ub8",Ds);class Ya extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=a,t}}Ya.prototype.bytesPerElement=8,Ue("StructArrayLayout2f8",Ya);class $o extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f,y,x,M,L){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,a,u,h,f,y,x,M,L)}emplace(t,n,a,u,h,f,y,x,M,L,z){const F=10*t;return this.uint16[F+0]=n,this.uint16[F+1]=a,this.uint16[F+2]=u,this.uint16[F+3]=h,this.uint16[F+4]=f,this.uint16[F+5]=y,this.uint16[F+6]=x,this.uint16[F+7]=M,this.uint16[F+8]=L,this.uint16[F+9]=z,t}}$o.prototype.bytesPerElement=20,Ue("StructArrayLayout10ui20",$o);class Ll extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f,y,x){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,a,u,h,f,y,x)}emplace(t,n,a,u,h,f,y,x,M){const L=8*t;return this.uint16[L+0]=n,this.uint16[L+1]=a,this.uint16[L+2]=u,this.uint16[L+3]=h,this.uint16[L+4]=f,this.uint16[L+5]=y,this.uint16[L+6]=x,this.uint16[L+7]=M,t}}Ll.prototype.bytesPerElement=16,Ue("StructArrayLayout8ui16",Ll);class Wo extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f,y,x,M,L,z,F){const j=this.length;return this.resize(j+1),this.emplace(j,t,n,a,u,h,f,y,x,M,L,z,F)}emplace(t,n,a,u,h,f,y,x,M,L,z,F,j){const U=12*t;return this.int16[U+0]=n,this.int16[U+1]=a,this.int16[U+2]=u,this.int16[U+3]=h,this.uint16[U+4]=f,this.uint16[U+5]=y,this.uint16[U+6]=x,this.uint16[U+7]=M,this.int16[U+8]=L,this.int16[U+9]=z,this.int16[U+10]=F,this.int16[U+11]=j,t}}Wo.prototype.bytesPerElement=24,Ue("StructArrayLayout4i4ui4i24",Wo);class Ou extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const h=3*t;return this.float32[h+0]=n,this.float32[h+1]=a,this.float32[h+2]=u,t}}Ou.prototype.bytesPerElement=12,Ue("StructArrayLayout3f12",Ou);class Ha extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Ha.prototype.bytesPerElement=4,Ue("StructArrayLayout1ul4",Ha);class Ta extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f,y,x,M){const L=this.length;return this.resize(L+1),this.emplace(L,t,n,a,u,h,f,y,x,M)}emplace(t,n,a,u,h,f,y,x,M,L){const z=10*t,F=5*t;return this.int16[z+0]=n,this.int16[z+1]=a,this.int16[z+2]=u,this.int16[z+3]=h,this.int16[z+4]=f,this.int16[z+5]=y,this.uint32[F+3]=x,this.uint16[z+8]=M,this.uint16[z+9]=L,t}}Ta.prototype.bytesPerElement=20,Ue("StructArrayLayout6i1ul2ui20",Ta);class Fu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,h,f)}emplace(t,n,a,u,h,f,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=u,this.int16[x+3]=h,this.int16[x+4]=f,this.int16[x+5]=y,t}}Fu.prototype.bytesPerElement=12,Ue("StructArrayLayout2i2i2i12",Fu);class Dl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,a,u,h)}emplace(t,n,a,u,h,f){const y=4*t,x=8*t;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[x+6]=h,this.int16[x+7]=f,t}}Dl.prototype.bytesPerElement=16,Ue("StructArrayLayout2f1f2i16",Dl);class Sa extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,u,h,f)}emplace(t,n,a,u,h,f,y){const x=16*t,M=4*t,L=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=a,this.float32[M+1]=u,this.float32[M+2]=h,this.int16[L+6]=f,this.int16[L+7]=y,t}}Sa.prototype.bytesPerElement=16,Ue("StructArrayLayout2ub2f2i16",Sa);class Rl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const h=3*t;return this.uint16[h+0]=n,this.uint16[h+1]=a,this.uint16[h+2]=u,t}}Rl.prototype.bytesPerElement=6,Ue("StructArrayLayout3ui6",Rl);class Bu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct){const It=this.length;return this.resize(It+1),this.emplace(It,t,n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct)}emplace(t,n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct,It){const ft=24*t,_t=12*t,Bt=48*t;return this.int16[ft+0]=n,this.int16[ft+1]=a,this.uint16[ft+2]=u,this.uint16[ft+3]=h,this.uint32[_t+2]=f,this.uint32[_t+3]=y,this.uint32[_t+4]=x,this.uint16[ft+10]=M,this.uint16[ft+11]=L,this.uint16[ft+12]=z,this.float32[_t+7]=F,this.float32[_t+8]=j,this.uint8[Bt+36]=U,this.uint8[Bt+37]=H,this.uint8[Bt+38]=rt,this.uint32[_t+10]=ct,this.int16[ft+22]=It,t}}Bu.prototype.bytesPerElement=48,Ue("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bu);class zl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct,It,ft,_t,Bt,Vt,re,xe,pe,Ie,Fe,Ae){const Le=this.length;return this.resize(Le+1),this.emplace(Le,t,n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct,It,ft,_t,Bt,Vt,re,xe,pe,Ie,Fe,Ae)}emplace(t,n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct,It,ft,_t,Bt,Vt,re,xe,pe,Ie,Fe,Ae,Le){const me=32*t,He=16*t;return this.int16[me+0]=n,this.int16[me+1]=a,this.int16[me+2]=u,this.int16[me+3]=h,this.int16[me+4]=f,this.int16[me+5]=y,this.int16[me+6]=x,this.int16[me+7]=M,this.uint16[me+8]=L,this.uint16[me+9]=z,this.uint16[me+10]=F,this.uint16[me+11]=j,this.uint16[me+12]=U,this.uint16[me+13]=H,this.uint16[me+14]=rt,this.uint16[me+15]=ct,this.uint16[me+16]=It,this.uint16[me+17]=ft,this.uint16[me+18]=_t,this.uint16[me+19]=Bt,this.uint16[me+20]=Vt,this.uint16[me+21]=re,this.uint16[me+22]=xe,this.uint32[He+12]=pe,this.float32[He+13]=Ie,this.float32[He+14]=Fe,this.uint16[me+30]=Ae,this.uint16[me+31]=Le,t}}zl.prototype.bytesPerElement=64,Ue("StructArrayLayout8i15ui1ul2f2ui64",zl);class Nl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Nl.prototype.bytesPerElement=4,Ue("StructArrayLayout1f4",Nl);class g extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const h=3*t;return this.uint16[6*t+0]=n,this.float32[h+1]=a,this.float32[h+2]=u,t}}g.prototype.bytesPerElement=12,Ue("StructArrayLayout1ui2f12",g);class e extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,a)}emplace(t,n,a,u){const h=4*t;return this.uint32[2*t+0]=n,this.uint16[h+2]=a,this.uint16[h+3]=u,t}}e.prototype.bytesPerElement=8,Ue("StructArrayLayout1ul2ui8",e);class r extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=a,t}}r.prototype.bytesPerElement=4,Ue("StructArrayLayout2ui4",r);class c extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}c.prototype.bytesPerElement=2,Ue("StructArrayLayout1ui2",c);class d extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,a,u)}emplace(t,n,a,u,h){const f=4*t;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=u,this.float32[f+3]=h,t}}d.prototype.bytesPerElement=16,Ue("StructArrayLayout4f16",d);class _ extends Uo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}_.prototype.size=20;class v extends Ta{get(t){return new _(this,t)}}Ue("CollisionBoxArray",v);class k extends Uo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}k.prototype.size=48;class C extends Bu{get(t){return new k(this,t)}}Ue("PlacedSymbolArray",C);class R extends Uo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}R.prototype.size=64;class O extends zl{get(t){return new R(this,t)}}Ue("SymbolInstanceArray",O);class X extends Nl{getoffsetX(t){return this.float32[1*t+0]}}Ue("GlyphOffsetArray",X);class Z extends Zo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ue("SymbolLineVertexArray",Z);class it extends Uo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}it.prototype.size=12;class ot extends g{get(t){return new it(this,t)}}Ue("TextAnchorOffsetArray",ot);class mt extends Uo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mt.prototype.size=8;class gt extends e{get(t){return new mt(this,t)}}Ue("FeatureIndexArray",gt);class yt extends qo{}class Ct extends qo{}class zt extends qo{}class St extends Nu{}class Nt extends Ds{}class Ft extends Ya{}class At extends $o{}class qt extends Ll{}class oe extends Wo{}class ee extends Ou{}class ie extends Ha{}class ae extends Fu{}class De extends Sa{}class Me extends Rl{}class ve extends r{}const Ze=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:hn}=Ze;class on{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,a,u){const h=this.segments[this.segments.length-1];return t>on.MAX_VERTEX_ARRAY_LENGTH&&et(`Max vertices per segment is ${on.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${on.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!h||h.vertexLength+t>on.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==u?this.createNewSegment(n,a,u):h}createNewSegment(t,n,a){const u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(u.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,n,a){return this.prepareSegment(0,t,n,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,u){return new on([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function Yn(i,t){return 256*(i=_n(Math.floor(i),0,255))+_n(Math.floor(t),0,255)}on.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ue("SegmentVector",on);const Hn=pi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ri=pi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Wn,Ci,ti,Ii={exports:{}},mi={exports:{}},Ti={exports:{}},xr=(function(){if(ti)return Ii.exports;ti=1;var i=(Wn||(Wn=1,mi.exports=function(n,a){var u,h,f,y,x,M,L,z;for(h=n.length-(u=3&n.length),f=a,x=3432918353,M=461845907,z=0;z<h;)L=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,f=27492+(65535&(y=5*(65535&(f=(f^=L=(65535&(L=(L=(65535&L)*x+(((L>>>16)*x&65535)<<16)&4294967295)<<15|L>>>17))*M+(((L>>>16)*M&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(L=0,u){case 3:L^=(255&n.charCodeAt(z+2))<<16;case 2:L^=(255&n.charCodeAt(z+1))<<8;case 1:f^=L=(65535&(L=(L=(65535&(L^=255&n.charCodeAt(z)))*x+(((L>>>16)*x&65535)<<16)&4294967295)<<15|L>>>17))*M+(((L>>>16)*M&65535)<<16)&4294967295}return f^=n.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),mi.exports),t=(Ci||(Ci=1,Ti.exports=function(n,a){for(var u,h=n.length,f=a^h,y=0;h>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(y)|(255&n.charCodeAt(++y))<<8|(255&n.charCodeAt(++y))<<16|(255&n.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),h-=4,++y;switch(h){case 3:f^=(255&n.charCodeAt(y+2))<<16;case 2:f^=(255&n.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&n.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Ti.exports);return Ii.exports=i,Ii.exports.murmur3=i,Ii.exports.murmur2=t,Ii.exports})(),Rs=$(xr);class vs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,u){this.ids.push(ta(t)),this.positions.push(n,a,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=ta(t);let a=0,u=this.ids.length-1;for(;a<u;){const f=a+u>>1;this.ids[f]>=n?u=f:a=f+1}const h=[];for(;this.ids[a]===n;)h.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return h}static serialize(t,n){const a=new Float64Array(t.ids),u=new Uint32Array(t.positions);return ea(a,u,0,a.length-1),n&&n.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(t){const n=new vs;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function ta(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Rs(String(i))}function ea(i,t,n,a){for(;n<a;){const u=i[n+a>>1];let h=n-1,f=a+1;for(;;){do h++;while(i[h]<u);do f--;while(i[f]>u);if(h>=f)break;Ea(i,h,f),Ea(t,3*h,3*f),Ea(t,3*h+1,3*f+1),Ea(t,3*h+2,3*f+2)}f-n<a-f?(ea(i,t,n,f),n=f+1):(ea(i,t,f+1,a),a=f)}}function Ea(i,t,n){const a=i[t];i[t]=i[n],i[n]=a}Ue("FeaturePositionMap",vs);class Qr{constructor(t,n){this.gl=t.gl,this.location=n}}class zs extends Qr{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Dr extends Qr{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ns extends Qr{constructor(t,n){super(t,n),this.current=un.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ka=new Float32Array(16);function Ma(i){return[Yn(255*i.r,255*i.g),Yn(255*i.b,255*i.a)]}class ci{constructor(t,n,a){this.value=t,this.uniformNames=n.map((u=>`u_${u}`)),this.type=a}setUniform(t,n,a){t.set(a.constantOr(this.value))}getBinding(t,n,a){return this.type==="color"?new Ns(t,n):new zs(t,n)}}class si{constructor(t,n){this.uniformNames=n.map((a=>`u_${a}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,n){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(t,n,a,u){let h=null;u==="u_pattern_to"?h=this.patternTo:u==="u_pattern_from"?h=this.patternFrom:u==="u_dasharray_to"?h=this.dashTo:u==="u_dasharray_from"?h=this.dashFrom:u==="u_pixel_ratio_to"?h=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(h=this.pixelRatioFrom),h!==null&&t.set(h)}getBinding(t,n,a){return a.substr(0,9)==="u_pattern"||a.substr(0,12)==="u_dasharray_"?new Dr(t,n):new zs(t,n)}}class Ai{constructor(t,n,a,u){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map((h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(t,n,a){const u=this.paintVertexArray.length,h=this.expression.evaluate(new qn(0,a),n,{},a.canonical,[],a.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(u,t,h)}updatePaintArray(t,n,a,u,h){const f=this.expression.evaluate(new qn(0,h),a,u);this._setPaintValue(t,n,f)}_setPaintValue(t,n,a){if(this.type==="color"){const u=Ma(a);for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xn{constructor(t,n,a,u,h,f){this.expression=t,this.uniformNames=n.map((y=>`u_${y}_t`)),this.type=a,this.useIntegerZoom=u,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map((y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new f}populatePaintArray(t,n,a){const u=this.expression.evaluate(new qn(this.zoom,a),n,{},a.canonical,[],a.formattedSection),h=this.expression.evaluate(new qn(this.zoom+1,a),n,{},a.canonical,[],a.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(f,t,u,h)}updatePaintArray(t,n,a,u,h){const f=this.expression.evaluate(new qn(this.zoom,h),a,u),y=this.expression.evaluate(new qn(this.zoom+1,h),a,u);this._setPaintValue(t,n,f,y)}_setPaintValue(t,n,a,u){if(this.type==="color"){const h=Ma(a),f=Ma(u);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,h[0],h[1],f[0],f[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=_n(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,a){return new zs(t,n)}}class na{constructor(t,n,a,u,h,f){this.expression=t,this.type=n,this.useIntegerZoom=a,this.zoom=u,this.layerId=f,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(t,n,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,this.getPositionIds(n),a)}updatePaintArray(t,n,a,u,h){this._setPaintValues(t,n,this.getPositionIds(a),h)}_setPaintValues(t,n,a,u){const h=this.getPositions(u);if(!h||!a)return;const f=h[a.min],y=h[a.mid],x=h[a.max];if(f&&y&&x)for(let M=t;M<n;M++)this.emplace(this.zoomInPaintVertexArray,M,y,f),this.emplace(this.zoomOutPaintVertexArray,M,y,x)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qc extends na{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Hn.members}emplace(t,n,a,u){t.emplace(n,a.tlbr[0],a.tlbr[1],a.tlbr[2],a.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],a.pixelRatio,u.pixelRatio)}}class Zc extends na{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return ri.members}emplace(t,n,a,u){t.emplace(n,0,a.y,a.height,a.width,0,u.y,u.height,u.width)}}class $c{constructor(t,n,a){this.binders={},this._buffers=[];const u=[];for(const h in t.paint._values){if(!a(h))continue;const f=t.paint.get(h);if(!(f instanceof ls&&Cs(f.property.specification)))continue;const y=td(h,t.type),x=f.value,M=f.property.specification.type,L=f.property.useIntegerZoom,z=f.property.specification["property-type"],F=z==="cross-faded"||z==="cross-faded-data-driven";if(x.kind==="constant")this.binders[h]=F?new si(x.value,y):new ci(x.value,y,M),u.push(`/u_${h}`);else if(x.kind==="source"||F){const j=ia(h,M,"source");this.binders[h]=F?h==="line-dasharray"?new Zc(x,M,L,n,j,t.id):new qc(x,M,L,n,j,t.id):new Ai(x,y,M,j),u.push(`/a_${h}`)}else{const j=ia(h,M,"composite");this.binders[h]=new Xn(x,y,M,L,n,j),u.push(`/z_${h}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ai||n instanceof Xn?n.maxValue:0}populatePaintArrays(t,n,a){for(const u in this.binders){const h=this.binders[u];(h instanceof Ai||h instanceof Xn||h instanceof na)&&h.populatePaintArray(t,n,a)}}setConstantPatternPositions(t,n){for(const a in this.binders){const u=this.binders[a];u instanceof si&&u.setConstantPatternPositions(t,n)}}setConstantDashPositions(t,n){for(const a in this.binders){const u=this.binders[a];u instanceof si&&u.setConstantDashPositions(t,n)}}updatePaintArrays(t,n,a,u,h){let f=!1;for(const y in t){const x=n.getPositions(y);for(const M of x){const L=a.feature(M.index);for(const z in this.binders){const F=this.binders[z];if((F instanceof Ai||F instanceof Xn||F instanceof na)&&F.expression.isStateDependent===!0){const j=u.paint.get(z);F.expression=j.value,F.updatePaintArray(M.start,M.end,L,t[y],h),f=!0}}}}return f}defines(){const t=[];for(const n in this.binders){const a=this.binders[n];(a instanceof ci||a instanceof si)&&t.push(...a.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Ai||a instanceof Xn)for(let u=0;u<a.paintVertexAttributes.length;u++)t.push(a.paintVertexAttributes[u].name);else if(a instanceof na){const u=a.getVertexAttributes();for(const h of u)t.push(h.name)}}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof ci||a instanceof si||a instanceof Xn)for(const u of a.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const a=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof ci||h instanceof si||h instanceof Xn){for(const f of h.uniformNames)if(n[f]){const y=h.getBinding(t,n[f],f);a.push({name:f,property:u,binding:y})}}}return a}setUniforms(t,n,a,u){for(const{name:h,property:f,binding:y}of n)this.binders[f].setUniform(y,u,a.get(f),h)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const a=this.binders[n];if(t&&a instanceof na){const u=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof Ai||a instanceof Xn)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const n in this.binders){const a=this.binders[n];(a instanceof Ai||a instanceof Xn||a instanceof na)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ai||n instanceof Xn||n instanceof na)&&n.destroy()}}}class Pa{constructor(t,n,a=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new $c(u,n,a);this.needsUpload=!1,this._featureMap=new vs,this._bufferOffset=0}populatePaintArrays(t,n,a,u){for(const h in this.programConfigurations)this.programConfigurations[h].populatePaintArrays(t,n,u);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,u){for(const h of a)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,n,h,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function td(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function ia(i,t,n){const a={color:{source:Ya,composite:d},number:{source:Nl,composite:Ya}},u=(function(h){return{"line-pattern":{source:At,composite:At},"fill-pattern":{source:At,composite:At},"fill-extrusion-pattern":{source:At,composite:At},"line-dasharray":{source:qt,composite:qt}}[h]})(i);return u&&u[n]||a[t][n]}Ue("ConstantBinder",ci),Ue("CrossFadedConstantBinder",si),Ue("SourceExpressionBinder",Ai),Ue("CrossFadedPatternBinder",qc),Ue("CrossFadedDasharrayBinder",Zc),Ue("CompositeExpressionBinder",Xn),Ue("ProgramConfiguration",$c,{omit:["_buffers"]}),Ue("ProgramConfigurationSet",Pa);const Ol=Math.pow(2,14)-1,Vu=-Ol-1;function ra(i){const t=he/i.extent,n=i.loadGeometry();for(let a=0;a<n.length;a++){const u=n[a];for(let h=0;h<u.length;h++){const f=u[h],y=Math.round(f.x*t),x=Math.round(f.y*t);f.x=_n(y,Vu,Ol),f.y=_n(x,Vu,Ol),(y<f.x||y>f.x+1||x<f.y||x>f.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Os(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?ra(i):[]}}const ju=-32768;function Gu(i,t,n,a,u){i.emplaceBack(ju+8*t+a,ju+8*n+u)}class ed{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new Ct,this.indexArray=new Me,this.segments=new on,this.programConfigurations=new Pa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,a){const u=this.layers[0],h=[];let f=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const L=u;f=L.layout.get("circle-sort-key"),y=!f.isConstant(),x=x||L.paint.get("circle-pitch-alignment")==="map"}const M=x?n.subdivisionGranularity.circle:1;for(const{feature:L,id:z,index:F,sourceLayerIndex:j}of t){const U=this.layers[0]._featureFilter.needGeometry,H=Os(L,U);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),H,a))continue;const rt=y?f.evaluate(H,{},a):void 0,ct={id:z,properties:L.properties,type:L.type,sourceLayerIndex:j,index:F,geometry:U?H.geometry:ra(L),patterns:{},sortKey:rt};h.push(ct)}y&&h.sort(((L,z)=>L.sortKey-z.sortKey));for(const L of h){const{geometry:z,index:F,sourceLayerIndex:j}=L,U=t[F].feature;this.addFeature(L,z,F,a,M),n.featureIndex.insert(U,z,F,j,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:a})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,u,h=1){let f;switch(h){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${h}; valid values are 1, 3, 5, 7.`)}const y=f.length;for(const x of n)for(const M of x){const L=M.x,z=M.y;if(L<0||L>=he||z<0||z>=he)continue;const F=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,t.sortKey),j=F.vertexLength;for(let U=0;U<y;U++)for(let H=0;H<y;H++)Gu(this.layoutVertexArray,L,z,f[H],f[U]);for(let U=0;U<y-1;U++)for(let H=0;H<y-1;H++){const rt=j+U*y+H,ct=j+(U+1)*y+H;this.indexArray.emplaceBack(rt,ct+1,rt+1),this.indexArray.emplaceBack(rt,ct,ct+1)}F.vertexLength+=y*y,F.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:{},canonical:u})}}function yf(i,t){for(let n=0;n<i.length;n++)if(Fl(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Fl(i,t[n]))return!0;return!!nd(i,t)}function Wc(i,t,n){return!!Fl(i,t)||!!id(t,i,n)}function vf(i,t){if(i.length===1)return bf(t,i[0]);for(let n=0;n<t.length;n++){const a=t[n];for(let u=0;u<a.length;u++)if(Fl(i,a[u]))return!0}for(let n=0;n<i.length;n++)if(bf(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(nd(i,t[n]))return!0;return!1}function Og(i,t,n){if(i.length>1){if(nd(i,t))return!0;for(let a=0;a<t.length;a++)if(id(t[a],i,n))return!0}for(let a=0;a<i.length;a++)if(id(i[a],t,n))return!0;return!1}function nd(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const a=i[n],u=i[n+1];for(let h=0;h<t.length-1;h++)if(Fg(a,u,t[h],t[h+1]))return!0}return!1}function Fg(i,t,n,a){return fe(i,n,a)!==fe(t,n,a)&&fe(i,t,n)!==fe(i,t,a)}function id(i,t,n){const a=n*n;if(t.length===1)return i.distSqr(t[0])<a;for(let u=1;u<t.length;u++)if(xf(i,t[u-1],t[u])<a)return!0;return!1}function xf(i,t,n){const a=t.distSqr(n);if(a===0)return i.distSqr(t);const u=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/a;return i.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function bf(i,t){let n,a,u,h=!1;for(let f=0;f<i.length;f++){n=i[f];for(let y=0,x=n.length-1;y<n.length;x=y++)a=n[y],u=n[x],a.y>t.y!=u.y>t.y&&t.x<(u.x-a.x)*(t.y-a.y)/(u.y-a.y)+a.x&&(h=!h)}return h}function Fl(i,t){let n=!1;for(let a=0,u=i.length-1;a<i.length;u=a++){const h=i[a],f=i[u];h.y>t.y!=f.y>t.y&&t.x<(f.x-h.x)*(t.y-h.y)/(f.y-h.y)+h.x&&(n=!n)}return n}function Bg(i,t,n){const a=n[0],u=n[2];if(i.x<a.x&&t.x<a.x||i.x>u.x&&t.x>u.x||i.y<a.y&&t.y<a.y||i.y>u.y&&t.y>u.y)return!1;const h=fe(i,t,n[0]);return h!==fe(i,t,n[1])||h!==fe(i,t,n[2])||h!==fe(i,t,n[3])}function Bl(i,t,n){const a=t.paint.get(i).value;return a.kind==="constant"?a.value:n.programConfigurations.get(t.id).getMaxValue(i)}function Xc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Yc(i,t,n,a,u){if(!t[0]&&!t[1])return i;const h=N.convert(t)._mult(u);n==="viewport"&&h._rotate(-a);const f=[];for(let y=0;y<i.length;y++)f.push(i[y].sub(h));return f}function Vg({queryGeometry:i,size:t},n){return Wc(i,n,t)}function jg({queryGeometry:i,size:t,transform:n,unwrappedTileID:a,getElevation:u},h){return Wc(i,h,t*(n.projectTileCoordinates(h.x,h.y,a,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function Gg({queryGeometry:i,size:t,transform:n,unwrappedTileID:a,getElevation:u},h){const f=n.projectTileCoordinates(h.x,h.y,a,u).signedDistanceFromCamera,y=t*(n.cameraToCenterDistance/f);return Wc(i,rd(h,n,a,u),y)}function Ug({queryGeometry:i,size:t,transform:n,unwrappedTileID:a,getElevation:u},h){return Wc(i,rd(h,n,a,u),t)}function wf({queryGeometry:i,size:t,transform:n,unwrappedTileID:a,getElevation:u,pitchAlignment:h="map",pitchScale:f="map"},y){const x=h==="map"?f==="map"?Vg:jg:f==="map"?Gg:Ug,M={queryGeometry:i,size:t,transform:n,unwrappedTileID:a,getElevation:u};for(const L of y)for(const z of L)if(x(M,z))return!0;return!1}function rd(i,t,n,a){const u=t.projectTileCoordinates(i.x,i.y,n,a).point;return new N((.5*u.x+.5)*t.width,(.5*-u.y+.5)*t.height)}let If,Tf;Ue("CircleBucket",ed,{omit:["layers"]});var qg={get paint(){return Tf=Tf||new Qi({"circle-radius":new en(pt.paint_circle["circle-radius"]),"circle-color":new en(pt.paint_circle["circle-color"]),"circle-blur":new en(pt.paint_circle["circle-blur"]),"circle-opacity":new en(pt.paint_circle["circle-opacity"]),"circle-translate":new We(pt.paint_circle["circle-translate"]),"circle-translate-anchor":new We(pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new We(pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new We(pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new en(pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new en(pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new en(pt.paint_circle["circle-stroke-opacity"])})},get layout(){return If=If||new Qi({"circle-sort-key":new en(pt.layout_circle["circle-sort-key"])})}};class Zg extends Jr{constructor(t,n){super(t,qg,n)}createBucket(t){return new ed(t)}queryRadius(t){const n=t;return Bl("circle-radius",this,n)+Bl("circle-stroke-width",this,n)+Xc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:a,geometry:u,transform:h,pixelsToTileUnits:f,unwrappedTileID:y,getElevation:x}){const M=Yc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-h.bearingInRadians,f),L=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),z=this.paint.get("circle-pitch-scale"),F=this.paint.get("circle-pitch-alignment");let j,U;return F==="map"?(j=M,U=L*f):(j=(function(H,rt,ct,It){return H.map((ft=>rd(ft,rt,ct,It)))})(M,h,y,x),U=L),wf({queryGeometry:j,size:U,transform:h,unwrappedTileID:y,getElevation:x,pitchAlignment:F,pitchScale:z},u)}}class Sf extends ed{}let Ef;Ue("HeatmapBucket",Sf,{omit:["layers"]});var $g={get paint(){return Ef=Ef||new Qi({"heatmap-radius":new en(pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new en(pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new We(pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Go(pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new We(pt.paint_heatmap["heatmap-opacity"])})}};function sd(i,{width:t,height:n},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*a)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*a}`)}else u=new Uint8Array(t*n*a);return i.width=t,i.height=n,i.data=u,i}function kf(i,{width:t,height:n},a){if(t===i.width&&n===i.height)return;const u=sd({},{width:t,height:n},a);ad(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},a),i.width=t,i.height=n,i.data=u.data}function ad(i,t,n,a,u,h){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||a.x>t.width-u.width||a.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,y=t.data;if(f===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const M=((n.y+x)*i.width+n.x)*h,L=((a.y+x)*t.width+a.x)*h;for(let z=0;z<u.width*h;z++)y[L+z]=f[M+z]}return t}class Uu{constructor(t,n){sd(this,t,1,n)}resize(t){kf(this,t,1)}clone(){return new Uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,u,h){ad(t,n,a,u,h,1)}}class Rr{constructor(t,n){sd(this,t,4,n)}resize(t){kf(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Rr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,u,h){ad(t,n,a,u,h,4)}setPixel(t,n,a){const u=4*(t*this.width+n);this.data[u+0]=Math.round(255*a.r/a.a),this.data[u+1]=Math.round(255*a.g/a.a),this.data[u+2]=Math.round(255*a.b/a.a),this.data[u+3]=Math.round(255*a.a)}}function Mf(i){const t={},n=i.resolution||256,a=i.clips?i.clips.length:1,u=i.image||new Rr({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const h=(f,y,x)=>{t[i.evaluationKey]=x;const M=i.expression.evaluate(t);u.setPixel(f/4/n,y/4,M)};if(i.clips)for(let f=0,y=0;f<a;++f,y+=4*n)for(let x=0,M=0;x<n;x++,M+=4){const L=x/(n-1),{start:z,end:F}=i.clips[f];h(y,M,z*(1-L)+F*L)}else for(let f=0,y=0;f<n;f++,y+=4)h(0,y,f/(n-1));return u}Ue("AlphaImage",Uu),Ue("RGBAImage",Rr);const od="big-fb";class Wg extends Jr{createBucket(t){return new Sf(t)}constructor(t,n){super(t,$g,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(od)&&this.heatmapFbos.delete(od)}queryRadius(t){return Bl("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:a,geometry:u,transform:h,pixelsToTileUnits:f,unwrappedTileID:y,getElevation:x}){return wf({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,a)*f,transform:h,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Pf;var Xg={get paint(){return Pf=Pf||new Qi({"hillshade-illumination-direction":new We(pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new We(pt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new We(pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new We(pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new We(pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new We(pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new We(pt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new We(pt.paint_hillshade["hillshade-method"])})}};class Yg extends Jr{constructor(t,n){super(t,Xg,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const h=Math.max(t.length,n.length,a.length,u.length);t=t.concat(Array(h-t.length).fill(t.at(-1))),n=n.concat(Array(h-n.length).fill(n.at(-1))),a=a.concat(Array(h-a.length).fill(a.at(-1))),u=u.concat(Array(h-u.length).fill(u.at(-1)));const f=n.map(be);return{directionRadians:t.map(be),altitudeRadians:f,shadowColor:u,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Cf;var Hg={get paint(){return Cf=Cf||new Qi({"color-relief-opacity":new We(pt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Go(pt["paint_color-relief"]["color-relief-color"])})}};class ld{constructor(t,n,a,u){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,a){const{width:u,height:h}=t,f=!(this.size&&this.size[0]===u&&this.size[1]===h||a),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),f)this.size=[u,h],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||bt(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,u,h,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:M,y:L}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||bt(t)?x.texSubImage2D(x.TEXTURE_2D,0,M,L,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,M,L,u,h,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,a){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Af{constructor(t,n,a,u=1,h=1,f=1,y=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void et(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=h,this.blueFactor=f,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<x;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(x,M)]=this.data[this._idx(x-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,x)]=this.data[this._idx(M,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<x;M++)for(let L=0;L<x;L++){const z=this.get(M,L);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,n){const a=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(a[u],a[u+1],a[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,a){return t*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}pack(t){return Lf(t,this.getUnpackVector())}getPixels(){return new Rr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,h=n*this.dim+this.dim,f=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:u=h-1;break;case 1:h=u+1}switch(a){case-1:f=y-1;break;case 1:y=f+1}const x=-n*this.dim,M=-a*this.dim;for(let L=f;L<y;L++)for(let z=u;z<h;z++)this.data[this._idx(z,L)]=t.data[this._idx(z+x,L+M)]}}function Lf(i,t){const n=t[0],a=t[1],u=t[2],h=t[3],f=Math.min(n,a,u),y=Math.round((i+h)/f);return{r:Math.floor(y*f/n)%256,g:Math.floor(y*f/a)%256,b:Math.floor(y*f/u)%256}}Ue("DEMData",Af);class Kg extends Jr{constructor(t,n){super(t,Hg,n)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},a=this._transitionablePaint._values["color-relief-color"].value.expression;if(a instanceof xa&&a._styleExpression.expression instanceof zi){this.colorRampExpression=a;const f=a._styleExpression.expression;n.elevationStops=f.labels,n.colorStops=[];for(const y of n.elevationStops)n.colorStops.push(f.evaluate({globals:{elevation:y}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[un.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const u={elevationStops:[],colorStops:[]},h=(n.elevationStops.length-1)/(t-1);for(let f=0;f<n.elevationStops.length-.5;f+=h)u.elevationStops.push(n.elevationStops[Math.round(f)]),u.colorStops.push(n.colorStops[Math.round(f)]);return et(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${n.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,a){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),h=new Rr({width:u.colorStops.length,height:1}),f=new Rr({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=Lf(u.elevationStops[y],a);f.setPixel(0,y,new un(x.r/255,x.g/255,x.b/255,1)),h.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new ld(t,f,t.gl.RGBA),colorTexture:new ld(t,h,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Jg=pi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qg}=Jg;function Hc(i,t,n){const a=n.patternDependencies;let u=!1;for(const h of t){const f=h.paint.get(`${i}-pattern`);f.isConstant()||(u=!0);const y=f.constantOr(null);y&&(u=!0,a[y.to]=!0,a[y.from]=!0)}return u}function ud(i,t,n,a,u){const{zoom:h}=a,f=u.patternDependencies;for(const y of t){const x=y.paint.get(`${i}-pattern`).value;if(x.kind!=="constant"){let M=x.evaluate({zoom:h-1},n,{},u.availableImages),L=x.evaluate({zoom:h},n,{},u.availableImages),z=x.evaluate({zoom:h+1},n,{},u.availableImages);M=M&&M.name?M.name:M,L=L&&L.name?L.name:L,z=z&&z.name?z.name:z,f[M]=!0,f[L]=!0,f[z]=!0,n.patterns[y.id]={min:M,mid:L,max:z}}}return n}function Df(i,t,n,a,u){let h;if(u===(function(f,y,x,M){let L=0;for(let z=y,F=x-M;z<x;z+=M)L+=(f[F]-f[z])*(f[z+1]+f[F+1]),F=z;return L})(i,t,n,a)>0)for(let f=t;f<n;f+=a)h=Of(f/a|0,i[f],i[f+1],h);else for(let f=n-a;f>=t;f-=a)h=Of(f/a|0,i[f],i[f+1],h);return h&&Vl(h,h.next)&&(Wu(h),h=h.next),h}function Xo(i,t){if(!i)return i;t||(t=i);let n,a=i;do if(n=!1,a.steiner||!Vl(a,a.next)&&Si(a.prev,a,a.next)!==0)a=a.next;else{if(Wu(a),a=t=a.prev,a===a.next)break;n=!0}while(n||a!==t);return t}function qu(i,t,n,a,u,h,f){if(!i)return;!f&&h&&(function(x,M,L,z){let F=x;do F.z===0&&(F.z=cd(F.x,F.y,M,L,z)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==x);F.prevZ.nextZ=null,F.prevZ=null,(function(j){let U,H=1;do{let rt,ct=j;j=null;let It=null;for(U=0;ct;){U++;let ft=ct,_t=0;for(let Vt=0;Vt<H&&(_t++,ft=ft.nextZ,ft);Vt++);let Bt=H;for(;_t>0||Bt>0&&ft;)_t!==0&&(Bt===0||!ft||ct.z<=ft.z)?(rt=ct,ct=ct.nextZ,_t--):(rt=ft,ft=ft.nextZ,Bt--),It?It.nextZ=rt:j=rt,rt.prevZ=It,It=rt;ct=ft}It.nextZ=null,H*=2}while(U>1)})(F)})(i,a,u,h);let y=i;for(;i.prev!==i.next;){const x=i.prev,M=i.next;if(h?e_(i,a,u,h):t_(i))t.push(x.i,i.i,M.i),Wu(i),i=M.next,y=M.next;else if((i=M)===y){f?f===1?qu(i=n_(Xo(i),t),t,n,a,u,h,2):f===2&&i_(i,t,n,a,u,h):qu(Xo(i),t,n,a,u,h,1);break}}}function t_(i){const t=i.prev,n=i,a=i.next;if(Si(t,n,a)>=0)return!1;const u=t.x,h=n.x,f=a.x,y=t.y,x=n.y,M=a.y,L=Math.min(u,h,f),z=Math.min(y,x,M),F=Math.max(u,h,f),j=Math.max(y,x,M);let U=a.next;for(;U!==t;){if(U.x>=L&&U.x<=F&&U.y>=z&&U.y<=j&&Zu(u,y,h,x,f,M,U.x,U.y)&&Si(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function e_(i,t,n,a){const u=i.prev,h=i,f=i.next;if(Si(u,h,f)>=0)return!1;const y=u.x,x=h.x,M=f.x,L=u.y,z=h.y,F=f.y,j=Math.min(y,x,M),U=Math.min(L,z,F),H=Math.max(y,x,M),rt=Math.max(L,z,F),ct=cd(j,U,t,n,a),It=cd(H,rt,t,n,a);let ft=i.prevZ,_t=i.nextZ;for(;ft&&ft.z>=ct&&_t&&_t.z<=It;){if(ft.x>=j&&ft.x<=H&&ft.y>=U&&ft.y<=rt&&ft!==u&&ft!==f&&Zu(y,L,x,z,M,F,ft.x,ft.y)&&Si(ft.prev,ft,ft.next)>=0||(ft=ft.prevZ,_t.x>=j&&_t.x<=H&&_t.y>=U&&_t.y<=rt&&_t!==u&&_t!==f&&Zu(y,L,x,z,M,F,_t.x,_t.y)&&Si(_t.prev,_t,_t.next)>=0))return!1;_t=_t.nextZ}for(;ft&&ft.z>=ct;){if(ft.x>=j&&ft.x<=H&&ft.y>=U&&ft.y<=rt&&ft!==u&&ft!==f&&Zu(y,L,x,z,M,F,ft.x,ft.y)&&Si(ft.prev,ft,ft.next)>=0)return!1;ft=ft.prevZ}for(;_t&&_t.z<=It;){if(_t.x>=j&&_t.x<=H&&_t.y>=U&&_t.y<=rt&&_t!==u&&_t!==f&&Zu(y,L,x,z,M,F,_t.x,_t.y)&&Si(_t.prev,_t,_t.next)>=0)return!1;_t=_t.nextZ}return!0}function n_(i,t){let n=i;do{const a=n.prev,u=n.next.next;!Vl(a,u)&&zf(a,n,n.next,u)&&$u(a,u)&&$u(u,a)&&(t.push(a.i,n.i,u.i),Wu(n),Wu(n.next),n=i=u),n=n.next}while(n!==i);return Xo(n)}function i_(i,t,n,a,u,h){let f=i;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&l_(f,y)){let x=Nf(f,y);return f=Xo(f,f.next),x=Xo(x,x.next),qu(f,t,n,a,u,h,0),void qu(x,t,n,a,u,h,0)}y=y.next}f=f.next}while(f!==i)}function r_(i,t){let n=i.x-t.x;return n===0&&(n=i.y-t.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function s_(i,t){const n=(function(u,h){let f=h;const y=u.x,x=u.y;let M,L=-1/0;if(Vl(u,f))return f;do{if(Vl(u,f.next))return f.next;if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const H=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(H<=y&&H>L&&(L=H,M=f.x<f.next.x?f:f.next,H===y))return M}f=f.next}while(f!==h);if(!M)return null;const z=M,F=M.x,j=M.y;let U=1/0;f=M;do{if(y>=f.x&&f.x>=F&&y!==f.x&&Rf(x<j?y:L,x,F,j,x<j?L:y,x,f.x,f.y)){const H=Math.abs(x-f.y)/(y-f.x);$u(f,u)&&(H<U||H===U&&(f.x>M.x||f.x===M.x&&a_(M,f)))&&(M=f,U=H)}f=f.next}while(f!==z);return M})(i,t);if(!n)return t;const a=Nf(n,i);return Xo(a,a.next),Xo(n,n.next)}function a_(i,t){return Si(i.prev,i,t.prev)<0&&Si(t.next,i,i.next)<0}function cd(i,t,n,a,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function o_(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Rf(i,t,n,a,u,h,f,y){return(u-f)*(t-y)>=(i-f)*(h-y)&&(i-f)*(a-y)>=(n-f)*(t-y)&&(n-f)*(h-y)>=(u-f)*(a-y)}function Zu(i,t,n,a,u,h,f,y){return!(i===f&&t===y)&&Rf(i,t,n,a,u,h,f,y)}function l_(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!(function(n,a){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==a.i&&u.next.i!==a.i&&zf(u,u.next,n,a))return!0;u=u.next}while(u!==n);return!1})(i,t)&&($u(i,t)&&$u(t,i)&&(function(n,a){let u=n,h=!1;const f=(n.x+a.x)/2,y=(n.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(h=!h),u=u.next;while(u!==n);return h})(i,t)&&(Si(i.prev,i,t.prev)||Si(i,t.prev,t))||Vl(i,t)&&Si(i.prev,i,i.next)>0&&Si(t.prev,t,t.next)>0)}function Si(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function Vl(i,t){return i.x===t.x&&i.y===t.y}function zf(i,t,n,a){const u=Jc(Si(i,t,n)),h=Jc(Si(i,t,a)),f=Jc(Si(n,a,i)),y=Jc(Si(n,a,t));return u!==h&&f!==y||!(u!==0||!Kc(i,n,t))||!(h!==0||!Kc(i,a,t))||!(f!==0||!Kc(n,i,a))||!(y!==0||!Kc(n,t,a))}function Kc(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Jc(i){return i>0?1:i<0?-1:0}function $u(i,t){return Si(i.prev,i,i.next)<0?Si(i,t,i.next)>=0&&Si(i,i.prev,t)>=0:Si(i,t,i.prev)<0||Si(i,i.next,t)<0}function Nf(i,t){const n=hd(i.i,i.x,i.y),a=hd(t.i,t.x,t.y),u=i.next,h=t.prev;return i.next=t,t.prev=i,n.next=u,u.prev=n,a.next=n,n.prev=a,h.next=a,a.prev=h,a}function Of(i,t,n,a){const u=hd(i,t,n);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Wu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function hd(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class jl{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Qc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Qc.noSubdivision=new Qc({fill:new jl(0,0),line:new jl(0,0),tile:new jl(0,0),stencil:new jl(0,0),circle:1}),Ue("SubdivisionGranularityExpression",jl),Ue("SubdivisionGranularitySetting",Qc);const Gl=-32768,Xu=32767;class u_{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=he/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const a=0|Math.round(t),u=0|Math.round(n),h=this._getKey(a,u);if(this._vertexDictionary.has(h))return this._vertexDictionary.get(h);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(h,f),this._vertexBuffer.push(a,u),f}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(u,h){const f=[];for(let y=0;y<h.length;y+=3){const x=h[y],M=h[y+1],L=h[y+2],z=u[2*x],F=u[2*x+1];(u[2*M]-z)*(u[2*L+1]-F)-(u[2*M+1]-F)*(u[2*L]-z)>0?(f.push(x),f.push(L),f.push(M)):(f.push(x),f.push(M),f.push(L))}return f})(this._vertexBuffer,t);const n=[],a=t.length;for(let u=0;u<a;u+=3){const h=[t[u+0],t[u+1],t[u+2]],f=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let y=1/0,x=1/0,M=-1/0,L=-1/0;for(let H=0;H<3;H++){const rt=f[2*H],ct=f[2*H+1];y=Math.min(y,rt),M=Math.max(M,rt),x=Math.min(x,ct),L=Math.max(L,ct)}if(y===M||x===L)continue;const z=Math.floor(y/this._granularityCellSize),F=Math.ceil(M/this._granularityCellSize),j=Math.floor(x/this._granularityCellSize),U=Math.ceil(L/this._granularityCellSize);if(z!==F||j!==U)for(let H=j;H<U;H++){const rt=this._scanlineGenerateVertexRingForCellRow(H,f,h);c_(this._vertexBuffer,rt,n)}else n.push(...h)}return n}_scanlineGenerateVertexRingForCellRow(t,n,a){const u=t*this._granularityCellSize,h=u+this._granularityCellSize,f=[];for(let y=0;y<3;y++){const x=n[2*y],M=n[2*y+1],L=n[2*(y+1)%6],z=n[(2*(y+1)+1)%6],F=n[2*(y+2)%6],j=n[(2*(y+2)+1)%6],U=L-x,H=z-M,rt=U===0,ct=H===0,It=(u-M)/H,ft=(h-M)/H,_t=Math.min(It,ft),Bt=Math.max(It,ft);if(!ct&&(_t>=1||Bt<=0)||ct&&(M<u||M>h)){z>=u&&z<=h&&f.push(a[(y+1)%3]);continue}!ct&&_t>0&&f.push(this._vertexToIndex(x+U*_t,M+H*_t));const Vt=x+U*Math.max(_t,0),re=x+U*Math.min(Bt,1);rt||this._generateIntraEdgeVertices(f,x,M,L,z,Vt,re),!ct&&Bt<1&&f.push(this._vertexToIndex(x+U*Bt,M+H*Bt)),(ct||z>=u&&z<=h)&&f.push(a[(y+1)%3]),!ct&&(z<=u||z>=h)&&this._generateInterEdgeVertices(f,x,M,L,z,F,j,re,u,h)}return f}_generateIntraEdgeVertices(t,n,a,u,h,f,y){const x=u-n,M=h-a,L=M===0,z=L?Math.min(n,u):Math.min(f,y),F=L?Math.max(n,u):Math.max(f,y),j=Math.floor(z/this._granularityCellSize)+1,U=Math.ceil(F/this._granularityCellSize)-1;if(L?n<u:f<y)for(let H=j;H<=U;H++){const rt=H*this._granularityCellSize;t.push(this._vertexToIndex(rt,a+M*(rt-n)/x))}else for(let H=U;H>=j;H--){const rt=H*this._granularityCellSize;t.push(this._vertexToIndex(rt,a+M*(rt-n)/x))}}_generateInterEdgeVertices(t,n,a,u,h,f,y,x,M,L){const z=h-a,F=f-u,j=y-h,U=(M-h)/j,H=(L-h)/j,rt=Math.min(U,H),ct=Math.max(U,H),It=u+F*rt;let ft=Math.floor(Math.min(It,x)/this._granularityCellSize)+1,_t=Math.ceil(Math.max(It,x)/this._granularityCellSize)-1,Bt=x<It;const Vt=j===0;if(Vt&&(y===M||y===L))return;if(Vt||rt>=1||ct<=0){const xe=a-y,pe=f+(n-f)*Math.min((M-y)/xe,(L-y)/xe);ft=Math.floor(Math.min(pe,x)/this._granularityCellSize)+1,_t=Math.ceil(Math.max(pe,x)/this._granularityCellSize)-1,Bt=x<pe}const re=z>0?L:M;if(Bt)for(let xe=ft;xe<=_t;xe++)t.push(this._vertexToIndex(xe*this._granularityCellSize,re));else for(let xe=_t;xe>=ft;xe--)t.push(this._vertexToIndex(xe*this._granularityCellSize,re))}_generateOutline(t){const n=[];for(const a of t){const u=Yo(a,this._granularity,!0),h=this._pointArrayToIndices(u),f=[];for(let y=1;y<h.length;y++)f.push(h[y-1]),f.push(h[y]);n.push(f)}return n}_handlePoles(t){let n=!1,a=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(n||a)&&this._fillPoles(t,n,a)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const a=t[n+1];a===Gl&&(t[n+1]=-32767),a===Xu&&(t[n+1]=32766)}}_generatePoleQuad(t,n,a,u,h,f){u>h!=(f===Gl)?(t.push(n),t.push(a),t.push(this._vertexToIndex(u,f)),t.push(a),t.push(this._vertexToIndex(h,f)),t.push(this._vertexToIndex(u,f))):(t.push(a),t.push(n),t.push(this._vertexToIndex(u,f)),t.push(this._vertexToIndex(h,f)),t.push(a),t.push(this._vertexToIndex(u,f)))}_fillPoles(t,n,a){const u=this._vertexBuffer,h=he,f=t.length;for(let y=2;y<f;y+=3){const x=t[y-2],M=t[y-1],L=t[y],z=u[2*x],F=u[2*x+1],j=u[2*M],U=u[2*M+1],H=u[2*L],rt=u[2*L+1];n&&(F===0&&U===0&&this._generatePoleQuad(t,x,M,z,j,Gl),U===0&&rt===0&&this._generatePoleQuad(t,M,L,j,H,Gl),rt===0&&F===0&&this._generatePoleQuad(t,L,x,H,z,Gl)),a&&(F===h&&U===h&&this._generatePoleQuad(t,x,M,z,j,Xu),U===h&&rt===h&&this._generatePoleQuad(t,M,L,j,H,Xu),rt===h&&F===h&&this._generatePoleQuad(t,L,x,H,z,Xu))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:a,holeIndices:u}=(function(y){const x=[],M=[];for(const L of y)if(L.length!==0){L!==y[0]&&x.push(M.length/2);for(let z=0;z<L.length;z++)M.push(L[z].x),M.push(L[z].y)}return{flattened:M,holeIndices:x}})(t);let h;this._initializeVertices(a);try{const y=(function(M,L,z=2){const F=L&&L.length,j=F?L[0]*z:M.length;let U=Df(M,0,j,z,!0);const H=[];if(!U||U.next===U.prev)return H;let rt,ct,It;if(F&&(U=(function(ft,_t,Bt,Vt){const re=[];for(let xe=0,pe=_t.length;xe<pe;xe++){const Ie=Df(ft,_t[xe]*Vt,xe<pe-1?_t[xe+1]*Vt:ft.length,Vt,!1);Ie===Ie.next&&(Ie.steiner=!0),re.push(o_(Ie))}re.sort(r_);for(let xe=0;xe<re.length;xe++)Bt=s_(re[xe],Bt);return Bt})(M,L,U,z)),M.length>80*z){rt=M[0],ct=M[1];let ft=rt,_t=ct;for(let Bt=z;Bt<j;Bt+=z){const Vt=M[Bt],re=M[Bt+1];Vt<rt&&(rt=Vt),re<ct&&(ct=re),Vt>ft&&(ft=Vt),re>_t&&(_t=re)}It=Math.max(ft-rt,_t-ct),It=It!==0?32767/It:0}return qu(U,H,z,rt,ct,It,0),H})(a,u),x=this._convertIndices(a,y);h=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let f=[];return n&&(f=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(h),{verticesFlattened:this._vertexBuffer,indicesTriangles:h,indicesLineList:f}}_convertIndices(t,n){const a=[];for(let u=0;u<n.length;u++)a.push(this._vertexToIndex(t[2*n[u]],t[2*n[u]+1]));return a}_pointArrayToIndices(t){const n=[];for(let a=0;a<t.length;a++){const u=t[a];n.push(this._vertexToIndex(u.x,u.y))}return n}}function Ff(i,t,n,a=!0){return new u_(n,t).subdividePolygonInternal(i,a)}function Yo(i,t,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const a=i[0],u=i[i.length-1],h=n&&(a.x!==u.x||a.y!==u.y);if(t<2)return h?[...i,i[0]]:[...i];const f=Math.floor(he/t),y=[];y.push(new N(i[0].x,i[0].y));const x=i.length,M=h?x:x-1;for(let L=0;L<M;L++){const z=i[L],F=L<x-1?i[L+1]:i[0],j=z.x,U=z.y,H=F.x,rt=F.y,ct=j!==H,It=U!==rt;if(!ct&&!It)continue;const ft=H-j,_t=rt-U,Bt=Math.abs(ft),Vt=Math.abs(_t);let re=j,xe=U;for(;;){const Ie=ft>0?(Math.floor(re/f)+1)*f:(Math.ceil(re/f)-1)*f,Fe=_t>0?(Math.floor(xe/f)+1)*f:(Math.ceil(xe/f)-1)*f,Ae=Math.abs(re-Ie),Le=Math.abs(xe-Fe),me=Math.abs(re-H),He=Math.abs(xe-rt),Ke=ct?Ae/Bt:Number.POSITIVE_INFINITY,nn=It?Le/Vt:Number.POSITIVE_INFINITY;if((me<=Ae||!ct)&&(He<=Le||!It))break;if(Ke<nn&&ct||!It){re=Ie,xe+=_t*Ke;const qe=new N(re,Math.round(xe));y[y.length-1].x===qe.x&&y[y.length-1].y===qe.y||y.push(qe)}else{re+=ft*nn,xe=Fe;const qe=new N(Math.round(re),xe);y[y.length-1].x===qe.x&&y[y.length-1].y===qe.y||y.push(qe)}}const pe=new N(H,rt);y[y.length-1].x===pe.x&&y[y.length-1].y===pe.y||y.push(pe)}return y}function c_(i,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,u=i[2*t[0]];for(let x=1;x<t.length;x++){const M=i[2*t[x]];M<u&&(u=M,a=x)}const h=t.length;let f=a,y=(f+1)%h;for(;;){const x=f-1>=0?f-1:h-1,M=(y+1)%h,L=i[2*t[x]],z=i[2*t[M]],F=i[2*t[f]],j=i[2*t[f]+1],U=i[2*t[y]+1];let H=!1;if(L<z)H=!0;else if(L>z)H=!1;else{const rt=U-j,ct=-(i[2*t[y]]-F),It=j<U?1:-1;((L-F)*rt+(i[2*t[x]+1]-j)*ct)*It>((z-F)*rt+(i[2*t[M]+1]-j)*ct)*It&&(H=!0)}if(H){const rt=t[x],ct=t[f],It=t[y];rt!==ct&&rt!==It&&ct!==It&&n.push(It,ct,rt),f--,f<0&&(f=h-1)}else{const rt=t[M],ct=t[f],It=t[y];rt!==ct&&rt!==It&&ct!==It&&n.push(It,ct,rt),y++,y>=h&&(y=0)}if(x===M)break}}function Bf(i,t,n,a,u,h,f,y,x){const M=u.length/2,L=f&&y&&x;if(M<on.MAX_VERTEX_ARRAY_LENGTH){const z=t.prepareSegment(M,n,a),F=z.vertexLength;for(let H=0;H<h.length;H+=3)a.emplaceBack(F+h[H],F+h[H+1],F+h[H+2]);let j,U;z.vertexLength+=M,z.primitiveLength+=h.length/3,L&&(U=f.prepareSegment(M,n,y),j=U.vertexLength,U.vertexLength+=M);for(let H=0;H<u.length;H+=2)i(u[H],u[H+1]);if(L)for(let H=0;H<x.length;H++){const rt=x[H];for(let ct=1;ct<rt.length;ct+=2)y.emplaceBack(j+rt[ct-1],j+rt[ct]);U.primitiveLength+=rt.length/2}}else(function(z,F,j,U,H,rt){const ct=[];for(let Vt=0;Vt<U.length/2;Vt++)ct.push(-1);const It={count:0};let ft=0,_t=z.getOrCreateLatestSegment(F,j),Bt=_t.vertexLength;for(let Vt=2;Vt<H.length;Vt+=3){const re=H[Vt-2],xe=H[Vt-1],pe=H[Vt];let Ie=ct[re]<ft,Fe=ct[xe]<ft,Ae=ct[pe]<ft;_t.vertexLength+((Ie?1:0)+(Fe?1:0)+(Ae?1:0))>on.MAX_VERTEX_ARRAY_LENGTH&&(_t=z.createNewSegment(F,j),ft=It.count,Ie=!0,Fe=!0,Ae=!0,Bt=0);const Le=Yu(ct,U,rt,It,re,Ie,_t),me=Yu(ct,U,rt,It,xe,Fe,_t),He=Yu(ct,U,rt,It,pe,Ae,_t);j.emplaceBack(Bt+Le-ft,Bt+me-ft,Bt+He-ft),_t.primitiveLength++}})(t,n,a,u,h,i),L&&(function(z,F,j,U,H,rt){const ct=[];for(let Vt=0;Vt<U.length/2;Vt++)ct.push(-1);const It={count:0};let ft=0,_t=z.getOrCreateLatestSegment(F,j),Bt=_t.vertexLength;for(let Vt=0;Vt<H.length;Vt++){const re=H[Vt];for(let xe=1;xe<H[Vt].length;xe+=2){const pe=re[xe-1],Ie=re[xe];let Fe=ct[pe]<ft,Ae=ct[Ie]<ft;_t.vertexLength+((Fe?1:0)+(Ae?1:0))>on.MAX_VERTEX_ARRAY_LENGTH&&(_t=z.createNewSegment(F,j),ft=It.count,Fe=!0,Ae=!0,Bt=0);const Le=Yu(ct,U,rt,It,pe,Fe,_t),me=Yu(ct,U,rt,It,Ie,Ae,_t);j.emplaceBack(Bt+Le-ft,Bt+me-ft),_t.primitiveLength++}}})(f,n,y,u,x,i),t.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function Yu(i,t,n,a,u,h,f){if(h){const y=a.count;return n(t[2*u],t[2*u+1]),i[u]=a.count,a.count++,f.vertexLength++,y}return i[u]}class dd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new zt,this.indexArray=new Me,this.indexArray2=new ve,this.programConfigurations=new Pa(t.layers,t.zoom),this.segments=new on,this.segments2=new on,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,a){this.hasDependencies=Hc("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),h=!u.isConstant(),f=[];for(const{feature:y,id:x,index:M,sourceLayerIndex:L}of t){const z=this.layers[0]._featureFilter.needGeometry,F=Os(y,z);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),F,a))continue;const j=h?u.evaluate(F,{},a,n.availableImages):void 0,U={id:x,properties:y.properties,type:y.type,sourceLayerIndex:L,index:M,geometry:z?F.geometry:ra(y),patterns:{},sortKey:j};f.push(U)}h&&f.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of f){const{geometry:x,index:M,sourceLayerIndex:L}=y;if(this.hasDependencies){const z=ud("fill",this.layers,y,{zoom:this.zoom},n);this.patternFeatures.push(z)}else this.addFeature(y,x,M,a,{},n.subdivisionGranularity);n.featureIndex.insert(t[M].feature,x,M,L,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:a})}addFeatures(t,n,a){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qg),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,u,h,f){for(const y of Ys(n,500)){const x=Ff(y,u,f.fill.getGranularityForZoomLevel(u.z)),M=this.layoutVertexArray;Bf(((L,z)=>{M.emplaceBack(L,z)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:h,canonical:u})}}let Vf,jf;Ue("FillBucket",dd,{omit:["layers","patternFeatures"]});var h_={get paint(){return jf=jf||new Qi({"fill-antialias":new We(pt.paint_fill["fill-antialias"]),"fill-opacity":new en(pt.paint_fill["fill-opacity"]),"fill-color":new en(pt.paint_fill["fill-color"]),"fill-outline-color":new en(pt.paint_fill["fill-outline-color"]),"fill-translate":new We(pt.paint_fill["fill-translate"]),"fill-translate-anchor":new We(pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new jo(pt.paint_fill["fill-pattern"])})},get layout(){return Vf=Vf||new Qi({"fill-sort-key":new en(pt.layout_fill["fill-sort-key"])})}};class d_ extends Jr{constructor(t,n){super(t,h_,n)}recalculate(t,n){super.recalculate(t,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new dd(t)}queryRadius(){return Xc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:a,pixelsToTileUnits:u}){return vf(Yc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,u),n)}isTileClipped(){return!0}}const f_=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),p_=pi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:m_}=f_;class Ul{constructor(t,n,a,u,h){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=u,this._values=h,t.readFields(g_,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,a=[];let u,h=1,f=0,y=0,x=0;for(;t.pos<n;){if(f<=0){const M=t.readVarint();h=7&M,f=M>>3}if(f--,h===1||h===2)y+=t.readSVarint(),x+=t.readSVarint(),h===1&&(u&&a.push(u),u=[]),u&&u.push(new N(y,x));else{if(h!==7)throw new Error(`unknown command ${h}`);u&&u.push(u[0].clone())}}return u&&a.push(u),a}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let a=1,u=0,h=0,f=0,y=1/0,x=-1/0,M=1/0,L=-1/0;for(;t.pos<n;){if(u<=0){const z=t.readVarint();a=7&z,u=z>>3}if(u--,a===1||a===2)h+=t.readSVarint(),f+=t.readSVarint(),h<y&&(y=h),h>x&&(x=h),f<M&&(M=f),f>L&&(L=f);else if(a!==7)throw new Error(`unknown command ${a}`)}return[y,M,x,L]}toGeoJSON(t,n,a){const u=this.extent*Math.pow(2,a),h=this.extent*t,f=this.extent*n,y=this.loadGeometry();function x(F){return[360*(F.x+h)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(F.y+f)/u)*Math.PI))-90]}function M(F){return F.map(x)}let L;if(this.type===1){const F=[];for(const U of y)F.push(U[0]);const j=M(F);L=F.length===1?{type:"Point",coordinates:j[0]}:{type:"MultiPoint",coordinates:j}}else if(this.type===2){const F=y.map(M);L=F.length===1?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F}}else{if(this.type!==3)throw new Error("unknown feature type");{const F=(function(U){const H=U.length;if(H<=1)return[U];const rt=[];let ct,It;for(let ft=0;ft<H;ft++){const _t=__(U[ft]);_t!==0&&(It===void 0&&(It=_t<0),It===_t<0?(ct&&rt.push(ct),ct=[U[ft]]):ct&&ct.push(U[ft]))}return ct&&rt.push(ct),rt})(y),j=[];for(const U of F)j.push(U.map(M));L=j.length===1?{type:"Polygon",coordinates:j[0]}:{type:"MultiPolygon",coordinates:j}}}const z={type:"Feature",geometry:L,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function g_(i,t,n){i===1?t.id=n.readVarint():i===2?(function(a,u){const h=a.readVarint()+a.pos;for(;a.pos<h;){const f=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[f]=y}})(n,t):i===3?t.type=n.readVarint():i===4&&(t._geometry=n.pos)}function __(i){let t=0;for(let n,a,u=0,h=i.length,f=h-1;u<h;f=u++)n=i[u],a=i[f],t+=(a.x-n.x)*(n.y+a.y);return t}Ul.types=["Unknown","Point","LineString","Polygon"];class Gf{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(y_,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new Ul(this._pbf,n,this.extent,this._keys,this._values)}}function y_(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push((function(a){let u=null;const h=a.readVarint()+a.pos;for(;a.pos<h;){const f=a.readVarint()>>3;u=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class Uf{constructor(t,n){this.layers=t.readFields(v_,{},n)}}function v_(i,t,n){if(i===3){const a=new Gf(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}const fd=Math.pow(2,13);function Hu(i,t,n,a,u,h,f,y){i.emplaceBack(t,n,2*Math.floor(a*fd)+f,u*fd*2,h*fd*2,Math.round(y))}class pd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new St,this.centroidVertexArray=new yt,this.indexArray=new Me,this.programConfigurations=new Pa(t.layers,t.zoom),this.segments=new on,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,a){this.features=[],this.hasDependencies=Hc("fill-extrusion",this.layers,n);for(const{feature:u,id:h,index:f,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,M=Os(u,x);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),M,a))continue;const L={id:h,sourceLayerIndex:y,index:f,geometry:x?M.geometry:ra(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(ud("fill-extrusion",this.layers,L,{zoom:this.zoom},n)):this.addFeature(L,L.geometry,f,a,{},n.subdivisionGranularity),n.featureIndex.insert(u,L.geometry,f,y,this.index,!0)}}addFeatures(t,n,a){for(const u of this.features){const{geometry:h}=u;this.addFeature(u,h,u.index,n,a,t.subdivisionGranularity)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:a})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,m_),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,p_.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,a,u,h,f){for(const y of Ys(n,500)){const x={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(x,u,t,y,f);const L=this.layoutVertexArray.length-M,z=Math.floor(x.x/x.sampleCount),F=Math.floor(x.y/x.sampleCount);for(let j=0;j<L;j++)this.centroidVertexArray.emplaceBack(z,F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:h,canonical:u})}processPolygon(t,n,a,u,h){if(u.length<1||qf(u[0]))return;for(const z of u)z.length!==0&&x_(t,z);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=h.fill.getGranularityForZoomLevel(n.z),x=Ul.types[a.type]==="Polygon";for(const z of u){if(z.length===0||qf(z))continue;const F=Yo(z,y,x);this._generateSideFaces(F,f)}if(!x)return;const M=Ff(u,n,y,!1),L=this.layoutVertexArray;Bf(((z,F)=>{Hu(L,z,F,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,n){let a=0;for(let u=1;u<t.length;u++){const h=t[u],f=t[u-1];if(b_(h,f))continue;n.segment.vertexLength+4>on.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=h.sub(f)._perp()._unit(),x=f.dist(h);a+x>32768&&(a=0),Hu(this.layoutVertexArray,h.x,h.y,y.x,y.y,0,0,a),Hu(this.layoutVertexArray,h.x,h.y,y.x,y.y,0,1,a),a+=x,Hu(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,a),Hu(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,a);const M=n.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function x_(i,t){for(let n=0;n<t.length;n++){const a=t[n];n===t.length-1&&t[0].x===a.x&&t[0].y===a.y||(i.x+=a.x,i.y+=a.y,i.sampleCount++)}}function b_(i,t){return i.x===t.x&&(i.x<0||i.x>he)||i.y===t.y&&(i.y<0||i.y>he)}function qf(i){return i.every((t=>t.x<0))||i.every((t=>t.x>he))||i.every((t=>t.y<0))||i.every((t=>t.y>he))}let Zf;Ue("FillExtrusionBucket",pd,{omit:["layers","features"]});var w_={get paint(){return Zf=Zf||new Qi({"fill-extrusion-opacity":new We(pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new en(pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new We(pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new We(pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jo(pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new en(pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new en(pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new We(pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class I_ extends Jr{constructor(t,n){super(t,w_,n)}createBucket(t){return new pd(t)}queryRadius(){return Xc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:a,geometry:u,transform:h,pixelsToTileUnits:f,pixelPosMatrix:y}){const x=Yc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-h.bearingInRadians,f),M=this.paint.get("fill-extrusion-height").evaluate(n,a),L=this.paint.get("fill-extrusion-base").evaluate(n,a),z=(function(j,U){const H=[];for(const rt of j){const ct=[rt.x,rt.y,0,1];tt(ct,ct,U),H.push(new N(ct[0]/ct[3],ct[1]/ct[3]))}return H})(x,y),F=(function(j,U,H,rt){const ct=[],It=[],ft=rt[8]*U,_t=rt[9]*U,Bt=rt[10]*U,Vt=rt[11]*U,re=rt[8]*H,xe=rt[9]*H,pe=rt[10]*H,Ie=rt[11]*H;for(const Fe of j){const Ae=[],Le=[];for(const me of Fe){const He=me.x,Ke=me.y,nn=rt[0]*He+rt[4]*Ke+rt[12],qe=rt[1]*He+rt[5]*Ke+rt[13],xn=rt[2]*He+rt[6]*Ke+rt[14],ei=rt[3]*He+rt[7]*Ke+rt[15],Li=xn+Bt,nr=ei+Vt,xs=nn+re,br=qe+xe,Yi=xn+pe,ir=ei+Ie,gi=new N((nn+ft)/nr,(qe+_t)/nr);gi.z=Li/nr,Ae.push(gi);const Hi=new N(xs/ir,br/ir);Hi.z=Yi/ir,Le.push(Hi)}ct.push(Ae),It.push(Le)}return[ct,It]})(u,L,M,y);return(function(j,U,H){let rt=1/0;vf(H,U)&&(rt=$f(H,U[0]));for(let ct=0;ct<U.length;ct++){const It=U[ct],ft=j[ct];for(let _t=0;_t<It.length-1;_t++){const Bt=It[_t],Vt=[Bt,It[_t+1],ft[_t+1],ft[_t],Bt];yf(H,Vt)&&(rt=Math.min(rt,$f(H,Vt)))}}return rt!==1/0&&rt})(F[0],F[1],z)}}function Ku(i,t){return i.x*t.x+i.y*t.y}function $f(i,t){if(i.length===1){let n=0;const a=t[n++];let u;for(;!u||a.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const h=t[n],f=i[0],y=u.sub(a),x=h.sub(a),M=f.sub(a),L=Ku(y,y),z=Ku(y,x),F=Ku(x,x),j=Ku(M,y),U=Ku(M,x),H=L*F-z*z,rt=(F*j-z*U)/H,ct=(L*U-z*j)/H,It=a.z*(1-rt-ct)+u.z*rt+h.z*ct;if(isFinite(It))return It}return 1/0}{let n=1/0;for(const a of t)n=Math.min(n,a.z);return n}}const T_=pi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:S_}=T_,E_=pi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:k_}=E_,M_=Math.cos(Math.PI/180*37.5),Wf=Math.pow(2,14)/.5;class md{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Nt,this.layoutVertexArray2=new Ft,this.indexArray=new Me,this.programConfigurations=new Pa(t.layers,t.zoom),this.segments=new on,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,a){this.hasDependencies=Hc("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),h=!u.isConstant(),f=[];for(const{feature:y,id:x,index:M,sourceLayerIndex:L}of t){const z=this.layers[0]._featureFilter.needGeometry,F=Os(y,z);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),F,a))continue;const j=h?u.evaluate(F,{},a):void 0,U={id:x,properties:y.properties,type:y.type,sourceLayerIndex:L,index:M,geometry:z?F.geometry:ra(y),patterns:{},dashes:{},sortKey:j};f.push(U)}h&&f.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of f){const{geometry:x,index:M,sourceLayerIndex:L}=y;this.hasDependencies?(Hc("line",this.layers,n)?ud("line",this.layers,y,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,n),this.patternFeatures.push(y)):this.addFeature(y,x,M,a,{},{},n.subdivisionGranularity),n.featureIndex.insert(t[M].feature,x,M,L,this.index)}}update(t,n,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:a,dashPositions:u})}addFeatures(t,n,a,u){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,k_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,S_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,u,h,f,y){const x=this.layers[0].layout,M=x.get("line-join").evaluate(t,{}),L=x.get("line-cap"),z=x.get("line-miter-limit"),F=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const j of n)this.addLine(j,t,M,L,z,F,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:h,dashPositions:f,canonical:u})}addLine(t,n,a,u,h,f,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Yo(t,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ft=0;ft<t.length-1;ft++)this.totalDistance+=t[ft].dist(t[ft+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Ul.types[n.type]==="Polygon";let L=t.length;for(;L>=2&&t[L-1].equals(t[L-2]);)L--;let z=0;for(;z<L-1&&t[z].equals(t[z+1]);)z++;if(L<(M?3:2))return;a==="bevel"&&(h=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,j=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let U,H,rt,ct,It;this.e1=this.e2=-1,M&&(U=t[L-2],It=t[z].sub(U)._unit()._perp());for(let ft=z;ft<L;ft++){if(rt=ft===L-1?M?t[z+1]:void 0:t[ft+1],rt&&t[ft].equals(rt))continue;It&&(ct=It),U&&(H=U),U=t[ft],It=rt?rt.sub(U)._unit()._perp():ct,ct=ct||It;let _t=ct.add(It);_t.x===0&&_t.y===0||_t._unit();const Bt=ct.x*It.x+ct.y*It.y,Vt=_t.x*It.x+_t.y*It.y,re=Vt!==0?1/Vt:1/0,xe=2*Math.sqrt(2-2*Vt),pe=Vt<M_&&H&&rt,Ie=ct.x*It.y-ct.y*It.x>0;if(pe&&ft>z){const Le=U.dist(H);if(Le>2*F){const me=U.sub(U.sub(H)._mult(F/Le)._round());this.updateDistance(H,me),this.addCurrentVertex(me,ct,0,0,j),H=me}}const Fe=H&&rt;let Ae=Fe?a:M?"butt":u;if(Fe&&Ae==="round"&&(re<f?Ae="miter":re<=2&&(Ae="fakeround")),Ae==="miter"&&re>h&&(Ae="bevel"),Ae==="bevel"&&(re>2&&(Ae="flipbevel"),re<h&&(Ae="miter")),H&&this.updateDistance(H,U),Ae==="miter")_t._mult(re),this.addCurrentVertex(U,_t,0,0,j);else if(Ae==="flipbevel"){if(re>100)_t=It.mult(-1);else{const Le=re*ct.add(It).mag()/ct.sub(It).mag();_t._perp()._mult(Le*(Ie?-1:1))}this.addCurrentVertex(U,_t,0,0,j),this.addCurrentVertex(U,_t.mult(-1),0,0,j)}else if(Ae==="bevel"||Ae==="fakeround"){const Le=-Math.sqrt(re*re-1),me=Ie?Le:0,He=Ie?0:Le;if(H&&this.addCurrentVertex(U,ct,me,He,j),Ae==="fakeround"){const Ke=Math.round(180*xe/Math.PI/20);for(let nn=1;nn<Ke;nn++){let qe=nn/Ke;if(qe!==.5){const ei=qe-.5;qe+=qe*ei*(qe-1)*((1.0904+Bt*(Bt*(3.55645-1.43519*Bt)-3.2452))*ei*ei+(.848013+Bt*(.215638*Bt-1.06021)))}const xn=It.sub(ct)._mult(qe)._add(ct)._unit()._mult(Ie?-1:1);this.addHalfVertex(U,xn.x,xn.y,!1,Ie,0,j)}}rt&&this.addCurrentVertex(U,It,-me,-He,j)}else if(Ae==="butt")this.addCurrentVertex(U,_t,0,0,j);else if(Ae==="square"){const Le=H?1:-1;this.addCurrentVertex(U,_t,Le,Le,j)}else Ae==="round"&&(H&&(this.addCurrentVertex(U,ct,0,0,j),this.addCurrentVertex(U,ct,1,1,j,!0)),rt&&(this.addCurrentVertex(U,It,-1,-1,j,!0),this.addCurrentVertex(U,It,0,0,j)));if(pe&&ft<L-1){const Le=U.dist(rt);if(Le>2*F){const me=U.add(rt.sub(U)._mult(F/Le)._round());this.updateDistance(U,me),this.addCurrentVertex(me,It,0,0,j),U=me}}}}addCurrentVertex(t,n,a,u,h,f=!1){const y=n.y*u-n.x,x=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,f,!1,a,h),this.addHalfVertex(t,y,x,f,!0,-u,h),this.distance>Wf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,a,u,h,f))}addHalfVertex({x:t,y:n},a,u,h,f,y,x){const M=.5*(this.lineClips?this.scaledDistance*(Wf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(n<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,L,this.e2),x.primitiveLength++),f?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}hasLineDasharray(t){for(const n of t){const a=n.paint.get("line-dasharray");if(a&&!a.isConstant())return!0}return!1}addLineDashDependencies(t,n,a,u){for(const h of t){const f=h.paint.get("line-dasharray");if(!f||f.value.kind==="constant")continue;const y=h.layout.get("line-cap")==="round",x={dasharray:f.value.evaluate({zoom:a-1},n,{}),round:y},M={dasharray:f.value.evaluate({zoom:a},n,{}),round:y},L={dasharray:f.value.evaluate({zoom:a+1},n,{}),round:y},z=`${x.dasharray.join(",")},${x.round}`,F=`${M.dasharray.join(",")},${M.round}`,j=`${L.dasharray.join(",")},${L.round}`;u.dashDependencies[z]=x,u.dashDependencies[F]=M,u.dashDependencies[j]=L,n.dashes[h.id]={min:z,mid:F,max:j}}}}let Xf,Yf;Ue("LineBucket",md,{omit:["layers","patternFeatures"]});var Hf={get paint(){return Yf=Yf||new Qi({"line-opacity":new en(pt.paint_line["line-opacity"]),"line-color":new en(pt.paint_line["line-color"]),"line-translate":new We(pt.paint_line["line-translate"]),"line-translate-anchor":new We(pt.paint_line["line-translate-anchor"]),"line-width":new en(pt.paint_line["line-width"]),"line-gap-width":new en(pt.paint_line["line-gap-width"]),"line-offset":new en(pt.paint_line["line-offset"]),"line-blur":new en(pt.paint_line["line-blur"]),"line-dasharray":new jo(pt.paint_line["line-dasharray"]),"line-pattern":new jo(pt.paint_line["line-pattern"]),"line-gradient":new Go(pt.paint_line["line-gradient"])})},get layout(){return Xf=Xf||new Qi({"line-cap":new We(pt.layout_line["line-cap"]),"line-join":new en(pt.layout_line["line-join"]),"line-miter-limit":new We(pt.layout_line["line-miter-limit"]),"line-round-limit":new We(pt.layout_line["line-round-limit"]),"line-sort-key":new en(pt.layout_line["line-sort-key"])})}};class P_ extends en{possiblyEvaluate(t,n){return n=new qn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,a,u){return n=Gt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,a,u)}}let th;class C_ extends Jr{constructor(t,n){super(t,Hf,n),this.gradientVersion=0,th||(th=new P_(Hf.paint.properties["line-width"].specification),th.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Zs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=th.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new md(t)}queryRadius(t){const n=t,a=Kf(Bl("line-width",this,n),Bl("line-gap-width",this,n)),u=Bl("line-offset",this,n);return a/2+Math.abs(u)+Xc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:a,geometry:u,transform:h,pixelsToTileUnits:f}){const y=Yc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-h.bearingInRadians,f),x=f/2*Kf(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),M=this.paint.get("line-offset").evaluate(n,a);return M&&(u=(function(L,z){const F=[];for(let j=0;j<L.length;j++){const U=L[j],H=[];for(let rt=0;rt<U.length;rt++){const ct=U[rt-1],It=U[rt],ft=U[rt+1],_t=rt===0?new N(0,0):It.sub(ct)._unit()._perp(),Bt=rt===U.length-1?new N(0,0):ft.sub(It)._unit()._perp(),Vt=_t._add(Bt)._unit(),re=Vt.x*Bt.x+Vt.y*Bt.y;re!==0&&Vt._mult(1/re),H.push(Vt._mult(z)._add(It))}F.push(H)}return F})(u,M*f)),(function(L,z,F){for(let j=0;j<z.length;j++){const U=z[j];if(L.length>=3){for(let H=0;H<U.length;H++)if(Fl(L,U[H]))return!0}if(Og(L,U,F))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function Kf(i,t){return t>0?t+2*i:i}const A_=pi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),L_=pi([{name:"a_projected_pos",components:3,type:"Float32"}],4);pi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const D_=pi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);pi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jf=pi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),R_=pi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function z_(i,t,n){return i.sections.forEach((a=>{a.text=(function(u,h,f){const y=h.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Qs.applyArabicShaping&&(u=Qs.applyArabicShaping(u)),u})(a.text,t,n)})),i}pi([{name:"triangle",components:3,type:"Uint16"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),pi([{type:"Float32",name:"offsetX"}]),pi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),pi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Bi=24;const Ju={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},N_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},O_={40:!0};function Qf(i,t,n,a,u,h){if("fontStack"in t){const f=n[t.fontStack],y=f&&f[i];return y?y.metrics.advance*t.scale+u:0}{const f=a[t.imageName];return f?f.displaySize[0]*t.scale*Bi/h+u:0}}function tp(i,t,n,a){const u=Math.pow(i-t,2);return a?i<t?u/2:2*u:u+Math.abs(n)*n}function F_(i,t,n){let a=0;return i===10&&(a-=1e4),n&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function ep(i,t,n,a,u,h){let f=null,y=tp(t,n,u,h);for(const x of a){const M=tp(t-x.x,n,u,h)+x.badness;M<=y&&(f=x,y=M)}return{index:i,x:t,priorBreak:f,badness:y}}function np(i){return i?np(i.priorBreak).concat(i.index):[]}class ql{constructor(t="",n=[],a=[]){this.text=t,this.sections=n,this.sectionIndex=a,this.imageSectionID=null}static fromFeature(t,n){const a=new ql;for(let u=0;u<t.sections.length;u++){const h=t.sections[u];h.image?a.addImageSection(h):a.addTextSection(h,n)}return a}length(){return[...this.text].length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}verticalizePunctuation(){this.text=(function(t){let n="",a={premature:!0,value:void 0};const u=t[Symbol.iterator]();let h=u.next();const f=t[Symbol.iterator]();f.next();let y=f.next();for(;!h.done;)n+=!y.done&&Pu(y.value.codePointAt(0))&&!Ju[y.value]||!a.premature&&Pu(a.value.codePointAt(0))&&!Ju[a.value]||!Ju[h.value]?h.value:Ju[h.value],a={value:h.value,premature:!1},h=u.next(),y=f.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const t=this.text.match(/^\s*/),n=t?t[0].length:0,a=this.text.match(/\S\s*$/),u=a?a[0].length-1:0;this.text=this.text.substring(n,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-u)}substring(t,n){const a=[...this.text].slice(t,n).join(""),u=this.sectionIndex.slice(t,n);return new ql(a,this.sections,u)}toCodeUnitIndex(t){return[...this.text].slice(0,t).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,a=0;for(let u=0;u<this.length();u++){const h=this.getSection(u);if("imageName"in h){const f=t[h.imageName];if(!f)continue;const y=f.displaySize;n=Math.max(n,y[0]),a=Math.max(a,y[1])}}return{maxImageWidth:n,maxImageHeight:a}}addTextSection(t,n){this.text+=t.text,this.sections.push({scale:t.scale||1,verticalAlign:t.verticalAlign||"bottom",fontStack:t.fontStack||n});const a=this.sections.length-1;this.sectionIndex.push(...[...t.text].map((()=>a)))}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void et("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push({scale:1,verticalAlign:t.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(t,n,a,u,h){const f=[],y=this.determineAverageLineWidth(t,n,a,u,h),x=this.hasZeroWidthSpaces();let M=0,L=0;const z=this.text[Symbol.iterator]();let F=z.next();const j=this.text[Symbol.iterator]();j.next();let U=j.next();const H=this.text[Symbol.iterator]();H.next(),H.next();let rt=H.next();for(;!F.done;){const ct=this.getSection(L),It=F.value.codePointAt(0);if(zc(It)||(M+=Qf(It,ct,a,u,t,h)),!U.done){const ft=Xh(It),_t=U.value.codePointAt(0);(N_[It]||ft||"imageName"in ct||!rt.done&&O_[_t])&&f.push(ep(L+1,M,y,f,F_(It,_t,ft&&x),!1))}L++,F=z.next(),U=j.next(),rt=H.next()}return np(ep(this.length(),M,y,f,0,!0))}determineAverageLineWidth(t,n,a,u,h){let f=0,y=0;for(const x of this.text){const M=this.getSection(y);f+=Qf(x.codePointAt(0),M,a,u,t,h),y++}return f/Math.max(1,Math.ceil(f/n))}}const gd=4294967296,ip=1/gd,rp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class _d{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,a=this.length){for(;this.pos<a;){const u=this.readVarint(),h=u>>3,f=this.pos;this.type=7&u,t(h,n,this),this.pos===f&&this.skip(u)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*gd;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*gd;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let a,u;return u=n[this.pos++],a=127&u,u<128?a:(u=n[this.pos++],a|=(127&u)<<7,u<128?a:(u=n[this.pos++],a|=(127&u)<<14,u<128?a:(u=n[this.pos++],a|=(127&u)<<21,u<128?a:(u=n[this.pos],a|=(15&u)<<28,(function(h,f,y){const x=y.buf;let M,L;if(L=x[y.pos++],M=(112&L)>>4,L<128||(L=x[y.pos++],M|=(127&L)<<3,L<128)||(L=x[y.pos++],M|=(127&L)<<10,L<128)||(L=x[y.pos++],M|=(127&L)<<17,L<128)||(L=x[y.pos++],M|=(127&L)<<24,L<128)||(L=x[y.pos++],M|=(1&L)<<31,L<128))return Zl(h,M,f);throw new Error("Expected varint not more than 10 bytes")})(a,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&rp?rp.decode(this.buf.subarray(n,t)):(function(a,u,h){let f="",y=u;for(;y<h;){const x=a[y];let M,L,z,F=null,j=x>239?4:x>223?3:x>191?2:1;if(y+j>h)break;j===1?x<128&&(F=x):j===2?(M=a[y+1],(192&M)==128&&(F=(31&x)<<6|63&M,F<=127&&(F=null))):j===3?(M=a[y+1],L=a[y+2],(192&M)==128&&(192&L)==128&&(F=(15&x)<<12|(63&M)<<6|63&L,(F<=2047||F>=55296&&F<=57343)&&(F=null))):j===4&&(M=a[y+1],L=a[y+2],z=a[y+3],(192&M)==128&&(192&L)==128&&(192&z)==128&&(F=(15&x)<<18|(63&M)<<12|(63&L)<<6|63&z,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,j=1):F>65535&&(F-=65536,f+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),f+=String.fromCharCode(F),y+=j}return f})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const a=new Uint8Array(n);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ip),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ip),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,a){let u,h;if(n>=0?(u=n%4294967296|0,h=n/4294967296|0):(u=~(-n%4294967296),h=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(f,y,x){x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7)})(u,0,a),(function(f,y){const x=(7&f)<<4;y.buf[y.pos++]|=x|((f>>>=3)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f|((f>>>=7)?128:0),f&&(y.buf[y.pos++]=127&f)))))})(h,a)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(u,h,f){for(let y,x,M=0;M<h.length;M++){if(y=h.charCodeAt(M),y>55295&&y<57344){if(!x){y>56319||M+1===h.length?(u[f++]=239,u[f++]=191,u[f++]=189):x=y;continue}if(y<56320){u[f++]=239,u[f++]=191,u[f++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[f++]=239,u[f++]=191,u[f++]=189,x=null);y<128?u[f++]=y:(y<2048?u[f++]=y>>6|192:(y<65536?u[f++]=y>>12|224:(u[f++]=y>>18|240,u[f++]=y>>12&63|128),u[f++]=y>>6&63|128),u[f++]=63&y|128)}return f})(this.buf,t,this.pos);const a=this.pos-n;a>=128&&sp(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let a=0;a<n;a++)this.buf[this.pos++]=t[a]}writeRawMessage(t,n){this.pos++;const a=this.pos;t(n,this);const u=this.pos-a;u>=128&&sp(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u}writeMessage(t,n,a){this.writeTag(t,2),this.writeRawMessage(n,a)}writePackedVarint(t,n){n.length&&this.writeMessage(t,B_,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,V_,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,U_,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,j_,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,G_,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,q_,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,Z_,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,$_,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,W_,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function Zl(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function sp(i,t,n){const a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(let u=n.pos-1;u>=i;u--)n.buf[u+a]=n.buf[u]}function B_(i,t){for(let n=0;n<i.length;n++)t.writeVarint(i[n])}function V_(i,t){for(let n=0;n<i.length;n++)t.writeSVarint(i[n])}function j_(i,t){for(let n=0;n<i.length;n++)t.writeFloat(i[n])}function G_(i,t){for(let n=0;n<i.length;n++)t.writeDouble(i[n])}function U_(i,t){for(let n=0;n<i.length;n++)t.writeBoolean(i[n])}function q_(i,t){for(let n=0;n<i.length;n++)t.writeFixed32(i[n])}function Z_(i,t){for(let n=0;n<i.length;n++)t.writeSFixed32(i[n])}function $_(i,t){for(let n=0;n<i.length;n++)t.writeFixed64(i[n])}function W_(i,t){for(let n=0;n<i.length;n++)t.writeSFixed64(i[n])}function X_(i,t,n){i===1&&n.readMessage(Y_,t)}function Y_(i,t,n){if(i===3){const{id:a,bitmap:u,width:h,height:f,left:y,top:x,advance:M}=n.readMessage(H_,{});t.push({id:a,bitmap:new Uu({width:h+6,height:f+6},u),metrics:{width:h,height:f,left:y,top:x,advance:M}})}}function H_(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}function ap(i){let t=0,n=0;for(const f of i)t+=f.w*f.h,n=Math.max(n,f.w);i.sort(((f,y)=>y.h-f.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,h=0;for(const f of i)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,h=Math.max(h,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===x.w&&f.h===x.h){const M=a.pop();M&&y<a.length&&(a[y]=M)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(a.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:u,h,fill:t/(u*h)||0}}class yd{constructor(t,{pixelRatio:n,version:a,stretchX:u,stretchY:h,content:f,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=h,this.content=f,this.version=a,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class op{constructor(t,n){const a={},u={};this.haveRenderCallbacks=[];const h=[];this.addImages(t,a,h),this.addImages(n,u,h);const{w:f,h:y}=ap(h),x=new Rr({width:f||1,height:y||1});for(const M in t){const L=t[M],z=a[M].paddedRect;Rr.copy(L.data,x,{x:0,y:0},{x:z.x+1,y:z.y+1},L.data)}for(const M in n){const L=n[M],z=u[M].paddedRect,F=z.x+1,j=z.y+1,U=L.data.width,H=L.data.height;Rr.copy(L.data,x,{x:0,y:0},{x:F,y:j},L.data),Rr.copy(L.data,x,{x:0,y:H-1},{x:F,y:j-1},{width:U,height:1}),Rr.copy(L.data,x,{x:0,y:0},{x:F,y:j+H},{width:U,height:1}),Rr.copy(L.data,x,{x:U-1,y:0},{x:F-1,y:j},{width:1,height:H}),Rr.copy(L.data,x,{x:0,y:0},{x:F+U,y:j},{width:1,height:H})}this.image=x,this.iconPositions=a,this.patternPositions=u}addImages(t,n,a){for(const u in t){const h=t[u],f={x:0,y:0,w:h.data.width+2,h:h.data.height+2};a.push(f),n[u]=new yd(f,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,h]=t.tl;a.update(n.data,void 0,{x:u,y:h})}}var Ka;function eh(i,t,n,a,u,h,f,y,x,M,L,z,F,j,U){const H=ql.fromFeature(i,u);let rt;z===b.ay.vertical&&H.verticalizePunctuation();let ct=H.determineLineBreaks(M,h,t,a,j);const{processBidirectionalText:It,processStyledBidirectionalText:ft}=Qs;if(It&&H.sections.length===1){rt=[],ct=ct.map((re=>H.toCodeUnitIndex(re)));const Vt=It(H.toString(),ct);for(const re of Vt){const xe=[...re].map((()=>0));rt.push(new ql(re,H.sections,xe))}}else if(ft){rt=[],ct=ct.map((pe=>H.toCodeUnitIndex(pe)));let Vt=0;const re=[];for(const pe of H.text)re.push(...Array(pe.length).fill(H.sectionIndex[Vt])),Vt++;const xe=ft(H.text,re,ct);for(const pe of xe){const Ie=[];let Fe="";for(const Ae of pe[0])Ie.push(pe[1][Fe.length]),Fe+=Ae;rt.push(new ql(pe[0],H.sections,Ie))}}else rt=(function(Vt,re){const xe=[];let pe=0;for(const Ie of re)xe.push(Vt.substring(pe,Ie)),pe=Ie;return pe<Vt.length()&&xe.push(Vt.substring(pe,Vt.length())),xe})(H,ct);const _t=[],Bt={positionedLines:_t,text:H.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:z,iconsInText:!1,verticalizable:!1};return(function(Vt,re,xe,pe,Ie,Fe,Ae,Le,me,He,Ke,nn){let qe=0,xn=0,ei=0,Li=0;const nr=Le==="right"?1:Le==="left"?0:.5,xs=Bi/nn;let br=0;for(const gi of Ie){gi.trim();const Hi=gi.getMaxScale(),cr={positionedGlyphs:[],lineOffset:0};Vt.positionedLines[br]=cr;const hr=cr.positionedGlyphs;let zr=0;if(!gi.length()){xn+=Fe,++br;continue}const rr=K_(pe,gi,xs);let Nr=0;for(const Gi of gi.text){const ai=gi.getSection(Nr),Di=Gi.codePointAt(0),hi=J_(me,Ke,Di),Ui={glyph:Di,imageName:null,x:qe,y:xn+-17,vertical:hi,scale:1,fontStack:"",sectionIndex:gi.getSectionIndex(Nr),metrics:null,rect:null};let La;if("fontStack"in ai){if(La=Q_(ai,Di,hi,rr,re,xe),!La)continue;Ui.fontStack=ai.fontStack}else{if(Vt.iconsInText=!0,ai.scale*=xs,La=ty(ai,hi,Hi,rr,pe),!La)continue;zr=Math.max(zr,La.imageOffset),Ui.imageName=ai.imageName}const{rect:Vs,metrics:uc,baselineOffset:no}=La;Ui.y+=no,Ui.scale=ai.scale,Ui.metrics=uc,Ui.rect=Vs,hr.push(Ui),hi?(Vt.verticalizable=!0,qe+=("imageName"in ai?uc.advance:Bi)*ai.scale+He):qe+=uc.advance*ai.scale+He,Nr++}hr.length!==0&&(ei=Math.max(qe-He,ei),ey(hr,0,hr.length-1,nr)),qe=0,cr.lineOffset=Math.max(zr,(Hi-1)*Bi);const bs=Fe*Hi+zr;xn+=bs,Li=Math.max(bs,Li),++br}const{horizontalAlign:Yi,verticalAlign:ir}=vd(Ae);(function(gi,Hi,cr,hr,zr,rr,Nr,bs,Gi){const ai=(Hi-cr)*zr;let Di=0;Di=rr!==Nr?-bs*hr- -17:-hr*Gi*Nr+.5*Nr;for(const hi of gi)for(const Ui of hi.positionedGlyphs)Ui.x+=ai,Ui.y+=Di})(Vt.positionedLines,nr,Yi,ir,ei,Li,Fe,xn,Ie.length),Vt.top+=-ir*xn,Vt.bottom=Vt.top+xn,Vt.left+=-Yi*ei,Vt.right=Vt.left+ei})(Bt,t,n,a,rt,f,y,x,z,M,F,U),!(function(Vt){for(const re of Vt)if(re.positionedGlyphs.length!==0)return!1;return!0})(_t)&&Bt}function vd(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function K_(i,t,n){const a=t.getMaxScale()*Bi,{maxImageWidth:u,maxImageHeight:h}=t.getMaxImageSize(i),f=Math.max(a,h*n);return{verticalLineContentWidth:Math.max(a,u*n),horizontalLineContentHeight:f}}function lp(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function J_(i,t,n){return!(i===b.ay.horizontal||!t&&!Xa(n)||t&&(zc(n)||(a=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function Q_(i,t,n,a,u,h){const f=h[i.fontStack],y=(function(M,L,z,F){if(M&&M.rect)return M;const j=L[z.fontStack],U=j&&j[F];return U?{rect:null,metrics:U.metrics}:null})(f&&f[t],u,i,t);if(y===null)return null;let x;if(n)x=a.verticalLineContentWidth-i.scale*Bi;else{const M=lp(i.verticalAlign);x=(a.horizontalLineContentHeight-i.scale*Bi)*M}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function ty(i,t,n,a,u){const h=u[i.imageName];if(!h)return null;const f=h.paddedRect,y=h.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:t?y[1]:y[0]};let M;if(t)M=a.verticalLineContentWidth-y[1]*i.scale;else{const L=lp(i.verticalAlign);M=(a.horizontalLineContentHeight-y[1]*i.scale)*L}return{rect:f,metrics:x,baselineOffset:M,imageOffset:(t?y[0]:y[1])*i.scale-Bi*n}}function ey(i,t,n,a){if(a===0)return;const u=i[n],h=(i[n].x+u.metrics.advance*u.scale)*a;for(let f=t;f<=n;f++)i[f].x-=h}function ny(i,t,n){const{horizontalAlign:a,verticalAlign:u}=vd(n),h=t[0]-i.displaySize[0]*a,f=t[1]-i.displaySize[1]*u;return{image:i,top:f,bottom:f+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function up(i){var t,n;let a=i.left,u=i.top,h=i.right-a,f=i.bottom-u;const y=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",M=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&h/f<M||y==="proportional"){const L=Math.ceil(f*M);a*=L/h,h=L}}else if(y==="proportional"&&x==="stretchOnly"&&M!==0&&h/f>M){const L=Math.ceil(h/M);u*=L/f,f=L}return{x1:a,y1:u,x2:a+h,y2:u+f}}function cp(i,t,n,a,u,h){const f=i.image;let y;if(f.content){const rt=f.content,ct=f.pixelRatio||1;y=[rt[0]/ct,rt[1]/ct,f.displaySize[0]-rt[2]/ct,f.displaySize[1]-rt[3]/ct]}const x=t.left*h,M=t.right*h;let L,z,F,j;n==="width"||n==="both"?(j=u[0]+x-a[3],z=u[0]+M+a[1]):(j=u[0]+(x+M-f.displaySize[0])/2,z=j+f.displaySize[0]);const U=t.top*h,H=t.bottom*h;return n==="height"||n==="both"?(L=u[1]+U-a[0],F=u[1]+H+a[2]):(L=u[1]+(U+H-f.displaySize[1])/2,F=L+f.displaySize[1]),{image:f,top:L,right:z,bottom:F,left:j,collisionPadding:y}}Ue("ImagePosition",yd),Ue("ImageAtlas",op),b.ay=void 0,(Ka=b.ay||(b.ay={}))[Ka.none=0]="none",Ka[Ka.horizontal=1]="horizontal",Ka[Ka.vertical=2]="vertical",Ka[Ka.horizontalOnly=3]="horizontalOnly";const Ca=128,Ja=32640;function hp(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new qn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=n;let h=0;for(;h<a.length&&a[h]<=i;)h++;h=Math.max(0,h-1);let f=h;for(;f<a.length&&a[f]<i+1;)f++;f=Math.min(a.length-1,f);const y=a[h],x=a[f];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new qn(y)),maxSize:n.evaluate(new qn(x)),interpolationType:u}}}function xd(i,t,n){let a="never";const u=i.get(t);return u?a=u:i.get(n)&&(a="always"),a}const iy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nh(i,t,n,a,u,h,f,y,x,M,L,z,F){const j=y?Math.min(Ja,Math.round(y[0])):0,U=y?Math.min(Ja,Math.round(y[1])):0;i.emplaceBack(t,n,Math.round(32*a),Math.round(32*u),h,f,(j<<1)+(x?1:0),U,16*M,16*L,256*z,256*F)}function bd(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function ry(i){for(const t of i.sections)if(Fc(t.text))return!0;return!1}class wd{constructor(t){this.layoutVertexArray=new oe,this.indexArray=new Me,this.programConfigurations=t,this.segments=new on,this.dynamicLayoutVertexArray=new ee,this.opacityVertexArray=new ie,this.hasVisibleVertices=!1,this.placedSymbolArray=new C}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,A_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,L_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,iy,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ue("SymbolBuffers",wd);class Id{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new on,this.collisionVertexArray=new De}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,D_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ue("CollisionBuffers",Id);class $l{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hp(this.zoom,n["text-size"]),this.iconSizeData=hp(this.zoom,n["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.canOverlap=xd(a,"text-overlap","text-allow-overlap")!=="never"||xd(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map((f=>b.ay[f]))),this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id)),this.sourceID=t.sourceID}createArrays(){this.text=new wd(new Pa(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new wd(new Pa(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new X,this.lineVertexArray=new Z,this.symbolInstances=new O,this.textAnchorOffsets=new ot}calculateGlyphDependencies(t,n,a,u,h){for(const f of t)if(n[f.codePointAt(0)]=!0,(a||u)&&h){const y=Ju[f];y&&(n[y.codePointAt(0)]=!0)}}populate(t,n,a){const u=this.layers[0],h=u.layout,f=h.get("text-font"),y=h.get("text-field"),x=h.get("icon-image"),M=(y.value.kind!=="constant"||y.value.value instanceof Cn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),L=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,z=h.get("symbol-sort-key");if(this.features=[],!M&&!L)return;const F=n.iconDependencies,j=n.glyphDependencies,U=n.availableImages,H=new qn(this.zoom);for(const{feature:rt,id:ct,index:It,sourceLayerIndex:ft}of t){const _t=u._featureFilter.needGeometry,Bt=Os(rt,_t);if(!u._featureFilter.filter(H,Bt,a))continue;let Vt,re;if(_t||(Bt.geometry=ra(rt)),M){const pe=u.getValueAndResolveTokens("text-field",Bt,a,U),Ie=Cn.factory(pe),Fe=this.hasRTLText=this.hasRTLText||ry(Ie);(!Fe||Qs.getRTLTextPluginStatus()==="unavailable"||Fe&&Qs.isParsed())&&(Vt=z_(Ie,u,Bt))}if(L){const pe=u.getValueAndResolveTokens("icon-image",Bt,a,U);re=pe instanceof Wi?pe:Wi.fromString(pe)}if(!Vt&&!re)continue;const xe=this.sortFeaturesByKey?z.evaluate(Bt,{},a):void 0;if(this.features.push({id:ct,text:Vt,icon:re,index:It,sourceLayerIndex:ft,geometry:Bt.geometry,properties:rt.properties,type:Ul.types[rt.type],sortKey:xe}),re&&(F[re.name]=!0),Vt){const pe=f.evaluate(Bt,{},a).join(","),Ie=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.ay.vertical)>=0;for(const Fe of Vt.sections)if(Fe.image)F[Fe.image.name]=!0;else{const Ae=Fo(Vt.toString()),Le=Fe.fontStack||pe,me=j[Le]=j[Le]||{};this.calculateGlyphDependencies(Fe.text,me,Ie,this.allowVerticalPlacement,Ae)}}}h.get("symbol-placement")==="line"&&(this.features=(function(rt){const ct={},It={},ft=[];let _t=0;function Bt(pe){ft.push(rt[pe]),_t++}function Vt(pe,Ie,Fe){const Ae=It[pe];return delete It[pe],It[Ie]=Ae,ft[Ae].geometry[0].pop(),ft[Ae].geometry[0]=ft[Ae].geometry[0].concat(Fe[0]),Ae}function re(pe,Ie,Fe){const Ae=ct[Ie];return delete ct[Ie],ct[pe]=Ae,ft[Ae].geometry[0].shift(),ft[Ae].geometry[0]=Fe[0].concat(ft[Ae].geometry[0]),Ae}function xe(pe,Ie,Fe){const Ae=Fe?Ie[0][Ie[0].length-1]:Ie[0][0];return`${pe}:${Ae.x}:${Ae.y}`}for(let pe=0;pe<rt.length;pe++){const Ie=rt[pe],Fe=Ie.geometry,Ae=Ie.text?Ie.text.toString():null;if(!Ae){Bt(pe);continue}const Le=xe(Ae,Fe),me=xe(Ae,Fe,!0);if(Le in It&&me in ct&&It[Le]!==ct[me]){const He=re(Le,me,Fe),Ke=Vt(Le,me,ft[He].geometry);delete ct[Le],delete It[me],It[xe(Ae,ft[Ke].geometry,!0)]=Ke,ft[He].geometry=null}else Le in It?Vt(Le,me,Fe):me in ct?re(Le,me,Fe):(Bt(pe),ct[Le]=_t-1,It[me]=_t-1)}return ft.filter((pe=>pe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((rt,ct)=>rt.sortKey-ct.sortKey))}update(t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:a}),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:a}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const a=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),h=t.dist(n[t.segment]);const f={};for(let y=t.segment+1;y<n.length;y++)f[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:u},y<n.length-1&&(u+=n[y+1].dist(n[y]));for(let y=t.segment||0;y>=0;y--)f[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:h},y>0&&(h+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=f[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,u,h,f,y,x,M,L,z,F){const j=t.indexArray,U=t.layoutVertexArray,H=t.segments.prepareSegment(4*n.length,U,j,this.canOverlap?f.sortKey:void 0),rt=this.glyphOffsetArray.length,ct=H.vertexLength,It=this.allowVerticalPlacement&&y===b.ay.vertical?Math.PI/2:0,ft=f.text&&f.text.sections;for(let _t=0;_t<n.length;_t++){const{tl:Bt,tr:Vt,bl:re,br:xe,tex:pe,pixelOffsetTL:Ie,pixelOffsetBR:Fe,minFontScaleX:Ae,minFontScaleY:Le,glyphOffset:me,isSDF:He,sectionIndex:Ke}=n[_t],nn=H.vertexLength,qe=me[1];nh(U,x.x,x.y,Bt.x,qe+Bt.y,pe.x,pe.y,a,He,Ie.x,Ie.y,Ae,Le),nh(U,x.x,x.y,Vt.x,qe+Vt.y,pe.x+pe.w,pe.y,a,He,Fe.x,Ie.y,Ae,Le),nh(U,x.x,x.y,re.x,qe+re.y,pe.x,pe.y+pe.h,a,He,Ie.x,Fe.y,Ae,Le),nh(U,x.x,x.y,xe.x,qe+xe.y,pe.x+pe.w,pe.y+pe.h,a,He,Fe.x,Fe.y,Ae,Le),bd(t.dynamicLayoutVertexArray,x,It),j.emplaceBack(nn,nn+2,nn+1),j.emplaceBack(nn+1,nn+2,nn+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(me[0]),_t!==n.length-1&&Ke===n[_t+1].sectionIndex||t.programConfigurations.populatePaintArrays(U.length,f,f.index,{imagePositions:{},canonical:F,formattedSection:ft&&ft[Ke]})}t.placedSymbolArray.emplaceBack(x.x,x.y,rt,this.glyphOffsetArray.length-rt,ct,M,L,x.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,z)}_addCollisionDebugVertex(t,n,a,u,h,f){return n.emplaceBack(0,0),t.emplaceBack(a.x,a.y,u,h,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,n,a,u,h,f,y){const x=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),M=x.vertexLength,L=h.layoutVertexArray,z=h.collisionVertexArray,F=y.anchorX,j=y.anchorY;this._addCollisionDebugVertex(L,z,f,F,j,new N(t,n)),this._addCollisionDebugVertex(L,z,f,F,j,new N(a,n)),this._addCollisionDebugVertex(L,z,f,F,j,new N(a,u)),this._addCollisionDebugVertex(L,z,f,F,j,new N(t,u)),x.vertexLength+=4;const U=h.indexArray;U.emplaceBack(M,M+1),U.emplaceBack(M+1,M+2),U.emplaceBack(M+2,M+3),U.emplaceBack(M+3,M),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,a,u){for(let h=t;h<n;h++){const f=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,u?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Id(ae,Jf.members,ve),this.iconCollisionBox=new Id(ae,Jf.members,ve);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,a,u,h,f,y,x,M){const L={};for(let z=n;z<a;z++){const F=t.get(z);L.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},L.textFeatureIndex=F.featureIndex;break}for(let z=u;z<h;z++){const F=t.get(z);L.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},L.verticalTextFeatureIndex=F.featureIndex;break}for(let z=f;z<y;z++){const F=t.get(z);L.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},L.iconFeatureIndex=F.featureIndex;break}for(let z=x;z<M;z++){const F=t.get(z);L.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},L.verticalIconFeatureIndex=F.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const a=t.placedSymbolArray.get(n),u=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<u;h+=4)t.indexArray.emplaceBack(h,h+2,h+1),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),a=Math.cos(t),u=[],h=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(n*x.anchorX+a*x.anchorY)),h.push(x.featureIndex)}return f.sort(((y,x)=>u[y]-u[x]||h[x]-h[y])),f}addToSortKeyRanges(t,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(((u,h,f)=>{u>=0&&f.indexOf(u)===h&&this.addIndicesForPlacedSymbol(this.text,u)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let dp,fp;Ue("SymbolBucket",$l,{omit:["layers","collisionBoxArray","features","compareText"]}),$l.MAX_GLYPHS=65535,$l.addDynamicAttributes=bd;var Td={get paint(){return fp=fp||new Qi({"icon-opacity":new en(pt.paint_symbol["icon-opacity"]),"icon-color":new en(pt.paint_symbol["icon-color"]),"icon-halo-color":new en(pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new en(pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new en(pt.paint_symbol["icon-halo-blur"]),"icon-translate":new We(pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new We(pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new en(pt.paint_symbol["text-opacity"]),"text-color":new en(pt.paint_symbol["text-color"],{runtimeType:Pi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new en(pt.paint_symbol["text-halo-color"]),"text-halo-width":new en(pt.paint_symbol["text-halo-width"]),"text-halo-blur":new en(pt.paint_symbol["text-halo-blur"]),"text-translate":new We(pt.paint_symbol["text-translate"]),"text-translate-anchor":new We(pt.paint_symbol["text-translate-anchor"])})},get layout(){return dp=dp||new Qi({"symbol-placement":new We(pt.layout_symbol["symbol-placement"]),"symbol-spacing":new We(pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new We(pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new en(pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new We(pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new We(pt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new We(pt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new We(pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new We(pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new We(pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new en(pt.layout_symbol["icon-size"]),"icon-text-fit":new We(pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new We(pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new en(pt.layout_symbol["icon-image"]),"icon-rotate":new en(pt.layout_symbol["icon-rotate"]),"icon-padding":new en(pt.layout_symbol["icon-padding"]),"icon-keep-upright":new We(pt.layout_symbol["icon-keep-upright"]),"icon-offset":new en(pt.layout_symbol["icon-offset"]),"icon-anchor":new en(pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new We(pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new We(pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new We(pt.layout_symbol["text-rotation-alignment"]),"text-field":new en(pt.layout_symbol["text-field"]),"text-font":new en(pt.layout_symbol["text-font"]),"text-size":new en(pt.layout_symbol["text-size"]),"text-max-width":new en(pt.layout_symbol["text-max-width"]),"text-line-height":new We(pt.layout_symbol["text-line-height"]),"text-letter-spacing":new en(pt.layout_symbol["text-letter-spacing"]),"text-justify":new en(pt.layout_symbol["text-justify"]),"text-radial-offset":new en(pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new We(pt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new en(pt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new en(pt.layout_symbol["text-anchor"]),"text-max-angle":new We(pt.layout_symbol["text-max-angle"]),"text-writing-mode":new We(pt.layout_symbol["text-writing-mode"]),"text-rotate":new en(pt.layout_symbol["text-rotate"]),"text-padding":new We(pt.layout_symbol["text-padding"]),"text-keep-upright":new We(pt.layout_symbol["text-keep-upright"]),"text-transform":new en(pt.layout_symbol["text-transform"]),"text-offset":new en(pt.layout_symbol["text-offset"]),"text-allow-overlap":new We(pt.layout_symbol["text-allow-overlap"]),"text-overlap":new We(pt.layout_symbol["text-overlap"]),"text-ignore-placement":new We(pt.layout_symbol["text-ignore-placement"]),"text-optional":new We(pt.layout_symbol["text-optional"])})}};class pp{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Nn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ue("FormatSectionOverride",pp,{omit:["defaultValue"]});class ih extends Jr{constructor(t,n){super(t,Td,n)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const h of a)u.indexOf(h)<0&&u.push(h);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,u){const h=this.layout.get(t).evaluate(n,{},a,u),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||xl(f.value)||!h?h:(function(y,x){return x.replace(/{([^{}]+)}/g,((M,L)=>y&&L in y?String(y[L]):""))})(n.properties,h)}createBucket(t){return new $l(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Td.paint.overridableProperties){if(!ih.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),a=new pp(n),u=new vl(a,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new xa("source",u):new wl("composite",u,n.value.zoomStops),this.paint._values[t]=new ls(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&ih.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const a=t.get("text-field"),u=Td.paint.properties[n];let h=!1;const f=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Cn)f(a.value.value.sections);else if(a.value.kind==="source"||a.value.kind==="composite"){const y=M=>{h||(M instanceof is&&Un(M.value)===Fr?f(M.value.sections):M instanceof bi?f(M.sections):M.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return h}}let mp;var sy={get paint(){return mp=mp||new Qi({"background-color":new We(pt.paint_background["background-color"]),"background-pattern":new jc(pt.paint_background["background-pattern"]),"background-opacity":new We(pt.paint_background["background-opacity"])})}};class ay extends Jr{constructor(t,n){super(t,sy,n)}}class oy extends Jr{constructor(t,n){super(t,{},n),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ly{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const uy={once:!0},Sd=63710088e-1;class Qa{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qa(Pn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,a=this.lat*n,u=t.lat*n,h=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return Sd*Math.acos(Math.min(h,1))}static convert(t){if(t instanceof Qa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Qa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Qa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gp=2*Math.PI*Sd;function _p(i){return gp*Math.cos(i*Math.PI/180)}function yp(i){return(180+i)/360}function vp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function xp(i,t){return i/_p(t)}function bp(i){return 360*i-180}function rh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function wp(i,t){return i*_p(rh(t))}class Qu{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){const a=Qa.convert(t);return new Qu(yp(a.lng),vp(a.lat),xp(n,a.lat))}toLngLat(){return new Qa(bp(this.x),rh(this.y))}toAltitude(){return wp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gp*(t=rh(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ip(i,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Ed{constructor(t,n,a){if(!(function(u,h,f){return!(u<0||u>25||f<0||f>=Math.pow(2,u)||h<0||h>=Math.pow(2,u))})(t,n,a))throw new Error(`x=${n}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=a,this.key=Wl(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,a){const u=(f=this.y,y=this.z,x=Ip(256*(h=this.x),256*(f=Math.pow(2,y)-f-1),y),M=Ip(256*(h+1),256*(f+1),y),x[0]+","+x[1]+","+M[0]+","+M[1]);var h,f,y,x,M;const L=(function(z,F,j){let U,H="";for(let rt=z;rt>0;rt--)U=1<<rt-1,H+=(F&U?1:0)+(j&U?2:0);return H})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new N((t.x*n-this.x)*he,(t.y*n-this.y)*he)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tp{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Wl(t,n.z,n.z,n.x,n.y)}}class us{constructor(t,n,a,u,h){if(this.terrainRttPosMatrix32f=null,t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Ed(a,+u,+h),this.key=Wl(n,t,a,u,h)}clone(){return new us(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new us(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?Wl(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Wl(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-t.canonical.z;return!(n<0)&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new us(n,this.wrap,n,a,u),new us(n,this.wrap,n,a+1,u),new us(n,this.wrap,n,a,u+1),new us(n,this.wrap,n,a+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new us(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Qu(t.x-this.wrap,t.y))}}function Wl(i,t,n,a,u){(i*=2)<0&&(i=-1*i-1);const h=1<<n;return(h*h*i+h*u+a).toString(36)+n.toString(36)+t.toString(36)}function tc(i,t){return t?i.properties[t]:i.id}function cy(i,t){const n={id:i.id};if(t.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(const a of t.removeProperties){const u=i.addOrUpdateProperties.findIndex((h=>h.key===a));u>-1&&i.addOrUpdateProperties.splice(u,1)}return(i.removeAllProperties||t.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||t.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...t.removeProperties||[]]),(i.addOrUpdateProperties||t.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(i.newGeometry||t.newGeometry)&&(n.newGeometry=t.newGeometry||i.newGeometry),n}function Sp(i){var t,n;if(!i)return{};const a={};return a.removeAll=i.removeAll,a.remove=new Set(i.remove||[]),a.add=new Map((t=i.add)===null||t===void 0?void 0:t.map((u=>[u.id,u]))),a.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((u=>[u.id,u]))),a}Ue("CanonicalTileID",Ed),Ue("OverscaledTileID",us,{omit:["terrainRttPosMatrix32f"]});class Ep{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class kp{constructor(t,n,a,u,h){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=u,this.properties=t.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Xl{_name;dataBuffer;nullabilityBuffer;_size;constructor(t,n,a){this._name=t,this.dataBuffer=n,typeof a=="number"?this._size=a:(this.nullabilityBuffer=a,this._size=a.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class sh extends Xl{}class kd extends sh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Md extends sh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Mp extends Xl{delta;constructor(t,n,a,u){super(t,n,u),this.delta=a}}class Pd extends Mp{constructor(t,n,a,u){super(t,Int32Array.of(n),a,u)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class Cd extends Xl{constructor(t,n,a){super(t,Int32Array.of(n),a)}getValueFromBuffer(t){return this.dataBuffer[0]}}class hy{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(t,n,a,u,h=4096){this._name=t,this._geometryVector=n,this._idVector=a,this._propertyVectors=u,this._extent=h}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){const t=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let a;this.idVector&&(a=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const u=t?.next().value,h={};for(const f of this.propertyVectors){if(!f)continue;const y=f.name,x=f.getValue(n);x!==null&&(h[y]=x)}n++,yield{id:a,geometry:u,properties:h}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const t=[],n=this.geometryVector.getGeometries();for(let a=0;a<this.numFeatures;a++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(a)):this.idVector.getValue(a));const h={coordinates:n[a],type:this.geometryVector.geometryType(a)},f={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,M=y.getValue(a);M!==null&&(f[x]=M)}t.push({id:u,geometry:h,properties:f})}return t}containsMaxSaveIntegerValues(t){return t instanceof kd||t instanceof Cd&&t instanceof Pd||t instanceof Md}}class dy{value;constructor(t){this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var tr,In,Aa,Fs,Ho,ts,Vi,ji,Pp,cs;(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(tr||(tr={}));class Ad{_dictionaryType;_offsetType;_lengthType;constructor(t,n,a){this._dictionaryType=t,this._offsetType=n,this._lengthType=a}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ni(i,t,n){const a=new Int32Array(n);let u=0,h=t.get();for(let f=0;f<a.length;f++){let y=i[h++],x=127&y;y<128||(y=i[h++],x|=(127&y)<<7,y<128||(y=i[h++],x|=(127&y)<<14,y<128||(y=i[h++],x|=(127&y)<<21,y<128||(y=i[h++],x|=(15&y)<<28)))),a[u++]=x}return t.set(h),a}function ah(i,t,n){const a=new BigInt64Array(n);for(let u=0;u<a.length;u++)a[u]=py(i,t);return a}function fy(i,t){let n,a;return a=i[t.get()],t.increment(),n=127&a,a<128?n:(a=i[t.get()],t.increment(),n|=(127&a)<<7,a<128?n:(a=i[t.get()],t.increment(),n|=(127&a)<<14,a<128?n:(a=i[t.get()],t.increment(),n|=(127&a)<<21,a<128?n:(a=i[t.get()],n|=(15&a)<<28,(function(u,h,f){let y,x;if(x=h[f.get()],f.increment(),y=(112&x)>>4,x<128||(x=h[f.get()],f.increment(),y|=(127&x)<<3,x<128)||(x=h[f.get()],f.increment(),y|=(127&x)<<10,x<128)||(x=h[f.get()],f.increment(),y|=(127&x)<<17,x<128)||(x=h[f.get()],f.increment(),y|=(127&x)<<24,x<128)||(x=h[f.get()],f.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,t)))))}function Cp(i,t,n,a){throw new Error("FastPFor is not implemented yet.")}function Ko(i){return i>>>1^-(1&i)}function Yl(i){return i>>1n^-(1n&i)}function py(i,t){let n=0n,a=0,u=t.get();for(;u<i.length;){const h=i[u++];if(n|=BigInt(127&h)<<BigInt(a),!(128&h))break;if(a+=7,a>=64)throw new Error("Varint too long")}return t.set(u),n}function Ap(i,t,n){const a=new Int32Array(n);let u=0;for(let h=0;h<t;h++){const f=i[h];a.fill(i[h+t],u,u+f),u+=f}return a}function Lp(i,t,n){const a=new BigInt64Array(n);let u=0;for(let h=0;h<t;h++){const f=Number(i[h]);a.fill(i[h+t],u,u+f),u+=f}return a}function Dp(i,t,n){const a=new Float64Array(n);let u=0;for(let h=0;h<t;h++){const f=i[h];a.fill(i[h+t],u,u+f),u+=f}return a}function Ld(i){const t=i.length/4*4;let n=1;if(t>=4)for(let a=i[0];n<t-4;n+=4)a=i[n]+=a,a=i[n+1]+=a,a=i[n+2]+=a,a=i[n+3]+=a;for(;n!=i.length;)i[n]+=i[n-1],++n}function Rp(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const t=i.length/4*4;let n=2;if(t>=4)for(;n<t-4;n+=4){const a=i[n],u=i[n+1],h=i[n+2],f=i[n+3];i[n]=(a>>>1^-(1&a))+i[n-2],i[n+1]=(u>>>1^-(1&u))+i[n-1],i[n+2]=(h>>>1^-(1&h))+i[n],i[n+3]=(f>>>1^-(1&f))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}function to(i,t,n){return Math.min(n,Math.max(t,i))}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(In||(In={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(Aa||(Aa={})),(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(Fs||(Fs={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(Ho||(Ho={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(ts||(ts={}));class Jo{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(t,n,a,u,h,f,y){this._physicalStreamType=t,this._logicalStreamType=n,this._logicalLevelTechnique1=a,this._logicalLevelTechnique2=u,this._physicalLevelTechnique=h,this._numValues=f,this._byteLength=y}static decode(t,n){const a=t[n.get()],u=Object.values(tr)[a>>4];let h=null;switch(u){case tr.DATA:h=new Ad(Object.values(Fs)[15&a]);break;case tr.OFFSET:h=new Ad(null,Object.values(Ho)[15&a]);break;case tr.LENGTH:h=new Ad(null,null,Object.values(ts)[15&a])}n.increment();const f=t[n.get()],y=Object.values(In)[f>>5],x=Object.values(In)[f>>2&7],M=Object.values(Aa)[3&f];n.increment();const L=Ni(t,n,2);return new Jo(u,h,y,x,M,L[0],L[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class oh extends Jo{num_bits;coordinate_shift;constructor(t,n,a,u,h,f,y,x,M){super(t,n,a,u,h,f,y),this.num_bits=x,this.coordinate_shift=M}static decode(t,n){const a=Jo.decode(t,n),u=Ni(t,n,2);return new oh(a.physicalStreamType,a.logicalStreamType,a.logicalLevelTechnique1,a.logicalLevelTechnique2,a.physicalLevelTechnique,a.numValues,a.byteLength,u[0],u[1])}static decodePartial(t,n,a){const u=Ni(n,a,2);return new oh(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,u[0],u[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class ec extends Jo{_runs;_numRleValues;constructor(t,n,a,u,h,f,y,x,M){super(t,n,a,u,h,f,y),this._runs=x,this._numRleValues=M}static decode(t,n){const a=Jo.decode(t,n),u=Ni(t,n,2);return new ec(a.physicalStreamType,a.logicalStreamType,a.logicalLevelTechnique1,a.logicalLevelTechnique2,a.physicalLevelTechnique,a.numValues,a.byteLength,u[0],u[1])}static decodePartial(t,n,a){const u=Ni(n,a,2);return new ec(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,u[0],u[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class ur{static decode(t,n){const a=Jo.decode(t,n);return a.logicalLevelTechnique1===In.MORTON?oh.decodePartial(a,t,n):In.RLE!==a.logicalLevelTechnique1&&In.RLE!==a.logicalLevelTechnique2||Aa.NONE===a.physicalLevelTechnique?a:ec.decodePartial(a,t,n)}}(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Vi||(Vi={}));class Bs{values;_size;constructor(t,n){this.values=t,this._size=n}get(t){const n=Math.floor(t/8);return(this.values[n]>>t%8&1)==1}set(t,n){const a=Math.floor(t/8);this.values[a]=this.values[a]|(n?1:0)<<t%8}getInt(t){const n=Math.floor(t/8);return this.values[n]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}class pn{constructor(){}static decodeIntStream(t,n,a,u,h){const f=pn.decodePhysicalLevelTechnique(t,n,a);return this.decodeIntBuffer(f,a,u,h)}static decodeLengthStreamToOffsetBuffer(t,n,a){const u=pn.decodePhysicalLevelTechnique(t,n,a);return this.decodeLengthToOffsetBuffer(u,a)}static decodePhysicalLevelTechnique(t,n,a){const u=a.physicalLevelTechnique;if(u===Aa.FAST_PFOR)return Cp();if(u===Aa.VARINT)return Ni(t,n,a.numValues);if(u===Aa.NONE){const h=n.get();n.add(a.byteLength);const f=t.subarray(h,n.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(t,n,a,u){const h=pn.decodePhysicalLevelTechnique(t,n,a);if(h.length===1){const f=h[0];return u?Ko(f):f}return u?(function(f){return Ko(f[1])})(h):(function(f){return f[1]})(h)}static decodeSequenceIntStream(t,n,a){return(function(u){if(u.length==2){const h=Ko(u[1]);return[h,h]}return[Ko(u[2]),Ko(u[3])]})(pn.decodePhysicalLevelTechnique(t,n,a))}static decodeSequenceLongStream(t,n,a){return(function(u){if(u.length==2){const h=Yl(u[1]);return[h,h]}return[Yl(u[2]),Yl(u[3])]})(ah(t,n,a.numValues))}static decodeLongStream(t,n,a,u){const h=ah(t,n,a.numValues);return this.decodeLongBuffer(h,a,u)}static decodeLongFloat64Stream(t,n,a,u){const h=(function(f,y,x){const M=new Float64Array(y);for(let L=0;L<y;L++)M[L]=fy(f,x);return M})(t,a.numValues,n);return this.decodeFloat64Buffer(h,a,u)}static decodeConstLongStream(t,n,a,u){const h=ah(t,n,a.numValues);if(h.length===1){const f=h[0];return u?Yl(f):f}return u?(function(f){return Yl(f[1])})(h):(function(f){return f[1]})(h)}static decodeIntBuffer(t,n,a,u){switch(n.logicalLevelTechnique1){case In.DELTA:return n.logicalLevelTechnique2===In.RLE?(function(h,f,y){const x=new Int32Array(y);let M=0,L=0;for(let z=0;z<f;z++){const F=h[z],j=Ko(h[z+f]);for(let U=0;U<F;U++)L+=j,x[M++]=L}return x})(t,n.runs,n.numRleValues):((function(h){h[0]=h[0]>>>1^-(1&h[0]);const f=h.length/4*4;let y=1;if(f>=4)for(;y<f-4;y+=4){const x=h[y],M=h[y+1],L=h[y+2],z=h[y+3];h[y]=(x>>>1^-(1&x))+h[y-1],h[y+1]=(M>>>1^-(1&M))+h[y],h[y+2]=(L>>>1^-(1&L))+h[y+1],h[y+3]=(z>>>1^-(1&z))+h[y+2]}for(;y!=h.length;++y)h[y]=(h[y]>>>1^-(1&h[y]))+h[y-1]})(t),t);case In.RLE:return(function(h,f,y){return y?(function(x,M,L){const z=new Int32Array(L);let F=0;for(let j=0;j<M;j++){const U=x[j];let H=x[j+M];H=H>>>1^-(1&H),z.fill(H,F,F+U),F+=U}return z})(h,f.runs,f.numRleValues):Ap(h,f.runs,f.numRleValues)})(t,n,a);case In.MORTON:return Ld(t),t;case In.COMPONENTWISE_DELTA:return u?((function(h,f,y,x){let M=h[0]>>>1^-(1&h[0]),L=h[1]>>>1^-(1&h[1]);h[0]=to(Math.round(M*f),y,x),h[1]=to(Math.round(L*f),y,x);const z=h.length/16;let F=2;if(z>=4)for(;F<z-4;F+=4){const j=h[F],U=h[F+1],H=(j>>>1^-(1&j))+M,rt=(U>>>1^-(1&U))+L;h[F]=to(Math.round(H*f),y,x),h[F+1]=to(Math.round(rt*f),y,x);const ct=h[F+2],It=h[F+3];M=(ct>>>1^-(1&ct))+H,L=(It>>>1^-(1&It))+rt,h[F+2]=to(Math.round(M*f),y,x),h[F+3]=to(Math.round(L*f),y,x)}for(;F!=h.length;F+=2)M+=h[F]>>>1^-(1&h[F]),L+=h[F+1]>>>1^-(1&h[F+1]),h[F]=to(Math.round(M*f),y,x),h[F+1]=to(Math.round(L*f),y,x)})(t,u.scale,u.min,u.max),t):(Rp(t),t);case In.NONE:return a&&(function(h){for(let f=0;f<h.length;f++){const y=h[f];h[f]=y>>>1^-(1&y)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${n.logicalLevelTechnique1}`)}}static decodeLongBuffer(t,n,a){switch(n.logicalLevelTechnique1){case In.DELTA:return n.logicalLevelTechnique2===In.RLE?(function(u,h,f){const y=new BigInt64Array(f);let x=0,M=0n;for(let L=0;L<h;L++){const z=Number(u[L]),F=Yl(u[L+h]);for(let j=0;j<z;j++)M+=F,y[x++]=M}return y})(t,n.runs,n.numRleValues):((function(u){u[0]=u[0]>>1n^-(1n&u[0]);const h=u.length/4*4;let f=1;if(h>=4)for(;f<h-4;f+=4){const y=u[f],x=u[f+1],M=u[f+2],L=u[f+3];u[f]=(y>>1n^-(1n&y))+u[f-1],u[f+1]=(x>>1n^-(1n&x))+u[f],u[f+2]=(M>>1n^-(1n&M))+u[f+1],u[f+3]=(L>>1n^-(1n&L))+u[f+2]}for(;f!=u.length;++f)u[f]=(u[f]>>1n^-(1n&u[f]))+u[f-1]})(t),t);case In.RLE:return(function(u,h,f){return f?(function(y,x,M){const L=new BigInt64Array(M);let z=0;for(let F=0;F<x;F++){const j=Number(y[F]);let U=y[F+x];U=U>>1n^-(1n&U),L.fill(U,z,z+j),z+=j}return L})(u,h.runs,h.numRleValues):Lp(u,h.runs,h.numRleValues)})(t,n,a);case In.NONE:return a&&(function(u){for(let h=0;h<u.length;h++){const f=u[h];u[h]=f>>1n^-(1n&f)}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${n.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(t,n,a){switch(n.logicalLevelTechnique1){case In.DELTA:return n.logicalLevelTechnique2===In.RLE&&(t=Dp(t,n.runs,n.numRleValues)),(function(u){u[0]=u[0]%2==1?(u[0]+1)/-2:u[0]/2;const h=u.length/4*4;let f=1;if(h>=4)for(;f<h-4;f+=4){const y=u[f],x=u[f+1],M=u[f+2],L=u[f+3];u[f]=(y%2==1?(y+1)/-2:y/2)+u[f-1],u[f+1]=(x%2==1?(x+1)/-2:x/2)+u[f],u[f+2]=(M%2==1?(M+1)/-2:M/2)+u[f+1],u[f+3]=(L%2==1?(L+1)/-2:L/2)+u[f+2]}for(;f!=u.length;++f)u[f]=(u[f]%2==1?(u[f]+1)/-2:u[f]/2)+u[f-1]})(t),t;case In.RLE:return(function(u,h,f){return f?(function(y,x,M){const L=new Float64Array(M);let z=0;for(let F=0;F<x;F++){const j=y[F];let U=y[F+x];U=U%2==1?(U+1)/-2:U/2,L.fill(U,z,z+j),z+=j}return L})(u,h.runs,h.numRleValues):Dp(u,h.runs,h.numRleValues)})(t,n,a);case In.NONE:return a&&(function(u){for(let h=0;h<u.length;h++){const f=u[h];u[h]=f%2==1?(f+1)/-2:f/2}})(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${n.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(t,n){if(n.logicalLevelTechnique1===In.DELTA&&n.logicalLevelTechnique2===In.NONE)return(function(a){const u=new Int32Array(a.length+1);u[0]=0,u[1]=Ko(a[0]);let h=u[1],f=2;for(;f!=u.length;++f){const y=a[f-1];h+=y>>>1^-(1&y),u[f]=u[f-1]+h}return u})(t);if(n.logicalLevelTechnique1===In.RLE&&n.logicalLevelTechnique2===In.NONE)return(function(a,u,h){const f=new Int32Array(h+1);f[0]=0;let y=1,x=f[0];for(let M=0;M<u;M++){const L=a[M],z=a[M+u];for(let F=y;F<y+L;F++)f[F]=z+x,x=f[F];y+=L}return f})(t,n.runs,n.numRleValues);if(n.logicalLevelTechnique1===In.NONE&&n.logicalLevelTechnique2===In.NONE){(function(u){let h=0;for(let f=0;f<u.length;f++)u[f]+=h,h=u[f]})(t);const a=new Int32Array(n.numValues+1);return a[0]=0,a.set(t,1),a}if(n.logicalLevelTechnique1===In.DELTA&&n.logicalLevelTechnique2===In.RLE){const a=(function(u,h,f){const y=new Int32Array(f+1);y[0]=0;let x=1,M=y[0];for(let L=0;L<h;L++){const z=u[L];let F=u[L+h];F=F>>>1^-(1&F);for(let j=x;j<x+z;j++)y[j]=F+M,M=y[j];x+=z}return y})(t,n.runs,n.numRleValues);return Ld(a),a}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(t,n,a,u,h){const f=a.physicalLevelTechnique===Aa.FAST_PFOR?Cp():Ni(t,n,a.numValues);return this.decodeNullableIntBuffer(f,a,u,h)}static decodeNullableLongStream(t,n,a,u,h){const f=ah(t,n,a.numValues);return this.decodeNullableLongBuffer(f,a,u,h)}static decodeNullableIntBuffer(t,n,a,u){switch(n.logicalLevelTechnique1){case In.DELTA:return n.logicalLevelTechnique2===In.RLE&&(t=Ap(t,n.runs,n.numRleValues)),(function(h,f){const y=new Int32Array(h.size());let x=0;h.get(0)?(y[0]=h.get(0)?f[0]>>>1^-(1&f[0]):0,x=1):y[0]=0;let M=1;for(;M!=y.length;++M)y[M]=h.get(M)?y[M-1]+(f[x]>>>1^-(1&f[x++])):y[M-1];return y})(u,t);case In.RLE:return(function(h,f,y,x){const M=f;return y?(function(L,z,F){const j=new Int32Array(L.size());let U=0;for(let H=0;H<F;H++){const rt=z[H];let ct=z[H+F];ct=ct>>>1^-(1&ct);for(let It=U;It<U+rt;It++)L.get(It)?j[It]=ct:(j[It]=0,U++);U+=rt}return j})(x,h,M.runs):(function(L,z,F){const j=new Int32Array(L.size());let U=0;for(let H=0;H<F;H++){const rt=z[H],ct=z[H+F];for(let It=U;It<U+rt;It++)L.get(It)?j[It]=ct:(j[It]=0,U++);U+=rt}return j})(x,h,M.runs)})(t,n,a,u);case In.MORTON:return Ld(t),t;case In.COMPONENTWISE_DELTA:return Rp(t),t;case In.NONE:return t=a?(function(h,f){const y=new Int32Array(h.size());let x=0,M=0;for(;M!=y.length;++M)if(h.get(M)){const L=f[x++];y[M]=L>>>1^-(1&L)}else y[M]=0;return y})(u,t):(function(h,f){const y=new Int32Array(h.size());let x=0,M=0;for(;M!=y.length;++M)y[M]=h.get(M)?f[x++]:0;return y})(u,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(t,n,a,u){switch(n.logicalLevelTechnique1){case In.DELTA:return n.logicalLevelTechnique2===In.RLE&&(t=Lp(t,n.runs,n.numRleValues)),(function(h,f){const y=new BigInt64Array(h.size());let x=0;h.get(0)?(y[0]=h.get(0)?f[0]>>1n^-(1n&f[0]):0n,x=1):y[0]=0n;let M=1;for(;M!=y.length;++M)y[M]=h.get(M)?y[M-1]+(f[x]>>1n^-(1n&f[x++])):y[M-1];return y})(u,t);case In.RLE:return(function(h,f,y,x){const M=f;return y?(function(L,z,F){const j=new BigInt64Array(L.size());let U=0;for(let H=0;H<F;H++){const rt=Number(z[H]);let ct=z[H+F];ct=ct>>1n^-(1n&ct);for(let It=U;It<U+rt;It++)L.get(It)?j[It]=ct:(j[It]=0n,U++);U+=rt}return j})(x,h,M.runs):(function(L,z,F){const j=new BigInt64Array(L.size());let U=0;for(let H=0;H<F;H++){const rt=Number(z[H]),ct=z[H+F];for(let It=U;It<U+rt;It++)L.get(It)?j[It]=ct:(j[It]=0n,U++);U+=rt}return j})(x,h,M.runs)})(t,n,a,u);case In.NONE:return t=a?(function(h,f){const y=new BigInt64Array(h.size());let x=0,M=0;for(;M!=y.length;++M)if(h.get(M)){const L=f[x++];y[M]=L>>1n^-(1n&L)}else y[M]=0n;return y})(u,t):(function(h,f){const y=new BigInt64Array(h.size());let x=0,M=0;for(;M!=y.length;++M)y[M]=h.get(M)?f[x++]:0n;return y})(u,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(t,n,a,u){const h=t.logicalLevelTechnique1;if(h===In.RLE)return t.runs===1?Vi.CONST:Vi.FLAT;const f=n instanceof Bs?n.size():n;if(h===In.DELTA&&t.logicalLevelTechnique2===In.RLE){const y=t.runs,x=2;if(t.numRleValues!==f)return Vi.FLAT;if(y===1)return Vi.SEQUENCE;if(y===2){const M=u.get();let L;if(t.physicalLevelTechnique===Aa.VARINT)L=Ni(a,u,4);else{const z=u.get();L=new Int32Array(a.buffer,a.byteOffset+z,4)}if(u.set(M),L[2]===x&&L[3]===x)return Vi.SEQUENCE}}return t.numValues===1?Vi.CONST:Vi.FLAT}}class zp extends sh{getValueFromBuffer(t){return this.dataBuffer[t]}}class Np extends Mp{constructor(t,n,a,u){super(t,BigInt64Array.of(n),a,u)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class Hl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(t,n,a){this._geometryOffsets=t,this._partOffsets=n,this._ringOffsets=a}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class my{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(t,n){this._coordinateShift=t<0?Math.abs(t):0,this.tileExtent=n+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=t,this.maxBound=n}validateCoordinates(t){if(t.x<this.minBound||t.y<this.minBound||t.x>this.maxBound||t.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class Kl extends my{encode(t){this.validateCoordinates(t);const n=t.x+this._coordinateShift,a=t.y+this._coordinateShift;let u=0;for(let h=0;h<this._numBits;h++)u|=(n&1<<h)<<h|(a&1<<h)<<h+1;return u}decode(t){return{x:this.decodeMorton(t)-this._coordinateShift,y:this.decodeMorton(t>>1)-this._coordinateShift}}decodeMorton(t){let n=0;for(let a=0;a<this._numBits;a++)n|=(t&1<<2*a)>>a;return n}static decode(t,n,a){return{x:Kl.decodeMorton(t,n)-a,y:Kl.decodeMorton(t>>1,n)-a}}static decodeMorton(t,n){let a=0;for(let u=0;u<n;u++)a|=(t&1<<2*u)>>u;return a}}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(ji||(ji={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(Pp||(Pp={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(cs||(cs={}));class gy{createPoint(t){return[[t]]}createMultiPoint(t){return t.map((n=>[n]))}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,n){return[t,...n]}createMultiPolygon(t){return t.flat()}}function Op(i){const t=new Array(i.numGeometries);let n=1,a=1,u=1,h=0;const f=new gy;let y=0,x=0;const M=i.mortonSettings,L=i.topologyVector,z=L.geometryOffsets,F=L.partOffsets,j=L.ringOffsets,U=i.vertexOffsets,H=i.containsPolygonGeometry(),rt=i.vertexBuffer;for(let ct=0;ct<i.numGeometries;ct++){const It=i.geometryType(ct);if(It===ji.POINT){if(U&&U.length!==0)if(i.vertexBufferType===cs.VEC_2){const ft=2*U[x++],_t=new N(rt[ft],rt[ft+1]);t[h++]=f.createPoint(_t)}else{const ft=U[x++],_t=Kl.decode(rt[ft],M.numBits,M.coordinateShift),Bt=new N(_t.x,_t.y);t[h++]=f.createPoint(Bt)}else{const ft=new N(rt[y++],rt[y++]);t[h++]=f.createPoint(ft)}z&&u++,F&&n++,j&&a++}else if(It===ji.MULTIPOINT){const ft=z[u]-z[u-1];u++;const _t=new Array(ft);if(U&&U.length!==0){for(let Bt=0;Bt<ft;Bt++){const Vt=2*U[x++];_t[Bt]=new N(rt[Vt],rt[Vt+1])}t[h++]=f.createMultiPoint(_t)}else{for(let Bt=0;Bt<ft;Bt++){const Vt=rt[y++],re=rt[y++];_t[Bt]=new N(Vt,re)}t[h++]=f.createMultiPoint(_t)}}else if(It===ji.LINESTRING){let ft,_t=0;H?(_t=j[a]-j[a-1],a++):_t=F[n]-F[n-1],n++,U&&U.length!==0?(ft=i.vertexBufferType===cs.VEC_2?Rd(rt,U,x,_t,!1):zd(rt,U,x,_t,!1,M),x+=_t):(ft=Dd(rt,y,_t,!1),y+=2*_t),t[h++]=f.createLineString(ft),z&&u++}else if(It===ji.POLYGON){const ft=F[n]-F[n-1];n++;const _t=new Array(ft-1);let Bt=j[a]-j[a-1];if(a++,U&&U.length!==0){const Vt=i.vertexBufferType===cs.VEC_2?uh(rt,U,x,Bt):ch(rt,U,x,Bt,0,M);x+=Bt;for(let re=0;re<_t.length;re++)Bt=j[a]-j[a-1],a++,_t[re]=i.vertexBufferType===cs.VEC_2?uh(rt,U,x,Bt):ch(rt,U,x,Bt,0,M),x+=Bt;t[h++]=f.createPolygon(Vt,_t)}else{const Vt=lh(rt,y,Bt);y+=2*Bt;for(let re=0;re<_t.length;re++)Bt=j[a]-j[a-1],a++,_t[re]=lh(rt,y,Bt),y+=2*Bt;t[h++]=f.createPolygon(Vt,_t)}z&&u++}else if(It===ji.MULTILINESTRING){const ft=z[u]-z[u-1];u++;const _t=new Array(ft);if(U&&U.length!==0){for(let Bt=0;Bt<ft;Bt++){let Vt=0;H?(Vt=j[a]-j[a-1],a++):Vt=F[n]-F[n-1],n++;const re=i.vertexBufferType===cs.VEC_2?Rd(rt,U,x,Vt,!1):zd(rt,U,x,Vt,!1,M);_t[Bt]=re,x+=Vt}t[h++]=f.createMultiLineString(_t)}else{for(let Bt=0;Bt<ft;Bt++){let Vt=0;H?(Vt=j[a]-j[a-1],a++):Vt=F[n]-F[n-1],n++,_t[Bt]=Dd(rt,y,Vt,!1),y+=2*Vt}t[h++]=f.createMultiLineString(_t)}}else{if(It!==ji.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ft=z[u]-z[u-1];u++;const _t=new Array(ft);let Bt=0;if(U&&U.length!==0){for(let Vt=0;Vt<ft;Vt++){const re=F[n]-F[n-1];n++;const xe=new Array(re-1);Bt=j[a]-j[a-1],a++;const pe=i.vertexBufferType===cs.VEC_2?uh(rt,U,x,Bt):ch(rt,U,x,Bt,0,M);x+=Bt;for(let Ie=0;Ie<xe.length;Ie++)Bt=j[a]-j[a-1],a++,xe[Ie]=i.vertexBufferType===cs.VEC_2?uh(rt,U,x,Bt):ch(rt,U,x,Bt,0,M),x+=Bt;_t[Vt]=f.createPolygon(pe,xe)}t[h++]=f.createMultiPolygon(_t)}else{for(let Vt=0;Vt<ft;Vt++){const re=F[n]-F[n-1];n++;const xe=new Array(re-1);Bt=j[a]-j[a-1],a++;const pe=lh(rt,y,Bt);y+=2*Bt;for(let Ie=0;Ie<xe.length;Ie++){const Fe=j[a]-j[a-1];a++,xe[Ie]=lh(rt,y,Fe),y+=2*Fe}_t[Vt]=f.createPolygon(pe,xe)}t[h++]=f.createMultiPolygon(_t)}}}}return t}function lh(i,t,n){return Dd(i,t,n,!0)}function uh(i,t,n,a){return Rd(i,t,n,a,!0)}function ch(i,t,n,a,u,h){return zd(i,t,n,a,!0,h)}function Dd(i,t,n,a){const u=new Array(a?n+1:n);for(let h=0;h<2*n;h+=2)u[h/2]=new N(i[t+h],i[t+h+1]);return a&&(u[u.length-1]=u[0]),u}function Rd(i,t,n,a,u){const h=new Array(u?a+1:a);for(let f=0;f<2*a;f+=2){const y=2*t[n+f/2];h[f/2]=new N(i[y],i[y+1])}return u&&(h[h.length-1]=h[0]),h}function zd(i,t,n,a,u,h){const f=new Array(u?a+1:a);for(let y=0;y<a;y++){const x=Kl.decode(i[t[n+y]],h.numBits,h.coordinateShift);f[y]=new N(x.x,x.y)}return u&&(f[f.length-1]=f[0]),f}class Fp{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(t,n,a,u,h){this._vertexBufferType=t,this._topologyVector=n,this._vertexOffsets=a,this._vertexBuffer=u,this._mortonSettings=h}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const t=Op(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:t[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(t){const n=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){const a=Kl.decode(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[a.x,a.y]}const n=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return Op(this)}get mortonSettings(){return this._mortonSettings}}class nc extends Fp{_numGeometries;_geometryType;constructor(t,n,a,u,h,f,y){super(a,u,h,f,y),this._numGeometries=t,this._geometryType=n}static createMortonEncoded(t,n,a,u,h,f){return new nc(t,n,cs.MORTON,a,u,h,f)}static create(t,n,a,u,h){return new nc(t,n,cs.VEC_2,a,u,h)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ji.POLYGON||this._geometryType===ji.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class ic extends Fp{_geometryTypes;constructor(t,n,a,u,h,f){super(t,a,u,h,f),this._geometryTypes=n}static createMortonEncoded(t,n,a,u,h){return new ic(cs.MORTON,t,n,a,u,h)}static create(t,n,a,u){return new ic(cs.VEC_2,t,n,a,u)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let t=0;t<this.numGeometries;t++)if(this.geometryType(t)===ji.POLYGON||this.geometryType(t)===ji.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Bp{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(t,n,a,u){this._triangleOffsets=t,this._indexBuffer=n,this._vertexBuffer=a,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const t=new Array(this.numGeometries),n=this._topologyVector,a=n.partOffsets,u=n.ringOffsets,h=n.geometryOffsets;let f=0,y=1,x=1,M=1;for(let L=0;L<this.numGeometries;L++)switch(this.geometryType(L)){case ji.POLYGON:{const z=a[y]-a[y-1];y++;const F=[];for(let j=0;j<z;j++){const U=u[x]-u[x-1];x++;const H=[];for(let rt=0;rt<U;rt++){const ct=this._vertexBuffer[f++],It=this._vertexBuffer[f++];H.push(new N(ct,It))}H.length>0&&H.push(H[0]),F.push(H)}t[L]=F,h&&M++}break;case ji.MULTIPOLYGON:{const z=h[M]-h[M-1];M++;const F=[];for(let j=0;j<z;j++){const U=a[y]-a[y-1];y++;for(let H=0;H<U;H++){const rt=u[x]-u[x-1];x++;const ct=[];for(let It=0;It<rt;It++){const ft=this._vertexBuffer[f++],_t=this._vertexBuffer[f++];ct.push(new N(ft,_t))}ct.length>0&&ct.push(ct[0]),F.push(ct)}}t[L]=F}}return t}[Symbol.iterator](){return null}}class hh extends Bp{_numGeometries;_geometryType;constructor(t,n,a,u,h,f){super(a,u,h,f),this._numGeometries=t,this._geometryType=n}static create(t,n,a,u,h,f){return new hh(t,n,a,u,h,f)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class dh extends Bp{_geometryTypes;constructor(t,n,a,u,h){super(n,a,u,h),this._geometryTypes=t}static create(t,n,a,u,h){return new dh(t,n,a,u,h)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function _y(i,t,n,a,u){const h=ur.decode(i,n);let f=null,y=null,x=null,M=null,L=null,z=null,F=null,j=null;if(pn.getVectorType(h,a,i,n)===Vi.CONST){const H=pn.decodeConstIntStream(i,n,h,!1);for(let rt=0;rt<t-1;rt++){const ct=ur.decode(i,n);switch(ct.physicalStreamType){case tr.LENGTH:switch(ct.logicalStreamType.lengthType){case ts.GEOMETRIES:f=pn.decodeLengthStreamToOffsetBuffer(i,n,ct);break;case ts.PARTS:y=pn.decodeLengthStreamToOffsetBuffer(i,n,ct);break;case ts.RINGS:x=pn.decodeLengthStreamToOffsetBuffer(i,n,ct);break;case ts.TRIANGLES:F=pn.decodeLengthStreamToOffsetBuffer(i,n,ct)}break;case tr.OFFSET:switch(ct.logicalStreamType.offsetType){case Ho.VERTEX:M=pn.decodeIntStream(i,n,ct,!1);break;case Ho.INDEX:j=pn.decodeIntStream(i,n,ct,!1)}break;case tr.DATA:if(Fs.VERTEX===ct.logicalStreamType.dictionaryType)L=pn.decodeIntStream(i,n,ct,!0,u);else{const It=ct;z={numBits:It.numBits(),coordinateShift:It.coordinateShift()},L=pn.decodeIntStream(i,n,ct,!1,u)}}}if(j!==null){if(f!=null||y!=null){const rt=new Hl(f,y,x);return hh.create(a,H,F,j,L,rt)}return hh.create(a,H,F,j,L)}return z===null?nc.create(a,H,new Hl(f,y,x),M,L):nc.createMortonEncoded(a,H,new Hl(f,y,x),M,L,z)}const U=pn.decodeIntStream(i,n,h,!1);for(let H=0;H<t-1;H++){const rt=ur.decode(i,n);switch(rt.physicalStreamType){case tr.LENGTH:switch(rt.logicalStreamType.lengthType){case ts.GEOMETRIES:f=pn.decodeIntStream(i,n,rt,!1);break;case ts.PARTS:y=pn.decodeIntStream(i,n,rt,!1);break;case ts.RINGS:x=pn.decodeIntStream(i,n,rt,!1);break;case ts.TRIANGLES:F=pn.decodeLengthStreamToOffsetBuffer(i,n,rt)}break;case tr.OFFSET:switch(rt.logicalStreamType.offsetType){case Ho.VERTEX:M=pn.decodeIntStream(i,n,rt,!1);break;case Ho.INDEX:j=pn.decodeIntStream(i,n,rt,!1)}break;case tr.DATA:if(Fs.VERTEX===rt.logicalStreamType.dictionaryType)L=pn.decodeIntStream(i,n,rt,!0,u);else{const ct=rt;z={numBits:ct.numBits(),coordinateShift:ct.coordinateShift()},L=pn.decodeIntStream(i,n,rt,!1,u)}}}return j!==null&&y===null?dh.create(U,F,j,L):(f!==null?(f=Nd(U,f,2),y!==null&&x!==null?(y=Vp(U,f,y,!1),x=(function(H,rt,ct,It){const ft=new Int32Array(ct[ct.length-1]+1);let _t=0;ft[0]=_t;let Bt=1,Vt=1,re=0;for(let xe=0;xe<H.length;xe++){const pe=H[xe],Ie=rt[xe+1]-rt[xe];if(pe!==0&&pe!==3)for(let Fe=0;Fe<Ie;Fe++){const Ae=ct[Bt]-ct[Bt-1];Bt++;for(let Le=0;Le<Ae;Le++)_t=ft[Vt++]=_t+It[re++]}else for(let Fe=0;Fe<Ie;Fe++)ft[Vt++]=++_t,Bt++}return ft})(U,f,y,x)):y!==null&&(y=(function(H,rt,ct){const It=new Int32Array(rt[rt.length-1]+1);let ft=0;It[0]=ft;let _t=1,Bt=0;for(let Vt=0;Vt<H.length;Vt++){const re=H[Vt],xe=rt[Vt+1]-rt[Vt];if(re===4||re===1)for(let pe=0;pe<xe;pe++)ft=It[_t++]=ft+ct[Bt++];else for(let pe=0;pe<xe;pe++)It[_t++]=++ft}return It})(U,f,y))):y!==null&&x!==null?(y=Nd(U,y,1),x=Vp(U,y,x,!0)):y!==null&&(y=Nd(U,y,0)),j!==null?dh.create(U,F,j,L,new Hl(f,y,x)):z===null?ic.create(U,new Hl(f,y,x),M,L):ic.createMortonEncoded(U,new Hl(f,y,x),M,L,z))}function Nd(i,t,n){const a=new Int32Array(i.length+1);let u=0;a[0]=u;let h=0;for(let f=0;f<i.length;f++)u=a[f+1]=u+(i[f]>n?t[h++]:1);return a}function Vp(i,t,n,a){const u=new Int32Array(t[t.length-1]+1);let h=0;u[0]=h;let f=1,y=0;for(let x=0;x<i.length;x++){const M=i[x],L=t[x+1]-t[x];if(M===5||M===2||a&&(M===4||M===1))for(let z=0;z<L;z++)h=u[f++]=h+n[y++];else for(let z=0;z<L;z++)u[f++]=++h}return u}class yy extends Xl{dataVector;constructor(t,n,a){super(t,n.getBuffer(),a),this.dataVector=n}getValueFromBuffer(t){return this.dataVector.get(t)}}class vy extends sh{getValueFromBuffer(t){return this.dataBuffer[t]}}class jp extends Xl{constructor(t,n,a){super(t,BigInt64Array.of(n),a)}getValueFromBuffer(t){return this.dataBuffer[0]}}function xy(i,t,n){for(let a=0;a<i;a++){const u=ur.decode(t,n);n.add(u.byteLength)}}function rc(i,t,n){return Gp(i,Math.ceil(t/8),n)}function Gp(i,t,n){const a=new Uint8Array(t);let u=0;for(;u<t;){const h=i[n.increment()];if(h<=127){const f=h+3,y=i[n.increment()],x=u+f;a.fill(y,u,x),u=x}else{const f=256-h;for(let y=0;y<f;y++)a[u++]=i[n.increment()]}}return a}const by=new TextDecoder;function Od(i,t,n){return n-t>=12?by.decode(i.subarray(t,n)):(function(a,u,h){let f="",y=u;for(;y<h;){const x=a[y];let M,L,z,F=null,j=x>239?4:x>223?3:x>191?2:1;if(y+j>h)break;j===1?x<128&&(F=x):j===2?(M=a[y+1],(192&M)==128&&(F=(31&x)<<6|63&M,F<=127&&(F=null))):j===3?(M=a[y+1],L=a[y+2],(192&M)==128&&(192&L)==128&&(F=(15&x)<<12|(63&M)<<6|63&L,(F<=2047||F>=55296&&F<=57343)&&(F=null))):j===4&&(M=a[y+1],L=a[y+2],z=a[y+3],(192&M)==128&&(192&L)==128&&(192&z)==128&&(F=(15&x)<<18|(63&M)<<12|(63&L)<<6|63&z,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,j=1):F>65535&&(F-=65536,f+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),f+=String.fromCharCode(F),y+=j}return f})(i,t,n)}class Fd extends Xl{offsetBuffer;constructor(t,n,a,u){super(t,a,u),this.offsetBuffer=n}}class Up extends Fd{textEncoder;constructor(t,n,a,u){super(t,n,a,u??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(t){return Od(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class Jl extends Fd{indexBuffer;textEncoder;constructor(t,n,a,u,h){super(t,a,u,h??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(t){const n=this.indexBuffer[t];return Od(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class qp extends Fd{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(t,n,a,u,h,f,y){super(t,a,u,y),this.indexBuffer=n,this.symbolOffsetBuffer=h,this.symbolTableBuffer=f,this.textEncoder=new TextEncoder}getValueFromBuffer(t){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(a,u,h){const f=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<h.length;x++)if(h[x]===255)f.push(h[++x]);else{const M=u[h[x]],L=y[h[x]];for(let z=0;z<M;z++)f.push(a[L+z])}return new Uint8Array(f)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[t];return Od(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(t){const n=new Uint32Array(t.length-1);let a=t[0];for(let u=1;u<t.length;u++){const h=t[u];n[u-1]=h-a,a=h}return n}}class sc{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(t,n,a,u,h){let f=null,y=null,x=null,M=null,L=null,z=null,F=null,j=null;for(let U=0;U<u;U++){const H=ur.decode(n,a);if(H.byteLength!==0)switch(H.physicalStreamType){case tr.PRESENT:{const rt=rc(n,H.numValues,a);z=new Bs(rt,H.numValues);break}case tr.OFFSET:y=h!=null||z!=null?pn.decodeNullableIntStream(n,a,H,!1,h??z):pn.decodeIntStream(n,a,H,!1);break;case tr.LENGTH:{const rt=pn.decodeLengthStreamToOffsetBuffer(n,a,H);ts.DICTIONARY===H.logicalStreamType.lengthType?f=rt:ts.SYMBOL===H.logicalStreamType.lengthType?M=rt:F=rt;break}case tr.DATA:{const rt=n.subarray(a.get(),a.get()+H.byteLength);a.add(H.byteLength);const ct=H.logicalStreamType.dictionaryType;Fs.FSST===ct?L=rt:Fs.SINGLE===ct||Fs.SHARED===ct?x=rt:Fs.NONE===ct&&(j=rt);break}}}return this.decodeFsstDictionaryVector(t,L,y,f,x,M,h??z)??this.decodeDictionaryVector(t,x,y,f,h??z)??this.decodePlainStringVector(t,F,j,y,h??z)}static decodeFsstDictionaryVector(t,n,a,u,h,f,y){return n?new qp(t,a,u,h,f,n,y):null}static decodeDictionaryVector(t,n,a,u,h){return n?h?new Jl(t,a,u,n,h):new Jl(t,a,u,n):null}static decodePlainStringVector(t,n,a,u,h){if(!n||!a)return null;if(u)return h?new Jl(t,u,n,a,h):new Jl(t,u,n,a);if(h&&h.size()!==n.length-1){const f=new Int32Array(h.size());let y=0;for(let x=0;x<h.size();x++)f[x]=h.get(x)?y++:0;return new Jl(t,f,n,a,h)}return h?new Up(t,n,a,h):new Up(t,n,a)}static decodeSharedDictionary(t,n,a,u,h){let f=null,y=null,x=null,M=null,L=!1;for(;!L;){const U=ur.decode(t,n);switch(U.physicalStreamType){case tr.LENGTH:ts.DICTIONARY===U.logicalStreamType.lengthType?f=pn.decodeLengthStreamToOffsetBuffer(t,n,U):x=pn.decodeLengthStreamToOffsetBuffer(t,n,U);break;case tr.DATA:Fs.SINGLE===U.logicalStreamType.dictionaryType||Fs.SHARED===U.logicalStreamType.dictionaryType?(y=t.subarray(n.get(),n.get()+U.byteLength),L=!0):M=t.subarray(n.get(),n.get()+U.byteLength),n.add(U.byteLength)}}const z=a.complexType.children,F=[];let j=0;for(const U of z){const H=Ni(t,n,1)[0];if(H==0)continue;const rt=`${a.name}${U.name===sc.ROOT_COLUMN_NAME?"":sc.NESTED_COLUMN_SEPARATOR+U.name}`;if(h&&!h.has(rt)){xy(H,t,n);continue}if(H!==2||U.type!=="scalarField"||U.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ct=ur.decode(t,n),It=rc(t,ct.numValues,n),ft=ur.decode(t,n),_t=(ft instanceof ec?ft.numRleValues:ft.numValues)!==u?pn.decodeNullableIntStream(t,n,ft,!1,new Bs(It,ct.numValues)):pn.decodeIntStream(t,n,ft,!1);F[j++]=M?new qp(rt,_t,f,y,x,M,new Bs(It,ct.numValues)):new Jl(rt,_t,f,y,new Bs(It,ct.numValues))}return F}}function wy(i,t,n,a,u,h){return n.type==="scalarType"?(function(f,y,x,M,L,z){let F=null,j=0;if(f===0)return null;if(z.nullable){const H=ur.decode(y,x);j=H.numValues;const rt=x.get(),ct=rc(y,j,x);x.set(rt+H.byteLength),F=new Bs(ct,H.numValues)}const U=F??M;switch(L.physicalType){case 4:case 3:return(function(H,rt,ct,It,ft){const _t=ur.decode(H,rt),Bt=pn.getVectorType(_t,ft,H,rt),Vt=It.physicalType===3;if(Bt===Vi.FLAT){const re=ac(ft)?pn.decodeNullableIntStream(H,rt,_t,Vt,ft):pn.decodeIntStream(H,rt,_t,Vt);return new kd(ct.name,re,ft)}if(Bt===Vi.SEQUENCE){const re=pn.decodeSequenceIntStream(H,rt,_t);return new Pd(ct.name,re[0],re[1],_t.numRleValues)}{const re=pn.decodeConstIntStream(H,rt,_t,Vt);return new Cd(ct.name,re,ft)}})(y,x,z,L,U);case 9:return sc.decode(z.name,y,x,z.nullable?f-1:f,F);case 0:return(function(H,rt,ct,It,ft){const _t=ur.decode(H,rt),Bt=_t.numValues,Vt=rt.get(),re=ac(ft)?(function(pe,Ie,Fe,Ae){const Le=Gp(pe,Math.ceil(Ie/8),Fe),me=new Bs(Le,Ie),He=Ae.size(),Ke=new Bs(new Uint8Array(He),He);let nn=0;for(let qe=0;qe<Ae.size();qe++){const xn=!!Ae.get(qe)&&me.get(nn++);Ke.set(qe,xn)}return Ke.getBuffer()})(H,Bt,rt,ft):rc(H,Bt,rt);rt.set(Vt+_t.byteLength);const xe=new Bs(re,Bt);return new yy(ct.name,xe,ft)})(y,x,z,0,U);case 6:case 5:return(function(H,rt,ct,It,ft){const _t=ur.decode(H,rt),Bt=pn.getVectorType(_t,It,H,rt),Vt=ft.physicalType===5;if(Bt===Vi.FLAT){const re=ac(It)?pn.decodeNullableLongStream(H,rt,_t,Vt,It):pn.decodeLongStream(H,rt,_t,Vt);return new zp(ct.name,re,It)}if(Bt===Vi.SEQUENCE){const re=pn.decodeSequenceLongStream(H,rt,_t);return new Np(ct.name,re[0],re[1],_t.numRleValues)}{const re=pn.decodeConstLongStream(H,rt,_t,Vt);return new jp(ct.name,re,It)}})(y,x,z,U,L);case 7:return(function(H,rt,ct,It){const ft=ur.decode(H,rt),_t=ac(It)?(function(Bt,Vt,re,xe){const pe=Vt.get(),Ie=pe+xe*Float32Array.BYTES_PER_ELEMENT,Fe=new Uint8Array(Bt.subarray(pe,Ie)).buffer,Ae=new Float32Array(Fe);Vt.set(Ie);const Le=re.size(),me=new Float32Array(Le);let He=0;for(let Ke=0;Ke<Le;Ke++)me[Ke]=re.get(Ke)?Ae[He++]:0;return me})(H,rt,It,ft.numValues):(function(Bt,Vt,re){const xe=Vt.get(),pe=xe+re*Float32Array.BYTES_PER_ELEMENT,Ie=new Uint8Array(Bt.subarray(xe,pe)).buffer,Fe=new Float32Array(Ie);return Vt.set(pe),Fe})(H,rt,ft.numValues);return new vy(ct.name,_t,It)})(y,x,z,U);case 8:return(function(H,rt,ct,It){const ft=ur.decode(H,rt),_t=ac(It)?(function(Bt,Vt,re,xe){const pe=Vt.get(),Ie=pe+xe*Float64Array.BYTES_PER_ELEMENT,Fe=new Uint8Array(Bt.subarray(pe,Ie)).buffer,Ae=new Float64Array(Fe);Vt.set(Ie);const Le=re.size(),me=new Float64Array(Le);let He=0;for(let Ke=0;Ke<Le;Ke++)me[Ke]=re.get(Ke)?Ae[He++]:0;return me})(H,rt,It,ft.numValues):(function(Bt,Vt,re){const xe=Vt.get(),pe=xe+re*Float64Array.BYTES_PER_ELEMENT,Ie=new Uint8Array(Bt.subarray(xe,pe)).buffer,Fe=new Float64Array(Ie);return Vt.set(pe),Fe})(H,rt,ft.numValues);return new Md(ct.name,_t,It)})(y,x,z,U);default:throw new Error(`The specified data type for the field is currently not supported: ${L}`)}})(a,i,t,u,n.scalarType,n):a!=1?null:sc.decodeSharedDictionary(i,t,n,u,h)}function ac(i){return i instanceof Bs}class fh{static decodeColumnType(t){switch(t){case 0:case 1:case 2:case 3:{const n={};n.nullable=!!(1&t),n.columnScope=0;const a={};return a.physicalType=t>1?6:4,a.type="physicalType",n.scalarType=a,n.type="scalarType",n}case 4:{const n={nullable:!1,columnScope:0},a={type:"physicalType",physicalType:0};return n.type="complexType",n.complexType=a,n}case 30:{const n={nullable:!1,columnScope:0},a={type:"physicalType",physicalType:1};return n.type="complexType",n.complexType=a,n}default:return this.mapScalarType(t)}}static columnTypeHasName(t){return t>=10}static columnTypeHasChildren(t){return t===30}static hasStreamCount(t){if(t.name==="id")return!1;if(t.type==="scalarType"){const n=t.scalarType;if(n.type==="physicalType")switch(n.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(n.type==="logicalType")return!1}else if(t.type==="complexType"){const n=t.complexType;if(n.type==="physicalType")switch(n.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",t),!1}static mapScalarType(t){let n=null;switch(t){case 10:case 11:n=0;break;case 12:case 13:n=1;break;case 14:case 15:n=2;break;case 16:case 17:n=3;break;case 18:case 19:n=4;break;case 20:case 21:n=5;break;case 22:case 23:n=6;break;case 24:case 25:n=7;break;case 26:case 27:n=8;break;case 28:case 29:n=9;break;default:return null}const a={};a.nullable=!!(1&t),a.columnScope=0;const u={type:"physicalType"};return u.physicalType=n,a.type="scalarType",a.scalarType=u,a}}const Iy=new TextDecoder;function Zp(i,t){const n=Ni(i,t,1)[0];if(n===0)return"";const a=t.get(),u=i.subarray(a,a+n);return t.add(n),Iy.decode(u)}function $p(i,t){const n=Ni(i,t,1)[0]>>>0,a=!!(4&n),u=!!(2&n),h=Ni(i,t,1)[0]>>>0,f={};if(1&n&&(f.nullable=!0),u){const y={};if(a?(y.type="logicalType",y.logicalType=h):(y.type="physicalType",y.physicalType=h),8&n){const x=Ni(i,t,1)[0]>>>0;y.children=new Array(x);for(let M=0;M<x;M++)y.children[M]=$p(i,t)}f.type="complexField",f.complexField=y}else{const y={};a?(y.type="logicalType",y.logicalType=h):(y.type="physicalType",y.physicalType=h),f.type="scalarField",f.scalarField=y}return f}function Ty(i,t){const n=Ni(i,t,1)[0]>>>0,a=fh.decodeColumnType(n);if(!a)throw new Error(`Unsupported column type code: ${n}`);if(fh.columnTypeHasName(n)?a.name=Zp(i,t):n>=0&&n<=3?a.name="id":n===4&&(a.name="geometry"),fh.columnTypeHasChildren(n)){const u=Ni(i,t,1)[0]>>>0,h=a.complexType;h.children=new Array(u);for(let f=0;f<u;f++)h.children[f]=$p(i,t)}return a}function Sy(i,t){const n={featureTables:[]},a={};a.name=Zp(i,t);const u=Ni(i,t,1)[0]>>>0,h=Ni(i,t,1)[0]>>>0;a.columns=new Array(h);for(let f=0;f<h;f++)a.columns[f]=Ty(i,t);return n.featureTables.push(a),[n,u]}function Ey(i,t,n,a,u,h,f=!1){const y=t.scalarType.physicalType,x=pn.getVectorType(u,h,i,n);if(y===4)switch(x){case Vi.FLAT:{const M=pn.decodeIntStream(i,n,u,!1);return new kd(a,M,h)}case Vi.SEQUENCE:{const M=pn.decodeSequenceIntStream(i,n,u);return new Pd(a,M[0],M[1],u.numRleValues)}case Vi.CONST:{const M=pn.decodeConstIntStream(i,n,u,!1);return new Cd(a,M,h)}}else switch(x){case Vi.FLAT:{if(f){const L=pn.decodeLongFloat64Stream(i,n,u,!1);return new Md(a,L,h)}const M=pn.decodeLongStream(i,n,u,!1);return new zp(a,M,h)}case Vi.SEQUENCE:{const M=pn.decodeSequenceLongStream(i,n,u);return new Np(a,M[0],M[1],u.numRleValues)}case Vi.CONST:{const M=pn.decodeConstLongStream(i,n,u,!1);return new jp(a,M,h)}}throw new Error("Vector type not supported for id column.")}class ky{constructor(t,n){var a;switch(this._featureData=t,this.properties=this._featureData.properties||{},(a=this._featureData.geometry)===null||a===void 0?void 0:a.type){case ji.POINT:case ji.MULTIPOINT:this.type=1;break;case ji.LINESTRING:case ji.MULTILINESTRING:this.type=2;break;case ji.POLYGON:case ji.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}projectPoint(t,n,a,u){return[360*(t.x+n)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+a)/u)*Math.PI))-90]}projectLine(t,n,a,u){return t.map((h=>this.projectPoint(h,n,a,u)))}toGeoJSON(t,n,a){const u=this.extent*Math.pow(2,a),h=this.extent*t,f=this.extent*n,y=this.loadGeometry();let x;switch(this.type){case 1:{const L=[];for(const F of y)L.push(F[0]);const z=this.projectLine(L,h,f,u);x=L.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z};break}case 2:{const L=y.map((z=>this.projectLine(z,h,f,u)));x=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L};break}case 3:{const L=Ys(y),z=[];for(const F of L)z.push(F.map((j=>this.projectLine(j,h,f,u))));x=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z};break}default:throw new Error(`unknown feature type: ${this.type}`)}const M={type:"Feature",geometry:x,properties:this.properties};return this.id!=null&&(M.id=this.id),M}loadGeometry(){const t=[];for(const n of this._featureData.geometry.coordinates){const a=[];for(const u of n)a.push(new N(u.x,u.y));t.push(a)}return t}bbox(){return[0,0,0,0]}}class My{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new ky(this.features[t],this.extent)}}class Wp{constructor(t){this.layers={};const n=(function(a,u,h=!0){const f=new dy(0),y=[];for(;f.get()<a.length;){const x=Ni(a,f,1)[0]>>>0,M=f.get()+x;if(M>a.length)throw new Error(`Block overruns tile: ${M} > ${a.length}`);if(Ni(a,f,1)[0]>>>0!=1){f.set(M);continue}const L=Sy(a,f),z=L[1],F=L[0].featureTables[0];let j=null,U=null;const H=[];let rt=0;for(const It of F.columns){const ft=It.name;if(ft==="id"){let _t=null;if(It.nullable){const Vt=ur.decode(a,f),re=f.get(),xe=rc(a,Vt.numValues,f);f.set(re+Vt.byteLength),_t=new Bs(xe,Vt.numValues)}const Bt=ur.decode(a,f);rt=Bt.getDecompressedCount(),j=Ey(a,It,f,ft,Bt,_t??rt,h)}else if(ft==="geometry"){const _t=Ni(a,f,1)[0];if(rt===0){const Bt=f.get();rt=ur.decode(a,f).getDecompressedCount(),f.set(Bt)}U=_y(a,_t,f,rt,u)}else{const _t=fh.hasStreamCount(It)?Ni(a,f,1)[0]:1;if(_t===0&&It.type==="scalarType")continue;const Bt=wy(a,f,It,_t,rt,void 0);Bt&&(Array.isArray(Bt)?H.push(...Bt):H.push(Bt))}}const ct=new hy(F.name,U,j,H,z);y.push(ct),f.set(M)}return y})(new Uint8Array(t));this.layers=n.reduce(((a,u)=>Object.assign(Object.assign({},a),{[u.name]:new My(u)})),{})}}class Qo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new Qo;return n.extend(t(new N(this.minX,this.minY))),n.extend(t(new N(this.maxX,this.minY))),n.extend(t(new N(this.minX,this.maxY))),n.extend(t(new N(this.maxX,this.maxY))),n}static fromPoints(t){const n=new Qo;for(const a of t)n.extend(a);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}const Bd="_geojsonTileLayer";class Xp{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new No(he,16,0),this.grid3D=new No(he,16,0),this.featureIndexArray=new gt,this.promoteId=n}insert(t,n,a,u,h,f){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,h);const x=f?this.grid3D:this.grid;for(let M=0;M<n.length;M++){const L=n[M],z=[1/0,1/0,-1/0,-1/0];for(let F=0;F<L.length;F++){const j=L[F];z[0]=Math.min(z[0],j.x),z[1]=Math.min(z[1],j.y),z[2]=Math.max(z[2],j.x),z[3]=Math.max(z[3],j.y)}z[0]<he&&z[1]<he&&z[2]>=0&&z[3]>=0&&x.insert(y,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Uf(new _d(this.rawTileData)).layers:new Wp(this.rawTileData).layers,this.sourceLayerCoder=new Ep(this.vtLayers?Object.keys(this.vtLayers).sort():[Bd])),this.vtLayers}query(t,n,a,u){this.loadVTLayers();const h=t.params,f=he/t.tileSize/t.scale,y=Po(h.filter,h.globalState),x=t.queryGeometry,M=t.queryPadding*f,L=Qo.fromPoints(x),z=this.grid.query(L.minX-M,L.minY-M,L.maxX+M,L.maxY+M),F=Qo.fromPoints(t.cameraQueryGeometry).expandBy(M),j=this.grid3D.query(F.minX,F.minY,F.maxX,F.maxY,((rt,ct,It,ft)=>(function(_t,Bt,Vt,re,xe){for(const Ie of _t)if(Bt<=Ie.x&&Vt<=Ie.y&&re>=Ie.x&&xe>=Ie.y)return!0;const pe=[new N(Bt,Vt),new N(Bt,xe),new N(re,xe),new N(re,Vt)];if(_t.length>2){for(const Ie of pe)if(Fl(_t,Ie))return!0}for(let Ie=0;Ie<_t.length-1;Ie++)if(Bg(_t[Ie],_t[Ie+1],pe))return!0;return!1})(t.cameraQueryGeometry,rt-M,ct-M,It+M,ft+M)));for(const rt of j)z.push(rt);z.sort(Py);const U={};let H;for(let rt=0;rt<z.length;rt++){const ct=z[rt];if(ct===H)continue;H=ct;const It=this.featureIndexArray.get(ct);let ft=null;this.loadMatchingFeature(U,It.bucketIndex,It.sourceLayerIndex,It.featureIndex,y,h.layers,h.availableImages,n,a,u,((_t,Bt,Vt)=>(ft||(ft=ra(_t)),Bt.queryIntersectsFeature({queryGeometry:x,feature:_t,featureState:Vt,geometry:ft,zoom:this.z,transform:t.transform,pixelsToTileUnits:f,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return U}loadMatchingFeature(t,n,a,u,h,f,y,x,M,L,z){const F=this.bucketLayerIDs[n];if(f&&!F.some((rt=>f.has(rt))))return;const j=this.sourceLayerCoder.decode(a),U=this.vtLayers[j].feature(u);if(h.needGeometry){const rt=Os(U,!0);if(!h.filter(new qn(this.tileID.overscaledZ),rt,this.tileID.canonical))return}else if(!h.filter(new qn(this.tileID.overscaledZ),U))return;const H=this.getId(U,j);for(let rt=0;rt<F.length;rt++){const ct=F[rt];if(f&&!f.has(ct))continue;const It=x[ct];if(!It)continue;let ft={};H&&L&&(ft=L.getState(It.sourceLayer||Bd,H));const _t=Gt({},M[ct]);_t.paint=Yp(_t.paint,It.paint,U,ft,y),_t.layout=Yp(_t.layout,It.layout,U,ft,y);const Bt=!z||z(U,It,ft);if(!Bt)continue;const Vt=new kp(U,this.z,this.x,this.y,H);Vt.layer=_t;let re=t[ct];re===void 0&&(re=t[ct]=[]),re.push({featureIndex:u,feature:Vt,intersectionZ:Bt})}}lookupSymbolFeatures(t,n,a,u,h,f,y,x){const M={};this.loadVTLayers();const L=Po(h.filterSpec,h.globalState);for(const z of t)this.loadMatchingFeature(M,a,u,z,L,f,y,x,n);return M}hasLayer(t){for(const n of this.bucketLayerIDs)for(const a of n)if(t===a)return!0;return!1}getId(t,n){var a;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((a=t.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function Yp(i,t,n,a,u){return sn(i,((h,f)=>{const y=t instanceof Ia?t.get(f):null;return y&&y.evaluate?y.evaluate(n,a,u):y}))}function Py(i,t){return t-i}function Hp(i,t,n,a,u){const h=[];for(let f=0;f<i.length;f++){const y=i[f];let x;for(let M=0;M<y.length-1;M++){let L=y[M],z=y[M+1];L.x<t&&z.x<t||(L.x<t?L=new N(t,L.y+(t-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x<t&&(z=new N(t,L.y+(t-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y<n&&z.y<n||(L.y<n?L=new N(L.x+(n-L.y)/(z.y-L.y)*(z.x-L.x),n)._round():z.y<n&&(z=new N(L.x+(n-L.y)/(z.y-L.y)*(z.x-L.x),n)._round()),L.x>=a&&z.x>=a||(L.x>=a?L=new N(a,L.y+(a-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x>=a&&(z=new N(a,L.y+(a-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y>=u&&z.y>=u||(L.y>=u?L=new N(L.x+(u-L.y)/(z.y-L.y)*(z.x-L.x),u)._round():z.y>=u&&(z=new N(L.x+(u-L.y)/(z.y-L.y)*(z.x-L.x),u)._round()),x&&L.equals(x[x.length-1])||(x=[L],h.push(x)),x.push(z)))))}}return h}function Kp(i,t,n,a,u){switch(t){case 1:return(function(h,f,y,x){const M=[];for(const L of h)for(const z of L){const F=x===0?z.x:z.y;F>=f&&F<=y&&M.push([z])}return M})(i,n,a,u);case 2:return Jp(i,n,a,u,!1);case 3:return Jp(i,n,a,u,!0)}return[]}function Cy(i,t,n,a,u){const h=a===0?Ay:Ly;let f=[];const y=[];for(let L=0;L<i.length-1;L++){const z=i[L],F=i[L+1],j=a===0?z.x:z.y,U=a===0?F.x:F.y;let H=!1;j<t?U>t&&f.push(h(z,F,t)):j>n?U<n&&f.push(h(z,F,n)):f.push(z),U<t&&j>=t&&(f.push(h(z,F,t)),H=!0),U>n&&j<=n&&(f.push(h(z,F,n)),H=!0),!u&&H&&(y.push(f),f=[])}const x=i.length-1,M=a===0?i[x].x:i[x].y;return M>=t&&M<=n&&f.push(i[x]),u&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(new N(f[0].x,f[0].y)),f.length>0&&y.push(f),y}function Jp(i,t,n,a,u){const h=[];for(const f of i){const y=Cy(f,t,n,a,u);y.length>0&&h.push(...y)}return h}function Ay(i,t,n){return new N(n,i.y+(n-i.x)/(t.x-i.x)*(t.y-i.y))}function Ly(i,t,n){return new N(i.x+(n-i.y)/(t.y-i.y)*(t.x-i.x),n)}Ue("FeatureIndex",Xp,{omit:["rawTileData","sourceLayerCoder"]});class eo extends N{constructor(t,n,a,u){super(t,n),this.angle=a,u!==void 0&&(this.segment=u)}clone(){return new eo(this.x,this.y,this.angle,this.segment)}}function Qp(i,t,n,a,u){if(t.segment===void 0||n===0)return!0;let h=t,f=t.segment+1,y=0;for(;y>-n/2;){if(f--,f<0)return!1;y-=i[f].dist(h),h=i[f]}y+=i[f].dist(i[f+1]),f++;const x=[];let M=0;for(;y<n/2;){const L=i[f],z=i[f+1];if(!z)return!1;let F=i[f-1].angleTo(L)-L.angleTo(z);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:F}),M+=F;y-x[0].distance>a;)M-=x.shift().angleDelta;if(M>u)return!1;f++,y+=L.dist(z)}return!0}function tm(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function em(i,t,n){return i?.6*t*n:0}function nm(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Dy(i,t,n,a,u,h){const f=em(n,u,h),y=nm(n,a)*h;let x=0;const M=tm(i)/2;for(let L=0;L<i.length-1;L++){const z=i[L],F=i[L+1],j=z.dist(F);if(x+j>M){const U=(M-x)/j,H=Cr.number(z.x,F.x,U),rt=Cr.number(z.y,F.y,U),ct=new eo(H,rt,F.angleTo(z),L);return ct._round(),!f||Qp(i,ct,y,f,t)?ct:void 0}x+=j}}function Ry(i,t,n,a,u,h,f,y,x){const M=em(a,h,f),L=nm(a,u),z=L*f,F=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-z<t/4&&(t=z+t/4),im(i,F?t/2*y%t:(L/2+2*h)*f*y%t,t,M,n,z,F,!1,x)}function im(i,t,n,a,u,h,f,y,x){const M=h/2,L=tm(i);let z=0,F=t-n,j=[];for(let U=0;U<i.length-1;U++){const H=i[U],rt=i[U+1],ct=H.dist(rt),It=rt.angleTo(H);for(;F+n<z+ct;){F+=n;const ft=(F-z)/ct,_t=Cr.number(H.x,rt.x,ft),Bt=Cr.number(H.y,rt.y,ft);if(_t>=0&&_t<x&&Bt>=0&&Bt<x&&F-M>=0&&F+M<=L){const Vt=new eo(_t,Bt,It,U);Vt._round(),a&&!Qp(i,Vt,h,a,u)||j.push(Vt)}}z+=ct}return y||j.length||f||(j=im(i,z/2,n,a,u,h,f,!0,x)),j}function rm(i,t,n,a){const u=[],h=i.image,f=h.pixelRatio,y=h.paddedRect.w-2,x=h.paddedRect.h-2;let M={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const L=h.stretchX||[[0,y]],z=h.stretchY||[[0,x]],F=(me,He)=>me+He[1]-He[0],j=L.reduce(F,0),U=z.reduce(F,0),H=y-j,rt=x-U;let ct=0,It=j,ft=0,_t=U,Bt=0,Vt=H,re=0,xe=rt;if(h.content&&a){const me=h.content,He=me[2]-me[0],Ke=me[3]-me[1];(h.textFitWidth||h.textFitHeight)&&(M=up(i)),ct=ph(L,0,me[0]),ft=ph(z,0,me[1]),It=ph(L,me[0],me[2]),_t=ph(z,me[1],me[3]),Bt=me[0]-ct,re=me[1]-ft,Vt=He-It,xe=Ke-_t}const pe=M.x1,Ie=M.y1,Fe=M.x2-pe,Ae=M.y2-Ie,Le=(me,He,Ke,nn)=>{const qe=mh(me.stretch-ct,It,Fe,pe),xn=gh(me.fixed-Bt,Vt,me.stretch,j),ei=mh(He.stretch-ft,_t,Ae,Ie),Li=gh(He.fixed-re,xe,He.stretch,U),nr=mh(Ke.stretch-ct,It,Fe,pe),xs=gh(Ke.fixed-Bt,Vt,Ke.stretch,j),br=mh(nn.stretch-ft,_t,Ae,Ie),Yi=gh(nn.fixed-re,xe,nn.stretch,U),ir=new N(qe,ei),gi=new N(nr,ei),Hi=new N(nr,br),cr=new N(qe,br),hr=new N(xn/f,Li/f),zr=new N(xs/f,Yi/f),rr=t*Math.PI/180;if(rr){const Gi=Math.sin(rr),ai=Math.cos(rr),Di=[ai,-Gi,Gi,ai];ir._matMult(Di),gi._matMult(Di),cr._matMult(Di),Hi._matMult(Di)}const Nr=me.stretch+me.fixed,bs=He.stretch+He.fixed;return{tl:ir,tr:gi,bl:cr,br:Hi,tex:{x:h.paddedRect.x+1+Nr,y:h.paddedRect.y+1+bs,w:Ke.stretch+Ke.fixed-Nr,h:nn.stretch+nn.fixed-bs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hr,pixelOffsetBR:zr,minFontScaleX:Vt/f/Fe,minFontScaleY:xe/f/Ae,isSDF:n}};if(a&&(h.stretchX||h.stretchY)){const me=sm(L,H,j),He=sm(z,rt,U);for(let Ke=0;Ke<me.length-1;Ke++){const nn=me[Ke],qe=me[Ke+1];for(let xn=0;xn<He.length-1;xn++)u.push(Le(nn,He[xn],qe,He[xn+1]))}}else u.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function ph(i,t,n){let a=0;for(const u of i)a+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return a}function sm(i,t,n){const a=[{fixed:-1,stretch:0}];for(const[u,h]of i){const f=a[a.length-1];a.push({fixed:u-f.stretch,stretch:f.stretch}),a.push({fixed:u-f.stretch,stretch:f.stretch+(h-u)})}return a.push({fixed:t+1,stretch:n}),a}function mh(i,t,n,a){return i/t*n+a}function gh(i,t,n,a){return i-t*n/a}Ue("Anchor",eo);class _h{constructor(t,n,a,u,h,f,y,x,M,L){var z;if(this.boxStartIndex=t.length,M){let F=f.top,j=f.bottom;const U=f.collisionPadding;U&&(F-=U[1],j+=U[3]);let H=j-F;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const F=!((z=f.image)===null||z===void 0)&&z.content&&(f.image.textFitWidth||f.image.textFitHeight)?up(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};F.y1=F.y1*y-x[0],F.y2=F.y2*y+x[2],F.x1=F.x1*y-x[3],F.x2=F.x2*y+x[1];const j=f.collisionPadding;if(j&&(F.x1-=j[0]*y,F.y1-=j[1]*y,F.x2+=j[2]*y,F.y2+=j[3]*y),L){const U=new N(F.x1,F.y1),H=new N(F.x2,F.y1),rt=new N(F.x1,F.y2),ct=new N(F.x2,F.y2),It=L*Math.PI/180;U._rotate(It),H._rotate(It),rt._rotate(It),ct._rotate(It),F.x1=Math.min(U.x,H.x,rt.x,ct.x),F.x2=Math.max(U.x,H.x,rt.x,ct.x),F.y1=Math.min(U.y,H.y,rt.y,ct.y),F.y2=Math.max(U.y,H.y,rt.y,ct.y)}t.emplaceBack(n.x,n.y,F.x1,F.y1,F.x2,F.y2,a,u,h)}this.boxEndIndex=t.length}}class zy{constructor(t=[],n=(a,u)=>a<u?-1:a>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:a}=this,u=n[t];for(;t>0;){const h=t-1>>1,f=n[h];if(a(u,f)>=0)break;n[t]=f,t=h}n[t]=u}_down(t){const{data:n,compare:a}=this,u=this.length>>1,h=n[t];for(;t<u;){let f=1+(t<<1);const y=f+1;if(y<this.length&&a(n[y],n[f])<0&&(f=y),a(n[f],h)>=0)break;n[t]=n[f],t=f}n[t]=h}}function Ny(i,t=1,n=!1){const a=Qo.fromPoints(i[0]),u=Math.min(a.width(),a.height());let h=u/2;const f=new zy([],Oy),{minX:y,minY:x,maxX:M,maxY:L}=a;if(u===0)return new N(y,x);for(let j=y;j<M;j+=u)for(let U=x;U<L;U+=u)f.push(new Ql(j+h,U+h,h,i));let z=(function(j){let U=0,H=0,rt=0;const ct=j[0];for(let It=0,ft=ct.length,_t=ft-1;It<ft;_t=It++){const Bt=ct[It],Vt=ct[_t],re=Bt.x*Vt.y-Vt.x*Bt.y;H+=(Bt.x+Vt.x)*re,rt+=(Bt.y+Vt.y)*re,U+=3*re}return new Ql(H/U,rt/U,0,j)})(i),F=f.length;for(;f.length;){const j=f.pop();(j.d>z.d||!z.d)&&(z=j,n&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,F)),j.max-z.d<=t||(h=j.h/2,f.push(new Ql(j.p.x-h,j.p.y-h,h,i)),f.push(new Ql(j.p.x+h,j.p.y-h,h,i)),f.push(new Ql(j.p.x-h,j.p.y+h,h,i)),f.push(new Ql(j.p.x+h,j.p.y+h,h,i)),F+=4)}return n&&(console.log(`num probes: ${F}`),console.log(`best distance: ${z.d}`)),z.p}function Oy(i,t){return t.max-i.max}function Ql(i,t,n,a){this.p=new N(i,t),this.h=n,this.d=(function(u,h){let f=!1,y=1/0;for(let x=0;x<h.length;x++){const M=h[x];for(let L=0,z=M.length,F=z-1;L<z;F=L++){const j=M[L],U=M[F];j.y>u.y!=U.y>u.y&&u.x<(U.x-j.x)*(u.y-j.y)/(U.y-j.y)+j.x&&(f=!f),y=Math.min(y,xf(u,j,U))}}return(f?1:-1)*Math.sqrt(y)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var er;b.aO=void 0,(er=b.aO||(b.aO={}))[er.center=1]="center",er[er.left=2]="left",er[er.right=3]="right",er[er.top=4]="top",er[er.bottom=5]="bottom",er[er["top-left"]=6]="top-left",er[er["top-right"]=7]="top-right",er[er["bottom-left"]=8]="bottom-left",er[er["bottom-right"]=9]="bottom-right";const Vd=Number.POSITIVE_INFINITY;function am(i,t){return t[1]!==Vd?(function(n,a,u){let h=0,f=0;switch(a=Math.abs(a),u=Math.abs(u),n){case"top-right":case"top-left":case"top":f=u-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-u}switch(n){case"top-right":case"bottom-right":case"right":h=-a;break;case"top-left":case"bottom-left":case"left":h=a}return[h,f]})(i,t[0],t[1]):(function(n,a){let u=0,h=0;a<0&&(a=0);const f=a/Math.SQRT2;switch(n){case"top-right":case"top-left":h=f-7;break;case"bottom-right":case"bottom-left":h=7-f;break;case"bottom":h=7-a;break;case"top":h=a-7}switch(n){case"top-right":case"bottom-right":u=-f;break;case"top-left":case"bottom-left":u=f;break;case"left":u=a;break;case"right":u=-a}return[u,h]})(i,t[0])}function om(i,t,n){var a;const u=i.layout,h=(a=u.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},n);if(h){const y=h.values,x=[];for(let M=0;M<y.length;M+=2){const L=x[M]=y[M],z=y[M+1].map((F=>F*Bi));L.startsWith("top")?z[1]-=7:L.startsWith("bottom")&&(z[1]+=7),x[M+1]=z}return new $i(x)}const f=u.get("text-variable-anchor");if(f){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*Bi,Vd]:u.get("text-offset").evaluate(t,{},n).map((M=>M*Bi));const x=[];for(const M of f)x.push(M,am(M,y));return new $i(x)}return null}function jd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fy(i,t,n,a,u,h,f,y,x,M,L,z){let F=h.textMaxSize.evaluate(t,{});F===void 0&&(F=f);const j=i.layers[0].layout,U=j.get("icon-offset").evaluate(t,{},L),H=um(n.horizontal),rt=f/24,ct=i.tilePixelRatio*rt,It=i.tilePixelRatio*F/24,ft=i.tilePixelRatio*y,_t=i.tilePixelRatio*j.get("symbol-spacing"),Bt=j.get("text-padding")*i.tilePixelRatio,Vt=(function(Ke,nn,qe,xn=1){const ei=Ke.get("icon-padding").evaluate(nn,{},qe),Li=ei&&ei.values;return[Li[0]*xn,Li[1]*xn,Li[2]*xn,Li[3]*xn]})(j,t,L,i.tilePixelRatio),re=j.get("text-max-angle")/180*Math.PI,xe=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",pe=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Ie=j.get("symbol-placement"),Fe=_t/2,Ae=j.get("icon-text-fit");let Le;a&&Ae!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Le=cp(a,n.vertical,Ae,j.get("icon-text-fit-padding"),U,rt)),H&&(a=cp(a,H,Ae,j.get("icon-text-fit-padding"),U,rt)));const me=L?z.line.getGranularityForZoomLevel(L.z):1,He=(Ke,nn)=>{nn.x<0||nn.x>=he||nn.y<0||nn.y>=he||(function(qe,xn,ei,Li,nr,xs,br,Yi,ir,gi,Hi,cr,hr,zr,rr,Nr,bs,Gi,ai,Di,hi,Ui,La,Vs,uc){const no=qe.addToLineVertexArray(xn,ei);let tl,tu,eu,nu,fm=0,pm=0,mm=0,gm=0,Yd=-1,Hd=-1;const Da={};let _m=Rs("");if(qe.allowVerticalPlacement&&Li.vertical){const dr=Yi.layout.get("text-rotate").evaluate(hi,{},Vs)+90;eu=new _h(ir,xn,gi,Hi,cr,Li.vertical,hr,zr,rr,dr),br&&(nu=new _h(ir,xn,gi,Hi,cr,br,bs,Gi,rr,dr))}if(nr){const dr=Yi.layout.get("icon-rotate").evaluate(hi,{}),hs=Yi.layout.get("icon-text-fit")!=="none",el=rm(nr,dr,La,hs),Gs=br?rm(br,dr,La,hs):void 0;tu=new _h(ir,xn,gi,Hi,cr,nr,bs,Gi,!1,dr),fm=4*el.length;const nl=qe.iconSizeData;let sa=null;nl.kind==="source"?(sa=[Ca*Yi.layout.get("icon-size").evaluate(hi,{})],sa[0]>Ja&&et(`${qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):nl.kind==="composite"&&(sa=[Ca*Ui.compositeIconSizes[0].evaluate(hi,{},Vs),Ca*Ui.compositeIconSizes[1].evaluate(hi,{},Vs)],(sa[0]>Ja||sa[1]>Ja)&&et(`${qe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),qe.addSymbols(qe.icon,el,sa,Di,ai,hi,b.ay.none,xn,no.lineStartIndex,no.lineLength,-1,Vs),Yd=qe.icon.placedSymbolArray.length-1,Gs&&(pm=4*Gs.length,qe.addSymbols(qe.icon,Gs,sa,Di,ai,hi,b.ay.vertical,xn,no.lineStartIndex,no.lineLength,-1,Vs),Hd=qe.icon.placedSymbolArray.length-1)}const ym=Object.keys(Li.horizontal);for(const dr of ym){const hs=Li.horizontal[dr];if(!tl){_m=Rs(hs.text);const Gs=Yi.layout.get("text-rotate").evaluate(hi,{},Vs);tl=new _h(ir,xn,gi,Hi,cr,hs,hr,zr,rr,Gs)}const el=hs.positionedLines.length===1;if(mm+=lm(qe,xn,hs,xs,Yi,rr,hi,Nr,no,Li.vertical?b.ay.horizontal:b.ay.horizontalOnly,el?ym:[dr],Da,Yd,Ui,Vs),el)break}Li.vertical&&(gm+=lm(qe,xn,Li.vertical,xs,Yi,rr,hi,Nr,no,b.ay.vertical,["vertical"],Da,Hd,Ui,Vs));const jy=tl?tl.boxStartIndex:qe.collisionBoxArray.length,Gy=tl?tl.boxEndIndex:qe.collisionBoxArray.length,Uy=eu?eu.boxStartIndex:qe.collisionBoxArray.length,qy=eu?eu.boxEndIndex:qe.collisionBoxArray.length,Zy=tu?tu.boxStartIndex:qe.collisionBoxArray.length,$y=tu?tu.boxEndIndex:qe.collisionBoxArray.length,Wy=nu?nu.boxStartIndex:qe.collisionBoxArray.length,Xy=nu?nu.boxEndIndex:qe.collisionBoxArray.length;let js=-1;const vh=(dr,hs)=>dr&&dr.circleDiameter?Math.max(dr.circleDiameter,hs):hs;js=vh(tl,js),js=vh(eu,js),js=vh(tu,js),js=vh(nu,js);const vm=js>-1?1:0;vm&&(js*=uc/Bi),qe.glyphOffsetArray.length>=$l.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hi.sortKey!==void 0&&qe.addToSortKeyRanges(qe.symbolInstances.length,hi.sortKey);const Yy=om(Yi,hi,Vs),[Hy,Ky]=(function(dr,hs){const el=dr.length,Gs=hs?.values;if(Gs?.length>0)for(let nl=0;nl<Gs.length;nl+=2){const sa=Gs[nl+1];dr.emplaceBack(b.aO[Gs[nl]],sa[0],sa[1])}return[el,dr.length]})(qe.textAnchorOffsets,Yy);qe.symbolInstances.emplaceBack(xn.x,xn.y,Da.right>=0?Da.right:-1,Da.center>=0?Da.center:-1,Da.left>=0?Da.left:-1,Da.vertical||-1,Yd,Hd,_m,jy,Gy,Uy,qy,Zy,$y,Wy,Xy,gi,mm,gm,fm,pm,vm,0,hr,js,Hy,Ky)})(i,nn,Ke,n,a,u,Le,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ct,[Bt,Bt,Bt,Bt],xe,x,ft,Vt,pe,U,t,h,M,L,f)};if(Ie==="line")for(const Ke of Hp(t.geometry,0,0,he,he)){const nn=Yo(Ke,me),qe=Ry(nn,_t,re,n.vertical||H,a,24,It,i.overscaling,he);for(const xn of qe)H&&By(i,H.text,Fe,xn)||He(nn,xn)}else if(Ie==="line-center"){for(const Ke of t.geometry)if(Ke.length>1){const nn=Yo(Ke,me),qe=Dy(nn,re,n.vertical||H,a,24,It);qe&&He(nn,qe)}}else if(t.type==="Polygon")for(const Ke of Ys(t.geometry,0)){const nn=Ny(Ke,16);He(Yo(Ke[0],me,!0),new eo(nn.x,nn.y,0))}else if(t.type==="LineString")for(const Ke of t.geometry){const nn=Yo(Ke,me);He(nn,new eo(nn[0].x,nn[0].y,0))}else if(t.type==="Point")for(const Ke of t.geometry)for(const nn of Ke)He([nn],new eo(nn.x,nn.y,0))}function lm(i,t,n,a,u,h,f,y,x,M,L,z,F,j,U){const H=(function(It,ft,_t,Bt,Vt,re,xe,pe){const Ie=Bt.layout.get("text-rotate").evaluate(re,{})*Math.PI/180,Fe=[];for(const Ae of ft.positionedLines)for(const Le of Ae.positionedGlyphs){if(!Le.rect)continue;const me=Le.rect||{};let He=4,Ke=!0,nn=1,qe=0;const xn=(Vt||pe)&&Le.vertical,ei=Le.metrics.advance*Le.scale/2;if(pe&&ft.verticalizable&&(qe=Ae.lineOffset/2-(Le.imageName?-(Bi-Le.metrics.width*Le.scale)/2:(Le.scale-1)*Bi)),Le.imageName){const Gi=xe[Le.imageName];Ke=Gi.sdf,nn=Gi.pixelRatio,He=1/nn}const Li=Vt?[Le.x+ei,Le.y]:[0,0];let nr=Vt?[0,0]:[Le.x+ei+_t[0],Le.y+_t[1]-qe],xs=[0,0];xn&&(xs=nr,nr=[0,0]);const br=Le.metrics.isDoubleResolution?2:1,Yi=(Le.metrics.left-He)*Le.scale-ei+nr[0],ir=(-Le.metrics.top-He)*Le.scale+nr[1],gi=Yi+me.w/br*Le.scale/nn,Hi=ir+me.h/br*Le.scale/nn,cr=new N(Yi,ir),hr=new N(gi,ir),zr=new N(Yi,Hi),rr=new N(gi,Hi);if(xn){const Gi=new N(-ei,ei- -17),ai=-Math.PI/2,Di=12-ei,hi=new N(22-Di,-(Le.imageName?Di:0)),Ui=new N(...xs);cr._rotateAround(ai,Gi)._add(hi)._add(Ui),hr._rotateAround(ai,Gi)._add(hi)._add(Ui),zr._rotateAround(ai,Gi)._add(hi)._add(Ui),rr._rotateAround(ai,Gi)._add(hi)._add(Ui)}if(Ie){const Gi=Math.sin(Ie),ai=Math.cos(Ie),Di=[ai,-Gi,Gi,ai];cr._matMult(Di),hr._matMult(Di),zr._matMult(Di),rr._matMult(Di)}const Nr=new N(0,0),bs=new N(0,0);Fe.push({tl:cr,tr:hr,bl:zr,br:rr,tex:me,writingMode:ft.writingMode,glyphOffset:Li,sectionIndex:Le.sectionIndex,isSDF:Ke,pixelOffsetTL:Nr,pixelOffsetBR:bs,minFontScaleX:0,minFontScaleY:0})}return Fe})(0,n,y,u,h,f,a,i.allowVerticalPlacement),rt=i.textSizeData;let ct=null;rt.kind==="source"?(ct=[Ca*u.layout.get("text-size").evaluate(f,{})],ct[0]>Ja&&et(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):rt.kind==="composite"&&(ct=[Ca*j.compositeTextSizes[0].evaluate(f,{},U),Ca*j.compositeTextSizes[1].evaluate(f,{},U)],(ct[0]>Ja||ct[1]>Ja)&&et(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,ct,y,h,f,M,t,x.lineStartIndex,x.lineLength,F,U);for(const It of L)z[It]=i.text.placedSymbolArray.length-1;return 4*H.length}function um(i){for(const t in i)return i[t];return null}function By(i,t,n,a){const u=i.compareText;if(t in u){const h=u[t];for(let f=h.length-1;f>=0;f--)if(a.dist(h[f])<n)return!0}else u[t]=[];return u[t].push(a),!1}const cm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const h=cm[15&a];if(!h)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Gd(y,f,h,t)}constructor(t,n=64,a=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=cm.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=n,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ud(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:y}=this,x=[0,h.length-1,0],M=[];for(;x.length;){const L=x.pop()||0,z=x.pop()||0,F=x.pop()||0;if(z-F<=y){for(let rt=F;rt<=z;rt++){const ct=f[2*rt],It=f[2*rt+1];ct>=t&&ct<=a&&It>=n&&It<=u&&M.push(h[rt])}continue}const j=F+z>>1,U=f[2*j],H=f[2*j+1];U>=t&&U<=a&&H>=n&&H<=u&&M.push(h[j]),(L===0?t<=U:n<=H)&&(x.push(F),x.push(j-1),x.push(1-L)),(L===0?a>=U:u>=H)&&(x.push(j+1),x.push(z),x.push(1-L))}return M}within(t,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:h,nodeSize:f}=this,y=[0,u.length-1,0],x=[],M=a*a;for(;y.length;){const L=y.pop()||0,z=y.pop()||0,F=y.pop()||0;if(z-F<=f){for(let rt=F;rt<=z;rt++)dm(h[2*rt],h[2*rt+1],t,n)<=M&&x.push(u[rt]);continue}const j=F+z>>1,U=h[2*j],H=h[2*j+1];dm(U,H,t,n)<=M&&x.push(u[j]),(L===0?t-a<=U:n-a<=H)&&(y.push(F),y.push(j-1),y.push(1-L)),(L===0?t+a>=U:n+a>=H)&&(y.push(j+1),y.push(z),y.push(1-L))}return x}}function Ud(i,t,n,a,u,h){if(u-a<=n)return;const f=a+u>>1;hm(i,t,f,a,u,h),Ud(i,t,n,a,f-1,1-h),Ud(i,t,n,f+1,u,1-h)}function hm(i,t,n,a,u,h){for(;u>a;){if(u-a>600){const M=u-a+1,L=n-a+1,z=Math.log(M),F=.5*Math.exp(2*z/3),j=.5*Math.sqrt(z*F*(M-F)/M)*(L-M/2<0?-1:1);hm(i,t,n,Math.max(a,Math.floor(n-L*F/M+j)),Math.min(u,Math.floor(n+(M-L)*F/M+j)),h)}const f=t[2*n+h];let y=a,x=u;for(oc(i,t,a,n),t[2*u+h]>f&&oc(i,t,a,u);y<x;){for(oc(i,t,y,x),y++,x--;t[2*y+h]<f;)y++;for(;t[2*x+h]>f;)x--}t[2*a+h]===f?oc(i,t,a,x):(x++,oc(i,t,x,u)),x<=n&&(a=x+1),n<=x&&(u=x-1)}}function oc(i,t,n,a){qd(i,n,a),qd(t,2*n,2*a),qd(t,2*n+1,2*a+1)}function qd(i,t,n){const a=i[t];i[t]=i[n],i[n]=a}function dm(i,t,n,a){const u=i-n,h=t-a;return u*u+h*h}var Zd;b.cG=void 0,(Zd=b.cG||(b.cG={})).create="create",Zd.load="load",Zd.fullLoad="fullLoad";let yh=null,lc=[];const $d=1e3/60,Wd="loadTime",Xd="fullLoadTime",Vy={mark(i){performance.mark(i)},frame(i){const t=i;yh!=null&&lc.push(t-yh),yh=t},clearMetrics(){yh=null,lc=[],performance.clearMeasures(Wd),performance.clearMeasures(Xd);for(const i in b.cG)performance.clearMarks(b.cG[i])},getPerformanceMetrics(){performance.measure(Wd,b.cG.create,b.cG.load),performance.measure(Xd,b.cG.create,b.cG.fullLoad);const i=performance.getEntriesByName(Wd)[0].duration,t=performance.getEntriesByName(Xd)[0].duration,n=lc.length,a=1/(lc.reduce(((h,f)=>h+f),0)/n/1e3),u=lc.filter((h=>h>$d)).reduce(((h,f)=>h+(f-$d)/$d),0);return{loadTime:i,fullLoadTime:t,fps:a,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};b.$=at,b.A=dt,b.B=Cl,b.C=wa,b.D=We,b.E=$t,b.F=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},b.G=Cr,b.H=qn,b.I=yd,b.J=Wh,b.K=function(i){if(Pt==null){const t=i.navigator?i.navigator.userAgent:null;Pt=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Pt},b.L=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ly((()=>this.process())),this.subscription=Re(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=de(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,t){return new Promise(((n,a)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),h=t?Re(t.signal,"abort",(()=>{h?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),uy):null;this.resolveRejects[u]={resolve:x=>{h?.unsubscribe(),n(x)},reject:x=>{h?.unsubscribe(),a(x)}};const f=[],y=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Oo(i.data,f)});this.target.postMessage(y,{transfer:f})}))}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const a=this.abortControllers[n];return delete this.abortControllers[n],void(a&&a.abort())}if(de(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return o(this,void 0,void 0,(function*(){if(t.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(t.error?u.reject(Ls(t.error)):u.resolve(Ls(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Ls(t.data),a=new AbortController;this.abortControllers[i]=a;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,a);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}}))}completeTask(i,t,n){const a=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Oo(t):null,data:Oo(n,a)};this.target.postMessage(u,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.M=ar,b.N=function(){var i=new dt(16);return dt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},b.O=function(i,t,n){var a,u,h,f,y,x,M,L,z,F,j,U,H=n[0],rt=n[1],ct=n[2];return t===i?(i[12]=t[0]*H+t[4]*rt+t[8]*ct+t[12],i[13]=t[1]*H+t[5]*rt+t[9]*ct+t[13],i[14]=t[2]*H+t[6]*rt+t[10]*ct+t[14],i[15]=t[3]*H+t[7]*rt+t[11]*ct+t[15]):(u=t[1],h=t[2],f=t[3],y=t[4],x=t[5],M=t[6],L=t[7],z=t[8],F=t[9],j=t[10],U=t[11],i[0]=a=t[0],i[1]=u,i[2]=h,i[3]=f,i[4]=y,i[5]=x,i[6]=M,i[7]=L,i[8]=z,i[9]=F,i[10]=j,i[11]=U,i[12]=a*H+y*rt+z*ct+t[12],i[13]=u*H+x*rt+F*ct+t[13],i[14]=h*H+M*rt+j*ct+t[14],i[15]=f*H+L*rt+U*ct+t[15]),i},b.P=N,b.Q=function(i,t,n){var a=n[0],u=n[1],h=n[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*h,i[9]=t[9]*h,i[10]=t[10]*h,i[11]=t[11]*h,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},b.R=Rr,b.S=function(i,t,n){var a=t[0],u=t[1],h=t[2],f=t[3],y=t[4],x=t[5],M=t[6],L=t[7],z=t[8],F=t[9],j=t[10],U=t[11],H=t[12],rt=t[13],ct=t[14],It=t[15],ft=n[0],_t=n[1],Bt=n[2],Vt=n[3];return i[0]=ft*a+_t*y+Bt*z+Vt*H,i[1]=ft*u+_t*x+Bt*F+Vt*rt,i[2]=ft*h+_t*M+Bt*j+Vt*ct,i[3]=ft*f+_t*L+Bt*U+Vt*It,i[4]=(ft=n[4])*a+(_t=n[5])*y+(Bt=n[6])*z+(Vt=n[7])*H,i[5]=ft*u+_t*x+Bt*F+Vt*rt,i[6]=ft*h+_t*M+Bt*j+Vt*ct,i[7]=ft*f+_t*L+Bt*U+Vt*It,i[8]=(ft=n[8])*a+(_t=n[9])*y+(Bt=n[10])*z+(Vt=n[11])*H,i[9]=ft*u+_t*x+Bt*F+Vt*rt,i[10]=ft*h+_t*M+Bt*j+Vt*ct,i[11]=ft*f+_t*L+Bt*U+Vt*It,i[12]=(ft=n[12])*a+(_t=n[13])*y+(Bt=n[14])*z+(Vt=n[15])*H,i[13]=ft*u+_t*x+Bt*F+Vt*rt,i[14]=ft*h+_t*M+Bt*j+Vt*ct,i[15]=ft*f+_t*L+Bt*U+Vt*It,i},b.T=ld,b.U=function(i,t){const n={};for(let a=0;a<t.length;a++){const u=t[a];u in i&&(n[u]=i[u])}return n},b.V=Qa,b.W=Pn,b.X=vp,b.Y=yp,b.Z=W,b._=o,b.a=ln,b.a$=Ot,b.a0=Te,b.a1=us,b.a2=bp,b.a3=rh,b.a4=he,b.a5=function(i,t,n){if(!i)return t||{};if(!t)return i||{};const a=Sp(i),u=Sp(t);(function(f,y){y.removeAll&&(f.add.clear(),f.update.clear(),f.remove.clear(),y.remove.clear());for(const x of y.remove)f.add.delete(x),f.update.delete(x);for(const[x,M]of y.update){const L=f.update.get(x);L&&(y.update.set(x,cy(L,M)),f.update.delete(x))}})(a,u);const h={};if((a.removeAll||u.removeAll)&&(h.removeAll=!0),h.remove=new Set([...a.remove,...u.remove]),h.add=new Map([...a.add,...u.add]),h.update=new Map([...a.update,...u.update]),h.remove.size&&h.add.size)for(const f of h.add.keys())h.remove.delete(f);return(function(f){const y={};return f.removeAll&&(y.removeAll=f.removeAll),f.remove&&(y.remove=Array.from(f.remove)),f.add&&(y.add=Array.from(f.add.values())),f.update&&(y.update=Array.from(f.update.values())),y})(h)},b.a6=function(i,t){if(i==null)return!0;if(i.type==="Feature")return tc(i,t)!=null;if(i.type==="FeatureCollection"){const n=new Set;for(const a of i.features){const u=tc(a,t);if(u==null||n.has(u))return!1;n.add(u)}return!0}return!1},b.a7=function(i,t){const n=new Map;if(i!=null)if(i.type==="Feature")n.set(tc(i,t),i);else for(const a of i.features)n.set(tc(a,t),a);return n},b.a8=function(i,t,n){var a,u;if(t.removeAll)i.clear();else if(t.remove)for(const h of t.remove)i.delete(h);if(t.add)for(const h of t.add){const f=tc(h,n);f!=null&&i.set(f,h)}if(t.update)for(const h of t.update){let f=i.get(h.id);if(!f)continue;const y=!!h.newGeometry,x=h.removeAllProperties||((a=h.removeProperties)===null||a===void 0?void 0:a.length)>0||((u=h.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if((y||x)&&(f=Object.assign({},f),i.set(h.id,f),y&&(f.geometry=h.newGeometry),x)){if(f.properties=h.removeAllProperties?{}:Object.assign({},f.properties||{}),h.removeProperties)for(const M of h.removeProperties)delete f.properties[M];if(h.addOrUpdateProperties)for(const{key:M,value:L}of h.addOrUpdateProperties)f.properties[M]=L}}},b.a9=Bd,b.aA=function(i,t){var n=t[0],a=t[1],u=t[2],h=t[3],f=t[4],y=t[5],x=t[6],M=t[7],L=t[8],z=t[9],F=t[10],j=t[11],U=t[12],H=t[13],rt=t[14],ct=t[15],It=n*y-a*f,ft=n*x-u*f,_t=n*M-h*f,Bt=a*x-u*y,Vt=a*M-h*y,re=u*M-h*x,xe=L*H-z*U,pe=L*rt-F*U,Ie=L*ct-j*U,Fe=z*rt-F*H,Ae=z*ct-j*H,Le=F*ct-j*rt,me=It*Le-ft*Ae+_t*Fe+Bt*Ie-Vt*pe+re*xe;return me?(i[0]=(y*Le-x*Ae+M*Fe)*(me=1/me),i[1]=(u*Ae-a*Le-h*Fe)*me,i[2]=(H*re-rt*Vt+ct*Bt)*me,i[3]=(F*Vt-z*re-j*Bt)*me,i[4]=(x*Ie-f*Le-M*pe)*me,i[5]=(n*Le-u*Ie+h*pe)*me,i[6]=(rt*_t-U*re-ct*ft)*me,i[7]=(L*re-F*_t+j*ft)*me,i[8]=(f*Ae-y*Ie+M*xe)*me,i[9]=(a*Ie-n*Ae-h*xe)*me,i[10]=(U*Vt-H*_t+ct*It)*me,i[11]=(z*_t-L*Vt-j*It)*me,i[12]=(y*pe-f*Fe-x*xe)*me,i[13]=(n*Fe-a*pe+u*xe)*me,i[14]=(H*ft-U*Bt-rt*It)*me,i[15]=(L*Bt-z*ft+F*It)*me,i):null},b.aB=te,b.aC=function(i){var t=i[0],n=i[1];return Math.sqrt(t*t+n*n)},b.aD=function(i){return i[0]=0,i[1]=0,i},b.aE=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i},b.aF=bd,b.aG=tt,b.aH=function(i,t,n,a){const u=t.y-i.y,h=t.x-i.x,f=a.y-n.y,y=a.x-n.x,x=f*h-y*u;if(x===0)return null;const M=(y*(i.y-n.y)-f*(i.x-n.x))/x;return new N(i.x+M*h,i.y+M*u)},b.aI=Hp,b.aJ=yf,b.aK=function(i){let t=1/0,n=1/0,a=-1/0,u=-1/0;for(const h of i)t=Math.min(t,h.x),n=Math.min(n,h.y),a=Math.max(a,h.x),u=Math.max(u,h.y);return[t,n,a,u]},b.aL=Bi,b.aM=_e,b.aN=function(i,t,n,a,u=!1){if(!n[0]&&!n[1])return[0,0];const h=u?a==="map"?-i.bearingInRadians:0:a==="viewport"?i.bearingInRadians:0;if(h){const f=Math.sin(h),y=Math.cos(h);n=[n[0]*y-n[1]*f,n[0]*f+n[1]*y]}return[u?n[0]:_e(t,n[0],i.zoom),u?n[1]:_e(t,n[1],i.zoom)]},b.aP=xd,b.aQ=jd,b.aR=vd,b.aS=Gd,b.aT=pi,b.aU=Qc,b.aV=yt,b.aW=on,b.aX=Me,b.aY=Ce,b.aZ=wp,b.a_=Kt,b.aa=Qu,b.ab=Qo,b.ac=25,b.ad=Ed,b.ae=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const a of i){const u=window.document.createElement("source");nt(a)||(t.crossOrigin="Anonymous"),u.src=a,t.appendChild(u)}}))},b.af=we,b.ag=function(){return bn++},b.ah=v,b.ai=$l,b.aj=Po,b.ak=Os,b.al=kp,b.am=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,a,u,h)=>{const f=u||h;return t[a]=!f||f.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},b.an=_n,b.ao=85.051129,b.ap=be,b.aq=function(i){return Math.pow(2,i)},b.ar=kt,b.as=xp,b.at=function(i){return Math.log(i)/Math.LN2},b.au=function(i){var t=i[0],n=i[1];return t*t+n*n},b.av=class{constructor(i,t){this.max=i,this.onRemove=t,this.reset()}reset(){for(const i in this.data)for(const t of this.data[i])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(i,t,n){const a=i.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const u={value:t,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout((()=>{this.remove(i,u)}),n)),this.data[a].push(u),this.order.push(a),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const t=this.data[i].shift();return t.timeout&&clearTimeout(t.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),t.value}getByKey(i){const t=this.data[i];return t?t[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,t){if(!this.has(i))return this;const n=i.wrapped().key,a=t===void 0?0:this.data[n].indexOf(t),u=this.data[n][a];return this.data[n].splice(a,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(i){const t=[];for(const n in this.data)for(const a of this.data[n])i(a.value)||t.push(a);for(const n of t)this.remove(n.value.tileID,n)}},b.aw=function(i){if(!i.length)return new Set;const t=Math.max(...i.map((x=>x.canonical.z)));let n=1/0,a=-1/0,u=1/0,h=-1/0;const f=[];for(const x of i){const{x:M,y:L,z}=x.canonical,F=Math.pow(2,t-z),j=M*F,U=L*F;f.push({id:x,x:j,y:U}),j<n&&(n=j),j>a&&(a=j),U<u&&(u=U),U>h&&(h=U)}const y=new Set;for(const x of f)x.x!==n&&x.x!==a&&x.y!==u&&x.y!==h||y.add(x.id);return y},b.ax=function(i,t){let n=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:h,maxZoom:f}=i,y=u?_n(zi.interpolationFactor(u,t,h,f),0,1):0;i.kind==="camera"?a=Cr.number(i.minSize,i.maxSize,y):n=y}return{uSizeT:n,uSize:a}},b.az=function(i,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:u}){return i.kind==="source"?a/Ca:i.kind==="composite"?Cr.number(a/Ca,u/Ca,n):t},b.b=bt,b.b$=class extends Qr{constructor(i,t){super(i,t),this.current=ka}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},b.b0=function(i){var t=new dt(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},b.b1=function(i,t,n){return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i},b.b2=function(i,t){var n=t[0],a=t[1],u=t[2],h=n*n+a*a+u*u;return h>0&&(h=1/Math.sqrt(h)),i[0]=t[0]*h,i[1]=t[1]*h,i[2]=t[2]*h,i},b.b3=ge,b.b4=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},b.b5=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},b.b6=Mt,b.b7=function(i,t,n){const a=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return a===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/a},b.b8=Ht,b.b9=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i},b.bA=ze,b.bB=function(i,t,n){var a=n[0],u=n[1],h=n[2],f=n[3],y=t[0],x=t[1],M=t[2],L=u*M-h*x,z=h*y-a*M,F=a*x-u*y;return i[0]=y+f*(L+=L)+u*(F+=F)-h*(z+=z),i[1]=x+f*z+h*L-a*F,i[2]=M+f*F+a*z-u*L,i},b.bC=function(i,t,n){const a=(u=[i[0],i[1],i[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((L=u[8])*(f=u[4])-(y=u[5])*(M=u[7]))+u[1]*(-L*(h=u[3])+y*(x=u[6]))+u[2]*(M*h-f*x);var u,h,f,y,x,M,L;if(a===0)return null;const z=ge([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),F=ge([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),j=ge([],[i[0],i[1],i[2]],[t[0],t[1],t[2]]),U=Kt([],z,-i[3]);return Ot(U,U,Kt([],F,-t[3])),Ot(U,U,Kt([],j,-n[3])),Kt(U,U,1/a),U},b.bD=Sd,b.bE=function(){return new Float64Array(4)},b.bF=function(i,t,n,a){var u=[],h=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],h[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),h[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),h[2]=u[2],i[0]=h[0]+n[0],i[1]=h[1]+n[1],i[2]=h[2]+n[2],i},b.bG=function(i,t,n,a){var u=[],h=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],h[0]=u[0],h[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),h[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),i[0]=h[0]+n[0],i[1]=h[1]+n[1],i[2]=h[2]+n[2],i},b.bH=function(i,t,n,a){var u=[],h=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],h[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),h[1]=u[1],h[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),i[0]=h[0]+n[0],i[1]=h[1]+n[1],i[2]=h[2]+n[2],i},b.bI=function(i,t,n){var a=Math.sin(n),u=Math.cos(n),h=t[0],f=t[1],y=t[2],x=t[3],M=t[8],L=t[9],z=t[10],F=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=h*u-M*a,i[1]=f*u-L*a,i[2]=y*u-z*a,i[3]=x*u-F*a,i[8]=h*a+M*u,i[9]=f*a+L*u,i[10]=y*a+z*u,i[11]=x*a+F*u,i},b.bJ=function(i,t){const n=Zt(i,360),a=Zt(t,360),u=a-n,h=a>n?u-360:u+360;return Math.abs(u)<Math.abs(h)?u:h},b.bK=function(i){return i[0]=0,i[1]=0,i[2]=0,i},b.bL=function(i,t,n,a){const u=Math.sqrt(i*i+t*t),h=Math.sqrt(n*n+a*a);i/=u,t/=u,n/=h,a/=h;const f=Math.acos(i*n+t*a);return-t*n+i*a>0?f:-f},b.bM=function(i,t){const n=Zt(i,2*Math.PI),a=Zt(t,2*Math.PI);return Math.min(Math.abs(n-a),Math.abs(n-a+2*Math.PI),Math.abs(n-a-2*Math.PI))},b.bN=function(){const i={},t=pt.$version;for(const n in pt.$root){const a=pt.$root[n];if(a.required){let u=null;u=n==="version"?t:a.type==="array"?[]:{},u!=null&&(i[n]=u)}}return i},b.bO=Mi,b.bP=ku,b.bQ=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(!i(t[a],n[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const a in t)if(!i(t[a],n[a]))return!1;return!0}return t===n},b.bR=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=le(i[n],t[i[n].ref]));return i},b.bS=function(i,t){if(i.type==="custom")return new oy(i,t);switch(i.type){case"background":return new ay(i,t);case"circle":return new Zg(i,t);case"color-relief":return new Kg(i,t);case"fill":return new d_(i,t);case"fill-extrusion":return new I_(i,t);case"heatmap":return new Wg(i,t);case"hillshade":return new Yg(i,t);case"line":return new C_(i,t);case"raster":return new Jh(i,t);case"symbol":return new ih(i,t)}},b.bT=i=>i.type==="raster",b.bU=Dt,b.bV=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!ue(i.version,t.version))return[{command:"setStyle",args:[t]}];ue(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),ue(i.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),ue(i.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),ue(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),ue(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),ue(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),ue(i.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),ue(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),ue(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),ue(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),ue(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),ue(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),ue(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),ue(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const a={},u=[];(function(f,y,x,M){let L;for(L in y=y||{},f=f||{})Object.prototype.hasOwnProperty.call(f,L)&&(Object.prototype.hasOwnProperty.call(y,L)||Xe(L,x,M));for(L in y)Object.prototype.hasOwnProperty.call(y,L)&&(Object.prototype.hasOwnProperty.call(f,L)?ue(f[L],y[L])||(f[L].type==="geojson"&&y[L].type==="geojson"&&jn(f,y,L)?ce(x,{command:"setGeoJSONSourceData",args:[L,y[L].data]}):an(L,y,x,M)):se(L,y,x))})(i.sources,t.sources,u,a);const h=[];i.layers&&i.layers.forEach((f=>{"source"in f&&a[f.source]?n.push({command:"removeLayer",args:[f.id]}):h.push(f)})),n=n.concat(u),(function(f,y,x){y=y||[];const M=(f=f||[]).map(En),L=y.map(En),z=f.reduce(zn,{}),F=y.reduce(zn,{}),j=M.slice(),U=Object.create(null);let H,rt,ct,It,ft;for(let _t=0,Bt=0;_t<M.length;_t++)H=M[_t],Object.prototype.hasOwnProperty.call(F,H)?Bt++:(ce(x,{command:"removeLayer",args:[H]}),j.splice(j.indexOf(H,Bt),1));for(let _t=0,Bt=0;_t<L.length;_t++)H=L[L.length-1-_t],j[j.length-1-_t]!==H&&(Object.prototype.hasOwnProperty.call(z,H)?(ce(x,{command:"removeLayer",args:[H]}),j.splice(j.lastIndexOf(H,j.length-Bt),1)):Bt++,It=j[j.length-_t],ce(x,{command:"addLayer",args:[F[H],It]}),j.splice(j.length-_t,0,H),U[H]=!0);for(let _t=0;_t<L.length;_t++)if(H=L[_t],rt=z[H],ct=F[H],!U[H]&&!ue(rt,ct))if(ue(rt.source,ct.source)&&ue(rt["source-layer"],ct["source-layer"])&&ue(rt.type,ct.type)){for(ft in vn(rt.layout,ct.layout,x,H,null,"setLayoutProperty"),vn(rt.paint,ct.paint,x,H,null,"setPaintProperty"),ue(rt.filter,ct.filter)||ce(x,{command:"setFilter",args:[H,ct.filter]}),ue(rt.minzoom,ct.minzoom)&&ue(rt.maxzoom,ct.maxzoom)||ce(x,{command:"setLayerZoomRange",args:[H,ct.minzoom,ct.maxzoom]}),rt)Object.prototype.hasOwnProperty.call(rt,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?vn(rt[ft],ct[ft],x,H,ft.slice(6),"setPaintProperty"):ue(rt[ft],ct[ft])||ce(x,{command:"setLayerProperty",args:[H,ft,ct[ft]]}));for(ft in ct)Object.prototype.hasOwnProperty.call(ct,ft)&&!Object.prototype.hasOwnProperty.call(rt,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?vn(rt[ft],ct[ft],x,H,ft.slice(6),"setPaintProperty"):ue(rt[ft],ct[ft])||ce(x,{command:"setLayerProperty",args:[H,ft,ct[ft]]}))}else ce(x,{command:"removeLayer",args:[H]}),It=j[j.lastIndexOf(H)+1],ce(x,{command:"addLayer",args:[ct,It]})})(h,t.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:"setStyle",args:[t]}]}return n},b.bW=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},b.bX=sn,b.bY=Be,b.bZ=class extends Qr{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},b.b_=Ns,b.ba=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]},b.bb=Tp,b.bc=Wl,b.bd=function(i,t,n,a,u){var h=1/Math.tan(t/2);if(i[0]=h/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=h,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0){var f=1/(a-u);i[10]=(u+a)*f,i[14]=2*u*a*f}else i[10]=-1,i[14]=-2*a;return i},b.be=function(i){var t=new dt(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},b.bf=function(i,t,n){var a=Math.sin(n),u=Math.cos(n),h=t[0],f=t[1],y=t[2],x=t[3],M=t[4],L=t[5],z=t[6],F=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=h*u+M*a,i[1]=f*u+L*a,i[2]=y*u+z*a,i[3]=x*u+F*a,i[4]=M*u-h*a,i[5]=L*u-f*a,i[6]=z*u-y*a,i[7]=F*u-x*a,i},b.bg=function(i,t,n){var a=Math.sin(n),u=Math.cos(n),h=t[4],f=t[5],y=t[6],x=t[7],M=t[8],L=t[9],z=t[10],F=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=h*u+M*a,i[5]=f*u+L*a,i[6]=y*u+z*a,i[7]=x*u+F*a,i[8]=M*u-h*a,i[9]=L*u-f*a,i[10]=z*u-y*a,i[11]=F*u-x*a,i},b.bh=function(){const i=new Float32Array(16);return kt(i),i},b.bi=function(){const i=new Float64Array(16);return kt(i),i},b.bj=function(){return new Float64Array(16)},b.bk=function(i,t,n){const a=new Float64Array(4);return ze(a,i,t-90,n),a},b.bl=function(i,t,n,a){var u,h,f,y,x,M=t[0],L=t[1],z=t[2],F=t[3],j=n[0],U=n[1],H=n[2],rt=n[3];return(h=M*j+L*U+z*H+F*rt)<0&&(h=-h,j=-j,U=-U,H=-H,rt=-rt),1-h>ut?(u=Math.acos(h),f=Math.sin(u),y=Math.sin((1-a)*u)/f,x=Math.sin(a*u)/f):(y=1-a,x=a),i[0]=y*M+x*j,i[1]=y*L+x*U,i[2]=y*z+x*H,i[3]=y*F+x*rt,i},b.bm=function(i){const t=new Float64Array(9);var n,a,u,h,f,y,x,M,L,z,F,j,U,H,rt,ct,It,ft;z=(u=(a=i)[0])*(x=u+u),F=(h=a[1])*x,U=(f=a[2])*x,H=f*(M=h+h),ct=(y=a[3])*x,It=y*M,ft=y*(L=f+f),(n=t)[0]=1-(j=h*M)-(rt=f*L),n[3]=F-ft,n[6]=U+It,n[1]=F+ft,n[4]=1-z-rt,n[7]=H-ct,n[2]=U-It,n[5]=H+ct,n[8]=1-z-j;const _t=Ce(-Math.asin(_n(t[2],-1,1)));let Bt,Vt;return Math.hypot(t[5],t[8])<.001?(Bt=0,Vt=-Ce(Math.atan2(t[3],t[4]))):(Bt=Ce(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Vt=Ce(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Bt,pitch:_t+90,bearing:Vt}},b.bn=function(i,t){return i.roll==t.roll&&i.pitch==t.pitch&&i.bearing==t.bearing},b.bo=un,b.bp=zs,b.bq=Gl,b.br=Xu,b.bs=jl,b.bt=Xt,b.bu=Ge,b.bv=cn,b.bw=function(i,t,n,a,u){return Xt(a,u,_n((i-t)/(n-t),0,1))},b.bx=Zt,b.by=function(){return new Float64Array(3)},b.bz=function(i,t,n,a){return i[0]=t[0]+n[0]*a,i[1]=t[1]+n[1]*a,i[2]=t[2]+n[2]*a,i},b.c=li,b.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},b.c0=Dr,b.c1=class extends Qr{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},b.c2=class extends Qr{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},b.c3=Lt,b.c4=function(i,t){var n=Math.sin(t),a=Math.cos(t);return i[0]=a,i[1]=n,i[2]=0,i[3]=-n,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},b.c5=function(i,t,n){var a=t[0],u=t[1],h=t[2];return i[0]=a*n[0]+u*n[3]+h*n[6],i[1]=a*n[1]+u*n[4]+h*n[7],i[2]=a*n[2]+u*n[5]+h*n[8],i},b.c6=function(i,t,n,a,u,h,f){var y=1/(t-n),x=1/(a-u),M=1/(h-f);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(t+n)*y,i[13]=(u+a)*x,i[14]=(f+h)*M,i[15]=1,i},b.c7=class extends Qr{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)t[4*n]=i[n].r,t[4*n+1]=i[n].g,t[4*n+2]=i[n].b,t[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,t)}}},b.c8=class extends Qr{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(i);this.gl.uniform1fv(this.location,t)}}},b.c9=class extends Dl{},b.cA=function(i){return Je[i]||kn[i]},b.cB=function(i,t,n){var a=t[0],u=t[1];return i[0]=n[0]*a+n[4]*u+n[12],i[1]=n[1]*a+n[5]*u+n[13],i},b.cC=function(i,t){const{x:n,y:a}=Qu.fromLngLat(t);return!(i<0||i>25||a<0||a>=1||n<0||n>=1)},b.cD=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},b.cE=class extends Zo{},b.cF=Vy,b.cH=function(i){return i.message===Oe},b.cI=yn,b.cJ=function(i,t){ln.REGISTERED_PROTOCOLS[i]=t},b.cK=function(i){delete ln.REGISTERED_PROTOCOLS[i]},b.cL=function(i,t){const n={};for(let u=0;u<i.length;u++){const h=t&&t[i[u].id]||Tc(i[u]);t&&(t[i[u].id]=h);let f=n[h];f||(f=n[h]=[]),f.push(i[u])}const a=[];for(const u in n)a.push(n[u]);return a},b.cM=Ue,b.cN=Ep,b.cO=Xp,b.cP=op,b.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=he/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],n=t.layout,a=t._unevaluatedLayout._values,u={layoutIconSize:a["icon-size"].possiblyEvaluate(new qn(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new qn(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new qn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:L}=i.bucket.textSizeData;u.compositeTextSizes=[a["text-size"].possiblyEvaluate(new qn(M),i.canonical),a["text-size"].possiblyEvaluate(new qn(L),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:L}=i.bucket.iconSizeData;u.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new qn(M),i.canonical),a["icon-size"].possiblyEvaluate(new qn(L),i.canonical)]}const h=n.get("text-line-height")*Bi,f=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const M of i.bucket.features){const L=n.get("text-font").evaluate(M,{},i.canonical).join(","),z=x.evaluate(M,{},i.canonical),F=u.layoutTextSize.evaluate(M,{},i.canonical),j=u.layoutIconSize.evaluate(M,{},i.canonical),U={horizontal:{},vertical:void 0},H=M.text;let rt,ct=[0,0];if(H){const _t=H.toString(),Bt=n.get("text-letter-spacing").evaluate(M,{},i.canonical)*Bi,Vt=Al(_t)?Bt:0,re=n.get("text-anchor").evaluate(M,{},i.canonical),xe=om(t,M,i.canonical);if(!xe){const Ae=n.get("text-radial-offset").evaluate(M,{},i.canonical);ct=Ae?am(re,[Ae*Bi,Vd]):n.get("text-offset").evaluate(M,{},i.canonical).map((Le=>Le*Bi))}let pe=f?"center":n.get("text-justify").evaluate(M,{},i.canonical);const Ie=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(M,{},i.canonical)*Bi:1/0,Fe=()=>{i.bucket.allowVerticalPlacement&&Fo(_t)&&(U.vertical=eh(H,i.glyphMap,i.glyphPositions,i.imagePositions,L,Ie,h,re,"left",Vt,ct,b.ay.vertical,!0,F,z))};if(!f&&xe){const Ae=new Set;if(pe==="auto")for(let me=0;me<xe.values.length;me+=2)Ae.add(jd(xe.values[me]));else Ae.add(pe);let Le=!1;for(const me of Ae)if(!U.horizontal[me])if(Le)U.horizontal[me]=U.horizontal[0];else{const He=eh(H,i.glyphMap,i.glyphPositions,i.imagePositions,L,Ie,h,"center",me,Vt,ct,b.ay.horizontal,!1,F,z);He&&(U.horizontal[me]=He,Le=He.positionedLines.length===1)}Fe()}else{pe==="auto"&&(pe=jd(re));const Ae=eh(H,i.glyphMap,i.glyphPositions,i.imagePositions,L,Ie,h,re,pe,Vt,ct,b.ay.horizontal,!1,F,z);Ae&&(U.horizontal[pe]=Ae),Fe(),Fo(_t)&&f&&y&&(U.vertical=eh(H,i.glyphMap,i.glyphPositions,i.imagePositions,L,Ie,h,re,pe,Vt,ct,b.ay.vertical,!1,F,z))}}let It=!1;if(M.icon&&M.icon.name){const _t=i.imageMap[M.icon.name];_t&&(rt=ny(i.imagePositions[M.icon.name],n.get("icon-offset").evaluate(M,{},i.canonical),n.get("icon-anchor").evaluate(M,{},i.canonical)),It=!!_t.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=It:i.bucket.sdfIcons!==It&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ft=um(U.horizontal)||U.vertical;i.bucket.iconsInText=!!ft&&ft.iconsInText,(ft||rt)&&Fy(i.bucket,M,U,rt,i.imageMap,u,F,j,ct,It,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},b.cR=dd,b.cS=pd,b.cT=md,b.cU=Gf,b.cV=_d,b.cW=Ul,b.cX=function(i,t,n,a,u,h){let f=Kp(i,t,n,u,0);return f=Kp(f,t,a,h,1),f},b.cY=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const t=this.map.get(i);return t!==void 0&&(this.map.delete(i),this.map.set(i,t)),t}set(i,t){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,t)}clear(){this.map.clear()}},b.cZ=Uf,b.c_=Wp,b.ca=R_,b.cb=class extends Rl{},b.cc=od,b.cd=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},b.ce=Mf,b.cf=function(i,t,n){var a=t[0],u=t[1],h=t[2],f=n[3]*a+n[7]*u+n[11]*h+n[15];return i[0]=(n[0]*a+n[4]*u+n[8]*h+n[12])/(f=f||1),i[1]=(n[1]*a+n[5]*u+n[9]*h+n[13])/f,i[2]=(n[2]*a+n[6]*u+n[10]*h+n[14])/f,i},b.cg=class extends zu{},b.ch=class extends c{},b.ci=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},b.cj=function(i,t){var n=i[0],a=i[1],u=i[2],h=i[3],f=i[4],y=i[5],x=i[6],M=i[7],L=i[8],z=i[9],F=i[10],j=i[11],U=i[12],H=i[13],rt=i[14],ct=i[15],It=t[0],ft=t[1],_t=t[2],Bt=t[3],Vt=t[4],re=t[5],xe=t[6],pe=t[7],Ie=t[8],Fe=t[9],Ae=t[10],Le=t[11],me=t[12],He=t[13],Ke=t[14],nn=t[15];return Math.abs(n-It)<=ut*Math.max(1,Math.abs(n),Math.abs(It))&&Math.abs(a-ft)<=ut*Math.max(1,Math.abs(a),Math.abs(ft))&&Math.abs(u-_t)<=ut*Math.max(1,Math.abs(u),Math.abs(_t))&&Math.abs(h-Bt)<=ut*Math.max(1,Math.abs(h),Math.abs(Bt))&&Math.abs(f-Vt)<=ut*Math.max(1,Math.abs(f),Math.abs(Vt))&&Math.abs(y-re)<=ut*Math.max(1,Math.abs(y),Math.abs(re))&&Math.abs(x-xe)<=ut*Math.max(1,Math.abs(x),Math.abs(xe))&&Math.abs(M-pe)<=ut*Math.max(1,Math.abs(M),Math.abs(pe))&&Math.abs(L-Ie)<=ut*Math.max(1,Math.abs(L),Math.abs(Ie))&&Math.abs(z-Fe)<=ut*Math.max(1,Math.abs(z),Math.abs(Fe))&&Math.abs(F-Ae)<=ut*Math.max(1,Math.abs(F),Math.abs(Ae))&&Math.abs(j-Le)<=ut*Math.max(1,Math.abs(j),Math.abs(Le))&&Math.abs(U-me)<=ut*Math.max(1,Math.abs(U),Math.abs(me))&&Math.abs(H-He)<=ut*Math.max(1,Math.abs(H),Math.abs(He))&&Math.abs(rt-Ke)<=ut*Math.max(1,Math.abs(rt),Math.abs(Ke))&&Math.abs(ct-nn)<=ut*Math.max(1,Math.abs(ct),Math.abs(nn))},b.ck=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},b.cl=i=>i.type==="symbol",b.cm=i=>i.type==="circle",b.cn=i=>i.type==="heatmap",b.co=i=>i.type==="line",b.cp=i=>i.type==="fill",b.cq=i=>i.type==="fill-extrusion",b.cr=i=>i.type==="hillshade",b.cs=i=>i.type==="color-relief",b.ct=i=>i.type==="background",b.cu=i=>i.type==="custom",b.cv=ye,b.cw=function(i,t,n){const a=Ne(t.x-n.x,t.y-n.y),u=Ne(i.x-n.x,i.y-n.y);var h,f;return Ce(Math.atan2(a[0]*u[1]-a[1]*u[0],(h=a)[0]*(f=u)[0]+h[1]*f[1]))},b.cx=Pe,b.cy=function(i,t){return kn[t]&&(i instanceof MouseEvent||i instanceof WheelEvent)},b.cz=function(i,t){return Je[t]&&"touches"in i},b.d=nt,b.d0=function(i,t,n,a,u){return o(this,void 0,void 0,(function*(){if(at())try{return yield Te(i,t,n,a,u)}catch{}return(function(h,f,y,x,M){const L=h.width,z=h.height;Ee&&Qt||(Ee=new OffscreenCanvas(L,z),Qt=Ee.getContext("2d",{willReadFrequently:!0})),Ee.width=L,Ee.height=z,Qt.drawImage(h,0,0,L,z);const F=Qt.getImageData(f,y,x,M);return Qt.clearRect(0,0,L,z),F.data})(i,t,n,a,u)}))},b.d1=Af,b.d2=$,b.d3=bl,b.d4=Qs,b.e=Gt,b.f=i=>o(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),b.g=Ye,b.h=i=>new Promise(((t,n)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame((()=>{a.src=Tt}))},a.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(u):Tt})),b.i=de,b.j=(i,t)=>wt(Gt(i,{type:"json"}),t),b.k=Rt,b.l=xt,b.m=wt,b.n=(i,t)=>wt(Gt(i,{type:"arrayBuffer"}),t),b.o=function(i){return new _d(i).readFields(X_,[])},b.p=ap,b.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},b.r=Uu,b.s=Re,b.t=Qi,b.u=pt,b.v=Ro,b.w=et,b.x=Bc,b.y=$h,b.z=Bo})),S("worker",["./shared"],(function(b){class o{constructor(nt,st){this.keyCache={},nt&&this.replace(nt,st)}replace(nt,st){this._layerConfigs={},this._layers={},this.update(nt,[],st)}update(nt,st,lt){for(const Rt of nt){this._layerConfigs[Rt.id]=Rt;const $t=this._layers[Rt.id]=b.bS(Rt,lt);$t._featureFilter=b.aj($t.filter,lt),this.keyCache[Rt.id]&&delete this.keyCache[Rt.id]}for(const Rt of st)delete this.keyCache[Rt],delete this._layerConfigs[Rt],delete this._layers[Rt];this.familiesBySource={};const xt=b.cL(Object.values(this._layerConfigs),this.keyCache);for(const Rt of xt){const $t=Rt.map((se=>this._layers[se.id])),pt=$t[0];if(pt.visibility==="none")continue;const Ut=pt.source||"";let le=this.familiesBySource[Ut];le||(le=this.familiesBySource[Ut]={});const ue=pt.sourceLayer||b.a9;let ce=le[ue];ce||(ce=le[ue]=[]),ce.push($t)}}}class N{constructor(nt){const st={},lt=[];for(const pt in nt){const Ut=nt[pt],le=st[pt]={};for(const ue in Ut){const ce=Ut[+ue];if(!ce||ce.bitmap.width===0||ce.bitmap.height===0)continue;const se={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};lt.push(se),le[ue]={rect:se,metrics:ce.metrics}}}const{w:xt,h:Rt}=b.p(lt),$t=new b.r({width:xt||1,height:Rt||1});for(const pt in nt){const Ut=nt[pt];for(const le in Ut){const ue=Ut[+le];if(!ue||ue.bitmap.width===0||ue.bitmap.height===0)continue;const ce=st[pt][le].rect;b.r.copy(ue.bitmap,$t,{x:0,y:0},{x:ce.x+1,y:ce.y+1},ue.bitmap)}}this.image=$t,this.positions=st}}b.cM("GlyphAtlas",N);class ${constructor(nt){this.tileID=new b.a1(nt.tileID.overscaledZ,nt.tileID.wrap,nt.tileID.canonical.z,nt.tileID.canonical.x,nt.tileID.canonical.y),this.uid=nt.uid,this.zoom=nt.zoom,this.pixelRatio=nt.pixelRatio,this.tileSize=nt.tileSize,this.source=nt.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=nt.showCollisionBoxes,this.collectResourceTiming=!!nt.collectResourceTiming,this.returnDependencies=!!nt.returnDependencies,this.promoteId=nt.promoteId,this.inFlightDependencies=[]}parse(nt,st,lt,xt,Rt){return b._(this,void 0,void 0,(function*(){this.status="parsing",this.data=nt,this.collisionBoxArray=new b.ah;const $t=new b.cN(Object.keys(nt.layers).sort()),pt=new b.cO(this.tileID,this.promoteId);pt.bucketLayerIDs=[];const Ut={},le={featureIndex:pt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:lt,subdivisionGranularity:Rt},ue=st.familiesBySource[this.source];for(const je in ue){const Qe=nt.layers[je];if(!Qe)continue;Qe.version===1&&b.w(`Vector tile source "${this.source}" layer "${je}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pi=$t.encode(je),or=[];for(let Kn=0;Kn<Qe.length;Kn++){const rn=Qe.feature(Kn),mr=pt.getId(rn,je);or.push({feature:rn,id:mr,index:Kn,sourceLayerIndex:Pi})}for(const Kn of ue[je]){const rn=Kn[0];rn.source!==this.source&&b.w(`layer.source = ${rn.source} does not equal this.source = ${this.source}`),rn.isHidden(this.zoom,!0)||(G(Kn,this.zoom,lt),(Ut[rn.id]=rn.createBucket({index:pt.bucketLayerIDs.length,layers:Kn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pi,sourceID:this.source})).populate(or,le,this.tileID.canonical),pt.bucketLayerIDs.push(Kn.map((mr=>mr.id))))}}const ce=b.bX(le.glyphDependencies,(je=>Object.keys(je).map(Number)));this.inFlightDependencies.forEach((je=>je?.abort())),this.inFlightDependencies=[];let se=Promise.resolve({});if(Object.keys(ce).length){const je=new AbortController;this.inFlightDependencies.push(je),se=xt.sendAsync({type:"GG",data:{stacks:ce,source:this.source,tileID:this.tileID,type:"glyphs"}},je)}const Xe=Object.keys(le.iconDependencies);let an=Promise.resolve({});if(Xe.length){const je=new AbortController;this.inFlightDependencies.push(je),an=xt.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},je)}const jn=Object.keys(le.patternDependencies);let vn=Promise.resolve({});if(jn.length){const je=new AbortController;this.inFlightDependencies.push(je),vn=xt.sendAsync({type:"GI",data:{icons:jn,source:this.source,tileID:this.tileID,type:"patterns"}},je)}const En=le.dashDependencies;let zn=Promise.resolve({});if(Object.keys(En).length){const je=new AbortController;this.inFlightDependencies.push(je),zn=xt.sendAsync({type:"GDA",data:{dashes:En}},je)}const[we,Gn,An,di]=yield Promise.all([se,an,vn,zn]),Nn=new N(we),ke=new b.cP(Gn,An);for(const je in Ut){const Qe=Ut[je];Qe instanceof b.ai?(G(Qe.layers,this.zoom,lt),b.cQ({bucket:Qe,glyphMap:we,glyphPositions:Nn.positions,imageMap:Gn,imagePositions:ke.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:le.subdivisionGranularity})):Qe.hasDependencies&&(Qe instanceof b.cR||Qe instanceof b.cS||Qe instanceof b.cT)&&(G(Qe.layers,this.zoom,lt),Qe.addFeatures(le,this.tileID.canonical,ke.patternPositions,di))}return this.status="done",{buckets:Object.values(Ut).filter((je=>!je.isEmpty())),featureIndex:pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nn.image,imageAtlas:ke,dashPositions:di,glyphMap:this.returnDependencies?we:null,iconMap:this.returnDependencies?Gn:null,glyphPositions:this.returnDependencies?Nn.positions:null}}))}}function G(wt,nt,st){const lt=new b.H(nt);for(const xt of wt)xt.recalculate(lt,st)}class V extends b.cW{constructor(nt,st){super(new b.cV,0,st,[],[]),this.feature=nt,this.type=nt.type,this.properties=nt.tags?nt.tags:{},"id"in nt&&(typeof nt.id=="string"?this.id=parseInt(nt.id,10):typeof nt.id!="number"||isNaN(nt.id)||(this.id=nt.id))}loadGeometry(){const nt=[],st=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const lt of st){const xt=[];for(const Rt of lt)xt.push(new b.P(Rt[0],Rt[1]));nt.push(xt)}return nt}}class K extends b.cU{constructor(nt,st){super(new b.cV),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=st?st.version:1,this.extent=st?st.extent:4096,this.length=nt.length,this.features=nt}feature(nt){return new V(this.features[nt],this.extent)}}function q(wt,nt){nt.writeVarintField(15,wt.version||1),nt.writeStringField(1,wt.name||""),nt.writeVarintField(5,wt.extent||4096);const st={keys:[],values:[],keycache:{},valuecache:{}};for(let Rt=0;Rt<wt.length;Rt++)st.feature=wt.feature(Rt),nt.writeMessage(2,Y,st);const lt=st.keys;for(const Rt of lt)nt.writeStringField(3,Rt);const xt=st.values;for(const Rt of xt)nt.writeMessage(4,dt,Rt)}function Y(wt,nt){if(!wt.feature)return;const st=wt.feature;st.id!==void 0&&nt.writeVarintField(1,st.id),nt.writeMessage(2,J,wt),nt.writeVarintField(3,st.type),nt.writeMessage(4,ut,st)}function J(wt,nt){for(const st in wt.feature?.properties){let lt=wt.feature.properties[st],xt=wt.keycache[st];if(lt===null)continue;xt===void 0&&(wt.keys.push(st),xt=wt.keys.length-1,wt.keycache[st]=xt),nt.writeVarint(xt),typeof lt!="string"&&typeof lt!="boolean"&&typeof lt!="number"&&(lt=JSON.stringify(lt));const Rt=typeof lt+":"+lt;let $t=wt.valuecache[Rt];$t===void 0&&(wt.values.push(lt),$t=wt.values.length-1,wt.valuecache[Rt]=$t),nt.writeVarint($t)}}function W(wt,nt){return(nt<<3)+(7&wt)}function at(wt){return wt<<1^wt>>31}function ut(wt,nt){const st=wt.loadGeometry(),lt=wt.type;let xt=0,Rt=0;for(const $t of st){let pt=1;lt===1&&(pt=$t.length),nt.writeVarint(W(1,pt));const Ut=lt===3?$t.length-1:$t.length;for(let le=0;le<Ut;le++){le===1&&lt!==1&&nt.writeVarint(W(2,Ut-1));const ue=$t[le].x-xt,ce=$t[le].y-Rt;nt.writeVarint(at(ue)),nt.writeVarint(at(ce)),xt+=ue,Rt+=ce}wt.type===3&&nt.writeVarint(W(7,1))}}function dt(wt,nt){const st=typeof wt;st==="string"?nt.writeStringField(1,wt):st==="boolean"?nt.writeBooleanField(7,wt):st==="number"&&(wt%1!=0?nt.writeDoubleField(3,wt):wt<0?nt.writeSVarintField(6,wt):nt.writeVarintField(5,wt))}class Lt extends b.cW{constructor(nt,st,lt,xt,Rt){super(new b.cV,0,Rt,[],[]),this.type=nt,this.properties=lt||{},this.extent=Rt,this.pointsArray=st,this.id=xt}loadGeometry(){return this.pointsArray.map((nt=>nt.map((st=>new b.P(st.x,st.y)))))}}class kt extends b.cU{constructor(nt,st,lt){super(new b.cV),this.version=2,this._myFeatures=nt,this.name=st,this.length=nt.length,this.extent=lt}feature(nt){return this._myFeatures[nt]}}class jt{constructor(){this.layers={}}addLayer(nt){this.layers[nt.name]=nt}}function Mt(wt){let nt=(function(st){const lt=new b.cV;return(function(xt,Rt){for(const $t in xt.layers)Rt.writeMessage(3,q,xt.layers[$t])})(st,lt),lt.finish()})(wt);return nt.byteOffset===0&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),{vectorTile:wt,rawData:nt.buffer}}function Wt(wt,nt,st){const{extent:lt}=wt,xt=Math.pow(2,st.z-nt.z),Rt=(st.x-nt.x*xt)*lt,$t=(st.y-nt.y*xt)*lt,pt=[];for(let Ut=0;Ut<wt.length;Ut++){const le=wt.feature(Ut);let ue=le.loadGeometry();for(const se of ue)for(const Xe of se)Xe.x=Xe.x*xt-Rt,Xe.y=Xe.y*xt-$t;const ce=128;ue=b.cX(ue,le.type,-ce,-ce,lt+ce,lt+ce),ue.length!==0&&pt.push(new Lt(le.type,ue,le.properties,le.id,lt))}return new kt(pt,wt.name,lt)}class Ot{constructor(nt,st,lt){this.actor=nt,this.layerIndex=st,this.availableImages=lt,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new b.cY(1e3)}loadVectorTile(nt,st){return b._(this,void 0,void 0,(function*(){const lt=yield b.n(nt.request,st);try{return{vectorTile:nt.encoding!=="mlt"?new b.cZ(new b.cV(lt.data)):new b.c_(lt.data),rawData:lt.data,cacheControl:lt.cacheControl,expires:lt.expires}}catch(xt){const Rt=new Uint8Array(lt.data);let $t=`Unable to parse the tile at ${nt.request.url}, `;throw $t+=Rt[0]===31&&Rt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xt.message}`,new Error($t)}}))}loadTile(nt){return b._(this,void 0,void 0,(function*(){const{uid:st,overzoomParameters:lt}=nt;lt&&(nt.request=lt.overzoomRequest);const xt=!!(nt&&nt.request&&nt.request.collectResourceTiming)&&new b.c$(nt.request),Rt=new $(nt);this.loading[st]=Rt;const $t=new AbortController;Rt.abort=$t;try{const pt=yield this.loadVectorTile(nt,$t);if(delete this.loading[st],!pt)return null;if(lt){const se=this._getOverzoomTile(nt,pt.vectorTile);pt.rawData=se.rawData,pt.vectorTile=se.vectorTile}const Ut=pt.rawData,le={};pt.expires&&(le.expires=pt.expires),pt.cacheControl&&(le.cacheControl=pt.cacheControl);const ue={};if(xt){const se=xt.finish();se&&(ue.resourceTiming=JSON.parse(JSON.stringify(se)))}Rt.vectorTile=pt.vectorTile;const ce=Rt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,nt.subdivisionGranularity);this.loaded[st]=Rt,this.fetching[st]={rawTileData:Ut,cacheControl:le,resourceTiming:ue};try{const se=yield ce;return b.e({rawTileData:Ut.slice(0),encoding:nt.encoding},se,le,ue)}finally{delete this.fetching[st]}}catch(pt){throw delete this.loading[st],Rt.status="done",this.loaded[st]=Rt,pt}}))}_getOverzoomTile(nt,st){const{tileID:lt,source:xt,overzoomParameters:Rt}=nt,{maxZoomTileID:$t}=Rt,pt=`${$t.key}_${lt.key}`,Ut=this.overzoomedTileResultCache.get(pt);if(Ut)return Ut;const le=new jt,ue=this.layerIndex.familiesBySource[xt];for(const se in ue){const Xe=st.layers[se];if(!Xe)continue;const an=Wt(Xe,$t,lt.canonical);an.length>0&&le.addLayer(an)}const ce=Mt(le);return this.overzoomedTileResultCache.set(pt,ce),ce}reloadTile(nt){return b._(this,void 0,void 0,(function*(){const st=nt.uid;if(!this.loaded||!this.loaded[st])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const lt=this.loaded[st];if(lt.showCollisionBoxes=nt.showCollisionBoxes,lt.status==="parsing"){const xt=yield lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,nt.subdivisionGranularity);let Rt;if(this.fetching[st]){const{rawTileData:$t,cacheControl:pt,resourceTiming:Ut}=this.fetching[st];delete this.fetching[st],Rt=b.e({rawTileData:$t.slice(0),encoding:nt.encoding},xt,pt,Ut)}else Rt=xt;return Rt}if(lt.status==="done"&&lt.vectorTile)return lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,nt.subdivisionGranularity)}))}abortTile(nt){return b._(this,void 0,void 0,(function*(){const st=this.loading,lt=nt.uid;st&&st[lt]&&st[lt].abort&&(st[lt].abort.abort(),delete st[lt])}))}removeTile(nt){return b._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[nt.uid]&&delete this.loaded[nt.uid]}))}}class Kt{constructor(){this.loaded={}}loadTile(nt){return b._(this,void 0,void 0,(function*(){const{uid:st,encoding:lt,rawImageData:xt,redFactor:Rt,greenFactor:$t,blueFactor:pt,baseShift:Ut}=nt,le=xt.width+2,ue=xt.height+2,ce=b.b(xt)?new b.R({width:le,height:ue},yield b.d0(xt,-1,-1,le,ue)):xt,se=new b.d1(st,ce,lt,Rt,$t,pt,Ut);return this.loaded=this.loaded||{},this.loaded[st]=se,se}))}removeTile(nt){const st=this.loaded,lt=nt.uid;st&&st[lt]&&delete st[lt]}}var ge,Et,Ht=(function(){if(Et)return ge;function wt(st,lt){if(st.length!==0){nt(st[0],lt);for(var xt=1;xt<st.length;xt++)nt(st[xt],!lt)}}function nt(st,lt){for(var xt=0,Rt=0,$t=0,pt=st.length,Ut=pt-1;$t<pt;Ut=$t++){var le=(st[$t][0]-st[Ut][0])*(st[Ut][1]+st[$t][1]),ue=xt+le;Rt+=Math.abs(xt)>=Math.abs(le)?xt-ue+le:le-ue+xt,xt=ue}xt+Rt>=0!=!!lt&&st.reverse()}return Et=1,ge=function st(lt,xt){var Rt,$t=lt&&lt.type;if($t==="FeatureCollection")for(Rt=0;Rt<lt.features.length;Rt++)st(lt.features[Rt],xt);else if($t==="GeometryCollection")for(Rt=0;Rt<lt.geometries.length;Rt++)st(lt.geometries[Rt],xt);else if($t==="Feature")st(lt.geometry,xt);else if($t==="Polygon")wt(lt.coordinates,xt);else if($t==="MultiPolygon")for(Rt=0;Rt<lt.coordinates.length;Rt++)wt(lt.coordinates[Rt],xt);return lt}})(),tt=b.d2(Ht);const Jt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:wt=>wt},ze=Math.fround||(te=new Float32Array(1),wt=>(te[0]=+wt,te[0]));var te;class Ne{constructor(nt){this.options=Object.assign(Object.create(Jt),nt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(nt){const{log:st,minZoom:lt,maxZoom:xt}=this.options;st&&console.time("total time");const Rt=`prepare ${nt.length} points`;st&&console.time(Rt),this.points=nt;const $t=[];for(let Ut=0;Ut<nt.length;Ut++){const le=nt[Ut];if(!le.geometry)continue;const[ue,ce]=le.geometry.coordinates,se=ze(Zt(ue)),Xe=ze(Xt(ce));$t.push(se,Xe,1/0,Ut,-1,1),this.options.reduce&&$t.push(0)}let pt=this.trees[xt+1]=this._createTree($t);st&&console.timeEnd(Rt);for(let Ut=xt;Ut>=lt;Ut--){const le=+Date.now();pt=this.trees[Ut]=this._createTree(this._cluster(pt,Ut)),st&&console.log("z%d: %d clusters in %dms",Ut,pt.numItems,+Date.now()-le)}return st&&console.timeEnd("total time"),this}getClusters(nt,st){let lt=((nt[0]+180)%360+360)%360-180;const xt=Math.max(-90,Math.min(90,nt[1]));let Rt=nt[2]===180?180:((nt[2]+180)%360+360)%360-180;const $t=Math.max(-90,Math.min(90,nt[3]));if(nt[2]-nt[0]>=360)lt=-180,Rt=180;else if(lt>Rt){const ce=this.getClusters([lt,xt,180,$t],st),se=this.getClusters([-180,xt,Rt,$t],st);return ce.concat(se)}const pt=this.trees[this._limitZoom(st)],Ut=pt.range(Zt(lt),Xt($t),Zt(Rt),Xt(xt)),le=pt.data,ue=[];for(const ce of Ut){const se=this.stride*ce;ue.push(le[se+5]>1?he(le,se,this.clusterProps):this.points[le[se+3]])}return ue}getChildren(nt){const st=this._getOriginId(nt),lt=this._getOriginZoom(nt),xt="No cluster with the specified id.",Rt=this.trees[lt];if(!Rt)throw new Error(xt);const $t=Rt.data;if(st*this.stride>=$t.length)throw new Error(xt);const pt=this.options.radius/(this.options.extent*Math.pow(2,lt-1)),Ut=Rt.within($t[st*this.stride],$t[st*this.stride+1],pt),le=[];for(const ue of Ut){const ce=ue*this.stride;$t[ce+4]===nt&&le.push($t[ce+5]>1?he($t,ce,this.clusterProps):this.points[$t[ce+3]])}if(le.length===0)throw new Error(xt);return le}getLeaves(nt,st,lt){const xt=[];return this._appendLeaves(xt,nt,st=st||10,lt=lt||0,0),xt}getTile(nt,st,lt){const xt=this.trees[this._limitZoom(nt)],Rt=Math.pow(2,nt),{extent:$t,radius:pt}=this.options,Ut=pt/$t,le=(lt-Ut)/Rt,ue=(lt+1+Ut)/Rt,ce={features:[]};return this._addTileFeatures(xt.range((st-Ut)/Rt,le,(st+1+Ut)/Rt,ue),xt.data,st,lt,Rt,ce),st===0&&this._addTileFeatures(xt.range(1-Ut/Rt,le,1,ue),xt.data,Rt,lt,Rt,ce),st===Rt-1&&this._addTileFeatures(xt.range(0,le,Ut/Rt,ue),xt.data,-1,lt,Rt,ce),ce.features.length?ce:null}getClusterExpansionZoom(nt){let st=this._getOriginZoom(nt)-1;for(;st<=this.options.maxZoom;){const lt=this.getChildren(nt);if(st++,lt.length!==1)break;nt=lt[0].properties.cluster_id}return st}_appendLeaves(nt,st,lt,xt,Rt){const $t=this.getChildren(st);for(const pt of $t){const Ut=pt.properties;if(Ut&&Ut.cluster?Rt+Ut.point_count<=xt?Rt+=Ut.point_count:Rt=this._appendLeaves(nt,Ut.cluster_id,lt,xt,Rt):Rt<xt?Rt++:nt.push(pt),nt.length===lt)break}return Rt}_createTree(nt){const st=new b.aS(nt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let lt=0;lt<nt.length;lt+=this.stride)st.add(nt[lt],nt[lt+1]);return st.finish(),st.data=nt,st}_addTileFeatures(nt,st,lt,xt,Rt,$t){for(const pt of nt){const Ut=pt*this.stride,le=st[Ut+5]>1;let ue,ce,se;if(le)ue=_e(st,Ut,this.clusterProps),ce=st[Ut],se=st[Ut+1];else{const jn=this.points[st[Ut+3]];ue=jn.properties;const[vn,En]=jn.geometry.coordinates;ce=Zt(vn),se=Xt(En)}const Xe={type:1,geometry:[[Math.round(this.options.extent*(ce*Rt-lt)),Math.round(this.options.extent*(se*Rt-xt))]],tags:ue};let an;an=le||this.options.generateId?st[Ut+3]:this.points[st[Ut+3]].id,an!==void 0&&(Xe.id=an),$t.features.push(Xe)}}_limitZoom(nt){return Math.max(this.options.minZoom,Math.min(Math.floor(+nt),this.options.maxZoom+1))}_cluster(nt,st){const{radius:lt,extent:xt,reduce:Rt,minPoints:$t}=this.options,pt=lt/(xt*Math.pow(2,st)),Ut=nt.data,le=[],ue=this.stride;for(let ce=0;ce<Ut.length;ce+=ue){if(Ut[ce+2]<=st)continue;Ut[ce+2]=st;const se=Ut[ce],Xe=Ut[ce+1],an=nt.within(Ut[ce],Ut[ce+1],pt),jn=Ut[ce+5];let vn=jn;for(const En of an){const zn=En*ue;Ut[zn+2]>st&&(vn+=Ut[zn+5])}if(vn>jn&&vn>=$t){let En,zn=se*jn,we=Xe*jn,Gn=-1;const An=(ce/ue<<5)+(st+1)+this.points.length;for(const di of an){const Nn=di*ue;if(Ut[Nn+2]<=st)continue;Ut[Nn+2]=st;const ke=Ut[Nn+5];zn+=Ut[Nn]*ke,we+=Ut[Nn+1]*ke,Ut[Nn+4]=An,Rt&&(En||(En=this._map(Ut,ce,!0),Gn=this.clusterProps.length,this.clusterProps.push(En)),Rt(En,this._map(Ut,Nn)))}Ut[ce+4]=An,le.push(zn/vn,we/vn,1/0,An,-1,vn),Rt&&le.push(Gn)}else{for(let En=0;En<ue;En++)le.push(Ut[ce+En]);if(vn>1)for(const En of an){const zn=En*ue;if(!(Ut[zn+2]<=st)){Ut[zn+2]=st;for(let we=0;we<ue;we++)le.push(Ut[zn+we])}}}}return le}_getOriginId(nt){return nt-this.points.length>>5}_getOriginZoom(nt){return(nt-this.points.length)%32}_map(nt,st,lt){if(nt[st+5]>1){const $t=this.clusterProps[nt[st+6]];return lt?Object.assign({},$t):$t}const xt=this.points[nt[st+3]].properties,Rt=this.options.map(xt);return lt&&Rt===xt?Object.assign({},Rt):Rt}}function he(wt,nt,st){return{type:"Feature",id:wt[nt+3],properties:_e(wt,nt,st),geometry:{type:"Point",coordinates:[(lt=wt[nt],360*(lt-.5)),Ge(wt[nt+1])]}};var lt}function _e(wt,nt,st){const lt=wt[nt+5],xt=lt>=1e4?`${Math.round(lt/1e3)}k`:lt>=1e3?Math.round(lt/100)/10+"k":lt,Rt=wt[nt+6],$t=Rt===-1?{}:Object.assign({},st[Rt]);return Object.assign($t,{cluster:!0,cluster_id:wt[nt+3],point_count:lt,point_count_abbreviated:xt})}function Zt(wt){return wt/360+.5}function Xt(wt){const nt=Math.sin(wt*Math.PI/180),st=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return st<0?0:st>1?1:st}function Ge(wt){const nt=(180-360*wt)*Math.PI/180;return 360*Math.atan(Math.exp(nt))/Math.PI-90}function ye(wt,nt,st,lt){let xt=lt;const Rt=nt+(st-nt>>1);let $t,pt=st-nt;const Ut=wt[nt],le=wt[nt+1],ue=wt[st],ce=wt[st+1];for(let se=nt+3;se<st;se+=3){const Xe=Pe(wt[se],wt[se+1],Ut,le,ue,ce);if(Xe>xt)$t=se,xt=Xe;else if(Xe===xt){const an=Math.abs(se-Rt);an<pt&&($t=se,pt=an)}}xt>lt&&($t-nt>3&&ye(wt,nt,$t,lt),wt[$t+2]=xt,st-$t>3&&ye(wt,$t,st,lt))}function Pe(wt,nt,st,lt,xt,Rt){let $t=xt-st,pt=Rt-lt;if($t!==0||pt!==0){const Ut=((wt-st)*$t+(nt-lt)*pt)/($t*$t+pt*pt);Ut>1?(st=xt,lt=Rt):Ut>0&&(st+=$t*Ut,lt+=pt*Ut)}return $t=wt-st,pt=nt-lt,$t*$t+pt*pt}function _n(wt,nt,st,lt){const xt={id:wt??null,type:nt,geometry:st,tags:lt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Pn(xt,st);else if(nt==="Polygon")Pn(xt,st[0]);else if(nt==="MultiLineString")for(const Rt of st)Pn(xt,Rt);else if(nt==="MultiPolygon")for(const Rt of st)Pn(xt,Rt[0]);return xt}function Pn(wt,nt){for(let st=0;st<nt.length;st+=3)wt.minX=Math.min(wt.minX,nt[st]),wt.minY=Math.min(wt.minY,nt[st+1]),wt.maxX=Math.max(wt.maxX,nt[st]),wt.maxY=Math.max(wt.maxY,nt[st+1])}function Gt(wt,nt,st,lt){if(!nt.geometry)return;const xt=nt.geometry.coordinates;if(xt&&xt.length===0)return;const Rt=nt.geometry.type,$t=Math.pow(st.tolerance/((1<<st.maxZoom)*st.extent),2);let pt=[],Ut=nt.id;if(st.promoteId?Ut=nt.properties[st.promoteId]:st.generateId&&(Ut=lt||0),Rt==="Point")bn(xt,pt);else if(Rt==="MultiPoint")for(const le of xt)bn(le,pt);else if(Rt==="LineString")sn(xt,pt,$t,!1);else if(Rt==="MultiLineString"){if(st.lineMetrics){for(const le of xt)pt=[],sn(le,pt,$t,!1),wt.push(_n(Ut,"LineString",pt,nt.properties));return}Be(xt,pt,$t,!1)}else if(Rt==="Polygon")Be(xt,pt,$t,!0);else{if(Rt!=="MultiPolygon"){if(Rt==="GeometryCollection"){for(const le of nt.geometry.geometries)Gt(wt,{id:Ut,geometry:le,properties:nt.properties},st,lt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const le of xt){const ue=[];Be(le,ue,$t,!0),pt.push(ue)}}wt.push(_n(Ut,Rt,pt,nt.properties))}function bn(wt,nt){nt.push(Dt(wt[0]),$n(wt[1]),0)}function sn(wt,nt,st,lt){let xt,Rt,$t=0;for(let Ut=0;Ut<wt.length;Ut++){const le=Dt(wt[Ut][0]),ue=$n(wt[Ut][1]);nt.push(le,ue,0),Ut>0&&($t+=lt?(xt*ue-le*Rt)/2:Math.sqrt(Math.pow(le-xt,2)+Math.pow(ue-Rt,2))),xt=le,Rt=ue}const pt=nt.length-3;nt[2]=1,ye(nt,0,pt,st),nt[pt+2]=1,nt.size=Math.abs($t),nt.start=0,nt.end=nt.size}function Be(wt,nt,st,lt){for(let xt=0;xt<wt.length;xt++){const Rt=[];sn(wt[xt],Rt,st,lt),nt.push(Rt)}}function Dt(wt){return wt/360+.5}function $n(wt){const nt=Math.sin(wt*Math.PI/180),st=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return st<0?0:st>1?1:st}function et(wt,nt,st,lt,xt,Rt,$t,pt){if(lt/=nt,Rt>=(st/=nt)&&$t<lt)return wt;if($t<st||Rt>=lt)return null;const Ut=[];for(const le of wt){const ue=le.geometry;let ce=le.type;const se=xt===0?le.minX:le.minY,Xe=xt===0?le.maxX:le.maxY;if(se>=st&&Xe<lt){Ut.push(le);continue}if(Xe<st||se>=lt)continue;let an=[];if(ce==="Point"||ce==="MultiPoint")fe(ue,an,st,lt,xt);else if(ce==="LineString")de(ue,an,st,lt,xt,!1,pt.lineMetrics);else if(ce==="MultiLineString")bt(ue,an,st,lt,xt,!1);else if(ce==="Polygon")bt(ue,an,st,lt,xt,!0);else if(ce==="MultiPolygon")for(const jn of ue){const vn=[];bt(jn,vn,st,lt,xt,!0),vn.length&&an.push(vn)}if(an.length){if(pt.lineMetrics&&ce==="LineString"){for(const jn of an)Ut.push(_n(le.id,ce,jn,le.tags));continue}ce!=="LineString"&&ce!=="MultiLineString"||(an.length===1?(ce="LineString",an=an[0]):ce="MultiLineString"),ce!=="Point"&&ce!=="MultiPoint"||(ce=an.length===3?"Point":"MultiPoint"),Ut.push(_n(le.id,ce,an,le.tags))}}return Ut.length?Ut:null}function fe(wt,nt,st,lt,xt){for(let Rt=0;Rt<wt.length;Rt+=3){const $t=wt[Rt+xt];$t>=st&&$t<=lt&&Tt(nt,wt[Rt],wt[Rt+1],wt[Rt+2])}}function de(wt,nt,st,lt,xt,Rt,$t){let pt=Pt(wt);const Ut=xt===0?Te:Ee;let le,ue,ce=wt.start;for(let vn=0;vn<wt.length-3;vn+=3){const En=wt[vn],zn=wt[vn+1],we=wt[vn+2],Gn=wt[vn+3],An=wt[vn+4],di=xt===0?En:zn,Nn=xt===0?Gn:An;let ke=!1;$t&&(le=Math.sqrt(Math.pow(En-Gn,2)+Math.pow(zn-An,2))),di<st?Nn>st&&(ue=Ut(pt,En,zn,Gn,An,st),$t&&(pt.start=ce+le*ue)):di>lt?Nn<lt&&(ue=Ut(pt,En,zn,Gn,An,lt),$t&&(pt.start=ce+le*ue)):Tt(pt,En,zn,we),Nn<st&&di>=st&&(ue=Ut(pt,En,zn,Gn,An,st),ke=!0),Nn>lt&&di<=lt&&(ue=Ut(pt,En,zn,Gn,An,lt),ke=!0),!Rt&&ke&&($t&&(pt.end=ce+le*ue),nt.push(pt),pt=Pt(wt)),$t&&(ce+=le)}let se=wt.length-3;const Xe=wt[se],an=wt[se+1],jn=xt===0?Xe:an;jn>=st&&jn<=lt&&Tt(pt,Xe,an,wt[se+2]),se=pt.length-3,Rt&&se>=3&&(pt[se]!==pt[0]||pt[se+1]!==pt[1])&&Tt(pt,pt[0],pt[1],pt[2]),pt.length&&nt.push(pt)}function Pt(wt){const nt=[];return nt.size=wt.size,nt.start=wt.start,nt.end=wt.end,nt}function bt(wt,nt,st,lt,xt,Rt){for(const $t of wt)de($t,nt,st,lt,xt,Rt,!1)}function Tt(wt,nt,st,lt){wt.push(nt,st,lt)}function Te(wt,nt,st,lt,xt,Rt){const $t=(Rt-nt)/(lt-nt);return Tt(wt,Rt,st+(xt-st)*$t,1),$t}function Ee(wt,nt,st,lt,xt,Rt){const $t=(Rt-st)/(xt-st);return Tt(wt,nt+(lt-nt)*$t,Rt,1),$t}function Qt(wt,nt){const st=[];for(let lt=0;lt<wt.length;lt++){const xt=wt[lt],Rt=xt.type;let $t;if(Rt==="Point"||Rt==="MultiPoint"||Rt==="LineString")$t=Re(xt.geometry,nt);else if(Rt==="MultiLineString"||Rt==="Polygon"){$t=[];for(const pt of xt.geometry)$t.push(Re(pt,nt))}else if(Rt==="MultiPolygon"){$t=[];for(const pt of xt.geometry){const Ut=[];for(const le of pt)Ut.push(Re(le,nt));$t.push(Ut)}}st.push(_n(xt.id,Rt,$t,xt.tags))}return st}function Re(wt,nt){const st=[];st.size=wt.size,wt.start!==void 0&&(st.start=wt.start,st.end=wt.end);for(let lt=0;lt<wt.length;lt+=3)st.push(wt[lt]+nt,wt[lt+1],wt[lt+2]);return st}function be(wt,nt){if(wt.transformed)return wt;const st=1<<wt.z,lt=wt.x,xt=wt.y;for(const Rt of wt.features){const $t=Rt.geometry,pt=Rt.type;if(Rt.geometry=[],pt===1)for(let Ut=0;Ut<$t.length;Ut+=2)Rt.geometry.push(Ce($t[Ut],$t[Ut+1],nt,st,lt,xt));else for(let Ut=0;Ut<$t.length;Ut++){const le=[];for(let ue=0;ue<$t[Ut].length;ue+=2)le.push(Ce($t[Ut][ue],$t[Ut][ue+1],nt,st,lt,xt));Rt.geometry.push(le)}}return wt.transformed=!0,wt}function Ce(wt,nt,st,lt,xt,Rt){return[Math.round(st*(wt*lt-xt)),Math.round(st*(nt*lt-Rt))]}function Je(wt,nt,st,lt,xt){const Rt=nt===xt.maxZoom?0:xt.tolerance/((1<<nt)*xt.extent),$t={features:[],numPoints:0,numSimplified:0,numFeatures:wt.length,source:null,x:st,y:lt,z:nt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pt of wt)kn($t,pt,Rt,xt);return $t}function kn(wt,nt,st,lt){const xt=nt.geometry,Rt=nt.type,$t=[];if(wt.minX=Math.min(wt.minX,nt.minX),wt.minY=Math.min(wt.minY,nt.minY),wt.maxX=Math.max(wt.maxX,nt.maxX),wt.maxY=Math.max(wt.maxY,nt.maxY),Rt==="Point"||Rt==="MultiPoint")for(let pt=0;pt<xt.length;pt+=3)$t.push(xt[pt],xt[pt+1]),wt.numPoints++,wt.numSimplified++;else if(Rt==="LineString")Oe($t,xt,wt,st,!1,!1);else if(Rt==="MultiLineString"||Rt==="Polygon")for(let pt=0;pt<xt.length;pt++)Oe($t,xt[pt],wt,st,Rt==="Polygon",pt===0);else if(Rt==="MultiPolygon")for(let pt=0;pt<xt.length;pt++){const Ut=xt[pt];for(let le=0;le<Ut.length;le++)Oe($t,Ut[le],wt,st,!0,le===0)}if($t.length){let pt=nt.tags||null;if(Rt==="LineString"&&lt.lineMetrics){pt={};for(const le in nt.tags)pt[le]=nt.tags[le];pt.mapbox_clip_start=xt.start/xt.size,pt.mapbox_clip_end=xt.end/xt.size}const Ut={geometry:$t,type:Rt==="Polygon"||Rt==="MultiPolygon"?3:Rt==="LineString"||Rt==="MultiLineString"?2:1,tags:pt};nt.id!==null&&(Ut.id=nt.id),wt.features.push(Ut)}}function Oe(wt,nt,st,lt,xt,Rt){const $t=lt*lt;if(lt>0&&nt.size<(xt?$t:lt))return void(st.numPoints+=nt.length/3);const pt=[];for(let Ut=0;Ut<nt.length;Ut+=3)(lt===0||nt[Ut+2]>$t)&&(st.numSimplified++,pt.push(nt[Ut],nt[Ut+1])),st.numPoints++;xt&&(function(Ut,le){let ue=0;for(let ce=0,se=Ut.length,Xe=se-2;ce<se;Xe=ce,ce+=2)ue+=(Ut[ce]-Ut[Xe])*(Ut[ce+1]+Ut[Xe+1]);if(ue>0===le)for(let ce=0,se=Ut.length;ce<se/2;ce+=2){const Xe=Ut[ce],an=Ut[ce+1];Ut[ce]=Ut[se-2-ce],Ut[ce+1]=Ut[se-1-ce],Ut[se-2-ce]=Xe,Ut[se-1-ce]=an}})(pt,Rt),wt.push(pt)}const li={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ln{constructor(nt,st){const lt=(st=this.options=(function(Rt,$t){for(const pt in $t)Rt[pt]=$t[pt];return Rt})(Object.create(li),st)).debug;if(lt&&console.time("preprocess data"),st.maxZoom<0||st.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(st.promoteId&&st.generateId)throw new Error("promoteId and generateId cannot be used together.");let xt=(function(Rt,$t){const pt=[];if(Rt.type==="FeatureCollection")for(let Ut=0;Ut<Rt.features.length;Ut++)Gt(pt,Rt.features[Ut],$t,Ut);else Gt(pt,Rt.type==="Feature"?Rt:{geometry:Rt},$t);return pt})(nt,st);this.tiles={},this.tileCoords=[],lt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",st.indexMaxZoom,st.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xt=(function(Rt,$t){const pt=$t.buffer/$t.extent;let Ut=Rt;const le=et(Rt,1,-1-pt,pt,0,-1,2,$t),ue=et(Rt,1,1-pt,2+pt,0,-1,2,$t);return(le||ue)&&(Ut=et(Rt,1,-pt,1+pt,0,-1,2,$t)||[],le&&(Ut=Qt(le,1).concat(Ut)),ue&&(Ut=Ut.concat(Qt(ue,-1)))),Ut})(xt,st),xt.length&&this.splitTile(xt,0,0,0),lt&&(xt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(nt,st,lt,xt,Rt,$t,pt){const Ut=[nt,st,lt,xt],le=this.options,ue=le.debug;for(;Ut.length;){xt=Ut.pop(),lt=Ut.pop(),st=Ut.pop(),nt=Ut.pop();const ce=1<<st,se=Ye(st,lt,xt);let Xe=this.tiles[se];if(!Xe&&(ue>1&&console.time("creation"),Xe=this.tiles[se]=Je(nt,st,lt,xt,le),this.tileCoords.push({z:st,x:lt,y:xt}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",st,lt,xt,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));const ke=`z${st}`;this.stats[ke]=(this.stats[ke]||0)+1,this.total++}if(Xe.source=nt,Rt==null){if(st===le.indexMaxZoom||Xe.numPoints<=le.indexMaxPoints)continue}else{if(st===le.maxZoom||st===Rt)continue;if(Rt!=null){const ke=Rt-st;if(lt!==$t>>ke||xt!==pt>>ke)continue}}if(Xe.source=null,nt.length===0)continue;ue>1&&console.time("clipping");const an=.5*le.buffer/le.extent,jn=.5-an,vn=.5+an,En=1+an;let zn=null,we=null,Gn=null,An=null,di=et(nt,ce,lt-an,lt+vn,0,Xe.minX,Xe.maxX,le),Nn=et(nt,ce,lt+jn,lt+En,0,Xe.minX,Xe.maxX,le);nt=null,di&&(zn=et(di,ce,xt-an,xt+vn,1,Xe.minY,Xe.maxY,le),we=et(di,ce,xt+jn,xt+En,1,Xe.minY,Xe.maxY,le),di=null),Nn&&(Gn=et(Nn,ce,xt-an,xt+vn,1,Xe.minY,Xe.maxY,le),An=et(Nn,ce,xt+jn,xt+En,1,Xe.minY,Xe.maxY,le),Nn=null),ue>1&&console.timeEnd("clipping"),Ut.push(zn||[],st+1,2*lt,2*xt),Ut.push(we||[],st+1,2*lt,2*xt+1),Ut.push(Gn||[],st+1,2*lt+1,2*xt),Ut.push(An||[],st+1,2*lt+1,2*xt+1)}}getTile(nt,st,lt){nt=+nt,st=+st,lt=+lt;const xt=this.options,{extent:Rt,debug:$t}=xt;if(nt<0||nt>24)return null;const pt=1<<nt,Ut=Ye(nt,st=st+pt&pt-1,lt);if(this.tiles[Ut])return be(this.tiles[Ut],Rt);$t>1&&console.log("drilling down to z%d-%d-%d",nt,st,lt);let le,ue=nt,ce=st,se=lt;for(;!le&&ue>0;)ue--,ce>>=1,se>>=1,le=this.tiles[Ye(ue,ce,se)];return le&&le.source?($t>1&&(console.log("found parent tile z%d-%d-%d",ue,ce,se),console.time("drilling down")),this.splitTile(le.source,ue,ce,se,nt,st,lt),$t>1&&console.timeEnd("drilling down"),this.tiles[Ut]?be(this.tiles[Ut],Rt):null):null}}function Ye(wt,nt,st){return 32*((1<<wt)*st+nt)+wt}class ar extends Ot{constructor(nt,st,lt,xt=yn){super(nt,st,lt),this._dataUpdateable=new Map,this._createGeoJSONIndex=xt}loadVectorTile(nt,st){return b._(this,void 0,void 0,(function*(){const lt=nt.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xt=this._geoJSONIndex.getTile(lt.z,lt.x,lt.y);return xt?Mt(new K(xt.features,{version:2,extent:b.a4})):null}))}loadData(nt){return b._(this,void 0,void 0,(function*(){var st;(st=this._pendingRequest)===null||st===void 0||st.abort();const lt=this._startPerformance(nt);this._pendingRequest=new AbortController;try{(!this._pendingData||nt.request||nt.data||nt.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(nt,this._pendingRequest));const xt=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(xt,nt),this.loaded={};const Rt=nt.dataDiff&&b.a6(xt)?{applyDiff:!0}:{data:xt};return this._finishPerformance(lt,nt,Rt),Rt}catch(xt){if(delete this._pendingRequest,b.cH(xt))return{abandoned:!0};throw xt}}))}_startPerformance(nt){var st;if(!((st=nt?.request)===null||st===void 0)&&st.collectResourceTiming)return new b.c$(nt.request)}_finishPerformance(nt,st,lt){if(!nt)return;const xt=nt.finish();xt&&(lt.resourceTiming={},lt.resourceTiming[st.source]=JSON.parse(JSON.stringify(xt)))}getData(){return b._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(nt){const st=this.loaded;return st&&st[nt.uid]?super.reloadTile(nt):this.loadTile(nt)}loadAndProcessGeoJSON(nt,st){return b._(this,void 0,void 0,(function*(){let lt;if(nt.request?lt=yield this.loadGeoJSONFromUrl(nt.request,nt.promoteId,st):nt.data?lt=this._loadGeoJSONFromObject(nt.data,nt.promoteId):nt.dataDiff&&(lt=this._loadGeoJSONFromDiff(nt.dataDiff,nt.promoteId,nt.source)),delete this._pendingRequest,typeof lt!="object")throw new Error(`Input data given to '${nt.source}' is not a valid GeoJSON object.`);return tt(lt,!0),nt.filter&&(lt=this._filterGeoJSON(lt,nt.filter)),lt}))}loadGeoJSONFromUrl(nt,st,lt){return b._(this,void 0,void 0,(function*(){const xt=yield b.j(nt,lt);return this._dataUpdateable=b.a6(xt.data,st)?b.a7(xt.data,st):void 0,xt.data}))}_loadGeoJSONFromObject(nt,st){return this._dataUpdateable=b.a6(nt,st)?b.a7(nt,st):void 0,nt}_loadGeoJSONFromDiff(nt,st,lt){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${lt}`);b.a8(this._dataUpdateable,nt,st);const xt=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(xt)}_filterGeoJSON(nt,st){const lt=b.d3(st,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(lt.result==="error")throw new Error(lt.value.map((Rt=>`${Rt.key}: ${Rt.message}`)).join(", "));const xt=nt.features.filter((Rt=>lt.value.evaluate({zoom:0},Rt)));return this._toFeatureCollection(xt)}_toFeatureCollection(nt){return{type:"FeatureCollection",features:nt}}removeSource(nt){return b._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(nt){return this._geoJSONIndex.getClusterExpansionZoom(nt.clusterId)}getClusterChildren(nt){return this._geoJSONIndex.getChildren(nt.clusterId)}getClusterLeaves(nt){return this._geoJSONIndex.getLeaves(nt.clusterId,nt.limit,nt.offset)}}function yn(wt,nt){return nt.cluster?new Ne((function({superclusterOptions:st,clusterProperties:lt}){if(!lt||!st)return st;const xt={},Rt={},$t={accumulated:null,zoom:0},pt={properties:null},Ut=Object.keys(lt);for(const le of Ut){const[ue,ce]=lt[le],se=b.d3(ce),Xe=b.d3(typeof ue=="string"?[ue,["accumulated"],["get",le]]:ue);xt[le]=se.value,Rt[le]=Xe.value}return st.map=le=>{pt.properties=le;const ue={};for(const ce of Ut)ue[ce]=xt[ce].evaluate($t,pt);return ue},st.reduce=(le,ue)=>{pt.properties=ue;for(const ce of Ut)$t.accumulated=le[ce],le[ce]=Rt[ce].evaluate($t,pt)},st})(nt)).load(wt.features):(function(st,lt){return new ln(st,lt)})(wt,nt.geojsonVtOptions)}class Mi{constructor(nt){this.self=nt,this.actor=new b.L(nt),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(st,lt)=>{if(this.externalWorkerSourceTypes[st])throw new Error(`Worker source with name "${st}" already registered.`);this.externalWorkerSourceTypes[st]=lt},this.self.addProtocol=b.cJ,this.self.removeProtocol=b.cK,this.self.registerRTLTextPlugin=st=>{b.d4.setMethods(st)},this.actor.registerMessageHandler("LDT",((st,lt)=>this._getDEMWorkerSource(st,lt.source).loadTile(lt))),this.actor.registerMessageHandler("RDT",((st,lt)=>b._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(st,lt.source).removeTile(lt)})))),this.actor.registerMessageHandler("GCEZ",((st,lt)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(st,lt.type,lt.source).getClusterExpansionZoom(lt)})))),this.actor.registerMessageHandler("GCC",((st,lt)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(st,lt.type,lt.source).getClusterChildren(lt)})))),this.actor.registerMessageHandler("GCL",((st,lt)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(st,lt.type,lt.source).getClusterLeaves(lt)})))),this.actor.registerMessageHandler("LD",((st,lt)=>this._getWorkerSource(st,lt.type,lt.source).loadData(lt))),this.actor.registerMessageHandler("GD",((st,lt)=>this._getWorkerSource(st,lt.type,lt.source).getData())),this.actor.registerMessageHandler("LT",((st,lt)=>this._getWorkerSource(st,lt.type,lt.source).loadTile(lt))),this.actor.registerMessageHandler("RT",((st,lt)=>this._getWorkerSource(st,lt.type,lt.source).reloadTile(lt))),this.actor.registerMessageHandler("AT",((st,lt)=>this._getWorkerSource(st,lt.type,lt.source).abortTile(lt))),this.actor.registerMessageHandler("RMT",((st,lt)=>this._getWorkerSource(st,lt.type,lt.source).removeTile(lt))),this.actor.registerMessageHandler("RS",((st,lt)=>b._(this,void 0,void 0,(function*(){if(!this.workerSources[st]||!this.workerSources[st][lt.type]||!this.workerSources[st][lt.type][lt.source])return;const xt=this.workerSources[st][lt.type][lt.source];delete this.workerSources[st][lt.type][lt.source],xt.removeSource!==void 0&&xt.removeSource(lt)})))),this.actor.registerMessageHandler("RM",(st=>b._(this,void 0,void 0,(function*(){delete this.layerIndexes[st],delete this.availableImages[st],delete this.workerSources[st],delete this.demWorkerSources[st],this.globalStates.delete(st)})))),this.actor.registerMessageHandler("SR",((st,lt)=>b._(this,void 0,void 0,(function*(){this.referrer=lt})))),this.actor.registerMessageHandler("SRPS",((st,lt)=>this._syncRTLPluginState(st,lt))),this.actor.registerMessageHandler("IS",((st,lt)=>b._(this,void 0,void 0,(function*(){this.self.importScripts(lt)})))),this.actor.registerMessageHandler("SI",((st,lt)=>this._setImages(st,lt))),this.actor.registerMessageHandler("UL",((st,lt)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(st).update(lt.layers,lt.removedIds,this._getGlobalState(st))})))),this.actor.registerMessageHandler("UGS",((st,lt)=>b._(this,void 0,void 0,(function*(){const xt=this._getGlobalState(st);for(const Rt in lt)xt[Rt]=lt[Rt]})))),this.actor.registerMessageHandler("SL",((st,lt)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(st).replace(lt,this._getGlobalState(st))}))))}_getGlobalState(nt){let st=this.globalStates.get(nt);return st||(st={},this.globalStates.set(nt,st)),st}_setImages(nt,st){return b._(this,void 0,void 0,(function*(){this.availableImages[nt]=st;for(const lt in this.workerSources[nt]){const xt=this.workerSources[nt][lt];for(const Rt in xt)xt[Rt].availableImages=st}}))}_syncRTLPluginState(nt,st){return b._(this,void 0,void 0,(function*(){return yield b.d4.syncState(st,this.self.importScripts)}))}_getAvailableImages(nt){let st=this.availableImages[nt];return st||(st=[]),st}_getLayerIndex(nt){let st=this.layerIndexes[nt];return st||(st=this.layerIndexes[nt]=new o),st}_getWorkerSource(nt,st,lt){if(this.workerSources[nt]||(this.workerSources[nt]={}),this.workerSources[nt][st]||(this.workerSources[nt][st]={}),!this.workerSources[nt][st][lt]){const xt={sendAsync:(Rt,$t)=>(Rt.targetMapId=nt,this.actor.sendAsync(Rt,$t))};switch(st){case"vector":this.workerSources[nt][st][lt]=new Ot(xt,this._getLayerIndex(nt),this._getAvailableImages(nt));break;case"geojson":this.workerSources[nt][st][lt]=new ar(xt,this._getLayerIndex(nt),this._getAvailableImages(nt));break;default:this.workerSources[nt][st][lt]=new this.externalWorkerSourceTypes[st](xt,this._getLayerIndex(nt),this._getAvailableImages(nt))}}return this.workerSources[nt][st][lt]}_getDEMWorkerSource(nt,st){return this.demWorkerSources[nt]||(this.demWorkerSources[nt]={}),this.demWorkerSources[nt][st]||(this.demWorkerSources[nt][st]=new Kt),this.demWorkerSources[nt][st]}}return b.i(self)&&(self.worker=new Mi(self)),Mi})),S("index",["exports","./shared"],(function(b,o){var N="5.13.0";function $(){var g=new o.A(4);return o.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let G,V,K;const q={frame(g,e,r){const c=requestAnimationFrame((_=>{d(),e(_)})),{unsubscribe:d}=o.s(g.signal,"abort",(()=>{d(),cancelAnimationFrame(c),r(o.c())}),!1)},frameAsync(g){return new Promise(((e,r)=>{this.frame(g,e,r)}))},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,r.drawImage(g,0,0,g.width,g.height),r},resolveURL:g=>(G||(G=document.createElement("a")),G.href=g,G.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return K!==void 0?K:!!matchMedia&&(V==null&&(V=matchMedia("(prefers-reduced-motion: reduce)")),V.matches)},set prefersReducedMotion(g){K=g}},Y=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(g){this._frozenAt=g}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function J(){return Y.getCurrentTime()}class W{static testProp(e){if(!W.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in W.docStyle)return e[r];return e[0]}static create(e,r,c){const d=window.document.createElement(e);return r!==void 0&&(d.className=r),c&&c.appendChild(d),d}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){W.docStyle&&W.selectProp&&(W.userSelect=W.docStyle[W.selectProp],W.docStyle[W.selectProp]="none")}static enableDrag(){W.docStyle&&W.selectProp&&(W.docStyle[W.selectProp]=W.userSelect)}static setTransform(e,r){e.style[W.transformProp]=r}static addEventListener(e,r,c,d={}){e.addEventListener(r,c,"passive"in d?d:d.capture)}static removeEventListener(e,r,c,d={}){e.removeEventListener(r,c,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",W.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",W.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",W.suppressClickInternal,!0)}),0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,c){const d=r.boundingClientRect;return new o.P((c.clientX-d.left)/r.x-e.clientLeft,(c.clientY-d.top)/r.y-e.clientTop)}static mousePos(e,r){const c=W.getScale(e);return W.getPoint(e,c,r)}static touchPos(e,r){const c=[],d=W.getScale(e);for(let _=0;_<r.length;_++)c.push(W.getPoint(e,d,r[_]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const d of c)d.remove();return W.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const c of r)W.removeAttributes(c),W.clean(c)}static removeAttributes(e){for(const{name:r,value:c}of e.attributes)W.isPossiblyDangerous(r,c)&&e.removeAttribute(r)}}W.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,W.selectProp=W.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),W.transformProp=W.testProp(["transform","WebkitTransform"]);const at={supported:!1,testSupport:function(g){!Lt&&dt&&(kt?jt(g):ut=g)}};let ut,dt,Lt=!1,kt=!1;function jt(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,dt),g.isContextLost())return;at.supported=!0}catch{}g.deleteTexture(e),Lt=!0}var Mt;typeof document<"u"&&(dt=document.createElement("img"),dt.onload=()=>{ut&&jt(ut),ut=null,kt=!0},dt.onerror=()=>{Lt=!0,ut=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let e,r,c,d;g.resetRequestQueue=()=>{e=[],r=0,c=0,d={}},g.addThrottleControl=C=>{const R=c++;return d[R]=C,R},g.removeThrottleControl=C=>{delete d[C],v()},g.getImage=(C,R,O=!0)=>new Promise(((X,Z)=>{at.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),o.e(C,{type:"image"}),e.push({abortController:R,requestParameters:C,supportImageRefresh:O,state:"queued",onError:it=>{Z(it)},onSuccess:it=>{X(it)}}),v()}));const _=C=>o._(this,void 0,void 0,(function*(){C.state="running";const{requestParameters:R,supportImageRefresh:O,onError:X,onSuccess:Z,abortController:it}=C,ot=O===!1&&!o.i(self)&&!o.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce(((yt,Ct)=>yt&&Ct==="accept"),!0));r++;const mt=ot?k(R,it):o.m(R,it);try{const yt=yield mt;delete C.abortController,C.state="completed",yt.data instanceof HTMLImageElement||o.b(yt.data)?Z(yt):yt.data&&Z({data:yield(gt=yt.data,typeof createImageBitmap=="function"?o.f(gt):o.h(gt)),cacheControl:yt.cacheControl,expires:yt.expires})}catch(yt){delete C.abortController,X(yt)}finally{r--,v()}var gt})),v=()=>{const C=(()=>{for(const R of Object.keys(d))if(d[R]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=r;R<C&&e.length>0;R++){const O=e.shift();O.abortController.signal.aborted?R--:_(O)}},k=(C,R)=>new Promise(((O,X)=>{const Z=new Image,it=C.url,ot=C.credentials;ot&&ot==="include"?Z.crossOrigin="use-credentials":(ot&&ot==="same-origin"||!o.d(it))&&(Z.crossOrigin="anonymous"),R.signal.addEventListener("abort",(()=>{Z.src="",X(o.c())})),Z.fetchPriority="high",Z.onload=()=>{Z.onerror=Z.onload=null,O({data:Z})},Z.onerror=()=>{Z.onerror=Z.onload=null,R.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Z.src=it}))})(Mt||(Mt={})),Mt.resetRequestQueue();class Wt{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ot(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const r=[];for(const{id:c,url:d}of g){const _=`${c}${d}`;r.indexOf(_)===-1&&(r.push(_),e.push({id:c,url:d}))}}return e}function Kt(g,e,r){try{const c=new URL(g);return c.pathname+=`${e}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ge(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class Et extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new o.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let c=!0;const d=r.data||r.spriteData;return this._validateStretch(r.stretchX,d&&d.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,d&&d.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,r){if(!e)return!0;let c=0;for(const d of e){if(d[0]<c||d[1]<d[0]||r<d[1])return!1;c=d[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const c=r.spriteData,d=c&&c.width||r.data.width,_=c&&c.height||r.data.height;return!(e[0]<0||d<e[0]||e[1]<0||_<e[1]||e[2]<0||d<e[2]||e[3]<0||_<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,c=!0){const d=this.getImage(e);if(c&&(d.data.width!==r.data.width||d.data.height!==r.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=d.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((r,c)=>{let d=!0;if(!this.isLoaded())for(const _ of e)this.images[_]||(d=!1);this.isLoaded()||d?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})}))}_getImagesForIds(e){const r={};for(const c of e){let d=this.getImage(c);d||(this.fire(new o.l("styleimagemissing",{id:c})),d=this.getImage(c)),d?r[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],c=this.getImage(e);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const d={w:c.data.width+2,h:c.data.height+2,x:0,y:0},_=new o.I(d,c);this.patterns[e]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const _ in this.patterns)e.push(this.patterns[_].bin);const{w:r,h:c}=o.p(e),d=this.atlasImage;d.resize({width:r||1,height:c||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],k=v.x+1,C=v.y+1,R=this.getImage(_).data,O=R.width,X=R.height;o.R.copy(R,d,{x:0,y:0},{x:k,y:C},{width:O,height:X}),o.R.copy(R,d,{x:0,y:X-1},{x:k,y:C-1},{width:O,height:1}),o.R.copy(R,d,{x:0,y:0},{x:k,y:C+X},{width:O,height:1}),o.R.copy(R,d,{x:O-1,y:0},{x:k-1,y:C},{width:1,height:X}),o.R.copy(R,d,{x:0,y:0},{x:k+O,y:C},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||o.w(`Image with ID: "${r}" was not found`),ge(c)&&this.updateImage(r,c)}}cloneImages(){const e={};for(const r in this.images){const c=this.images[r];e[r]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return e}}const Ht=1e20;function tt(g,e,r,c,d,_,v,k,C){for(let R=e;R<e+c;R++)Jt(g,r*_+R,_,d,v,k,C);for(let R=r;R<r+d;R++)Jt(g,R*_+e,1,c,v,k,C)}function Jt(g,e,r,c,d,_,v){_[0]=0,v[0]=-Ht,v[1]=Ht,d[0]=g[e];for(let k=1,C=0,R=0;k<c;k++){d[k]=g[e+k*r];const O=k*k;do{const X=_[C];R=(d[k]-d[X]+O-X*X)/(k-X)/2}while(R<=v[C]&&--C>-1);C++,_[C]=k,v[C]=R,v[C+1]=Ht}for(let k=0,C=0;k<c;k++){for(;v[C+1]<k;)C++;const R=_[C],O=k-R;g[e+k*r]=d[R]+O*O}}const ze=o.v.layout_symbol["text-font"].default.join(",");class te{constructor(e,r,c){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=c}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,(function*(){const r=[];for(const _ in e)for(const v of e[_])r.push(this._getAndCacheGlyphsPromise(_,v));const c=yield Promise.all(r),d={};for(const{stack:_,id:v,glyph:k}of c)d[_]||(d[_]={}),d[_][v]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return d}))}_getAndCacheGlyphsPromise(e,r){return o._(this,void 0,void 0,(function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=c.glyphs[r];return d!==void 0?{stack:e,id:r,glyph:d}:!this.url||this._charUsesLocalIdeographFontFamily(r)?(d=c.glyphs[r]=this._drawGlyph(c,e,r),{stack:e,id:r,glyph:d}):yield this._downloadAndCacheRangePromise(e,r)}))}_downloadAndCacheRangePromise(e,r){return o._(this,void 0,void 0,(function*(){const c=this.entries[e],d=Math.floor(r/256);if(c.ranges[d])return{stack:e,id:r,glyph:null};if(!c.requests[d]){const _=te.loadGlyphRange(e,d,this.url,this.requestManager);c.requests[d]=_}try{const _=yield c.requests[d];for(const v in _)c.glyphs[+v]=_[+v];return c.ranges[d]=!0,{stack:e,id:r,glyph:_[r]||null}}catch(_){const v=c.glyphs[r]=this._drawGlyph(c,e,r);return this._warnOnMissingGlyphRange(v,d,r,_),{stack:e,id:r,glyph:v}}}))}_warnOnMissingGlyphRange(e,r,c,d){const _=256*r,v=_+255,k=c.toString(16).padStart(4,"0").toUpperCase();o.w(`Unable to load glyph range ${r}, ${_}-${v}. Rendering codepoint U+${k} locally instead. ${d}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&o.q(e)}_drawGlyph(e,r,c){const d=r===ze&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),_=d?"ideographTinySDF":"tinySDF";e[_]||(e[_]=this._createTinySDF(d?this.localIdeographFontFamily:r));const v=e[_].draw(String.fromCodePoint(c));return{id:c,bitmap:new o.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const r=e?e.split(","):[];r.push("sans-serif");const c=r.map((d=>/[-\w]+/.test(d)?d:`'${CSS.escape(d)}'`)).join(",");return new te.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(r[0]),fontStyle:this._fontStyle(r[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const r={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[d,_]of Object.entries(r))new RegExp(`\\b${d}\\b`,"i").test(e)&&(c=`${_}`);return c}destroy(){for(const e in this.entries){const r=this.entries[e];r.tinySDF&&(r.tinySDF=null),r.ideographTinySDF&&(r.ideographTinySDF=null),r.glyphs={},r.requests={},r.ranges={}}this.entries={}}}te.loadGlyphRange=function(g,e,r,c){return o._(this,void 0,void 0,(function*(){const d=256*e,_=d+255,v=c.transformRequest(r.replace("{fontstack}",g).replace("{range}",`${d}-${_}`),"Glyphs"),k=yield o.n(v,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${_}`);const C={};for(const R of o.o(k.data))C[R.id]=R;return C}))},te.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:k=null}={}){this.buffer=e,this.cutoff=c,this.radius=r,this.lang=k;const C=this.size=g+4*e,R=this._createCanvas(C),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${v} ${_} ${g}px ${d}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(g),v=Math.ceil(r),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),C=Math.min(this.size-this.buffer,v+Math.ceil(c)),R=k+2*this.buffer,O=C+2*this.buffer,X=Math.max(R*O,0),Z=new Uint8ClampedArray(X),it={data:Z,width:R,height:O,glyphWidth:k,glyphHeight:C,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(k===0||C===0)return it;const{ctx:ot,buffer:mt,gridInner:gt,gridOuter:yt}=this;this.lang&&(ot.lang=this.lang),ot.clearRect(mt,mt,k,C),ot.fillText(g,mt,mt+v);const Ct=ot.getImageData(mt,mt,k,C);yt.fill(Ht,0,X),gt.fill(0,0,X);for(let zt=0;zt<C;zt++)for(let St=0;St<k;St++){const Nt=Ct.data[4*(zt*k+St)+3]/255;if(Nt===0)continue;const Ft=(zt+mt)*R+St+mt;if(Nt===1)yt[Ft]=0,gt[Ft]=Ht;else{const At=.5-Nt;yt[Ft]=At>0?At*At:0,gt[Ft]=At<0?At*At:0}}tt(yt,0,0,R,O,R,this.f,this.v,this.z),tt(gt,mt,mt,k,C,R,this.f,this.v,this.z);for(let zt=0;zt<X;zt++){const St=Math.sqrt(yt[zt])-Math.sqrt(gt[zt]);Z[zt]=Math.round(255-255*(St/this.radius+this.cutoff))}return it}};class Ne{constructor(){this.specification=o.u.light.position}possiblyEvaluate(e,r){return o.F(e.expression.evaluate(r))}interpolate(e,r,c){return{x:o.G.number(e.x,r.x,c),y:o.G.number(e.y,r.y,c),z:o.G.number(e.z,r.z,c)}}}let he;class _e extends o.E{constructor(e){super(),he=he||new o.t({anchor:new o.D(o.u.light.anchor),position:new Ne,color:new o.D(o.u.light.color),intensity:new o.D(o.u.light.intensity)}),this._transitionable=new o.x(he,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(o.y,e,r))for(const c in e){const d=e[c];c.endsWith(o.z)?this._transitionable.setTransition(c.slice(0,-o.z.length),d):this._transitionable.setValue(c,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c){return(!c||c.validate!==!1)&&o.B(this,e.call(o.C,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.u}))}}const Zt=new o.t({"sky-color":new o.D(o.u.sky["sky-color"]),"horizon-color":new o.D(o.u.sky["horizon-color"]),"fog-color":new o.D(o.u.sky["fog-color"]),"fog-ground-blend":new o.D(o.u.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.u.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.u.sky["atmosphere-blend"])});class Xt extends o.E{constructor(e){super(),this._transitionable=new o.x(Zt,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0))}setSky(e,r={}){if(!this._validate(o.J,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in e){const d=e[c];c.endsWith(o.z)?this._transitionable.setTransition(c.slice(0,-o.z.length),d):this._transitionable.setValue(c,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c={}){return c?.validate!==!1&&o.B(this,e.call(o.C,o.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ge{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const c=e.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,r)),this.dashEntry[c]}getDashRanges(e,r,c){const d=[];let _=e.length%2==1?-e[e.length-1]*c:0,v=e[0]*c,k=!0;d.push({left:_,right:v,isDash:k,zeroLength:e[0]===0});let C=e[0];for(let R=1;R<e.length;R++){k=!k;const O=e[R];_=C*c,C+=O,v=C*c,d.push({left:_,right:v,isDash:k,zeroLength:O===0})}return d}addRoundDash(e,r,c){const d=r/2;for(let _=-c;_<=c;_++){const v=this.width*(this.nextRow+c+_);let k=0,C=e[k];for(let R=0;R<this.width;R++){R/C.right>1&&(C=e[++k]);const O=Math.abs(R-C.left),X=Math.abs(R-C.right),Z=Math.min(O,X);let it;const ot=_/c*(d+1);if(C.isDash){const mt=d-Math.abs(ot);it=Math.sqrt(Z*Z+mt*mt)}else it=d-Math.sqrt(Z*Z+ot*ot);this.data[v+R]=Math.max(0,Math.min(255,it+128))}}}addRegularDash(e){for(let k=e.length-1;k>=0;--k){const C=e[k],R=e[k+1];C.zeroLength?e.splice(k,1):R&&R.isDash===C.isDash&&(R.left=C.left,e.splice(k,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const d=this.width*this.nextRow;let _=0,v=e[_];for(let k=0;k<this.width;k++){k/v.right>1&&(v=e[++_]);const C=Math.abs(k-v.left),R=Math.abs(k-v.right),O=Math.min(C,R);this.data[d+k]=Math.max(0,Math.min(255,(v.isDash?O:-O)+128))}}addDash(e,r){const c=r?7:0,d=2*c+1;if(this.nextRow+d>this.height)return o.w("LineAtlas out of space"),null;let _=0;for(let k=0;k<e.length;k++)_+=e[k];if(_!==0){const k=this.width/_,C=this.getDashRanges(e,this.width,k);r?this.addRoundDash(C,k,c):this.addRegularDash(C)}const v={y:this.nextRow+c,height:2*c,width:_};return this.nextRow+=d,this.dirty=!0,v}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const ye="maplibre_preloaded_worker_pool";class Pe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Pe.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ye]}numActive(){return Object.keys(this.active).length}}const _n=Math.floor(q.hardwareConcurrency/2);let Pn,Gt;function bn(){return Pn||(Pn=new Pe),Pn}Pe.workerCount=o.K(globalThis)?Math.max(Math.min(_n,3),1):1;class sn{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let d=0;d<c.length;d++){const _=new o.L(c[d],r);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const c=[];for(const d of this.actors)c.push(d.sendAsync({type:e,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const c of this.actors)c.registerMessageHandler(e,r)}unregisterMessageHandler(e){for(const r of this.actors)r.unregisterMessageHandler(e)}}function Be(){return Gt||(Gt=new sn(bn(),o.M),Gt.registerMessageHandler("GR",((g,e,r)=>o.m(e,r)))),Gt}function Dt(g,e){const r=o.N();return o.O(r,r,[1,1,0]),o.Q(r,r,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?o.S(r,r,g.calculatePosMatrix(e.toUnwrapped())):r}function $n(g,e,r,c,d,_,v){var k;const C=(function(Z,it,ot){if(Z)for(const mt of Z){const gt=it[mt];if(gt&&gt.source===ot&&gt.type==="fill-extrusion")return!0}else for(const mt in it){const gt=it[mt];if(gt.source===ot&&gt.type==="fill-extrusion")return!0}return!1})((k=d?.layers)!==null&&k!==void 0?k:null,e,g.id),R=_.maxPitchScaleFactor(),O=g.tilesIn(c,R,C);O.sort(et);const X=[];for(const Z of O)X.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(e,r,g.getState(),Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,d,_,R,Dt(_,Z.tileID),v?(it,ot)=>v(Z.tileID,it,ot):void 0)});return(function(Z,it){for(const ot in Z)for(const mt of Z[ot])fe(mt,it);return Z})((function(Z){const it={},ot={};for(const mt of Z){const gt=mt.queryResults,yt=mt.wrappedTileID,Ct=ot[yt]=ot[yt]||{};for(const zt in gt){const St=gt[zt],Nt=Ct[zt]=Ct[zt]||{},Ft=it[zt]=it[zt]||[];for(const At of St)Nt[At.featureIndex]||(Nt[At.featureIndex]=!0,Ft.push(At))}}return it})(X),g)}function et(g,e){const r=g.tileID,c=e.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function fe(g,e){const r=g.feature,c=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function de(g,e,r){return o._(this,void 0,void 0,(function*(){let c=g;if(g.url?c=(yield o.j(e.transformRequest(g.url,"Source"),r)).data:yield q.frameAsync(r),!c)return null;const d=o.U(o.e(c,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(d.vectorLayerIds=c.vector_layers.map((_=>_.id))),d}))}class Pt{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.V?new o.V(e.lng,e.lat):o.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.V?new o.V(e.lng,e.lat):o.V.convert(e),this}extend(e){const r=this._sw,c=this._ne;let d,_;if(e instanceof o.V)d=e,_=e;else{if(!(e instanceof Pt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pt.convert(e)):this.extend(o.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.V.convert(e)):this;if(d=e._sw,_=e._ne,!d||!_)return this}return r||c?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new o.V(d.lng,d.lat),this._ne=new o.V(_.lng,_.lat)),this}getCenter(){return new o.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.V(this.getWest(),this.getNorth())}getSouthEast(){return new o.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:c}=o.V.convert(e);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}intersects(e){if((e=Pt.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;const r=o.W(this.getWest(),-180,180),c=o.W(this.getEast(),-180,180),d=o.W(e.getWest(),-180,180),_=o.W(e.getEast(),-180,180),v=r>c,k=d>_;return!(!v||!k)||(v?_>=r||d<=c:k?c>=d||r<=_:!(d>c||_<r))}static convert(e){return e instanceof Pt?e:e&&new Pt(e)}static fromLngLat(e,r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*e.lat);return new Pt(new o.V(e.lng-d,e.lat-c),new o.V(e.lng+d,e.lat+c))}adjustAntiMeridian(){const e=new o.V(this._sw.lng,this._sw.lat),r=new o.V(this._ne.lng,this._ne.lat);return new Pt(e,e.lng>r.lng?new o.V(r.lng+360,r.lat):r)}}class bt{constructor(e,r,c){this.bounds=Pt.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),c=Math.floor(o.Y(this.bounds.getWest())*r),d=Math.floor(o.X(this.bounds.getNorth())*r),_=Math.ceil(o.Y(this.bounds.getEast())*r),v=Math.ceil(o.X(this.bounds.getSouth())*r);return e.x>=c&&e.x<_&&e.y>=d&&e.y<v}}class Tt extends o.E{constructor(e,r,c,d){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.U(r,["url","scheme","tileSize","promoteId","encoding"])),this._options=o.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield de(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new bt(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};c.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((_,v)=>{e.reloadPromise={resolve:_,reject:v}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const _=yield e.actor.sendAsync({type:d,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,_)}catch(_){if(delete e.abortController,e.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const r=e.tileID.scaledTo(this.maxzoom).canonical,c=r.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:r,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Te extends o.E{constructor(e,r,c,d){super(),this.id=e,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},r),o.e(this,o.U(r,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield de(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new bt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(r))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const c=yield Mt.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const d=this.map.painter.context,_=d.gl,v=c.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new o.T(d,v,_.RGBA,{useMipmap:!0}),e.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Ee extends Te{constructor(e,r,c,d){super(e,r,c,d),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield Mt.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const v=o.b(_)&&o.Z()?_:yield this.readImageNow(_),k={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const C=yield e.actor.sendAsync({type:"LDT",data:k});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}readImageNow(e){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.$()){const r=e.width+2,c=e.height+2;try{return new o.R({width:r,height:c},yield o.a0(e,-1,-1,r,c))}catch{}}return q.getImageData(e,1)}))}_getNeighboringTiles(e){const r=e.canonical,c=Math.pow(2,r.z),d=(r.x-1+c)%c,_=r.x===0?e.wrap-1:e.wrap,v=(r.x+1+c)%c,k=r.x+1===c?e.wrap+1:e.wrap,C={};return C[new o.a1(e.overscaledZ,_,r.z,d,r.y).key]={backfilled:!1},C[new o.a1(e.overscaledZ,k,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(C[new o.a1(e.overscaledZ,_,r.z,d,r.y-1).key]={backfilled:!1},C[new o.a1(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new o.a1(e.overscaledZ,k,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<c&&(C[new o.a1(e.overscaledZ,_,r.z,d,r.y+1).key]={backfilled:!1},C[new o.a1(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new o.a1(e.overscaledZ,k,r.z,v,r.y+1).key]={backfilled:!1}),C}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function Qt(g){return g.type==="GeometryCollection"?g.geometries.map((e=>e.coordinates)).flat(1/0):g.coordinates.flat(1/0)}function Re(g){const e=new Pt;let r;switch(g.type){case"FeatureCollection":r=g.features.map((c=>Qt(c.geometry))).flat(1/0);break;case"Feature":r=Qt(g.geometry);break;default:r=Qt(g)}if(r.length==0)return e;for(let c=0;c<r.length-1;c+=2)e.extend([r[c],r[c+1]]);return e}class be extends o.E{constructor(e,r,c,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=c.getActor(),this.setEventedParent(d),this._data=typeof r.data=="string"?{url:r.data}:{geojson:r.data},this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:o.a4,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.a4,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(o.a4/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,r){this._data=typeof e=="string"?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};const c=this._updateWorkerData();return r?c:this}updateData(e,r){this._pendingWorkerUpdate.diff=o.a5(this._pendingWorkerUpdate.diff,e);const c=this._updateWorkerData();return r?c:this}getData(){return o._(this,void 0,void 0,(function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return o._(this,void 0,void 0,(function*(){return Re(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:c}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:r}=this._pendingWorkerUpdate,c=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(c.request=this.map._requestManager.transformRequest(q.resolveURL(e),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=e,this._pendingWorkerUpdate.data=void 0):r&&(c.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));d.applyDiff?this._applyDiff(r):this._data={geojson:d.data};let _=null;d.resourceTiming&&d.resourceTiming[this.id]&&(_=d.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&o.e(v,{resourceTiming:_}),this.fire(new o.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(r)})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(d))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(e){const r=typeof this.promoteId=="string"?this.promoteId:void 0;this._data.url||this._data.updateable||!o.a6(this._data.geojson,r)||(this._data={updateable:o.a7(this._data.geojson,r)}),e&&this._data.updateable?o.a8(this._data.updateable,e,r):o.w("Cannot apply GeoJSONSource#updateData due to internal error")}_getShouldReloadTileOptions(e){if(this._options.cluster||!e||e.removeAll)return;const{add:r=[],update:c=[],remove:d=[]}=e||{},_=new Set([...c.map((v=>v.id)),...d]);for(const v of _.values())if(typeof v!="number"&&this.promoteId==null)return void o.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs (e.g. "${v}"). Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...c.map((v=>v.newGeometry)),...r.map((v=>v.geometry))].filter(Boolean).map((v=>Re(v))),prevIds:_}}shouldReloadTile(e,{nextBounds:r,prevIds:c}){if(!e.latestFeatureIndex)return e.state!=="unloaded";const d=e.latestFeatureIndex.loadVTLayers();for(let C=0;C<e.latestFeatureIndex.featureIndexArray.length;C++){const R=e.latestFeatureIndex.featureIndexArray.get(C),O=d[o.a9].feature(R.featureIndex),X=e.latestFeatureIndex.getId(O,o.a9);if(c.has(X))return!0}const{buffer:_,extent:v}=this.workerOptions.geojsonVtOptions,k=(function({x:C,y:R,z:O},X=0){const Z=o.a2((C-X)/Math.pow(2,O)),it=o.a3((R+1+X)/Math.pow(2,O)),ot=o.a2((C+1+X)/Math.pow(2,O)),mt=o.a3((R-X)/Math.pow(2,O));return new Pt([Z,it],[ot,mt])})(e.tileID.canonical,_/v);for(const C of r)if(k.intersects(C))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:r,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,r==="RT")}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Ce extends o.E{constructor(e,r,c,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=r}load(e){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Mt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new o.k(r))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(o.aa.fromLngLat);var c;return this.tileID=(function(d){const _=o.ab.fromPoints(d),v=_.width(),k=_.height(),C=Math.max(v,k),R=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),O=Math.pow(2,R);return new o.ad(R,Math.floor((_.minX+_.maxX)/2*O),Math.floor((_.minY+_.maxY)/2*O))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new o.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:c,maxX:d,maxY:_}=o.ab.fromPoints(e),v={};for(let k=0;k<=o.ac;k++){const C=Math.pow(2,k),R=Math.floor(r*C),O=Math.floor(c*C),X=Math.floor(d*C),Z=Math.floor(_*C);v[k]={minTileX:R,minTileY:O,maxTileX:X,maxTileY:Z}}return v}}class Je extends Ce{constructor(e,r,c,d){super(e,r,c,d),this.roundZoom=!0,this.type="video",this.options=r}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield o.ae(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new o.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new o.k(new o.af(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class kn extends Ce{constructor(e,r,c,d){super(e,r,c,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new o.k(new o.af(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.af(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.k(new o.af(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.af(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.af(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,c.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Oe={},li=g=>{switch(g){case"geojson":return be;case"image":return Ce;case"raster":return Te;case"raster-dem":return Ee;case"vector":return Tt;case"video":return Je;case"canvas":return kn}return Oe[g]},ln="RTLPluginLoaded";class Ye extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Be()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,(function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=q.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(ln))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ar=null;function yn(){return ar||(ar=new Ye),ar}var Mi,wt;(function(g){g[g.Base=0]="Base",g[g.Parent=1]="Parent"})(Mi||(Mi={})),(function(g){g[g.Departing=0]="Departing",g[g.Incoming=1]="Incoming"})(wt||(wt={}));class nt{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=o.ag(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:r,fadingParentID:c,fadeEndTime:d}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=r,this.fadingParentID=c,this.fadeEndTime=d}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=J(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(d,_){const v={};if(!_)return v;for(const k of d){const C=k.layerIds.map((R=>_.getLayer(R))).filter(Boolean);if(C.length!==0){k.layers=C,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((R=>C.filter((O=>O.id===R))[0])));for(const R of C)v[R.id]=k}}return v})(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof o.ai){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof o.ai&&_.hasRTLText){this.hasRTLText=!0,yn().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(d).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new o.ah}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,c,d,_,v,k,C,R,O,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:O,transform:C,params:k,queryPadding:this.queryPadding*R,getElevation:X},e,r,c):{}}querySourceFeatures(e,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",v=d[o.a9]||d[_];if(!v)return;const k=o.aj(r?.filter,r?.globalState),{z:C,x:R,y:O}=this.tileID.canonical,X={z:C,x:R,y:O};for(let Z=0;Z<v.length;Z++){const it=v.feature(Z);if(k.needGeometry){const gt=o.ak(it,!0);if(!k.filter(new o.H(this.tileID.overscaledZ),gt,this.tileID.canonical))continue}else if(!k.filter(new o.H(this.tileID.overscaledZ),it))continue;const ot=c.getId(it,_),mt=new o.al(it,C,R,O,ot);mt.tile=X,e.push(mt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const c=o.am(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const _=this.expirationTime-r;_?this.expirationTime=c+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const _=this.buckets[d],v=_.layers[0].sourceLayer||o.a9,k=c[v],C=e[v];if(!k||!C||Object.keys(C).length===0)continue;_.update(C,k,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const R=r&&r.style&&r.style.getLayer(d);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<J()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=J()+e}setDependencies(e,r){const c={};for(const d of r)c[d]=!0;this.dependencies[e]=c}hasDependency(e,r){for(const c of e){const d=this.dependencies[c];if(d){for(const _ of r)if(d[_])return!0}}return!1}}class st{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,c){const d=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},o.e(this.stateChanges[e][d],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const _ in this.state[e])_!==d&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const _ in this.state[e][d])c[_]||(this.deletedStates[e][d][_]=null)}else for(const _ in c)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][_]===null&&delete this.deletedStates[e][d][_]}removeFeatureState(e,r,c){if(this.deletedStates[e]===null)return;const d=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&r!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][c]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(c in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][c]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,r){const c=String(r),d=o.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const _=this.deletedStates[e][r];if(_===null)return{};for(const v in _)delete d[v]}return d}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const v in this.stateChanges[d])this.state[d][v]||(this.state[d][v]={}),o.e(this.state[d][v],this.stateChanges[d][v]),_[v]=this.state[d][v];c[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const v in this.state[d])_[v]={},this.state[d][v]={};else for(const v in this.deletedStates[d]){if(this.deletedStates[d][v]===null)this.state[d][v]={};else for(const k of Object.keys(this.deletedStates[d][v]))delete this.state[d][v][k];_[v]=this.state[d][v]}c[d]=c[d]||{},o.e(c[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in e)e[d].setFeatureState(c,r)}}const lt=89.25;function xt(g,e){const r=o.an(e.lat,-o.ao,o.ao);return new o.P(o.Y(e.lng)*g,o.X(r)*g)}function Rt(g,e){return new o.aa(e.x/g,e.y/g).toLngLat()}function $t(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(o.ap(90-g.pitch)),Math.tan(o.ap(lt-g.pitch)))}function pt(g,e){const r=g.canonical,c=e/o.aq(r.z),d=r.x+Math.pow(2,r.z)*g.wrap,_=o.ar(new Float64Array(16));return o.O(_,_,[d*c,r.y*c,0]),o.Q(_,_,[c/o.a4,c/o.a4,1]),_}function Ut(g,e,r,c,d){const _=o.aa.fromLngLat(g,e),v=d*o.as(1,g.lat),k=v*Math.cos(o.ap(r)),C=Math.sqrt(v*v-k*k),R=C*Math.sin(o.ap(-c)),O=C*Math.cos(o.ap(-c));return new o.aa(_.x+R,_.y+O,_.z+k)}function le(g,e,r){const c=e.intersectsFrustum(g);if(!r||c===0)return c;const d=e.intersectsPlane(r);return d===0?0:c===2&&d===2?2:1}function ue(g,e,r){let c=0;const d=(r-e)/10;for(let _=0;_<10;_++)c+=d*Math.pow(Math.cos(e+(_+.5)/10*(r-e)),g);return c}function ce(g,e){return function(r,c,d,_,v){const k=2*((g-1)/o.at(Math.cos(o.ap(lt-v))/Math.cos(o.ap(lt)))-1),C=Math.acos(d/_),R=2*ue(k-1,0,o.ap(v/2)),O=Math.min(o.ap(lt),C+o.ap(v/2)),X=ue(k-1,Math.min(O,C-o.ap(v/2)),O),Z=Math.atan(c/d),it=Math.hypot(c,d);let ot=r;return ot+=o.at(_/it/Math.max(.5,Math.cos(o.ap(v/2)))),ot+=k*o.at(Math.cos(Z))/2,ot-=o.at(Math.max(1,X/R/e))/2,ot}}const se=ce(9.314,3);function Xe(g,e){const r=(e.roundZoom?Math.round:Math.floor)(g.zoom+o.at(g.tileSize/e.tileSize));return Math.max(0,r)}function an(g,e){const r=g.getCameraFrustum(),c=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=o.aa.fromLngLat(g.center,g.elevation);d.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const v=g.getCoveringTilesDetailsProvider(),k=v.allowVariableZoom(g,e),C=Xe(g,e),R=e.minzoom||0,O=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,X=Math.min(Math.max(0,C),O),Z=Math.pow(2,X),it=[Z*d.x,Z*d.y,0],ot=[Z*_.x,Z*_.y,0],mt=Math.hypot(_.x-d.x,_.y-d.y),gt=Math.abs(_.z-d.z),yt=Math.hypot(mt,gt),Ct=Nt=>({zoom:0,x:0,y:0,wrap:Nt,fullyVisible:!1}),zt=[],St=[];if(g.renderWorldCopies&&v.allowWorldCopies())for(let Nt=1;Nt<=3;Nt++)zt.push(Ct(-Nt)),zt.push(Ct(Nt));for(zt.push(Ct(0));zt.length>0;){const Nt=zt.pop(),Ft=Nt.x,At=Nt.y;let qt=Nt.fullyVisible;const oe={x:Ft,y:At,z:Nt.zoom},ee=v.getTileBoundingVolume(oe,Nt.wrap,g.elevation,e);if(!qt){const Me=le(r,ee,c);if(Me===0)continue;qt=Me===2}const ie=v.distanceToTile2d(d.x,d.y,oe,ee);let ae=C;k&&(ae=(e.calculateTileZoom||se)(g.zoom+o.at(g.tileSize/e.tileSize),ie,gt,yt,g.fov)),ae=(e.roundZoom?Math.round:Math.floor)(ae),ae=Math.max(0,ae);const De=Math.min(ae,O);if(Nt.wrap=v.getWrap(_,oe,Nt.wrap),Nt.zoom>=De){if(Nt.zoom<R)continue;const Me=X-Nt.zoom,ve=it[0]-.5-(Ft<<Me),Ze=it[1]-.5-(At<<Me),hn=e.reparseOverscaled?Math.max(Nt.zoom,ae):Nt.zoom;St.push({tileID:new o.a1(Nt.zoom===O?hn:Nt.zoom,Nt.wrap,Nt.zoom,Ft,At),distanceSq:o.au([ot[0]-.5-Ft,ot[1]-.5-At]),tileDistanceToCamera:Math.sqrt(ve*ve+Ze*Ze)})}else for(let Me=0;Me<4;Me++)zt.push({zoom:Nt.zoom+1,x:(Ft<<1)+Me%2,y:(At<<1)+(Me>>1),wrap:Nt.wrap,fullyVisible:qt})}return St.sort(((Nt,Ft)=>Nt.distanceSq-Ft.distanceSq)).map((Nt=>Nt.tileID))}const jn=o.ab.fromPoints([new o.P(0,0),new o.P(o.a4,o.a4)]);class vn extends o.E{constructor(e,r,c){super(),this.id=e,this.dispatcher=c,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,_,v,k)=>{const C=new(li(_.type))(d,_,v,k);if(C.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${C.id}`);return C})(e,r,c,this),this._tiles={},this._cache=new o.av(0,(d=>this._unloadTile(d))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new st,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,c){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,c)}catch(d){e.state="errored",d.status!==404?this._source.fire(new o.k(d,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(En).map((e=>e.key))}getRenderableIds(e){const r=[];for(const c in this._tiles)this._isIdRenderable(c,e)&&r.push(this._tiles[c]);return e?r.sort(((c,d)=>{const _=c.tileID,v=d.tileID,k=new o.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians),C=new o.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return _.overscaledZ-v.overscaledZ||C.y-k.y||C.x-k.x})).map((c=>c.tileID.key)):r.map((c=>c.tileID)).sort(En).map((c=>c.key))}hasRenderableParent(e){const r=e.overscaledZ-1;if(r>=this._source.minzoom){const c=this.getLoadedTile(e.scaledTo(r));if(c)return this._isIdRenderable(c.tileID.key)}return!1}_isIdRenderable(e,r=!1){var c;return(c=this._tiles[e])===null||c===void 0?void 0:c.isRenderable(r)}reload(e,r=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)r&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[c],r)||(e?this._reloadTile(c,"expired"):this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading"))}}_reloadTile(e,r){return o._(this,void 0,void 0,(function*(){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,e,r))}))}_tileLoaded(e,r,c){e.timeAdded=J(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let d=0;d<r.length;d++){const _=r[d];if(e.neighboringTiles&&e.neighboringTiles[_]){const v=this.getTileByID(_);c(e,v),c(v,e)}}function c(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let v=_.tileID.canonical.x-d.tileID.canonical.x;const k=_.tileID.canonical.y-d.tileID.canonical.y,C=Math.pow(2,d.tileID.canonical.z),R=_.tileID.key;v===0&&k===0||Math.abs(k)>1||(Math.abs(v)>1&&(Math.abs(v+C)===1?v+=C:Math.abs(v-C)===1&&(v-=C)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,v,k),d.neighboringTiles&&d.neighboringTiles[R]&&(d.neighboringTiles[R].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r){const c=this._getLoadedDescendents(r),d=new Set;for(const _ of r){const v=c[_.key];if(!v?.length){d.add(_);continue}const k=_.overscaledZ+vn.maxOverzooming,C=v.filter((X=>X.tileID.overscaledZ<=k));if(!C.length){d.add(_);continue}const R=Math.min(...C.map((X=>X.tileID.overscaledZ))),O=C.filter((X=>X.tileID.overscaledZ===R)).map((X=>X.tileID));for(const X of O)e[X.key]=X;this._areDescendentsComplete(O,R,_.overscaledZ)||d.add(_)}return d}_getLoadedDescendents(e){var r;const c={};for(const d in this._tiles){const _=this._tiles[d];if(_.hasData())for(const v of e)_.tileID.isChildOf(v)&&(c[r=v.key]||(c[r]=[])).push(_)}return c}_areDescendentsComplete(e,r,c){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===r:Math.pow(4,r-c)===e.length}getLoadedTile(e){const r=this._tiles[e.key];return r?.hasData()?r:null}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const c={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),c[_.tileID.key]=_}this._tiles=c,this._resetTileReloadTimers()}}update(e,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((C=>new o.a1(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y))):(c=an(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((C=>this._source.hasTile(C))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const d=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Xe(e,this._source),v=this._updateRetainedTiles(c,_),k=zn(this._source.type);k&&this._rasterFadeDuration>0&&!r&&this._updateFadingTiles(c,v),k?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(e){for(const r in this._tiles)e[r]||this._removeTile(r)}_cleanUpVectorTiles(e){for(const r in this._tiles){const c=this._tiles[r];e[r]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(r):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(e){const r=[];for(const c of e)if(c.canonical.z>this._source.minzoom){const d=c.scaledTo(c.canonical.z-1);r.push(d);const _=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));r.push(_)}return e.concat(r)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var c;const d=new Set;for(const R of e)this._addTile(R).hasData()||d.add(R);const _=e.reduce(((R,O)=>(R[O.key]=O,R)),{}),v=this._retainLoadedChildren(_,d),k={},C=Math.max(r-vn.maxUnderzooming,this._source.minzoom);for(const R of v){let O=this._tiles[R.key],X=O?.wasRequested();for(let Z=R.overscaledZ-1;Z>=C;--Z){const it=R.scaledTo(Z);if(k[it.key])break;if(k[it.key]=!0,O=this.getTile(it),!O&&X&&(O=this._addTile(it)),O){const ot=O.hasData();if((ot||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||X)&&(_[it.key]=it),X=O.wasRequested(),ot)break}}}return _}_updateFadingTiles(e,r){const c=J(),d=o.aw(e);for(const _ of e){const v=this._tiles[_.key];v.fadingDirection!==wt.Departing&&v.fadeOpacity!==0||v.resetFadeLogic(),this._updateFadingAncestor(v,r,c)||this._updateFadingDescendents(v,r,c)||this._updateFadingEdge(v,d,c)||v.resetFadeLogic()}}_updateFadingAncestor(e,r,c){if(!e.hasData())return!1;const{tileID:d,fadingRole:_,fadingDirection:v,fadingParentID:k}=e;if(_===Mi.Base&&v===wt.Incoming&&k)return r[k.key]=k,!0;const C=Math.max(d.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let R=d.overscaledZ-1;R>=C;R--){const O=d.scaledTo(R),X=this.getLoadedTile(O);if(X)return e.setCrossFadeLogic({fadingRole:Mi.Base,fadingDirection:wt.Incoming,fadingParentID:X.tileID,fadeEndTime:c+this._rasterFadeDuration}),X.setCrossFadeLogic({fadingRole:Mi.Parent,fadingDirection:wt.Departing,fadeEndTime:c+this._rasterFadeDuration}),r[O.key]=O,!0}return!1}_updateFadingDescendents(e,r,c){if(!e.hasData())return!1;const d=e.tileID.children(this._source.maxzoom);let _=this._updateFadingChildren(e,d,r,c);if(_)return!0;for(const v of d){const k=v.children(this._source.maxzoom);this._updateFadingChildren(e,k,r,c)&&(_=!0)}return _}_updateFadingChildren(e,r,c,d){if(r[0].overscaledZ>=this._source.maxzoom)return!1;let _=!1;for(const v of r){const k=this.getLoadedTile(v);if(!k)continue;const{fadingRole:C,fadingDirection:R,fadingParentID:O}=k;C===Mi.Base&&R===wt.Departing&&O||(k.setCrossFadeLogic({fadingRole:Mi.Base,fadingDirection:wt.Departing,fadingParentID:e.tileID,fadeEndTime:d+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Mi.Parent,fadingDirection:wt.Incoming,fadeEndTime:d+this._rasterFadeDuration})),c[v.key]=v,_=!0}return _}_updateFadingEdge(e,r,c){const d=e.tileID;return!!e.selfFading||!e.hasData()&&!!r.has(d)&&(e.setSelfFadeLogic(c+this._rasterFadeDuration),!0)}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(r.resetFadeLogic(),this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null));const c=r;return r||(r=new nt(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,c||this._source.fire(new o.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){this._clearTileReloadTimer(e);const c=r.getExpiryTimeout();c&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),c))}_clearTileReloadTimer(e){const r=this._timers[e];r&&(clearTimeout(r),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some((c=>c.equals(this._tiles[r].tileID.canonical)))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,c){const d=[],_=this.transform;if(!_)return d;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),k=c?_.getCameraQueryGeometry(e):e,C=it=>_.screenPointToMercatorCoordinate(it,this.terrain),R=this.transformBbox(e,C,!v),O=this.transformBbox(k,C,!v),X=this.getIds(),Z=o.ab.fromPoints(O);for(let it=0;it<X.length;it++){const ot=this._tiles[X[it]];if(ot.holdingForSymbolFade())continue;const mt=v?[ot.tileID]:[ot.tileID.unwrapTo(-1),ot.tileID.unwrapTo(0)],gt=Math.pow(2,_.zoom-ot.tileID.overscaledZ),yt=r*ot.queryPadding*o.a4/ot.tileSize/gt;for(const Ct of mt){const zt=Z.map((St=>Ct.getTilePoint(new o.aa(St.x,St.y))));if(zt.expandBy(yt),zt.intersects(jn)){const St=R.map((Ft=>Ct.getTilePoint(Ft))),Nt=O.map((Ft=>Ct.getTilePoint(Ft)));d.push({tile:ot,tileID:v?Ct:Ct.unwrapTo(0),queryGeometry:St,cameraQueryGeometry:Nt,scale:gt})}}}return d}transformBbox(e,r,c){let d=e.map(r);if(c){const _=o.ab.fromPoints(e);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(r);o.ab.fromPoints(d).covers(v)||(d=d.map((k=>k.x>.5?new o.aa(k.x-1,k.y,k.z):k)))}return d}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((c=>this._tiles[c].tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(zn(this._source.type)&&this._rasterFadeDuration>0){const e=J();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,r,c){this._state.updateState(e=e||o.a9,r,c)}removeFeatureState(e,r,c){this._state.removeFeatureState(e=e||o.a9,r,c)}getFeatureState(e,r){return this._state.getState(e=e||o.a9,r)}setDependencies(e,r,c){const d=this._tiles[e];d&&d.setDependencies(r,c)}reloadTilesForDependencies(e,r){for(const c in this._tiles)this._tiles[c].hasDependency(e,r)&&this._reloadTile(c,"reloading");this._cache.filter((c=>!c.hasDependency(e,r)))}}function En(g,e){const r=Math.abs(2*g.wrap)-+(g.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||c-r||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function zn(g){return g==="raster"||g==="image"||g==="video"}vn.maxUnderzooming=10,vn.maxOverzooming=3;class we{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.an(e,0,1);let r=1,c=this._distances[r];const d=e*this.paddedLength+this.padding;for(;c<d&&r<this._distances.length;)c=this._distances[++r];const _=r-1,v=this._distances[_],k=c-v,C=k>0?(d-v)/k:0;return this.points[_].mult(1-C).add(this.points[r].mult(C))}}function Gn(g,e){let r=!0;return g==="always"||g!=="never"&&e!=="never"||(r=!1),r}class An{constructor(e,r,c){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(r/c);for(let v=0;v<this.xCellCount*this.yCellCount;v++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,c,d,_){this._forEachCell(r,c,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(e,r,c,d){this._forEachCell(r-d,c-d,r+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(c),this.circles.push(d)}_insertBoxCell(e,r,c,d,_,v){this.boxCells[_].push(v)}_insertCircleCell(e,r,c,d,_,v){this.circleCells[_].push(v)}_query(e,r,c,d,_,v,k){if(c<0||e>this.width||d<0||r>this.height)return[];const C=[];if(e<=0&&r<=0&&this.width<=c&&this.height<=d){if(_)return[{key:null,x1:e,y1:r,x2:c,y2:d}];for(let R=0;R<this.boxKeys.length;R++)C.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],X=this.circles[3*R+1],Z=this.circles[3*R+2];C.push({key:this.circleKeys[R],x1:O-Z,y1:X-Z,x2:O+Z,y2:X+Z})}}else this._forEachCell(e,r,c,d,this._queryCell,C,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},k);return C}query(e,r,c,d){return this._query(e,r,c,d,!1,null)}hitTest(e,r,c,d,_,v){return this._query(e,r,c,d,!0,_,v).length>0}hitTestCircle(e,r,c,d,_){const v=e-c,k=e+c,C=r-c,R=r+c;if(k<0||v>this.width||R<0||C>this.height)return!1;const O=[];return this._forEachCell(v,C,k,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:d,circle:{x:e,y:r,radius:c},seenUids:{box:{},circle:{}}},_),O.length>0}_queryCell(e,r,c,d,_,v,k,C){const{seenUids:R,hitTest:O,overlapMode:X}=k,Z=this.boxCells[_];if(Z!==null){const ot=this.bboxes;for(const mt of Z)if(!R.box[mt]){R.box[mt]=!0;const gt=4*mt,yt=this.boxKeys[mt];if(e<=ot[gt+2]&&r<=ot[gt+3]&&c>=ot[gt+0]&&d>=ot[gt+1]&&(!C||C(yt))&&(!O||!Gn(X,yt.overlapMode))&&(v.push({key:yt,x1:ot[gt],y1:ot[gt+1],x2:ot[gt+2],y2:ot[gt+3]}),O))return!0}}const it=this.circleCells[_];if(it!==null){const ot=this.circles;for(const mt of it)if(!R.circle[mt]){R.circle[mt]=!0;const gt=3*mt,yt=this.circleKeys[mt];if(this._circleAndRectCollide(ot[gt],ot[gt+1],ot[gt+2],e,r,c,d)&&(!C||C(yt))&&(!O||!Gn(X,yt.overlapMode))){const Ct=ot[gt],zt=ot[gt+1],St=ot[gt+2];if(v.push({key:yt,x1:Ct-St,y1:zt-St,x2:Ct+St,y2:zt+St}),O)return!0}}}return!1}_queryCellCircle(e,r,c,d,_,v,k,C){const{circle:R,seenUids:O,overlapMode:X}=k,Z=this.boxCells[_];if(Z!==null){const ot=this.bboxes;for(const mt of Z)if(!O.box[mt]){O.box[mt]=!0;const gt=4*mt,yt=this.boxKeys[mt];if(this._circleAndRectCollide(R.x,R.y,R.radius,ot[gt+0],ot[gt+1],ot[gt+2],ot[gt+3])&&(!C||C(yt))&&!Gn(X,yt.overlapMode))return v.push(!0),!0}}const it=this.circleCells[_];if(it!==null){const ot=this.circles;for(const mt of it)if(!O.circle[mt]){O.circle[mt]=!0;const gt=3*mt,yt=this.circleKeys[mt];if(this._circlesCollide(ot[gt],ot[gt+1],ot[gt+2],R.x,R.y,R.radius)&&(!C||C(yt))&&!Gn(X,yt.overlapMode))return v.push(!0),!0}}}_forEachCell(e,r,c,d,_,v,k,C){const R=this._convertToXCellCoord(e),O=this._convertToYCellCoord(r),X=this._convertToXCellCoord(c),Z=this._convertToYCellCoord(d);for(let it=R;it<=X;it++)for(let ot=O;ot<=Z;ot++)if(_.call(this,e,r,c,d,this.xCellCount*ot+it,v,k,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,c,d,_,v){const k=d-e,C=_-r,R=c+v;return R*R>k*k+C*C}_circleAndRectCollide(e,r,c,d,_,v,k){const C=(v-d)/2,R=Math.abs(e-(d+C));if(R>C+c)return!1;const O=(k-_)/2,X=Math.abs(r-(_+O));if(X>O+c)return!1;if(R<=C||X<=O)return!0;const Z=R-C,it=X-O;return Z*Z+it*it<=c*c}}function di(g,e,r){const c=o.N();if(!g){const{vecSouth:X,vecEast:Z}=ke(e),it=$();it[0]=Z[0],it[1]=Z[1],it[2]=X[0],it[3]=X[1],d=it,(O=(v=(_=it)[0])*(R=_[3])-(C=_[2])*(k=_[1]))&&(d[0]=R*(O=1/O),d[1]=-k*O,d[2]=-C*O,d[3]=v*O),c[0]=it[0],c[1]=it[1],c[4]=it[2],c[5]=it[3]}var d,_,v,k,C,R,O;return o.Q(c,c,[1/r,1/r,1]),c}function Nn(g,e,r,c){if(g){const d=o.N();if(!e){const{vecSouth:_,vecEast:v}=ke(r);d[0]=v[0],d[1]=v[1],d[4]=_[0],d[5]=_[1]}return o.Q(d,d,[c,c,1]),d}return r.pixelsToClipSpaceMatrix}function ke(g){const e=Math.cos(g.rollInRadians),r=Math.sin(g.rollInRadians),c=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),v=o.aB();v[0]=-d*c*r-_*e,v[1]=-_*c*r+d*e;const k=o.aC(v);k<1e-9?o.aD(v):o.aE(v,v,1/k);const C=o.aB();C[0]=d*c*e-_*r,C[1]=_*c*e+d*r;const R=o.aC(C);return R<1e-9?o.aD(C):o.aE(C,C,1/R),{vecEast:C,vecSouth:v}}function je(g,e,r,c){let d;c?(d=[g,e,c(g,e),1],o.aG(d,d,r)):(d=[g,e,0,1],Zi(d,d,r));const _=d[3];return{point:new o.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Qe(g,e){return .5+g/e*.5}function Pi(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function or(g,e,r,c,d,_,v,k,C,R,O,X,Z){const it=r?g.textSizeData:g.iconSizeData,ot=o.ax(it,e.transform.zoom),mt=[256/e.width*2+1,256/e.height*2+1],gt=r?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;gt.clear();const yt=g.lineVertexArray,Ct=r?g.text.placedSymbolArray:g.icon.placedSymbolArray,zt=e.transform.width/e.transform.height;let St=!1;for(let Nt=0;Nt<Ct.length;Nt++){const Ft=Ct.get(Nt);if(Ft.hidden||Ft.writingMode===o.ay.vertical&&!St){Vr(Ft.numGlyphs,gt);continue}St=!1;const At=new o.P(Ft.anchorX,Ft.anchorY),qt={getElevation:Z,pitchedLabelPlaneMatrix:c,lineVertexArray:yt,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:At,unwrappedTileID:C,width:R,height:O,translation:X},oe=es(Ft.anchorX,Ft.anchorY,qt);if(!Pi(oe.point,mt)){Vr(Ft.numGlyphs,gt);continue}const ee=Qe(e.transform.cameraToCenterDistance,oe.signedDistanceFromCamera),ie=o.az(it,ot,Ft),ae=_?ie*e.transform.getPitchedTextCorrection(Ft.anchorX,Ft.anchorY,C)/ee:ie*ee,De=mr({projectionContext:qt,pitchedLabelPlaneMatrixInverse:d,symbol:Ft,fontSize:ae,flip:!1,keepUpright:v,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:gt,aspectRatio:zt,rotateToLine:k});St=De.useVertical,(De.notEnoughRoom||St||De.needsFlipping&&mr({projectionContext:qt,pitchedLabelPlaneMatrixInverse:d,symbol:Ft,fontSize:ae,flip:!0,keepUpright:v,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:gt,aspectRatio:zt,rotateToLine:k}).notEnoughRoom)&&Vr(Ft.numGlyphs,gt)}r?g.text.dynamicLayoutVertexBuffer.updateData(gt):g.icon.dynamicLayoutVertexBuffer.updateData(gt)}function Kn(g,e,r,c,d,_,v,k){const C=_.glyphStartIndex+_.numGlyphs,R=_.lineStartIndex,O=_.lineStartIndex+_.lineLength,X=e.getoffsetX(_.glyphStartIndex),Z=e.getoffsetX(C-1),it=Dn(g*X,r,c,d,_.segment,R,O,k,v);if(!it)return null;const ot=Dn(g*Z,r,c,d,_.segment,R,O,k,v);return ot?k.projectionCache.anyProjectionOccluded?null:{first:it,last:ot}:null}function rn(g,e,r,c){return g===o.ay.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*c?{useVertical:!0}:(g===o.ay.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function mr(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:d,flip:_,keepUpright:v,glyphOffsetArray:k,dynamicLayoutVertexArray:C,aspectRatio:R,rotateToLine:O}=g,X=d/24,Z=c.lineOffsetX*X,it=c.lineOffsetY*X;let ot;if(c.numGlyphs>1){const mt=c.glyphStartIndex+c.numGlyphs,gt=c.lineStartIndex,yt=c.lineStartIndex+c.lineLength,Ct=Kn(X,k,Z,it,_,c,O,e);if(!Ct)return{notEnoughRoom:!0};const zt=Is(Ct.first.point.x,Ct.first.point.y,e,r),St=Is(Ct.last.point.x,Ct.last.point.y,e,r);if(v&&!_){const Nt=rn(c.writingMode,zt,St,R);if(Nt)return Nt}ot=[Ct.first];for(let Nt=c.glyphStartIndex+1;Nt<mt-1;Nt++){const Ft=Dn(X*k.getoffsetX(Nt),Z,it,_,c.segment,gt,yt,e,O);if(!Ft)return{notEnoughRoom:!0};ot.push(Ft)}ot.push(Ct.last)}else{if(v&&!_){const gt=Tr(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,yt=c.lineStartIndex+c.segment+1,Ct=new o.P(e.lineVertexArray.getx(yt),e.lineVertexArray.gety(yt)),zt=Tr(Ct.x,Ct.y,e),St=zt.signedDistanceFromCamera>0?zt.point:Fr(e.tileAnchorPoint,Ct,gt,1,e),Nt=Is(gt.x,gt.y,e,r),Ft=Is(St.x,St.y,e,r),At=rn(c.writingMode,Nt,Ft,R);if(At)return At}const mt=Dn(X*k.getoffsetX(c.glyphStartIndex),Z,it,_,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,O);if(!mt||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ot=[mt]}for(const mt of ot)o.aF(C,mt.point,mt.angle);return{}}function Fr(g,e,r,c,d){const _=g.add(g.sub(e)._unit()),v=Tr(_.x,_.y,d).point,k=r.sub(v);return r.add(k._mult(c/k.mag()))}function Jn(g,e,r){const c=e.projectionCache;if(c.projections[g])return c.projections[g];const d=new o.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),_=Tr(d.x,d.y,e);if(_.signedDistanceFromCamera>0)return c.projections[g]=_.point,c.anyProjectionOccluded=c.anyProjectionOccluded||_.isOccluded,_.point;const v=g-r.direction;return Fr(r.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),d,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Tr(g,e,r){const c=g+r.translation[0],d=e+r.translation[1];let _;return r.pitchWithMap?(_=je(c,d,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(c,d,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function Is(g,e,r,c){if(r.pitchWithMap){const d=[g,e,0,1];return o.aG(d,d,c),r.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],r.unwrappedTileID,r.getElevation).point}return{x:g/r.width*2-1,y:1-e/r.height*2}}function es(g,e,r){return r.transform.projectTileCoordinates(g,e,r.unwrappedTileID,r.getElevation)}function Br(g,e,r){return g._unit()._perp()._mult(e*r)}function qi(g,e,r,c,d,_,v,k,C){if(k.projectionCache.offsets[g])return k.projectionCache.offsets[g];const R=r.add(e);if(g+C.direction<c||g+C.direction>=d)return k.projectionCache.offsets[g]=R,R;const O=Jn(g+C.direction,k,C),X=Br(O.sub(r),v,C.direction),Z=r.add(X),it=O.add(X);return k.projectionCache.offsets[g]=o.aH(_,R,Z,it)||R,k.projectionCache.offsets[g]}function Dn(g,e,r,c,d,_,v,k,C){const R=c?g-e:g+e;let O=R>0?1:-1,X=0;c&&(O*=-1,X=Math.PI),O<0&&(X+=Math.PI);let Z,it=O>0?_+d:_+d+1;k.projectionCache.cachedAnchorPoint?Z=k.projectionCache.cachedAnchorPoint:(Z=Tr(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=Z);let ot,mt,gt=Z,yt=Z,Ct=0,zt=0;const St=Math.abs(R),Nt=[];let Ft;for(;Ct+zt<=St;){if(it+=O,it<_||it>=v)return null;Ct+=zt,yt=gt,mt=ot;const oe={absOffsetX:St,direction:O,distanceFromAnchor:Ct,previousVertex:yt};if(gt=Jn(it,k,oe),r===0)Nt.push(yt),Ft=gt.sub(yt);else{let ee;const ie=gt.sub(yt);ee=ie.mag()===0?Br(Jn(it+O,k,oe).sub(gt),r,O):Br(ie,r,O),mt||(mt=yt.add(ee)),ot=qi(it,ee,gt,_,v,mt,r,k,oe),Nt.push(mt),Ft=ot.sub(mt)}zt=Ft.mag()}const At=Ft._mult((St-Ct)/zt)._add(mt||yt),qt=X+Math.atan2(gt.y-yt.y,gt.x-yt.x);return Nt.push(At),{point:At,angle:C?qt:0,path:Nt}}const sl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Vr(g,e){for(let r=0;r<g;r++){const c=e.length;e.resize(c+4),e.float32.set(sl,3*c)}}function Zi(g,e,r){const c=e[0],d=e[1];return g[0]=r[0]*c+r[4]*d+r[12],g[1]=r[1]*c+r[5]*d+r[13],g[3]=r[3]*c+r[7]*d+r[15],g}const Rn=100;class jr{constructor(e,r=new An(e.width+200,e.height+200,25),c=new An(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Rn,this.screenBottomBoundary=e.height+Rn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,c,d,_,v,k,C,R,O,X,Z){const it=this.projectAndGetPerspectiveRatio(e.anchorPointX+C[0],e.anchorPointY+C[1],_,O,Z),ot=c*it.perspectiveRatio;let mt;if(v||k)mt=this._projectCollisionBox(e,ot,d,_,v,k,C,it,O,X,Z);else{const Ft=it.x+(X?X.x*ot:0),At=it.y+(X?X.y*ot:0);mt={allPointsOccluded:!1,box:[Ft+e.x1*ot,At+e.y1*ot,Ft+e.x2*ot,At+e.y2*ot]}}const[gt,yt,Ct,zt]=mt.box,St=v?mt.allPointsOccluded:it.isOccluded;let Nt=St;return Nt||(Nt=it.perspectiveRatio<this.perspectiveRatioCutoff),Nt||(Nt=!this.isInsideGrid(gt,yt,Ct,zt)),Nt||r!=="always"&&this.grid.hitTest(gt,yt,Ct,zt,r,R)?{box:[gt,yt,Ct,zt],placeable:!1,offscreen:!1,occluded:St}:{box:[gt,yt,Ct,zt],placeable:!0,offscreen:this.isOffscreen(gt,yt,Ct,zt),occluded:St}}placeCollisionCircles(e,r,c,d,_,v,k,C,R,O,X,Z,it,ot){const mt=[],gt=new o.P(r.anchorX,r.anchorY),yt=this.getPerspectiveRatio(gt.x,gt.y,v,ot),Ct=(R?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,v)/yt:_*yt)/o.aL,zt={getElevation:ot,pitchedLabelPlaneMatrix:k,lineVertexArray:c,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:gt,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:it},St=Kn(Ct,d,r.lineOffsetX*Ct,r.lineOffsetY*Ct,!1,r,!1,zt);let Nt=!1,Ft=!1,At=!0;if(St){const qt=.5*X*yt+Z,oe=new o.P(-100,-100),ee=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ie=new we,ae=St.first,De=St.last;let Me=[];for(let hn=ae.path.length-1;hn>=1;hn--)Me.push(ae.path[hn]);for(let hn=1;hn<De.path.length;hn++)Me.push(De.path[hn]);const ve=2.5*qt;if(R){const hn=this.projectPathToScreenSpace(Me,zt);Me=hn.some((on=>on.signedDistanceFromCamera<=0))?[]:hn.map((on=>on.point))}let Ze=[];if(Me.length>0){const hn=Me[0].clone(),on=Me[0].clone();for(let Yn=1;Yn<Me.length;Yn++)hn.x=Math.min(hn.x,Me[Yn].x),hn.y=Math.min(hn.y,Me[Yn].y),on.x=Math.max(on.x,Me[Yn].x),on.y=Math.max(on.y,Me[Yn].y);Ze=hn.x>=oe.x&&on.x<=ee.x&&hn.y>=oe.y&&on.y<=ee.y?[Me]:on.x<oe.x||hn.x>ee.x||on.y<oe.y||hn.y>ee.y?[]:o.aI([Me],oe.x,oe.y,ee.x,ee.y)}for(const hn of Ze){ie.reset(hn,.25*qt);let on=0;on=ie.length<=.5*qt?1:Math.ceil(ie.paddedLength/ve)+1;for(let Yn=0;Yn<on;Yn++){const Hn=Yn/Math.max(on-1,1),ri=ie.lerp(Hn),Wn=ri.x+Rn,Ci=ri.y+Rn;mt.push(Wn,Ci,qt,0);const ti=Wn-qt,Ii=Ci-qt,mi=Wn+qt,Ti=Ci+qt;if(At=At&&this.isOffscreen(ti,Ii,mi,Ti),Ft=Ft||this.isInsideGrid(ti,Ii,mi,Ti),e!=="always"&&this.grid.hitTestCircle(Wn,Ci,qt,e,O)&&(Nt=!0,!C))return{circles:[],offscreen:!1,collisionDetected:Nt}}}}return{circles:!C&&Nt||!Ft||yt<this.perspectiveRatioCutoff?[]:mt,offscreen:At,collisionDetected:Nt}}projectPathToScreenSpace(e,r){const c=(function(d,_){const v=o.N();return o.aA(v,_.pitchedLabelPlaneMatrix),d.map((k=>{const C=je(k.x,k.y,v,_.getElevation),R=_.transform.projectTileCoordinates(C.point.x,C.point.y,_.unwrappedTileID,_.getElevation);return R.point.x=(.5*R.point.x+.5)*_.width,R.point.y=(.5*-R.point.y+.5)*_.height,R}))})(e,r);return(function(d){let _=0,v=0,k=0,C=0;for(let R=0;R<d.length;R++)d[R].isOccluded?(k=R+1,C=0):(C++,C>v&&(v=C,_=k));return d.slice(_,_+v)})(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],c=new o.ab;for(const X of e){const Z=new o.P(X.x+Rn,X.y+Rn);c.extend(Z),r.push(Z)}const{minX:d,minY:_,maxX:v,maxY:k}=c,C=this.grid.query(d,_,v,k).concat(this.ignoredGrid.query(d,_,v,k)),R={},O={};for(const X of C){const Z=X.key;if(R[Z.bucketInstanceId]===void 0&&(R[Z.bucketInstanceId]={}),R[Z.bucketInstanceId][Z.featureIndex])continue;const it=[new o.P(X.x1,X.y1),new o.P(X.x2,X.y1),new o.P(X.x2,X.y2),new o.P(X.x1,X.y2)];o.aJ(r,it)&&(R[Z.bucketInstanceId][Z.featureIndex]=!0,O[Z.bucketInstanceId]===void 0&&(O[Z.bucketInstanceId]=[]),O[Z.bucketInstanceId].push(Z.featureIndex))}return O}insertCollisionBox(e,r,c,d,_,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:v,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,c,d,_,v){const k=c?this.ignoredGrid:this.grid,C={bucketInstanceId:d,featureIndex:_,collisionGroupID:v,overlapMode:r};for(let R=0;R<e.length;R+=4)k.insertCircle(C,e[R],e[R+1],e[R+2])}projectAndGetPerspectiveRatio(e,r,c,d,_){if(_){let v;d?(v=[e,r,d(e,r),1],o.aG(v,v,_)):(v=[e,r,0,1],Zi(v,v,_));const k=v[3];return{x:(v[0]/k+1)/2*this.transform.width+Rn,y:(-v[1]/k+1)/2*this.transform.height+Rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}{const v=this.transform.projectTileCoordinates(e,r,c,d);return{x:(v.point.x+1)/2*this.transform.width+Rn,y:(1-v.point.y)/2*this.transform.height+Rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,c,d){const _=this.transform.projectTileCoordinates(e,r,c,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,r,c,d){return c<Rn||e>=this.screenRightBoundary||d<Rn||r>this.screenBottomBoundary}isInsideGrid(e,r,c,d){return c>=0&&e<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=o.ar([]);return o.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,c,d,_,v,k,C,R,O,X){let Z=1,it=0,ot=0,mt=1;const gt=e.anchorPointX+k[0],yt=e.anchorPointY+k[1];if(v&&!_){const Me=this.projectAndGetPerspectiveRatio(gt+1,yt,d,R,X),ve=Me.x-C.x,Ze=Math.atan((Me.y-C.y)/ve)+(ve<0?Math.PI:0),hn=Math.sin(Ze),on=Math.cos(Ze);Z=on,it=hn,ot=-hn,mt=on}else if(!v&&_){const Me=ke(this.transform);Z=Me.vecEast[0],it=Me.vecEast[1],ot=Me.vecSouth[0],mt=Me.vecSouth[1]}let Ct=C.x,zt=C.y,St=r;_&&(Ct=gt,zt=yt,St=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),St*=this.transform.getPitchedTextCorrection(gt,yt,d),O||(St*=o.an(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(Ct+=Z*O.x*St+ot*O.y*St,zt+=it*O.x*St+mt*O.y*St);const Nt=e.x1*St,Ft=e.x2*St,At=(Nt+Ft)/2,qt=e.y1*St,oe=e.y2*St,ee=(qt+oe)/2,ie=[{offsetX:Nt,offsetY:qt},{offsetX:At,offsetY:qt},{offsetX:Ft,offsetY:qt},{offsetX:Ft,offsetY:ee},{offsetX:Ft,offsetY:oe},{offsetX:At,offsetY:oe},{offsetX:Nt,offsetY:oe},{offsetX:Nt,offsetY:ee}];let ae=[];for(const{offsetX:Me,offsetY:ve}of ie)ae.push(new o.P(Ct+Z*Me+ot*ve,zt+it*Me+mt*ve));let De=!1;if(_){const Me=ae.map((ve=>this.projectAndGetPerspectiveRatio(ve.x,ve.y,d,R,X)));De=Me.some((ve=>!ve.isOccluded)),ae=Me.map((ve=>new o.P(ve.x,ve.y)))}else De=!0;return{box:o.aK(ae),allPointsOccluded:!De}}}class ds{constructor(e,r,c,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class fs{constructor(e,r,c,d,_){this.text=new ds(e?e.text:null,r,c,_),this.icon=new ds(e?e.icon:null,r,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ao{constructor(e,r,c){this.text=e,this.icon=r,this.skipFade=c}}class Us{constructor(e,r,c,d,_){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=_}}class al{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[e]}}function oo(g,e,r,c,d){const{horizontalAlign:_,verticalAlign:v}=o.aR(g);return new o.P(-(_-.5)*e+c[0]*d,-(v-.5)*r+c[1]*d)}class ol{constructor(e,r,c,d,_){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new jr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new al(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(c,d)=>r.getElevation(e,c,d):null}getBucketParts(e,r,c,d){const _=c.getBucket(r),v=c.latestFeatureIndex;if(!_||!v||r.id!==_.layerIds[0])return;const k=c.collisionBoxArray,C=_.layers[0].layout,R=_.layers[0].paint,O=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/o.a4,Z=c.tileID.toUnwrapped(),it=C.get("text-rotation-alignment")==="map",ot=o.aM(c,1,this.transform.zoom),mt=o.aN(this.collisionIndex.transform,c,R.get("text-translate"),R.get("text-translate-anchor")),gt=o.aN(this.collisionIndex.transform,c,R.get("icon-translate"),R.get("icon-translate-anchor")),yt=di(it,this.transform,ot);this.retainedQueryData[_.bucketInstanceId]=new Us(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,c.tileID);const Ct={bucket:_,layout:C,translationText:mt,translationIcon:gt,unwrappedTileID:Z,pitchedLabelPlaneMatrix:yt,scale:O,textPixelRatio:X,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:o.ax(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const zt of _.sortKeyRanges){const{sortKey:St,symbolInstanceStart:Nt,symbolInstanceEnd:Ft}=zt;e.push({sortKey:St,symbolInstanceStart:Nt,symbolInstanceEnd:Ft,parameters:Ct})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Ct})}attemptAnchorPlacement(e,r,c,d,_,v,k,C,R,O,X,Z,it,ot,mt,gt,yt,Ct,zt,St){const Nt=o.aO[e.textAnchor],Ft=[e.textOffset0,e.textOffset1],At=oo(Nt,c,d,Ft,_),qt=this.collisionIndex.placeCollisionBox(r,Z,C,R,O,k,v,gt,X.predicate,zt,At,St);if((!Ct||this.collisionIndex.placeCollisionBox(Ct,Z,C,R,O,k,v,yt,X.predicate,zt,At,St).placeable)&&qt.placeable){let oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[it.crossTileID]&&this.prevPlacement.placements[it.crossTileID]&&this.prevPlacement.placements[it.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[it.crossTileID].anchor),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[it.crossTileID]={textOffset:Ft,width:c,height:d,anchor:Nt,textBoxScale:_,prevAnchor:oe},this.markUsedJustification(ot,Nt,it,mt),ot.allowVerticalPlacement&&(this.markUsedOrientation(ot,mt,it),this.placedOrientations[it.crossTileID]=mt),{shift:At,placedGlyphBoxes:qt}}}placeLayerBucketPart(e,r,c){const{bucket:d,layout:_,translationText:v,translationIcon:k,unwrappedTileID:C,pitchedLabelPlaneMatrix:R,textPixelRatio:O,holdingForFade:X,collisionBoxArray:Z,partiallyEvaluatedTextSize:it,collisionGroup:ot}=e.parameters,mt=_.get("text-optional"),gt=_.get("icon-optional"),yt=o.aP(_,"text-overlap","text-allow-overlap"),Ct=yt==="always",zt=o.aP(_,"icon-overlap","icon-allow-overlap"),St=zt==="always",Nt=_.get("text-rotation-alignment")==="map",Ft=_.get("text-pitch-alignment")==="map",At=_.get("icon-text-fit")!=="none",qt=_.get("symbol-z-order")==="viewport-y",oe=Ct&&(St||!d.hasIconData()||gt),ee=St&&(Ct||!d.hasTextData()||mt);!d.collisionArrays&&Z&&d.deserializeCollisionBoxes(Z);const ie=this.retainedQueryData[d.bucketInstanceId].tileID,ae=this._getTerrainElevationFunc(ie),De=this.transform.getFastPathSimpleProjectionMatrix(ie),Me=(ve,Ze,hn)=>{var on,Yn;if(r[ve.crossTileID])return;if(X)return void(this.placements[ve.crossTileID]=new ao(!1,!1,!1));let Hn=!1,ri=!1,Wn=!0,Ci=null,ti={box:null,placeable:!1,offscreen:null,occluded:!1},Ii={placeable:!1},mi=null,Ti=null,xr=null,Rs=0,vs=0,ta=0;Ze.textFeatureIndex?Rs=Ze.textFeatureIndex:ve.useRuntimeCollisionCircles&&(Rs=ve.featureIndex),Ze.verticalTextFeatureIndex&&(vs=Ze.verticalTextFeatureIndex);const ea=Ze.textBox;if(ea){const Dr=ci=>{let si=o.ay.horizontal;if(d.allowVerticalPlacement&&!ci&&this.prevPlacement){const Ai=this.prevPlacement.placedOrientations[ve.crossTileID];Ai&&(this.placedOrientations[ve.crossTileID]=Ai,si=Ai,this.markUsedOrientation(d,si,ve))}return si},Ns=(ci,si)=>{if(d.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&Ze.verticalTextBox){for(const Ai of d.writingModes)if(Ai===o.ay.vertical?(ti=si(),Ii=ti):ti=ci(),ti&&ti.placeable)break}else ti=ci()},ka=ve.textAnchorOffsetStartIndex,Ma=ve.textAnchorOffsetEndIndex;if(Ma===ka){const ci=(si,Ai)=>{const Xn=this.collisionIndex.placeCollisionBox(si,yt,O,ie,C,Ft,Nt,v,ot.predicate,ae,void 0,De);return Xn&&Xn.placeable&&(this.markUsedOrientation(d,Ai,ve),this.placedOrientations[ve.crossTileID]=Ai),Xn};Ns((()=>ci(ea,o.ay.horizontal)),(()=>{const si=Ze.verticalTextBox;return d.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&si?ci(si,o.ay.vertical):{box:null,offscreen:null}})),Dr(ti&&ti.placeable)}else{let ci=o.aO[(Yn=(on=this.prevPlacement)===null||on===void 0?void 0:on.variableOffsets[ve.crossTileID])===null||Yn===void 0?void 0:Yn.anchor];const si=(Xn,na,qc)=>{const Zc=Xn.x2-Xn.x1,$c=Xn.y2-Xn.y1,Pa=ve.textBoxScale,td=At&&zt==="never"?na:null;let ia=null,Ol=yt==="never"?1:2,Vu="never";ci&&Ol++;for(let ra=0;ra<Ol;ra++){for(let Os=ka;Os<Ma;Os++){const ju=d.textAnchorOffsets.get(Os);if(ci&&ju.textAnchor!==ci)continue;const Gu=this.attemptAnchorPlacement(ju,Xn,Zc,$c,Pa,Nt,Ft,O,ie,C,ot,Vu,ve,d,qc,v,k,td,ae);if(Gu&&(ia=Gu.placedGlyphBoxes,ia&&ia.placeable))return Hn=!0,Ci=Gu.shift,ia}ci?ci=null:Vu=yt}return c&&!ia&&(ia={box:this.collisionIndex.placeCollisionBox(ea,"always",O,ie,C,Ft,Nt,v,ot.predicate,ae,void 0,De).box,offscreen:!1,placeable:!1,occluded:!1}),ia};Ns((()=>si(ea,Ze.iconBox,o.ay.horizontal)),(()=>{const Xn=Ze.verticalTextBox;return d.allowVerticalPlacement&&(!ti||!ti.placeable)&&ve.numVerticalGlyphVertices>0&&Xn?si(Xn,Ze.verticalIconBox,o.ay.vertical):{box:null,occluded:!0,offscreen:null}})),ti&&(Hn=ti.placeable,Wn=ti.offscreen);const Ai=Dr(ti&&ti.placeable);if(!Hn&&this.prevPlacement){const Xn=this.prevPlacement.variableOffsets[ve.crossTileID];Xn&&(this.variableOffsets[ve.crossTileID]=Xn,this.markUsedJustification(d,Xn.anchor,ve,Ai))}}}if(mi=ti,Hn=mi&&mi.placeable,Wn=mi&&mi.offscreen,ve.useRuntimeCollisionCircles&&ve.centerJustifiedTextSymbolIndex>=0){const Dr=d.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex),Ns=o.az(d.textSizeData,it,Dr),ka=_.get("text-padding");Ti=this.collisionIndex.placeCollisionCircles(yt,Dr,d.lineVertexArray,d.glyphOffsetArray,Ns,C,R,c,Ft,ot.predicate,ve.collisionCircleDiameter,ka,v,ae),Ti.circles.length&&Ti.collisionDetected&&!c&&o.w("Collisions detected, but collision boxes are not shown"),Hn=Ct||Ti.circles.length>0&&!Ti.collisionDetected,Wn=Wn&&Ti.offscreen}if(Ze.iconFeatureIndex&&(ta=Ze.iconFeatureIndex),Ze.iconBox){const Dr=Ns=>this.collisionIndex.placeCollisionBox(Ns,zt,O,ie,C,Ft,Nt,k,ot.predicate,ae,At&&Ci?Ci:void 0,De);Ii&&Ii.placeable&&Ze.verticalIconBox?(xr=Dr(Ze.verticalIconBox),ri=xr.placeable):(xr=Dr(Ze.iconBox),ri=xr.placeable),Wn=Wn&&xr.offscreen}const Ea=mt||ve.numHorizontalGlyphVertices===0&&ve.numVerticalGlyphVertices===0,Qr=gt||ve.numIconVertices===0;Ea||Qr?Qr?Ea||(ri=ri&&Hn):Hn=ri&&Hn:ri=Hn=ri&&Hn;const zs=ri&&xr.placeable;if(Hn&&mi.placeable&&this.collisionIndex.insertCollisionBox(mi.box,yt,_.get("text-ignore-placement"),d.bucketInstanceId,Ii&&Ii.placeable&&vs?vs:Rs,ot.ID),zs&&this.collisionIndex.insertCollisionBox(xr.box,zt,_.get("icon-ignore-placement"),d.bucketInstanceId,ta,ot.ID),Ti&&Hn&&this.collisionIndex.insertCollisionCircles(Ti.circles,yt,_.get("text-ignore-placement"),d.bucketInstanceId,Rs,ot.ID),c&&this.storeCollisionData(d.bucketInstanceId,hn,Ze,mi,xr,Ti),ve.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ve.crossTileID]=new ao((Hn||oe)&&!mi?.occluded,(ri||ee)&&!xr?.occluded,Wn||d.justReloaded),r[ve.crossTileID]=!0};if(qt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ve=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ze=ve.length-1;Ze>=0;--Ze){const hn=ve[Ze];Me(d.symbolInstances.get(hn),d.collisionArrays[hn],hn)}}else for(let ve=e.symbolInstanceStart;ve<e.symbolInstanceEnd;ve++)Me(d.symbolInstances.get(ve),d.collisionArrays[ve],ve);d.justReloaded=!1}storeCollisionData(e,r,c,d,_,v){if(c.textBox||c.iconBox){let k,C;this.collisionBoxArrays.has(e)?k=this.collisionBoxArrays.get(e):(k=new Map,this.collisionBoxArrays.set(e,k)),k.has(r)?C=k.get(r):(C={text:null,icon:null},k.set(r,C)),c.textBox&&(C.text=d.box),c.iconBox&&(C.icon=_.box)}if(v){let k=this.collisionCircleArrays[e];k===void 0&&(k=this.collisionCircleArrays[e]=[]);for(let C=0;C<v.circles.length;C+=4)k.push(v.circles[C+0]-Rn),k.push(v.circles[C+1]-Rn),k.push(v.circles[C+2]),k.push(v.collisionDetected?1:0)}}markUsedJustification(e,r,c,d){let _;_=d===o.ay.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[o.aQ(r)];const v=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const k of v)k>=0&&(e.text.placedSymbolArray.get(k).crossTileID=_>=0&&k!==_?0:c.crossTileID)}markUsedOrientation(e,r,c){const d=r===o.ay.horizontal||r===o.ay.horizontalOnly?r:0,_=r===o.ay.vertical?r:0,v=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const k of v)e.text.placedSymbolArray.get(k).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(e):1,_=r?r.opacities:{},v=r?r.variableOffsets:{},k=r?r.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],O=_[C];O?(this.opacities[C]=new fs(O,d,R.text,R.icon),c=c||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[C]=new fs(null,d,R.text,R.icon,R.skipFade),c=c||R.text||R.icon)}for(const C in _){const R=_[C];if(!this.opacities[C]){const O=new fs(R,d,!1,!1);O.isHidden()||(this.opacities[C]=O,c=c||R.text.placed||R.icon.placed)}}for(const C in v)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=v[C]);for(const C in k)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=k[C]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const c={};for(const d of r){const _=d.getBucket(e);_&&d.latestFeatureIndex&&e.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,c,d.collisionBoxArray)}}updateBucketOpacities(e,r,c,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const _=e.layers[0],v=_.layout,k=new fs(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),R=v.get("icon-allow-overlap"),O=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=v.get("text-rotation-alignment")==="map",Z=v.get("text-pitch-alignment")==="map",it=v.get("icon-text-fit")!=="none",ot=new fs(null,0,C&&(R||!e.hasIconData()||v.get("icon-optional")),R&&(C||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const mt=(yt,Ct,zt)=>{for(let St=0;St<Ct/4;St++)yt.opacityVertexArray.emplaceBack(zt);yt.hasVisibleVertices=yt.hasVisibleVertices||zt!==Ur},gt=this.collisionBoxArrays.get(e.bucketInstanceId);for(let yt=0;yt<e.symbolInstances.length;yt++){const Ct=e.symbolInstances.get(yt),{numHorizontalGlyphVertices:zt,numVerticalGlyphVertices:St,crossTileID:Nt}=Ct;let Ft=this.opacities[Nt];c[Nt]?Ft=k:Ft||(Ft=ot,this.opacities[Nt]=Ft),c[Nt]=!0;const At=Ct.numIconVertices>0,qt=this.placedOrientations[Ct.crossTileID],oe=qt===o.ay.vertical,ee=qt===o.ay.horizontal||qt===o.ay.horizontalOnly;if(zt>0||St>0){const ae=ul(Ft.text);mt(e.text,zt,oe?Ur:ae),mt(e.text,St,ee?Ur:ae);const De=Ft.text.isHidden();[Ct.rightJustifiedTextSymbolIndex,Ct.centerJustifiedTextSymbolIndex,Ct.leftJustifiedTextSymbolIndex].forEach((Ze=>{Ze>=0&&(e.text.placedSymbolArray.get(Ze).hidden=De||oe?1:0)})),Ct.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Ct.verticalPlacedTextSymbolIndex).hidden=De||ee?1:0);const Me=this.variableOffsets[Ct.crossTileID];Me&&this.markUsedJustification(e,Me.anchor,Ct,qt);const ve=this.placedOrientations[Ct.crossTileID];ve&&(this.markUsedJustification(e,"left",Ct,ve),this.markUsedOrientation(e,ve,Ct))}if(At){const ae=ul(Ft.icon),De=!(it&&Ct.verticalPlacedIconSymbolIndex&&oe);Ct.placedIconSymbolIndex>=0&&(mt(e.icon,Ct.numIconVertices,De?ae:Ur),e.icon.placedSymbolArray.get(Ct.placedIconSymbolIndex).hidden=Ft.icon.isHidden()),Ct.verticalPlacedIconSymbolIndex>=0&&(mt(e.icon,Ct.numVerticalIconVertices,De?Ur:ae),e.icon.placedSymbolArray.get(Ct.verticalPlacedIconSymbolIndex).hidden=Ft.icon.isHidden())}const ie=gt&&gt.has(yt)?gt.get(yt):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ae=e.collisionArrays[yt];if(ae){let De=new o.P(0,0);if(ae.textBox||ae.verticalTextBox){let Me=!0;if(O){const ve=this.variableOffsets[Nt];ve?(De=oo(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textBoxScale),X&&De._rotate(Z?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Me=!1}if(ae.textBox||ae.verticalTextBox){let ve;ae.textBox&&(ve=oe),ae.verticalTextBox&&(ve=ee),ua(e.textCollisionBox.collisionVertexArray,Ft.text.placed,!Me||ve,ie.text,De.x,De.y)}}if(ae.iconBox||ae.verticalIconBox){const Me=!!(!ee&&ae.verticalIconBox);let ve;ae.iconBox&&(ve=Me),ae.verticalIconBox&&(ve=!Me),ua(e.iconCollisionBox.collisionVertexArray,Ft.icon.placed,ve,ie.icon,it?De.x:0,it?De.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function ua(g,e,r,c,d,_){c&&c.length!==0||(c=[0,0,0,0]);const v=c[0]-Rn,k=c[1]-Rn,C=c[2]-Rn,R=c[3]-Rn;g.emplaceBack(e?1:0,r?1:0,d||0,_||0,v,k),g.emplaceBack(e?1:0,r?1:0,d||0,_||0,C,k),g.emplaceBack(e?1:0,r?1:0,d||0,_||0,C,R),g.emplaceBack(e?1:0,r?1:0,d||0,_||0,v,R)}const Gr=Math.pow(2,25),ns=Math.pow(2,24),Oa=Math.pow(2,17),ps=Math.pow(2,16),ll=Math.pow(2,9),lo=Math.pow(2,8),uo=Math.pow(2,1);function ul(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,r=Math.floor(127*g.opacity);return r*Gr+e*ns+r*Oa+e*ps+r*ll+e*lo+r*uo+e}const Ur=0;class ms{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,c,d,_){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(v,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((k,C)=>k.sortKey-C.sortKey)));this._currentPartIndex<v.length;)if(r.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,_())return!0;return!1}}class co{constructor(e,r,c,d,_,v,k,C){this.placement=new ol(e,r,v,k,C),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(e,r,c){const d=J(),_=()=>!this._forceFullPlacement&&J()-d>2;for(;this._currentPlacementIndex>=0;){const v=r[e[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=k)&&(!v.maxzoom||v.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new ms(v)),this._inProgressLayer.continuePlacement(c[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const qr=512/o.a4/2;class ho{constructor(e,r,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};const d=new Map;for(let _=0;_<r.length;_++){const v=r.get(_),k=v.key,C=d.get(k);C?C.push(v):d.set(k,[v])}for(const[_,v]of d){const k={positions:v.map((C=>({x:Math.floor(C.anchorX*qr),y:Math.floor(C.anchorY*qr)}))),crossTileIDs:v.map((C=>C.crossTileID))};if(k.positions.length>128){const C=new o.aS(k.positions.length,16,Uint16Array);for(const{x:R,y:O}of k.positions)C.add(R,O);C.finish(),delete k.positions,k.index=C}this._symbolsByKey[_]=k}}getScaledCoordinates(e,r){const{x:c,y:d,z:_}=this.tileID.canonical,{x:v,y:k,z:C}=r.canonical,R=qr/Math.pow(2,C-_),O=(k*o.a4+e.anchorY)*R,X=d*o.a4*qr;return{x:Math.floor((v*o.a4+e.anchorX)*R-c*o.a4*qr),y:Math.floor(O-X)}}findMatches(e,r,c){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<e.length;_++){const v=e.get(_);if(v.crossTileID)continue;const k=this._symbolsByKey[v.key];if(!k)continue;const C=this.getScaledCoordinates(v,r);if(k.index){const R=k.index.range(C.x-d,C.y-d,C.x+d,C.y+d).sort();for(const O of R){const X=k.crossTileIDs[O];if(!c[X]){c[X]=!0,v.crossTileID=X;break}}}else if(k.positions)for(let R=0;R<k.positions.length;R++){const O=k.positions[R],X=k.crossTileIDs[R];if(Math.abs(O.x-C.x)<=d&&Math.abs(O.y-C.y)<=d&&!c[X]){c[X]=!0,v.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class hu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const c in this.indexes){const d=this.indexes[c],_={};for(const v in d){const k=d[v];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+r),_[k.tileID.key]=k}this.indexes[c]=_}this.lng=e}addBucket(e,r,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>e.overscaledZ)for(const k in v){const C=v[k];C.tileID.isChildOf(e)&&C.findMatches(r.symbolInstances,e,d)}else{const k=v[e.scaledTo(Number(_)).key];k&&k.findMatches(r.symbolInstances,e,d)}}for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_);v.crossTileID||(v.crossTileID=c.generate(),d[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ho(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const c of r.getCrossTileIDsLists())for(const d of c)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let r=!1;for(const c in this.indexes){const d=this.indexes[c];for(const _ in d)e[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[_]),delete d[_],r=!0)}return r}}class Ln{constructor(){this.layerIndexes={},this.crossTileIDs=new hu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,c){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new Zr);let _=!1;const v={};d.handleWrapJump(c);for(const k of r){const C=k.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(k.tileID,C,this.crossTileIDs)&&(_=!0),v[C.bucketInstanceId]=!0)}return d.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(e){const r={};e.forEach((c=>{r[c]=!0}));for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var un="void main() {fragColor=vec4(1.0);}";const gr={prelude:wn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wn(un,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:wn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:wn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wn(un,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:wn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wn(g,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(d):d,k={};return{fragmentSource:g=g.replace(r,((C,R,O,X,Z)=>(k[Z]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${O} ${X} ${Z};
#else
uniform ${O} ${X} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${O} ${X} ${Z} = u_${Z};
#endif
`))),vertexSource:e=e.replace(r,((C,R,O,X,Z)=>{const it=X==="float"?"vec2":"vec4",ot=Z.match(/color/)?"color":it;return k[Z]?R==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${O} ${it} a_${Z};
out ${O} ${X} ${Z};
#else
uniform ${O} ${X} u_${Z};
#endif
`:ot==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${O} ${X} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${ot}(a_${Z}, u_${Z}_t);
#else
    ${O} ${X} ${Z} = u_${Z};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${O} ${it} a_${Z};
#else
uniform ${O} ${X} u_${Z};
#endif
`:ot==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${O} ${X} ${Z} = a_${Z};
#else
    ${O} ${X} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${O} ${X} ${Z} = unpack_mix_${ot}(a_${Z}, u_${Z}_t);
#else
    ${O} ${X} ${Z} = u_${Z};
#endif
`})),staticAttributes:c,staticUniforms:v}}class _i{constructor(e,r,c){this.vertexBuffer=e,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Cn=o.aT([{name:"a_pos",type:"Int16",components:2}]);const yi="#define PROJECTION_MERCATOR",Oi="mercator";class vi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Oi}get shaderDefine(){return yi}get shaderPreludeCode(){return gr.projectionMercator}get vertexShaderPreludeCode(){return gr.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aU.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,c,d,_){if(this._cachedMesh)return this._cachedMesh;const v=new o.aV;v.emplaceBack(0,0),v.emplaceBack(o.a4,0),v.emplaceBack(0,o.a4),v.emplaceBack(o.a4,o.a4);const k=e.createVertexBuffer(v,Cn.members),C=o.aW.simpleSegment(0,0,4,2),R=new o.aX;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const O=e.createIndexBuffer(R);return this._cachedMesh=new _i(k,O,C),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class On{constructor(e=0,r=0,c=0,d=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=c,this.right=d}interpolate(e,r,c){return r.top!=null&&e.top!=null&&(this.top=o.G.number(e.top,r.top,c)),r.bottom!=null&&e.bottom!=null&&(this.bottom=o.G.number(e.bottom,r.bottom,c)),r.left!=null&&e.left!=null&&(this.left=o.G.number(e.left,r.left,c)),r.right!=null&&e.right!=null&&(this.right=o.G.number(e.right,r.right,c)),this}getCenter(e,r){const c=o.an((this.left+e-this.right)/2,0,e),d=o.an((this.top+r-this.bottom)/2,0,r);return new o.P(c,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new On(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ts(g,e){if(!g.renderWorldCopies||g.lngRange)return;const r=e.lng-g.center.lng;e.lng+=r>180?-360:r<-180?360:0}function $i(g){return Math.max(0,Math.floor(g))}class Wi{constructor(e,r){var c;this.applyConstrain=(d,_)=>this._constrainOverride!==null?this._constrainOverride(d,_):this._callbacks.defaultConstrain(d,_),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=r?.renderWorldCopies===void 0||!!r?.renderWorldCopies,this._minZoom=r?.minZoom||0,this._maxZoom=r?.maxZoom||22,this._minPitch=r?.minPitch==null?0:r?.minPitch,this._maxPitch=r?.maxPitch==null?60:r?.maxPitch,this._constrainOverride=(c=r?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=$i(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new On,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,c){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=$i(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new On(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,r&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=o.W(e,-180,180)*Math.PI/180;var c,d,_,v,k,C,R,O,X;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=$(),c=this._rotationMatrix,_=-this._bearingInRadians,v=(d=this._rotationMatrix)[0],k=d[1],C=d[2],R=d[3],O=Math.sin(_),X=Math.cos(_),c[0]=v*X+C*O,c[1]=k*X+R*O,c[2]=v*-O+C*X,c[3]=k*-O+R*X)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=o.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aY(this._fovInRadians)}setFov(e){e=o.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.applyConstrain(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=o.aq(r),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,c){this._unmodified=!1,this._edgeInsets.interpolate(e,r,c),this.constrainInternal(),this._calcMatrices()}resize(e,r,c=!0){this._width=e,this._height=r,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Pt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.ao,o.ao])}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:c,minY:d,maxX:_,maxY:v}=o.ab.fromPoints(r).extend(e);return[new o.P(c,d),new o.P(_,d),new o.P(_,v),new o.P(c,v),new o.P(c,d)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ar(new Float64Array(16));o.Q(e,e,[this._width/2,-this._height/2,1]),o.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ar(new Float64Array(16)),o.Q(e,e,[1,-1,1]),o.O(e,e,[-1,-1,0]),o.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,c,d){const _=c!==void 0?c:this.bearing,v=d=d!==void 0?d:this.pitch,k=o.aa.fromLngLat(e,r),C=-Math.cos(o.ap(v)),R=Math.sin(o.ap(v)),O=R*Math.sin(o.ap(_)),X=-R*Math.cos(o.ap(_));let Z=this.elevation;const it=r-Z;let ot;C*it>=0||Math.abs(C)<.1?(ot=1e4,Z=r+ot*C):ot=-it/C;let mt,gt,yt=o.aZ(1,k.y),Ct=0;do{if(Ct+=1,Ct>10)break;gt=ot/yt,mt=new o.aa(k.x+O*gt,k.y+X*gt),yt=1/mt.meterInMercatorCoordinateUnits()}while(Math.abs(ot-gt*yt)>1e-12);return{center:mt.toLngLat(),elevation:Z,zoom:o.at(this.height/2/Math.tan(this.fovInRadians/2)/gt/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=o.as(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,d=o.aa.fromLngLat(this.center,this.elevation),_=Ut(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;const v=this.calculateCenterFromCameraLngLatAlt(_.toLngLat(),o.aZ(_.z,d.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=o.as(1,this.center.lat)*this.worldSize;return Ut(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/o.a4,1/r/o.a4]}}class cn{constructor(e,r){this.min=e,this.max=r,this.center=o.a_([],o.a$([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],c=o.b0(this.min),d=o.b0(this.max);for(let _=0;_<r.length;_++)c[_]=r[_]?this.min[_]:this.center[_],d[_]=r[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new cn(c,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let c=0;c<e.planes.length;c++){const d=this.intersectsPlane(e.planes[c]);if(d===0)return 0;d===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],c=e[3];for(let d=0;d<3;d++)e[d]>0?(r+=e[d]*this.min[d],c+=e[d]*this.max[d]):(c+=e[d]*this.min[d],r+=e[d]*this.max[d]);return r>=0?2:c<0?0:1}}class Sr{distanceToTile2d(e,r,c,d){const _=d.distanceX([e,r]),v=d.distanceY([e,r]);return Math.hypot(_,v)}getWrap(e,r,c){return c}getTileBoundingVolume(e,r,c,d){var _,v;let k=0,C=0;if(d?.terrain){const O=new o.a1(e.z,r,e.z,e.x,e.y),X=d.terrain.getMinMaxElevation(O);k=(_=X.minElevation)!==null&&_!==void 0?_:Math.min(0,c),C=(v=X.maxElevation)!==null&&v!==void 0?v:Math.max(0,c)}const R=1<<e.z;return new cn([r+e.x/R,e.y/R,k],[r+(e.x+1)/R,(e.y+1)/R,C])}allowVariableZoom(e,r){const c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=o.an(78.5-c/2,0,60);return!!r.terrain||e.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class $r{constructor(e,r,c){this.points=e,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(e,r=1,c=0,d,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],k=Math.pow(2,c),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((Z=>(function(it,ot,mt,gt){const yt=o.aG([],it,ot),Ct=1/yt[3]/mt*gt;return o.b5(yt,yt,[Ct,Ct,1/yt[3],Ct])})(Z,e,r,k)));d&&(function(Z,it,ot,mt){const gt=mt?4:0,yt=mt?0:4;let Ct=0;const zt=[],St=[];for(let At=0;At<4;At++){const qt=o.b1([],Z[At+yt],Z[At+gt]),oe=o.b6(qt);o.a_(qt,qt,1/oe),zt.push(oe),St.push(qt)}for(let At=0;At<4;At++){const qt=o.b7(Z[At+gt],St[At],ot);Ct=qt!==null&&qt>=0?Math.max(Ct,qt):Math.max(Ct,zt[At])}const Nt=(function(At,qt){const oe=o.b1([],At[qt[0]],At[qt[1]]),ee=o.b1([],At[qt[2]],At[qt[1]]),ie=[0,0,0,0];return o.b2(ie,o.b3([],oe,ee)),ie[3]=-o.b4(ie,At[qt[0]]),ie})(Z,it),Ft=(function(At,qt){const oe=o.b8(At),ee=o.b9([],At,1/oe),ie=o.b1([],qt,o.a_([],ee,o.b4(qt,ee))),ae=o.b8(ie);if(ae>0){const De=Math.sqrt(1-ee[3]*ee[3]),Me=o.a_([],ee,-ee[3]),ve=o.a$([],Me,o.a_([],ie,De/ae));return o.ba(qt,ve)}return null})(ot,Nt);if(Ft!==null){const At=Ft/o.b4(St[0],Nt);Ct=Math.min(Ct,At)}for(let At=0;At<4;At++){const qt=Math.min(Ct,zt[At]);Z[At+yt]=[Z[At+gt][0]+St[At][0]*qt,Z[At+gt][1]+St[At][1]*qt,Z[At+gt][2]+St[At][2]*qt,1]}})(C,v[0],d,_);const R=v.map((Z=>{const it=o.b1([],C[Z[0]],C[Z[1]]),ot=o.b1([],C[Z[2]],C[Z[1]]),mt=o.b2([],o.b3([],it,ot)),gt=-o.b4(mt,C[Z[1]]);return mt.concat(gt)})),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],X=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const Z of C)for(let it=0;it<3;it++)O[it]=Math.min(O[it],Z[it]),X[it]=Math.max(X[it],Z[it]);return new $r(C,R,new cn(O,X))}}class Un{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(r,c)=>{c=o.an(+c,this.minZoom,this.maxZoom);const d={center:new o.V(r.lng,r.lat),zoom:c};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const St=179.9999999999;_=[-St,St]}const v=this.tileSize*o.aq(d.zoom);let k=0,C=v,R=0,O=v,X=0,Z=0;const{x:it,y:ot}=this.size;if(this._helper._latRange){const St=this._helper._latRange;k=o.X(St[1])*v,C=o.X(St[0])*v,C-k<ot&&(X=ot/(C-k))}_&&(R=o.W(o.Y(_[0])*v,0,v),O=o.W(o.Y(_[1])*v,0,v),O<R&&(O+=v),O-R<it&&(Z=it/(O-R)));const{x:mt,y:gt}=xt(v,r);let yt,Ct;const zt=Math.max(Z||0,X||0);if(zt){const St=new o.P(Z?(O+R)/2:mt,X?(C+k)/2:gt);return d.center=Rt(v,St).wrap(),d.zoom+=o.at(zt),d}if(this._helper._latRange){const St=ot/2;gt-St<k&&(Ct=k+St),gt+St>C&&(Ct=C-St)}if(_){const St=(R+O)/2;let Nt=mt;this._helper._renderWorldCopies&&(Nt=o.W(mt,St-v/2,St+v/2));const Ft=it/2;Nt-Ft<R&&(yt=R+Ft),Nt+Ft>O&&(yt=O-Ft)}if(yt!==void 0||Ct!==void 0){const St=new o.P(yt??mt,Ct??gt);d.center=Rt(v,St).wrap()}return d},this.applyConstrain=(r,c)=>this._helper.applyConstrain(r,c),this._helper=new Wi({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,c)=>this.defaultConstrain(r,c)},e),this._coveringTilesDetailsProvider=new Sr}clone(){const e=new Un;return e.apply(this),e}apply(e,r,c){this._helper.apply(e,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new o.bb(0,e)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new o.P(0,0)),d=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),k=Math.floor(Math.min(c.x,d.x,_.x,v.x)),C=Math.floor(Math.max(c.x,d.x,_.x,v.x)),R=1;for(let O=k-R;O<=C+R;O++)O!==0&&r.push(new o.bb(O,e))}return r}getCameraFrustum(){return $r.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,r){const c=o.as(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(r,c),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),v=o.aa.fromLngLat(e),k=new o.aa(v.x-(d.x-_.x),v.y-(d.y-_.y));this.setCenter(k?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(o.aa.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.aa.fromLngLat(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const c=r||0,d=[e.x,e.y,0,1],_=[e.x,e.y,1,1];o.aG(d,d,this._pixelMatrixInverse),o.aG(_,_,this._pixelMatrixInverse);const v=d[3],k=_[3],C=d[1]/v,R=_[1]/k,O=d[2]/v,X=_[2]/k,Z=O===X?0:(c-O)/(X-O);return new o.aa(o.G.number(d[0]/v,_[0]/k,Z)/this.worldSize,o.G.number(C,R,Z)/this.worldSize,c)}coordinatePoint(e,r=0,c=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,r,1];return o.aG(d,d,c),new o.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-$t(this));return new Pt().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-$t(this)}calculatePosMatrix(e,r=!1,c){var d;const _=(d=e.key)!==null&&d!==void 0?d:o.bc(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=r?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const R=v.get(_);return c?R.f32:R.f64}const k=pt(e,this.worldSize);o.S(k,r?this._alignedProjMatrix:this._viewProjMatrix,k);const C={f64:k,f32:new Float32Array(k)};return v.set(_,C),c?C.f32:C.f64}calculateFogMatrix(e){const r=e.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const d=pt(e,this.worldSize);return o.S(d,this._fogMatrix,d),c.set(r,new Float32Array(d)),c.get(r)}calculateCenterFromCameraLngLatAlt(e,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,d)}_calculateNearFarZIfNeeded(e,r,c){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=e-d*this._helper._pixelPerMeter/Math.cos(r),v=d<0?_:e,k=Math.PI/2+this.pitchInRadians,C=o.ap(this.fov)*(Math.abs(Math.cos(o.ap(this.roll)))*this.height+Math.abs(Math.sin(o.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),R=Math.sin(C)*v/Math.sin(o.an(Math.PI-k-C,.01,Math.PI-.01)),O=$t(this),X=Math.atan(O/this._helper.cameraToCenterDistance),Z=o.ap(.75),it=X>Z?2*X*(.5+c.y/(2*O)):Z,ot=Math.sin(it)*v/Math.sin(o.an(Math.PI-k-it,.01,Math.PI-.01)),mt=Math.min(R,ot);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*mt+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=xt(this.worldSize,this.center),c=r.x,d=r.y;this._helper._pixelPerMeter=o.as(1,this.center.lat)*this.worldSize;const _=o.ap(Math.min(this.pitch,lt)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let k;this._calculateNearFarZIfNeeded(v,_,e),k=new Float64Array(16),o.bd(k,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aA(this._invProjMatrix,k),k[8]=2*-e.x/this._helper._width,k[9]=2*e.y/this._helper._height,this._projectionMatrix=o.be(k),o.Q(k,k,[1,-1,1]),o.O(k,k,[0,0,-this._helper.cameraToCenterDistance]),o.bf(k,k,-this.rollInRadians),o.bg(k,k,this.pitchInRadians),o.bf(k,k,-this.bearingInRadians),o.O(k,k,[-c,-d,0]),this._mercatorMatrix=o.Q([],k,[this.worldSize,this.worldSize,this.worldSize]),o.Q(k,k,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,k),o.O(k,k,[0,0,-this.elevation]),this._viewProjMatrix=k,this._invViewProjMatrix=o.aA([],k);const C=[0,0,-1,1];o.aG(C,C,this._invViewProjMatrix),this._cameraPosition=[C[0]/C[3],C[1]/C[3],C[2]/C[3]],this._fogMatrix=new Float64Array(16),o.bd(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.bf(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.bg(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.bf(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.O(this._fogMatrix,this._fogMatrix,[-c,-d,0]),o.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,k);const R=this._helper._width%2/2,O=this._helper._height%2/2,X=Math.cos(this.bearingInRadians),Z=Math.sin(-this.bearingInRadians),it=c-Math.round(c)+X*R+Z*O,ot=d-Math.round(d)+X*O+Z*R,mt=new Float64Array(k);if(o.O(mt,mt,[it>.5?it-1:it,ot>.5?ot-1:ot,0]),this._alignedProjMatrix=mt,k=o.aA(new Float64Array(16),this._pixelMatrix),!k)throw new Error("failed to invert matrix");this._pixelMatrixInverse=k,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aG(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=o.as(1,this.center.lat)*this.worldSize;return Ut(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const c=o.aa.fromLngLat(e),d=[c.x*this.worldSize,c.y*this.worldSize,r,1];return o.aG(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:d}=e,_=this._helper.getMercatorTileCoordinates(r),v=r?this.calculatePosMatrix(r,c,!0):null;let k;return k=r&&r.terrainRttPosMatrix32f&&d?r.terrainRttPosMatrix32f:v||o.bh(),{mainMatrix:k,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:k}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,c){return 1}transformLightDirection(e){return o.b0(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,c,d){const _=this.calculatePosMatrix(c);let v;d?(v=[e,r,d(e,r),1],o.aG(v,v,_)):(v=[e,r,0,1],Zi(v,v,_));const k=v[3];return{point:new o.P(v[0]/k,v[1]/k),signedDistanceFromCamera:k,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const c=o.aa.fromLngLat(e,r),d=c.meterInMercatorCoordinateUnits(),_=o.bi();return o.O(_,_,[c.x,c.y,c.z]),o.bf(_,_,Math.PI),o.bg(_,_,Math.PI/2),o.Q(_,_,[-d,d,d]),_}getProjectionDataForCustomLayer(e=!0){const r=new o.a1(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),d=pt(r,this.worldSize);o.S(d,this._viewProjMatrix,d),c.tileMercatorCoords=[0,0,1,1];const _=[o.a4,o.a4,this.worldSize/this._helper.pixelsPerMeter],v=o.bj();return o.Q(v,d,_),c.fallbackMatrix=v,c.mainMatrix=v,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Wr(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function is(g){if(g.useSlerp)if(g.k<1){const e=o.bk(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),r=o.bk(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),c=new Float64Array(4);o.bl(c,e,r,g.k);const d=o.bm(c);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(o.G.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(o.G.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(o.G.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function xi(g,e,r,c,d){const _=d.padding,v=xt(d.worldSize,r.getNorthWest()),k=xt(d.worldSize,r.getNorthEast()),C=xt(d.worldSize,r.getSouthEast()),R=xt(d.worldSize,r.getSouthWest()),O=o.ap(-c),X=v.rotate(O),Z=k.rotate(O),it=C.rotate(O),ot=R.rotate(O),mt=new o.P(Math.max(X.x,Z.x,ot.x,it.x),Math.max(X.y,Z.y,ot.y,it.y)),gt=new o.P(Math.min(X.x,Z.x,ot.x,it.x),Math.min(X.y,Z.y,ot.y,it.y)),yt=mt.sub(gt),Ct=(d.width-(_.left+_.right+e.left+e.right))/yt.x,zt=(d.height-(_.top+_.bottom+e.top+e.bottom))/yt.y;if(zt<0||Ct<0)return void Wr();const St=Math.min(o.at(d.scale*Math.min(Ct,zt)),g.maxZoom),Nt=o.P.convert(g.offset),Ft=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ap(c)),At=Nt.add(Ft).mult(d.scale/o.aq(St));return{center:Rt(d.worldSize,v.add(C).div(2).sub(At)),zoom:St,bearing:c}}class Xi{get useGlobeControls(){return!1}handlePanInertia(e,r){const c=e.mag(),d=Math.abs($t(r));return{easingOffset:e.mult(Math.min(.75*d/c,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,c){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,r,c,d,_){return xi(e,r,c,d,_)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(o.V.convert(r.center))}handleEaseTo(e,r){const c=e.zoom,d=e.padding,_={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},k=r.zoom!==void 0,C=!e.isPaddingEqual(r.padding);let R=!1;const O=k?+r.zoom:e.zoom;let X=e.centerPoint.add(r.offsetAsPoint);const Z=e.screenPointToLocation(X),{center:it,zoom:ot}=e.applyConstrain(o.V.convert(r.center||Z),O??c);Ts(e,it);const mt=xt(e.worldSize,Z),gt=xt(e.worldSize,it).sub(mt),yt=o.aq(ot-c);return R=ot!==c,{easeFunc:Ct=>{if(R&&e.setZoom(o.G.number(c,ot,Ct)),o.bn(_,v)||is({startEulerAngles:_,endEulerAngles:v,tr:e,k:Ct,useSlerp:_.roll!=v.roll}),C&&(e.interpolatePadding(d,r.padding,Ct),X=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const zt=o.aq(e.zoom-c),St=ot>c?Math.min(2,yt):Math.max(.5,yt),Nt=Math.pow(St,1-Ct),Ft=Rt(e.worldSize,mt.add(gt.mult(Ct*Nt)).mult(zt));e.setLocationAtPoint(e.renderWorldCopies?Ft.wrap():Ft,X)}},isZooming:R,elevationCenter:it}}handleFlyTo(e,r){const c=r.zoom!==void 0,d=e.zoom,_=e.applyConstrain(o.V.convert(r.center||r.locationAtOffset),c?+r.zoom:d),v=_.center,k=_.zoom;Ts(e,v);const C=xt(e.worldSize,r.locationAtOffset),R=xt(e.worldSize,v).sub(C),O=R.mag(),X=o.aq(k-d);let Z;if(r.minZoom!==void 0){const it=Math.min(+r.minZoom,d,k),ot=e.applyConstrain(v,it).zoom;Z=o.aq(ot-d)}return{easeFunc:(it,ot,mt,gt)=>{e.setZoom(it===1?k:d+o.at(ot));const yt=it===1?v:Rt(e.worldSize,C.add(R.mult(mt)).mult(ot));e.setLocationAtPoint(e.renderWorldCopies?yt.wrap():yt,gt)},scaleOfZoom:X,targetCenter:v,scaleOfMinZoom:Z,pixelPathLength:O}}}class Fn{constructor(e,r,c){this.blendFunction=e,this.blendColor=r,this.mask=c}}Fn.Replace=[1,0],Fn.disabled=new Fn(Fn.Replace,o.bo.transparent,[!1,!1,!1,!1]),Fn.unblended=new Fn(Fn.Replace,o.bo.transparent,[!0,!0,!0,!0]),Fn.alphaBlended=new Fn([1,771],o.bo.transparent,[!0,!0,!0,!0]);const Er=2305;class Tn{constructor(e,r,c){this.enable=e,this.mode=r,this.frontFace=c}}Tn.disabled=new Tn(!1,1029,Er),Tn.backCCW=new Tn(!0,1029,Er),Tn.frontCCW=new Tn(!0,1028,Er);class mn{constructor(e,r,c){this.func=e,this.mask=r,this.range=c}}mn.ReadOnly=!1,mn.ReadWrite=!0,mn.disabled=new mn(519,mn.ReadOnly,[0,1]);const Ss=7680;class dn{constructor(e,r,c,d,_,v){this.test=e,this.ref=r,this.mask=c,this.fail=d,this.depthFail=_,this.pass=v}}dn.disabled=new dn({func:519,mask:0},0,0,Ss,Ss,Ss);const rs=new WeakMap;function kr(g){var e;if(rs.has(g))return rs.get(g);{const r=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return rs.set(g,r),r}}class Fi{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const d=new o.aV;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const _=new o.aX;_.emplaceBack(0,1,2),this._fullscreenTriangle=new _i(r.createVertexBuffer(d,Cn.members),r.createIndexBuffer(_),o.aW.simpleSegment(0,0,d.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const v=c.createTexture();c.bindTexture(c.TEXTURE_2D,v),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),kr(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const c=this._cachedRenderContext.context,d=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:o.bo.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,d.TRIANGLES,mn.disabled,dn.disabled,Fn.unblended,Tn.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&kr(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const _=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&kr(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Fi._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const _r=o.a4/128;function Fa(g,e){const r=g.granularity!==void 0?Math.max(g.granularity,1):1,c=r+(g.generateBorders?2:0),d=r+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=c+1,v=d+1,k=g.generateBorders?-1:0,C=g.generateBorders||g.extendToNorthPole?-1:0,R=r+(g.generateBorders?1:0),O=r+(g.generateBorders||g.extendToSouthPole?1:0),X=_*v,Z=c*d*6,it=_*v>65536;if(it&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ot=it||e==="32bit",mt=new Int16Array(2*X);let gt=0;for(let zt=C;zt<=O;zt++)for(let St=k;St<=R;St++){let Nt=St/r*o.a4;St===-1&&(Nt=-_r),St===r+1&&(Nt=o.a4+_r);let Ft=zt/r*o.a4;zt===-1&&(Ft=g.extendToNorthPole?o.bq:-_r),zt===r+1&&(Ft=g.extendToSouthPole?o.br:o.a4+_r),mt[gt++]=Nt,mt[gt++]=Ft}const yt=ot?new Uint32Array(Z):new Uint16Array(Z);let Ct=0;for(let zt=0;zt<d;zt++)for(let St=0;St<c;St++){const Nt=St+1+zt*_,Ft=St+(zt+1)*_,At=St+1+(zt+1)*_;yt[Ct++]=St+zt*_,yt[Ct++]=Ft,yt[Ct++]=Nt,yt[Ct++]=Nt,yt[Ct++]=Ft,yt[Ct++]=At}return{vertices:mt.buffer.slice(0),indices:yt.buffer.slice(0),uses32bitIndices:ot}}const Xr=new o.aU({fill:new o.bs(128,2),line:new o.bs(512,0),tile:new o.bs(128,32),stencil:new o.bs(128,1),circle:3});class qs{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return gr.projectionGlobe}get vertexShaderPreludeCode(){return gr.projectionMercator.vertexSource}get subdivisionGranularity(){return Xr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Fi(e));const r=o.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(r,c),_=J();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bt(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bu(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,c,d,_){const v=(_==="stencil"?Xr.stencil:Xr.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:v,generateBorders:c,extendToNorthPole:r.y===0&&d,extendToSouthPole:r.y===(1<<r.z)-1&&d})}_getMesh(e,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const d=(function(_,v){const k=Fa(v,"16bit"),C=o.aV.deserialize({arrayBuffer:k.vertices,length:k.vertices.byteLength/2/2}),R=o.aX.deserialize({arrayBuffer:k.indices,length:k.indices.byteLength/2/3});return new _i(_.createVertexBuffer(C,Cn.members),_.createIndexBuffer(R),o.aW.simpleSegment(0,0,C.length,R.length))})(e,r);return this._tileMeshCache[c]=d,d}recalculate(e){}hasTransition(){const e=J();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const ss=new o.t({type:new o.D(o.u.projection.type)});class Zs extends o.E{constructor(e){super(),this._transitionable=new o.x(ss,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0)),this._mercatorProjection=new vi,this._verticalPerspectiveProjection=new qs}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bv){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,c,d,_){return this.currentProjection.getMeshFromTileID(e,r,c,d,_)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Mr(g){const e=Ba(g.worldSize,g.center.lat);return 2*Math.PI*e}function Pr(g,e,r,c,d){const _=1/(1<<d),v=e/o.a4*_+c*_,k=o.bx((g/o.a4*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),C=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,R=Math.cos(C),O=new Float64Array(3);return O[0]=Math.sin(k)*R,O[1]=Math.sin(C),O[2]=Math.cos(k)*R,O}function Ri(g){return(function(e,r){const c=Math.cos(r),d=new Float64Array(3);return d[0]=Math.sin(e)*c,d[1]=Math.sin(r),d[2]=Math.cos(e)*c,d})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function Ba(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function cl(g){const e=Math.asin(g[1])/Math.PI*180,r=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(r>1e-6){const c=g[0]/r,d=Math.acos(g[2]/r),_=(c>0?d:-d)/Math.PI*180;return new o.V(o.W(_,-180,180),e)}return new o.V(0,e)}function zi(g){return Math.cos(g*Math.PI/180)}function fi(g,e){const r=zi(g),c=zi(e);return o.at(c/r)}function Cr(g,e){const r=g.rotate(e.bearingInRadians),c=e.zoom+fi(e.center.lat,0),d=o.bt(1/zi(e.center.lat),1/zi(Math.min(Math.abs(e.center.lat),60)),o.bw(c,7,3,0,1)),_=360/Mr({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.V(e.center.lng-r.x*_*d,o.an(e.center.lat+r.y*_,-o.ao,o.ao))}function $s(g){const e=.5*g,r=Math.sin(e),c=Math.cos(e);return Math.log(r+c)-Math.log(c-r)}function as(g,e,r,c){const d=g.lat+r*c;if(Math.abs(r)>1){const _=(Math.sign(g.lat+r)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,v=Math.abs(g.lat+r)*Math.PI/180,k=$s(_+c*(v-_)),C=$s(_),R=$s(v);return new o.V(g.lng+e*((k-C)/(R-C)),d)}return new o.V(g.lng+e*c,d)}class Ki{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,c,d){const _=`${e.z}_${e.x}_${e.y}_${d?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const k=this._cachePrevious.get(_);if(k)return this._cache.set(_,k),k;const C=this._boundingVolumeFactory(e,r,c,d);return this._cache.set(_,C),this._hadAnyChanges=!0,C}}class Ar{constructor(e,r,c,d){this.min=c,this.max=d,this.points=e,this.planes=r}static fromAabb(e,r){const c=[];for(let d=0;d<8;d++)c.push([1&~d?e[0]:r[0],(d>>1&1)==1?r[1]:e[1],(d>>2&1)==1?r[2]:e[2]]);return new Ar(c,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,c){const d=o.bA([],c[0],c[1],c[2]),_=o.bB([],[r[0],0,0],d),v=o.bB([],[0,r[1],0],d),k=o.bB([],[0,0,r[2]],d),C=[...e],R=[...e];for(let X=0;X<8;X++)for(let Z=0;Z<3;Z++){const it=e[Z]+_[Z]*(1&~X?-1:1)+v[Z]*((X>>1&1)==1?1:-1)+k[Z]*((X>>2&1)==1?1:-1);C[Z]=Math.min(C[Z],it),R[Z]=Math.max(R[Z],it)}const O=[];for(let X=0;X<8;X++){const Z=[...e];o.a$(Z,Z,o.a_([],_,1&~X?-1:1)),o.a$(Z,Z,o.a_([],v,(X>>1&1)==1?1:-1)),o.a$(Z,Z,o.a_([],k,(X>>2&1)==1?1:-1)),O.push(Z)}return new Ar(O,[[..._,-o.b4(_,O[0])],[...v,-o.b4(v,O[0])],[...k,-o.b4(k,O[0])],[-_[0],-_[1],-_[2],-o.b4(_,O[7])],[-v[0],-v[1],-v[2],-o.b4(v,O[7])],[-k[0],-k[1],-k[2],-o.b4(k,O[7])]],C,R)}intersectsFrustum(e){let r=!0;const c=this.points.length,d=this.planes.length,_=e.planes.length,v=e.points.length;for(let k=0;k<_;k++){const C=e.planes[k];let R=0;for(let O=0;O<c;O++){const X=this.points[O];C[0]*X[0]+C[1]*X[1]+C[2]*X[2]+C[3]>=0&&R++}if(R===0)return 0;R<c&&(r=!1)}if(r)return 2;for(let k=0;k<d;k++){const C=this.planes[k];let R=0;for(let O=0;O<v;O++){const X=e.points[O];C[0]*X[0]+C[1]*X[1]+C[2]*X[2]+C[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let c=0;for(let d=0;d<r;d++){const _=this.points[d];e[0]*_[0]+e[1]*_[1]+e[2]*_[2]+e[3]>=0&&c++}return c===r?2:c===0?0:1}}function ca(g,e,r){const c=g-e;return c<0?-c:Math.max(0,c-r)}function fo(g,e,r,c,d){const _=g-r;let v;return v=_<0?Math.min(-_,1+_-d):_>1?Math.min(Math.max(_-d,0),1-_):0,Math.max(v,ca(e,c,d))}class po{constructor(){this._boundingVolumeCache=new Ki(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,c,d){const _=1<<c.z,v=1/_,k=c.x/_,C=c.y/_;let R=2;return R=Math.min(R,fo(e,r,k,C,v)),R=Math.min(R,fo(e,r,k+.5,-C-v,v)),R=Math.min(R,fo(e,r,k+.5,2-C-v,v)),R}getWrap(e,r,c){const d=1<<r.z,_=1/d,v=r.x/d,k=ca(e.x,v,_),C=ca(e.x,v-1,_),R=ca(e.x,v+1,_),O=Math.min(k,C,R);return O===R?1:O===C?-1:0}allowVariableZoom(e,r){return Xe(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,c,d){return this._boundingVolumeCache.getTileBoundingVolume(e,r,c,d)}_computeTileBoundingVolume(e,r,c,d){var _,v;let k=0,C=0;if(d?.terrain){const R=new o.a1(e.z,r,e.z,e.x,e.y),O=d.terrain.getMinMaxElevation(R);k=(_=O.minElevation)!==null&&_!==void 0?_:Math.min(0,c),C=(v=O.maxElevation)!==null&&v!==void 0?v:Math.max(0,c)}if(k/=o.bD,C/=o.bD,k+=1,C+=1,e.z<=0)return Ar.fromAabb([-C,-C,-C],[C,C,C]);if(e.z===1)return Ar.fromAabb([e.x===0?-C:0,e.y===0?0:-C,-C],[e.x===0?0:C,e.y===0?C:0,C]);{const R=[Pr(0,0,e.x,e.y,e.z),Pr(o.a4,0,e.x,e.y,e.z),Pr(o.a4,o.a4,e.x,e.y,e.z),Pr(0,o.a4,e.x,e.y,e.z)],O=[];for(const ie of R)O.push(o.a_([],ie,C));if(C!==k)for(const ie of R)O.push(o.a_([],ie,k));e.y===0&&O.push([0,1,0]),e.y===(1<<e.z)-1&&O.push([0,-1,0]);const X=[1,1,1],Z=[-1,-1,-1];for(const ie of O)for(let ae=0;ae<3;ae++)X[ae]=Math.min(X[ae],ie[ae]),Z[ae]=Math.max(Z[ae],ie[ae]);const it=Pr(o.a4/2,o.a4/2,e.x,e.y,e.z),ot=o.b3([],[0,1,0],it);o.b2(ot,ot);const mt=o.b3([],it,ot);o.b2(mt,mt);const gt=o.b3([],R[2],R[1]);o.b2(gt,gt);const yt=o.b3([],R[0],R[3]);o.b2(yt,yt),O.push(o.a_([],it,C)),e.y>=(1<<e.z)/2&&O.push(o.a_([],Pr(o.a4/2,0,e.x,e.y,e.z),C)),e.y<(1<<e.z)/2&&O.push(o.a_([],Pr(o.a4/2,o.a4,e.x,e.y,e.z),C));const Ct=mo(it,O),zt=mo(mt,O),St=[-it[0],-it[1],-it[2],Ct.max],Nt=[it[0],it[1],it[2],-Ct.min],Ft=[-mt[0],-mt[1],-mt[2],zt.max],At=[mt[0],mt[1],mt[2],-zt.min],qt=[...gt,0],oe=[...yt,0],ee=[];return e.y===0?ee.push(o.bC(oe,qt,St),o.bC(oe,qt,Nt)):ee.push(o.bC(Ft,qt,St),o.bC(Ft,qt,Nt),o.bC(Ft,oe,St),o.bC(Ft,oe,Nt)),e.y===(1<<e.z)-1?ee.push(o.bC(oe,qt,St),o.bC(oe,qt,Nt)):ee.push(o.bC(At,qt,St),o.bC(At,qt,Nt),o.bC(At,oe,St),o.bC(At,oe,Nt)),new Ar(ee,[St,Nt,Ft,At,qt,oe],X,Z)}}}function mo(g,e){let r=1/0,c=-1/0;for(const d of e){const _=o.b4(g,d);r=Math.min(r,_),c=Math.max(c,_)}return{min:r,max:c}}class Ws{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=o.bE(),this._projectionMatrix=o.bi(),this._globeViewProjMatrix32f=o.bh(),this._globeViewProjMatrixNoCorrection=o.bi(),this._globeViewProjMatrixNoCorrectionInverted=o.bi(),this._globeProjMatrixInverted=o.bi(),this._cameraPosition=o.by(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(r,c)=>{const d=o.an(r.lat,-o.ao,o.ao),_=o.an(+c,this.minZoom+fi(0,d),this.maxZoom);return{center:new o.V(r.lng,d),zoom:_}},this.applyConstrain=(r,c)=>this._helper.applyConstrain(r,c),this._helper=new Wi({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,c)=>this.defaultConstrain(r,c)},e),this._coveringTilesDetailsProvider=new po}clone(){const e=new Ws;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=o.by();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:c}=e,d=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,c=this.cameraToCenterDistance/e,d=Math.sin(r)*c,_=Math.cos(r)*c+1,v=1/Math.sqrt(d*d+_*_)*1;let k=-d,C=_;const R=Math.sqrt(k*k+C*C);k/=R,C/=R;const O=[0,k,C];o.bF(O,O,[0,0,0],-this.bearingInRadians),o.bG(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),o.bH(O,O,[0,0,0],this.center.lng*Math.PI/180);const X=1/o.b6(O);return o.a_(O,O,X),[...O,-v*X]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ri(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,d=Math.cos(c),_=[Math.sin(r)*d,Math.sin(c),Math.cos(r)*d],v=[_[2],0,-_[0]],k=[0,0,0];o.b3(k,v,_),o.b2(v,v),o.b2(k,k);const C=[0,0,0];return o.b2(C,[v[0]*e[0]+k[0]*e[1]+_[0]*e[2],v[1]*e[0]+k[1]*e[1]+_[1]*e[2],v[2]*e[0]+k[2]*e[1]+_[2]*e[2]]),C}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,c){const d=(function(k,C,R){const O=1/(1<<R.z);return new o.aa(k/o.a4*O+R.x*O,C/o.a4*O+R.y*O)})(e,r,c.canonical),_=(v=d.y,[o.bx(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(e,r,c,d){const _=c.canonical,v=Pr(e,r,_.x,_.y,_.z),k=1+(d?d(e,r):0)/o.bD,C=[v[0]*k,v[1]*k,v[2]*k,1];o.aG(C,C,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,O=R[0]*v[0]+R[1]*v[1]+R[2]*v[2]+R[3]<0;return{point:new o.P(C[0]/C[3],C[1]/C[3]),signedDistanceFromCamera:C[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Ba(this.worldSize,this.center.lat),r=o.bj(),c=o.bj();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.bd(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;r[8]=2*-d.x/this._helper._width,r[9]=2*d.y/this._helper._height,this._projectionMatrix=o.be(r),this._globeProjMatrixInverted=o.bj(),o.aA(this._globeProjMatrixInverted,r),o.O(r,r,[0,0,-this.cameraToCenterDistance]),o.bf(r,r,this.rollInRadians),o.bg(r,r,-this.pitchInRadians),o.bf(r,r,this.bearingInRadians),o.O(r,r,[0,0,-e]);const _=o.by();_[0]=e,_[1]=e,_[2]=e,o.bg(c,r,this.center.lat*Math.PI/180),o.bI(c,c,-this.center.lng*Math.PI/180),o.Q(c,c,_),this._globeViewProjMatrixNoCorrection=c,o.bg(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bI(r,r,-this.center.lng*Math.PI/180),o.Q(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=o.bj(),o.aA(this._globeViewProjMatrixNoCorrectionInverted,c);const v=o.by();this._cameraPosition=o.by(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bF(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),o.bG(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),o.bF(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),o.a$(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bG(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),o.bH(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const k=o.be(this._globeViewProjMatrixNoCorrectionInverted);o.Q(k,k,[1,1,-1]),this._cachedFrustum=$r.fromInvProjectionMatrix(k,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");const r=o.bj();return o.ar(r),r}getVisibleUnwrappedCoordinates(e){return[new o.bb(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=Ri(e);o.a_(c,c,1+r/o.bD);const d=o.bE();return o.aG(d,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,c=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,r),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,r)],d=[];for(const X of c)d.push(this.unprojectScreenPoint(X));let _=0,v=0,k=0,C=0;const R=this.center;for(const X of d){const Z=o.bJ(R.lng,X.lng),it=o.bJ(R.lat,X.lat);Z<v&&(v=Z),Z>_&&(_=Z),it<C&&(C=it),it>k&&(k=it)}const O=[R.lng+v,R.lat+C,R.lng+_,R.lat+k];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new Pt(O)}calculateCenterFromCameraLngLatAlt(e,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,d)}setLocationAtPoint(e,r){const c=Ri(this.unprojectScreenPoint(r)),d=Ri(e),_=o.by();o.bK(_);const v=o.by();o.bH(v,c,_,-this.center.lng*Math.PI/180),o.bG(v,v,_,this.center.lat*Math.PI/180);const k=d[0]*d[0]+d[2]*d[2],C=v[0]*v[0];if(k<C)return;const R=Math.sqrt(k-C),O=-R,X=o.bL(d[0],d[2],v[0],R),Z=o.bL(d[0],d[2],v[0],O),it=o.by();o.bH(it,d,_,-X);const ot=o.bL(it[1],it[2],v[1],v[2]),mt=o.by();o.bH(mt,d,_,-Z);const gt=o.bL(mt[1],mt[2],v[1],v[2]),yt=.5*Math.PI,Ct=ot>=-yt&&ot<=yt,zt=gt>=-yt&&gt<=yt;let St,Nt;if(Ct&&zt){const oe=this.center.lng*Math.PI/180,ee=this.center.lat*Math.PI/180;o.bM(X,oe)+o.bM(ot,ee)<o.bM(Z,oe)+o.bM(gt,ee)?(St=X,Nt=ot):(St=Z,Nt=gt)}else if(Ct)St=X,Nt=ot;else{if(!zt)return;St=Z,Nt=gt}const Ft=St/Math.PI*180,At=Nt/Math.PI*180,qt=this.center.lat;this.setCenter(new o.V(Ft,o.an(At,-90,90))),this.setZoom(this.zoom+fi(qt,this.center.lat))}locationToScreenPoint(e,r){const c=Ri(e);if(r){const d=r.getElevationForLngLatZoom(e,this._helper._tileZoom);o.a_(c,c,1+d/o.bD)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){const r=o.bE();return o.aG(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new o.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c)return c}return o.aa.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,r){const c=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,d)}getRayDirectionFromPixel(e){const r=o.bE();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,o.aG(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=o.by();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const d=o.by();return o.b2(d,c),d}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=o.bE();return o.aG(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const c=o.b4(e,r),d=o.by(),_=o.by();o.a_(_,r,c),o.b1(d,e,_);const v=1-o.b4(d,d);if(v<0)return null;const k=o.b4(e,e)-1,C=-c+(c<0?1:-1)*Math.sqrt(v),R=k/C,O=C;return{tMin:Math.min(R,O),tMax:Math.max(R,O)}}unprojectScreenPoint(e){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(r,c);if(d){const O=o.by();o.a$(O,r,[c[0]*d.tMin,c[1]*d.tMin,c[2]*d.tMin]);const X=o.by();return o.b2(X,O),cl(X)}const _=this._cachedClippingPlane,v=_[0]*c[0]+_[1]*c[1]+_[2]*c[2],k=-o.ba(_,r)/v,C=o.by();if(k>0)o.a$(C,r,[c[0]*k,c[1]*k,c[2]*k]);else{const O=o.by();o.a$(O,r,[2*c[0],2*c[1],2*c[2]]);const X=o.ba(this._cachedClippingPlane,O);o.b1(C,O,[this._cachedClippingPlane[0]*X,this._cachedClippingPlane[1]*X,this._cachedClippingPlane[2]*X])}const R=(function(O){const X=o.by();return X[0]=O[0]*-O[3],X[1]=O[1]*-O[3],X[2]=O[2]*-O[3],{center:X,radius:Math.sqrt(1-O[3]*O[3])}})(_);return cl((function(O,X,Z){const it=o.by();o.b1(it,Z,O);const ot=o.by();return o.bz(ot,O,it,X/o.b8(it)),ot})(R.center,R.radius,C))}getMatrixForModel(e,r){const c=o.V.convert(e),d=1/o.bD,_=o.bi();return o.bI(_,_,c.lng/180*Math.PI),o.bg(_,_,-c.lat/180*Math.PI),o.O(_,_,[0,0,1+r/o.bD]),o.bg(_,_,.5*Math.PI),o.Q(_,_,[d,d,d]),_}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new o.a1(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class ha{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(r,c)=>this.currentTransform.defaultConstrain(r,c),this.applyConstrain=(r,c)=>this._helper.applyConstrain(r,c),this._helper=new Wi({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,c)=>this.defaultConstrain(r,c)},e),this._globeness=1,this._mercatorTransform=new Un,this._verticalPerspectiveTransform=new Ws}clone(){const e=new ha;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bt(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bt(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,c){const d=this._mercatorTransform.getPitchedTextCorrection(e,r,c),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,c);return o.bt(d,_,this._globeness)}projectTileCoordinates(e,r,c,d){return this.currentTransform.projectTileCoordinates(e,r,c,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,d)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Qn{get useGlobeControls(){return!0}handlePanInertia(e,r){const c=Cr(e,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const c=e.around,d=r.screenPointToLocation(c);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const _=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const v=r.zoom-_;if(v===0)return;const k=o.bJ(r.center.lng,d.lng),C=k/(Math.abs(k/180)+1),R=o.bJ(r.center.lat,d.lat),O=r.getRayDirectionFromPixel(c),X=r.cameraPosition,Z=-1*o.b4(X,O),it=o.by();o.a$(it,X,[O[0]*Z,O[1]*Z,O[2]*Z]);const ot=o.b6(it)-1,mt=Math.exp(.5*-Math.max(ot-.3,0)),gt=Ba(r.worldSize,r.center.lat)/Math.min(r.width,r.height),yt=o.bw(gt,.9,.5,1,.25),Ct=(1-o.aq(-v))*Math.min(mt,yt),zt=r.center.lat,St=r.zoom,Nt=new o.V(r.center.lng+C*Ct,o.an(r.center.lat+R*Ct,-o.ao,o.ao));r.setLocationAtPoint(d,c);const Ft=r.center,At=o.bw(Math.abs(k),45,85,0,1),qt=o.bw(gt,.75,.35,0,1),oe=Math.pow(Math.max(At,qt),.25),ee=o.bJ(Ft.lng,Nt.lng),ie=o.bJ(Ft.lat,Nt.lat);r.setCenter(new o.V(Ft.lng+ee*oe,Ft.lat+ie*oe).wrap()),r.setZoom(St+fi(zt,r.center.lat))}handleMapControlsPan(e,r,c){if(!e.panDelta)return;const d=r.center.lat,_=r.zoom;r.setCenter(Cr(e.panDelta,r).wrap()),r.setZoom(_+fi(d,r.center.lat))}cameraForBoxAndBearing(e,r,c,d,_){const v=xi(e,r,c,d,_),k=r.left/_.width*2-1,C=(_.width-r.right)/_.width*2-1,R=r.top/_.height*-2+1,O=(_.height-r.bottom)/_.height*-2+1,X=o.bJ(c.getWest(),c.getEast())<0,Z=X?c.getEast():c.getWest(),it=X?c.getWest():c.getEast(),ot=Math.max(c.getNorth(),c.getSouth()),mt=Math.min(c.getNorth(),c.getSouth()),gt=Z+.5*o.bJ(Z,it),yt=ot+.5*o.bJ(ot,mt),Ct=_.clone();Ct.setCenter(v.center),Ct.setBearing(v.bearing),Ct.setPitch(0),Ct.setRoll(0),Ct.setZoom(v.zoom);const zt=Ct.modelViewProjectionMatrix,St=[Ri(c.getNorthWest()),Ri(c.getNorthEast()),Ri(c.getSouthWest()),Ri(c.getSouthEast()),Ri(new o.V(it,yt)),Ri(new o.V(Z,yt)),Ri(new o.V(gt,ot)),Ri(new o.V(gt,mt))],Nt=Ri(v.center);let Ft=Number.POSITIVE_INFINITY;for(const At of St)k<0&&(Ft=Qn.getLesserNonNegativeNonNull(Ft,Qn.solveVectorScale(At,Nt,zt,"x",k))),C>0&&(Ft=Qn.getLesserNonNegativeNonNull(Ft,Qn.solveVectorScale(At,Nt,zt,"x",C))),R>0&&(Ft=Qn.getLesserNonNegativeNonNull(Ft,Qn.solveVectorScale(At,Nt,zt,"y",R))),O<0&&(Ft=Qn.getLesserNonNegativeNonNull(Ft,Qn.solveVectorScale(At,Nt,zt,"y",O)));if(Number.isFinite(Ft)&&Ft!==0)return v.zoom=Ct.zoom+o.at(Ft),v;Wr()}handleJumpToCenterZoom(e,r){const c=e.center.lat,d=e.applyConstrain(r.center?o.V.convert(r.center):e.center,e.zoom).center;e.setCenter(d.wrap());const _=r.zoom!==void 0?+r.zoom:e.zoom+fi(c,d.lat);e.zoom!==_&&e.setZoom(_)}handleEaseTo(e,r){const c=e.zoom,d=e.center,_=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},k={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},C=r.zoom!==void 0,R=!e.isPaddingEqual(r.padding);let O=!1;const X=r.center?o.V.convert(r.center):d,Z=e.applyConstrain(X,c).center;Ts(e,Z);const it=e.clone();it.setCenter(Z),it.setZoom(C?+r.zoom:c+fi(d.lat,X.lat)),it.setBearing(r.bearing);const ot=new o.P(o.an(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.an(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));it.setLocationAtPoint(Z,ot);const mt=(r.offset&&r.offsetAsPoint.mag())>0?it.center:Z,gt=C?+r.zoom:c+fi(d.lat,mt.lat),yt=c+fi(d.lat,0),Ct=gt+fi(mt.lat,0),zt=o.bJ(d.lng,mt.lng),St=o.bJ(d.lat,mt.lat),Nt=o.aq(Ct-yt);return O=gt!==c,{easeFunc:Ft=>{if(o.bn(v,k)||is({startEulerAngles:v,endEulerAngles:k,tr:e,k:Ft,useSlerp:v.roll!=k.roll}),R&&e.interpolatePadding(_,r.padding,Ft),r.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const At=Ct>yt?Math.min(2,Nt):Math.max(.5,Nt),qt=Math.pow(At,1-Ft),oe=as(d,zt,St,Ft*qt);e.setCenter(oe.wrap())}if(O){const At=o.G.number(yt,Ct,Ft)+fi(0,e.center.lat);e.setZoom(At)}},isZooming:O,elevationCenter:mt}}handleFlyTo(e,r){const c=r.zoom!==void 0,d=e.center,_=e.zoom,v=e.padding,k=!e.isPaddingEqual(r.padding),C=e.applyConstrain(o.V.convert(r.center||r.locationAtOffset),_).center,R=c?+r.zoom:e.zoom+fi(e.center.lat,C.lat),O=e.clone();O.setCenter(C),O.setZoom(R),O.setBearing(r.bearing);const X=new o.P(o.an(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.an(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(C,X);const Z=O.center;Ts(e,Z);const it=(function(St,Nt,Ft){const At=Ri(Nt),qt=Ri(Ft),oe=o.b4(At,qt),ee=Math.acos(oe),ie=Mr(St);return ee/(2*Math.PI)*ie})(e,d,Z),ot=_+fi(d.lat,0),mt=R+fi(Z.lat,0),gt=o.aq(mt-ot);let yt;if(typeof r.minZoom=="number"){const St=+r.minZoom+fi(Z.lat,0),Nt=Math.min(St,ot,mt)+fi(0,Z.lat),Ft=e.applyConstrain(Z,Nt).zoom+fi(Z.lat,0);yt=o.aq(Ft-ot)}const Ct=o.bJ(d.lng,Z.lng),zt=o.bJ(d.lat,Z.lat);return{easeFunc:(St,Nt,Ft,At)=>{const qt=as(d,Ct,zt,Ft);k&&e.interpolatePadding(v,r.padding,St);const oe=St===1?Z:qt;e.setCenter(oe.wrap());const ee=ot+o.at(Nt);e.setZoom(St===1?R:ee+fi(0,oe.lat))},scaleOfZoom:gt,targetCenter:Z,scaleOfMinZoom:yt,pixelPathLength:it}}static solveVectorScale(e,r,c,d,_){const v=d==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],k=[c[3],c[7],c[11],c[15]],C=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],R=e[0]*k[0]+e[1]*k[1]+e[2]*k[2],O=r[0]*v[0]+r[1]*v[1]+r[2]*v[2],X=r[0]*k[0]+r[1]*k[1]+r[2]*k[2];return O+_*R===C+_*X||k[3]*(C-O)+v[3]*(X-R)+C*X==O*R?null:(O+v[3]-_*X-_*k[3])/(O-C-_*X+_*R)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class da{constructor(e){this._globe=e,this._mercatorCameraHelper=new Xi,this._verticalPerspectiveCameraHelper=new Qn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,c){this.currentHelper.handleMapControlsPan(e,r,c)}cameraForBoxAndBearing(e,r,c,d,_){return this.currentHelper.cameraForBoxAndBearing(e,r,c,d,_)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const bi=(g,e)=>o.B(g,e&&e.filter((r=>r.identifier!=="source.canvas"))),Es=o.bN();class fa extends o.E{constructor(e,r={}){var c,d;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const k=this.tileManagers[v].getSource().type;k!=="vector"&&k!=="geojson"||this.tileManagers[v].reload()}},this.map=e,this.dispatcher=new sn(bn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,k)=>this.getGlyphs(v,k))),this.dispatcher.registerMessageHandler("GI",((v,k)=>this.getImages(v,k))),this.dispatcher.registerMessageHandler("GDA",((v,k)=>this.getDashes(v,k))),this.imageManager=new Et,this.imageManager.setEventedParent(this);const _=((c=e._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((d=document.documentElement)===null||d===void 0?void 0:d.lang)||void 0;this.glyphManager=new te(e._requestManager,r.localIdeographFontFamily,_),this.lineAtlas=new Ge(256,512),this.crossTileSymbolIndex=new Ln,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",o.bO()),yn().on(ln,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const k=this.tileManagers[v.sourceId];if(!k)return;const C=k.getSource();if(C&&C.vectorLayerIds)for(const R in this._layers){const O=this._layers[R];O.source===C.id&&this._validateLayer(O)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new o.bP,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,r){var c,d,_;this._checkLoaded();const v=r===null?(_=(d=(c=this.stylesheet.state)===null||c===void 0?void 0:c[e])===null||d===void 0?void 0:d.default)!==null&&_!==void 0?_:null:r;if(o.bQ(v,this._globalState[e]))return this;this._globalState[e]=v,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const c in e)!o.bQ(this._globalState[c],e[c].default)&&(r.push(c),this._globalState[c]=e[c].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;const r=new Set,c={};for(const d of e){c[d]=this._globalState[d];for(const _ in this._layers){const v=this._layers[_],k=v.getLayoutAffectingGlobalStateRefs(),C=v.getPaintAffectingGlobalStateRefs();if(k.has(d)&&r.add(v.source),C.has(d))for(const{name:R,value:O}of C.get(d))this._updatePaintProperty(v,R,O)}}this.dispatcher.broadcast("UGS",c);for(const d in this.tileManagers)r.has(d)&&(this._reloadSource(d),this._changed=!0)}loadURL(e,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;o.j(d,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,r,c)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new o.k(v))}))}loadJSON(e,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,c)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Es,{validate:!1})}_load(e,r,c){var d,_;let v=r.transformStyle?r.transformStyle(c,e):e;if(!r.validate||!bi(this,o.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const k in v.sources)this.addSource(k,v.sources[k],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new _e(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Xt(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var e,r,c;const d=o.bR(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",d),this._order=d.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of d){const v=o.bS(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,o.bT(v)&&this.tileManagers[v.source]){const k=(c=(r=_.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&c!==void 0?c:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(k)}}}_loadSprite(e,r=!1,c=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(_,v,k,C){return o._(this,void 0,void 0,(function*(){const R=Ot(_),O=k>1?"@2x":"",X={},Z={};for(const{id:it,url:ot}of R){const mt=v.transformRequest(Kt(ot,O,".json"),"SpriteJSON");X[it]=o.j(mt,C);const gt=v.transformRequest(Kt(ot,O,".png"),"SpriteImage");Z[it]=Mt.getImage(gt,C)}return yield Promise.all([...Object.values(X),...Object.values(Z)]),(function(it,ot){return o._(this,void 0,void 0,(function*(){const mt={};for(const gt in it){mt[gt]={};const yt=q.getImageCanvasContext((yield ot[gt]).data),Ct=(yield it[gt]).data;for(const zt in Ct){const{width:St,height:Nt,x:Ft,y:At,sdf:qt,pixelRatio:oe,stretchX:ee,stretchY:ie,content:ae,textFitWidth:De,textFitHeight:Me}=Ct[zt];mt[gt][zt]={data:null,pixelRatio:oe,sdf:qt,stretchX:ee,stretchY:ie,content:ae,textFitWidth:De,textFitHeight:Me,spriteData:{width:St,height:Nt,x:Ft,y:At,context:yt}}}}return mt}))})(X,Z)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((_=>{if(this._spriteRequest=null,_)for(const v in _){this._spritesImagesIds[v]=[];const k=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((C=>!(C in _))):[];for(const C of k)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in _[v]){const R=v==="default"?C:`${v}:${C}`;this._spritesImagesIds[v].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,_[v][C],!1):this.imageManager.addImage(R,_[v][C]),r&&(this._changedImages[R]=!0)}}})).catch((_=>{this._spriteRequest=null,d=_,this.fire(new o.k(d))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),c&&c(d)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.tileManagers[e.source];if(!r)return;const c=e.sourceLayer;if(!c)return;const d=r.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.k(new Error(`Source layer "${c}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?o.bU(c):c);const d=[];for(const _ of e)if(c[_]){const v=r?o.bU(c[_]):c[_];d.push(v)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const d=this._layers[c];d.type!=="custom"&&(e[c]=d.serialize())}return e}hasTransitions(){var e,r,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const d in this.tileManagers)if(this.tileManagers[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const v in this._updatedSources){const k=this._updatedSources[v];if(k==="reload")this._reloadSource(v);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const c={};for(const d in this.tileManagers){const _=this.tileManagers[d];c[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(e,this._availableImages),!_.isHidden(e.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const d in c){const _=this.tileManagers[d];!!c[d]!=!!_.used&&_.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var c;this._checkLoaded();const d=this.serialize();if(e=r.transformStyle?r.transformStyle(d,e):e,((c=r.validate)===null||c===void 0||c)&&bi(this,o.C(e)))return!1;(e=o.bU(e)).layers=o.bR(e.layers);const _=o.bV(d,e),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const k of v.operations)k();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],c=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":r.push((()=>{}));break;default:c.push(d.command)}return{operations:r,unimplemented:c}}addImage(e,r){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,c={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.C.source,`sources.${e}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=this.tileManagers[e]=new vn(e,r,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e}))),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));const r=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],r.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const c=this.tileManagers[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,r,c={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new o.k(new Error(`Layer "${d}" already exists on this map.`)));let _;if(e.type==="custom"){if(bi(this,o.bW(e)))return;_=o.bS(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=o.bU(e),e=o.e(e,{source:d})),this._validate(o.C.layer,`layers.${d}`,e,{arrayIndex:-1},c))return;_=o.bS(e,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const v=r?this._order.indexOf(r):this._order.length;if(r&&v===-1)this.fire(new o.k(new Error(`Cannot add layer "${d}" before non-existing layer "${r}".`)));else{if(this._order.splice(v,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const k=this._removedLayers[d];delete this._removedLayers[d],k.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const c=this._order.indexOf(e);this._order.splice(c,1);const d=r?this._order.indexOf(r):this._order.length;r&&d===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,c){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===r&&d.maxzoom===c||(r!=null&&(d.minzoom=r),c!=null&&(d.maxzoom=c),this._updateLayer(d)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,c={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!o.bQ(d.filter,r))return r==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(o.C.filter,`layers.${d.id}.filter`,r,null,c)||(d.setFilter(o.bU(r)),this._updateLayer(d)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bU(this.getLayer(e).filter)}setLayoutProperty(e,r,c,d={}){this._checkLoaded();const _=this.getLayer(e);_?o.bQ(_.getLayoutProperty(r),c)||(_.setLayoutProperty(r,c,d),this._updateLayer(_)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const c=this.getLayer(e);if(c)return c.getLayoutProperty(r);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,c,d={}){this._checkLoaded();const _=this.getLayer(e);_?o.bQ(_.getPaintProperty(r),c)||this._updatePaintProperty(_,r,c,d):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,c,d={}){e.setPaintProperty(r,c,d)&&this._updateLayer(e),o.bT(e)&&r==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const c=e.source,d=e.sourceLayer,_=this.tileManagers[c];if(_===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&d?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||d?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,e.id,r)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const c=e.source,d=this.tileManagers[c];if(d===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const _=d.getSource().type,v=_==="vector"?e.sourceLayer:void 0;_!=="vector"||v?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(v,e.id,r):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,c=e.sourceLayer,d=this.tileManagers[r];if(d!==void 0)return d.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(c,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.bX(this.tileManagers,(_=>_.serialize())),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,d=this.stylesheet;return o.bY({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:r,terrain:c},(_=>_!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=v=>this._layers[v].type==="fill-extrusion",c={},d=[];for(let v=this._order.length-1;v>=0;v--){const k=this._order[v];if(r(k)){c[k]=v;for(const C of e){const R=C[k];if(R)for(const O of R)d.push(O)}}}d.sort(((v,k)=>k.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const k=this._order[v];if(r(k))for(let C=d.length-1;C>=0;C--){const R=d[C].feature;if(c[R.layer.id]<v)break;_.push(R),d.pop()}else for(const C of e){const R=C[k];if(R)for(const O of R)_.push(O.feature)}}return _}queryRenderedFeatures(e,r,c){r&&r.filter&&this._validate(o.C.filter,"queryRenderedFeatures.filter",r.filter,null,r);const d={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of r.layers){const O=this._layers[R];if(!O)return this.fire(new o.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];d[O.source]=!0}}const _=[];r.availableImages=this._availableImages;const v=this._serializedAllLayers(),k=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,C=Object.assign(Object.assign({},r),{layers:k,globalState:this._globalState});for(const R in this.tileManagers)r.layers&&!d[R]||_.push($n(this.tileManagers[R],this._layers,v,e,C,c,this.map.terrain?(O,X,Z)=>this.map.terrain.getElevation(O,X,Z):void 0));return this.placement&&_.push((function(R,O,X,Z,it,ot,mt){const gt={},yt=ot.queryRenderedSymbols(Z),Ct=[];for(const zt of Object.keys(yt).map(Number))Ct.push(mt[zt]);Ct.sort(et);for(const zt of Ct){const St=zt.featureIndex.lookupSymbolFeatures(yt[zt.bucketInstanceId],O,zt.bucketIndex,zt.sourceLayerIndex,{filterSpec:it.filter,globalState:it.globalState},it.layers,it.availableImages,R);for(const Nt in St){const Ft=gt[Nt]=gt[Nt]||[],At=St[Nt];At.sort(((qt,oe)=>{const ee=zt.featureSortOrder;if(ee){const ie=ee.indexOf(qt.featureIndex);return ee.indexOf(oe.featureIndex)-ie}return oe.featureIndex-qt.featureIndex}));for(const qt of At)Ft.push(qt)}}return(function(zt,St,Nt){for(const Ft in zt)for(const At of zt[Ft])fe(At,Nt[St[Ft].source]);return zt})(gt,R,X)})(this._layers,v,this.tileManagers,e,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(e,r){r?.filter&&this._validate(o.C.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.tileManagers[e];return c?(function(d,_){const v=d.getRenderableIds().map((R=>d.getTileByID(R))),k=[],C={};for(let R=0;R<v.length;R++){const O=v[R],X=O.tileID.canonical.key;C[X]||(C[X]=!0,O.querySourceFeatures(k,_))}return k})(c,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const c=this.light.getLight();let d=!1;for(const v in e)if(!o.bQ(e[v],c[v])){d=!0;break}if(!d)return;const _={now:J(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(_)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const c=this.getSky();let d=!1;if(!e&&!c)return;if(e&&!c)d=!0;else if(!e&&c)d=!0;else for(const v in e)if(!o.bQ(e[v],c[v])){d=!0;break}if(!d)return;const _={now:J(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(_)}_setProjectionInternal(e){const r=(function(c,d){const _={constrainOverride:d};if(Array.isArray(c)){const v=new Zs({type:c});return{projection:v,transform:new ha(_),cameraHelper:new da(v)}}switch(c){case"mercator":return{projection:new vi,transform:new Un(_),cameraHelper:new Xi};case"globe":{const v=new Zs({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new ha(_),cameraHelper:new da(v)}}case"vertical-perspective":return{projection:new qs,transform:new Ws(_),cameraHelper:new Qn};default:return o.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new vi,transform:new Un(_),cameraHelper:new Xi}}})(e,this.map.transformConstrain);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(e,r,c,d,_={}){return(!_||_.validate!==!1)&&bi(this,e.call(o.C,o.e({key:r,style:this.serialize(),value:c,styleSpec:o.u},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yn().off(ln,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.tileManagers){const c=this.tileManagers[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const r in this.tileManagers)this.tileManagers[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,r,c,d,_=!1){let v=!1,k=!1;const C={};for(const R of this._order){const O=this._layers[R];if(O.type!=="symbol")continue;if(!C[O.source]){const Z=this.tileManagers[O.source];C[O.source]=Z.getRenderableIds(!0).map((it=>Z.getTileByID(it))).sort(((it,ot)=>ot.tileID.overscaledZ-it.tileID.overscaledZ||(it.tileID.isLessThan(ot.tileID)?-1:1)))}const X=this.crossTileSymbolIndex.addLayer(O,C[O.source],e.center.lng);v=v||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(J(),e.zoom))&&(this.pauseablePlacement=new co(e,this.map.terrain,this._order,_,r,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(J()),k=!0),v&&this.pauseablePlacement.placement.setStale()),k||v)for(const R of this._order){const O=this._layers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,C[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(J())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,r){return o._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const d=this.tileManagers[r.source];return d&&d.setDependencies(r.tileID.key,r.type,r.icons),c}))}getGlyphs(e,r){return o._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),d=this.tileManagers[r.source];return d&&d.setDependencies(r.tileID.key,r.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(o.C.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,r){return o._(this,void 0,void 0,(function*(){const c={};for(const[d,_]of Object.entries(r.dashes))c[d]=this.lineAtlas.getDash(_.dasharray,_.round);return c}))}addSprite(e,r,c={},d){this._checkLoaded();const _=[{id:e,url:r}],v=[...Ot(this.stylesheet.sprite),..._];this._validate(o.C.sprite,"sprite",v,null,c)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,d))}removeSprite(e){this._checkLoaded();const r=Ot(this.stylesheet.sprite);if(r.find((c=>c.id===e))){if(this._spritesImagesIds[e])for(const c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex((c=>c.id===e)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ot(this.stylesheet.sprite)}setSprite(e,r={},c){this._checkLoaded(),e&&this._validate(o.C.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const r=this.tileManagers[e];if(r.setEventedParent(null),r._tiles){for(const c in r._tiles)r._tiles[c].unloadVectorData();r._tiles={}}r._cache.reset(),r.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const r=this._layers[e];r.setEventedParent(null),r.onRemove&&r.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Lr=o.aT([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class hl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,c,d,_,v,k,C,R){this.context=e;let O=this.boundPaintVertexBuffers.length!==d.length;for(let X=0;!O&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(O=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||O||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==R?this.freshBind(r,c,d,_,v,k,C,R):(e.bindVertexArray.set(this.vao),k&&k.bind(),_&&_.dynamicDraw&&_.bind(),C&&C.bind(),R&&R.bind())}freshBind(e,r,c,d,_,v,k,C){const R=e.numAttributes,O=this.context,X=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=C,r.enableAttributes(X,e);for(const Z of c)Z.enableAttributes(X,e);v&&v.enableAttributes(X,e),k&&k.enableAttributes(X,e),C&&C.enableAttributes(X,e),r.bind(),r.setVertexAttribPointers(X,e,_);for(const Z of c)Z.bind(),Z.setVertexAttribPointers(X,e,_);v&&(v.bind(),v.setVertexAttribPointers(X,e,_)),d&&d.bind(),k&&(k.bind(),k.setVertexAttribPointers(X,e,_)),C&&(C.bind(),C.setVertexAttribPointers(X,e,_)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Va=(g,e,r,c,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):o.bo.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):o.bo.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),ks={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function gs(g){const e=[];for(let r=0;r<g.length;r++){if(g[r]===null)continue;const c=g[r].split(" ");e.push(c.pop())}return e}class du{constructor(e,r,c,d,_,v,k,C,R=[]){const O=e.gl;this.program=O.createProgram();const X=gs(r.staticAttributes),Z=c?c.getBinderAttributes():[],it=X.concat(Z),ot=gr.prelude.staticUniforms?gs(gr.prelude.staticUniforms):[],mt=k.staticUniforms?gs(k.staticUniforms):[],gt=r.staticUniforms?gs(r.staticUniforms):[],yt=c?c.getBinderUniforms():[],Ct=ot.concat(mt).concat(gt).concat(yt),zt=[];for(const ee of Ct)zt.indexOf(ee)<0&&zt.push(ee);const St=c?c.defines():[];kr(O)&&St.unshift("#version 300 es"),_&&St.push("#define OVERDRAW_INSPECTOR;"),v&&St.push("#define TERRAIN3D;"),C&&St.push(C),R&&St.push(...R);let Nt=St.concat(gr.prelude.fragmentSource,k.fragmentSource,r.fragmentSource).join(`
`),Ft=St.concat(gr.prelude.vertexSource,k.vertexSource,r.vertexSource).join(`
`);kr(O)||(Nt=(function(ee){return ee.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Nt),Ft=(function(ee){return ee.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ft));const At=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(At,Nt),O.compileShader(At),!O.getShaderParameter(At,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(At)}`);O.attachShader(this.program,At);const qt=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(qt,Ft),O.compileShader(qt),!O.getShaderParameter(qt,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(qt)}`);O.attachShader(this.program,qt),this.attributes={};const oe={};this.numAttributes=it.length;for(let ee=0;ee<this.numAttributes;ee++)it[ee]&&(O.bindAttribLocation(this.program,ee,it[ee]),this.attributes[it[ee]]=ee);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(qt),O.deleteShader(At);for(let ee=0;ee<zt.length;ee++){const ie=zt[ee];if(ie&&!oe[ie]){const ae=O.getUniformLocation(this.program,ie);ae&&(oe[ie]=ae)}}this.fixedUniforms=d(e,oe),this.terrainUniforms=((ee,ie)=>({u_depth:new o.bZ(ee,ie.u_depth),u_terrain:new o.bZ(ee,ie.u_terrain),u_terrain_dim:new o.bp(ee,ie.u_terrain_dim),u_terrain_matrix:new o.b$(ee,ie.u_terrain_matrix),u_terrain_unpack:new o.c0(ee,ie.u_terrain_unpack),u_terrain_exaggeration:new o.bp(ee,ie.u_terrain_exaggeration)}))(e,oe),this.projectionUniforms=((ee,ie)=>({u_projection_matrix:new o.b$(ee,ie.u_projection_matrix),u_projection_tile_mercator_coords:new o.c0(ee,ie.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.c0(ee,ie.u_projection_clipping_plane),u_projection_transition:new o.bp(ee,ie.u_projection_transition),u_projection_fallback_matrix:new o.b$(ee,ie.u_projection_fallback_matrix)}))(e,oe),this.binderUniforms=c?c.getUniforms(e,oe):[]}draw(e,r,c,d,_,v,k,C,R,O,X,Z,it,ot,mt,gt,yt,Ct,zt){const St=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(d),e.setColorMode(_),e.setCullFace(v),C){e.activeTexture.set(St.TEXTURE2),St.bindTexture(St.TEXTURE_2D,C.depthTexture),e.activeTexture.set(St.TEXTURE3),St.bindTexture(St.TEXTURE_2D,C.texture);for(const Ft in this.terrainUniforms)this.terrainUniforms[Ft].set(C[Ft])}if(R)for(const Ft in R)this.projectionUniforms[ks[Ft]].set(R[Ft]);if(k)for(const Ft in this.fixedUniforms)this.fixedUniforms[Ft].set(k[Ft]);gt&&gt.setUniforms(e,this.binderUniforms,ot,{zoom:mt});let Nt=0;switch(r){case St.LINES:Nt=2;break;case St.TRIANGLES:Nt=3;break;case St.LINE_STRIP:Nt=1}for(const Ft of it.get()){const At=Ft.vaos||(Ft.vaos={});(At[O]||(At[O]=new hl)).bind(e,this,X,gt?gt.getPaintVertexBuffers():[],Z,Ft.vertexOffset,yt,Ct,zt),St.drawElements(r,Ft.primitiveLength*Nt,St.UNSIGNED_SHORT,Ft.primitiveOffset*Nt*2)}}}function pa(g,e,r){const c=1/o.aM(r,1,e.transform.tileZoom),d=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,e.transform.tileZoom)/d,v=_*(r.tileID.canonical.x+r.tileID.wrap*d),k=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[v>>16,k>>16],u_pixel_coord_lower:[65535&v,65535&k]}}const dl=(g,e,r,c)=>{const d=g.style.light,_=d.properties.get("position"),v=[_.x,_.y,_.z],k=o.c3();d.properties.get("anchor")==="viewport"&&o.c4(k,g.transform.bearingInRadians),o.c5(v,v,k);const C=g.transform.transformLightDirection(v),R=d.properties.get("color");return{u_lightpos:v,u_lightpos_globe:C,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:c}},Xs=(g,e,r,c,d,_,v)=>o.e(dl(g,e,r,c),pa(_,g,v),{u_height_factor:-Math.pow(2,d.overscaledZ)/v.tileSize/8}),fl=(g,e,r,c)=>o.e(pa(e,g,r),{u_fill_translate:c}),pl=(g,e)=>({u_world:g,u_fill_translate:e}),fu=(g,e,r,c,d)=>o.e(fl(g,e,r,d),{u_world:c}),go=(g,e,r,c,d)=>{const _=g.transform;let v,k,C=0;if(r.paint.get("circle-pitch-alignment")==="map"){const R=o.aM(e,1,_.zoom);v=!0,k=[R,R],C=R/(o.a4*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else v=!1,k=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:k,u_globe_extrude_scale:C,u_translate:c}},_o=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),yo=g=>({u_viewport_size:[g.width,g.height]}),vo=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),xo=(g,e,r,c)=>{const d=o.aM(g,1,e)/(o.a4*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:o.aM(g,1,e),u_intensity:r,u_globe_extrude_scale:d}},bo=(g,e,r,c)=>{const d=o.N();o.c6(d,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},Ms=(g,e,r)=>{const c=r.paint.get("hillshade-accent-color");let d;switch(r.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const _=r.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:gl(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:c,u_method:d,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},ml=(g,e)=>{const r=e.stride,c=o.N();return o.c6(c,0,o.a4,-o.a4,0,0,1),o.O(c,c,[0,-o.a4,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function gl(g,e){const r=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new o.aa(0,c/r).toLngLat().lat,new o.aa(0,(c+1)/r).toLngLat().lat]}const ma=(g,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:g.paint.get("color-relief-opacity")}),ga=(g,e,r,c)=>{const d=g.transform;return{u_translation:Io(g,e,r),u_ratio:c/o.aM(e,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ys=(g,e,r,c,d)=>o.e(ga(g,e,r,c),{u_image:0,u_image_height:d}),_l=(g,e,r,c,d)=>{const _=g.transform,v=Hs(e,_);return{u_translation:Io(g,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:c/o.aM(e,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[v,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},pu=(g,e,r,c,d)=>{const _=Hs(e,g.transform);return o.e(ga(g,e,r,c),{u_tileratio:_,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image:0,u_mix:d.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})},wo=(g,e,r,c,d,_)=>{const v=Hs(e,g.transform);return o.e(ga(g,e,r,c),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image_dash:1,u_mix:d.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})};function Hs(g,e){return 1/o.aM(g,1,e.tileZoom)}function Io(g,e,r){return o.aN(g.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const ja=(g,e,r,c,d)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(v=c.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=c.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:To(c.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var _,v};function To(g){g*=Math.PI/180;const e=Math.sin(g),r=Math.cos(g);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const _a=(g,e,r,c,d,_,v,k,C,R,O,X,Z)=>{const it=v.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:it.cameraToCenterDistance,u_pitch:it.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:it.width/it.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:k,u_coord_matrix:C,u_is_text:+O,u_pitch_with_map:+c,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:X,u_texture:0,u_translation:R,u_pitched_scale:Z}},Yr=(g,e,r,c,d,_,v,k,C,R,O,X,Z,it)=>{const ot=v.transform;return o.e(_a(g,e,r,c,d,_,v,k,C,R,O,X,it),{u_gamma_scale:c?Math.cos(ot.pitch*Math.PI/180)*ot.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},_s=(g,e,r,c,d,_,v,k,C,R,O,X,Z)=>o.e(Yr(g,e,r,c,d,_,v,k,C,R,!0,O,0,Z),{u_texsize_icon:X,u_texture_icon:1}),So=(g,e)=>({u_opacity:g,u_color:e}),Ga=(g,e,r,c,d)=>o.e((function(_,v,k,C){const R=k.imageManager.getPattern(_.from.toString()),O=k.imageManager.getPattern(_.to.toString()),{width:X,height:Z}=k.imageManager.getPixelSize(),it=Math.pow(2,C.tileID.overscaledZ),ot=C.tileSize*Math.pow(2,k.transform.tileZoom)/it,mt=ot*(C.tileID.canonical.x+C.tileID.wrap*it),gt=ot*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[X,Z],u_mix:v.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/o.aM(C,1,k.transform.tileZoom),u_pixel_coord_upper:[mt>>16,gt>>16],u_pixel_coord_lower:[65535&mt,65535&gt]}})(r,d,e,c),{u_opacity:g}),Ji=(g,e)=>{},yr={fillExtrusion:(g,e)=>({u_lightpos:new o.c1(g,e.u_lightpos),u_lightpos_globe:new o.c1(g,e.u_lightpos_globe),u_lightintensity:new o.bp(g,e.u_lightintensity),u_lightcolor:new o.c1(g,e.u_lightcolor),u_vertical_gradient:new o.bp(g,e.u_vertical_gradient),u_opacity:new o.bp(g,e.u_opacity),u_fill_translate:new o.c2(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new o.c1(g,e.u_lightpos),u_lightpos_globe:new o.c1(g,e.u_lightpos_globe),u_lightintensity:new o.bp(g,e.u_lightintensity),u_lightcolor:new o.c1(g,e.u_lightcolor),u_vertical_gradient:new o.bp(g,e.u_vertical_gradient),u_height_factor:new o.bp(g,e.u_height_factor),u_opacity:new o.bp(g,e.u_opacity),u_fill_translate:new o.c2(g,e.u_fill_translate),u_image:new o.bZ(g,e.u_image),u_texsize:new o.c2(g,e.u_texsize),u_pixel_coord_upper:new o.c2(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(g,e.u_pixel_coord_lower),u_scale:new o.c1(g,e.u_scale),u_fade:new o.bp(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new o.c2(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new o.bZ(g,e.u_image),u_texsize:new o.c2(g,e.u_texsize),u_pixel_coord_upper:new o.c2(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(g,e.u_pixel_coord_lower),u_scale:new o.c1(g,e.u_scale),u_fade:new o.bp(g,e.u_fade),u_fill_translate:new o.c2(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new o.c2(g,e.u_world),u_fill_translate:new o.c2(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new o.c2(g,e.u_world),u_image:new o.bZ(g,e.u_image),u_texsize:new o.c2(g,e.u_texsize),u_pixel_coord_upper:new o.c2(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(g,e.u_pixel_coord_lower),u_scale:new o.c1(g,e.u_scale),u_fade:new o.bp(g,e.u_fade),u_fill_translate:new o.c2(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new o.bp(g,e.u_camera_to_center_distance),u_scale_with_map:new o.bZ(g,e.u_scale_with_map),u_pitch_with_map:new o.bZ(g,e.u_pitch_with_map),u_extrude_scale:new o.c2(g,e.u_extrude_scale),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bp(g,e.u_globe_extrude_scale),u_translate:new o.c2(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new o.c2(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new o.c2(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new o.b_(g,e.u_color),u_overlay:new o.bZ(g,e.u_overlay),u_overlay_scale:new o.bp(g,e.u_overlay_scale)}),depth:Ji,clippingMask:Ji,heatmap:(g,e)=>({u_extrude_scale:new o.bp(g,e.u_extrude_scale),u_intensity:new o.bp(g,e.u_intensity),u_globe_extrude_scale:new o.bp(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new o.b$(g,e.u_matrix),u_world:new o.c2(g,e.u_world),u_image:new o.bZ(g,e.u_image),u_color_ramp:new o.bZ(g,e.u_color_ramp),u_opacity:new o.bp(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new o.bZ(g,e.u_image),u_latrange:new o.c2(g,e.u_latrange),u_exaggeration:new o.bp(g,e.u_exaggeration),u_altitudes:new o.c8(g,e.u_altitudes),u_azimuths:new o.c8(g,e.u_azimuths),u_accent:new o.b_(g,e.u_accent),u_method:new o.bZ(g,e.u_method),u_shadows:new o.c7(g,e.u_shadows),u_highlights:new o.c7(g,e.u_highlights)}),hillshadePrepare:(g,e)=>({u_matrix:new o.b$(g,e.u_matrix),u_image:new o.bZ(g,e.u_image),u_dimension:new o.c2(g,e.u_dimension),u_zoom:new o.bp(g,e.u_zoom),u_unpack:new o.c0(g,e.u_unpack)}),colorRelief:(g,e)=>({u_image:new o.bZ(g,e.u_image),u_unpack:new o.c0(g,e.u_unpack),u_dimension:new o.c2(g,e.u_dimension),u_elevation_stops:new o.bZ(g,e.u_elevation_stops),u_color_stops:new o.bZ(g,e.u_color_stops),u_color_ramp_size:new o.bZ(g,e.u_color_ramp_size),u_opacity:new o.bp(g,e.u_opacity)}),line:(g,e)=>({u_translation:new o.c2(g,e.u_translation),u_ratio:new o.bp(g,e.u_ratio),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new o.c2(g,e.u_translation),u_ratio:new o.bp(g,e.u_ratio),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(g,e.u_units_to_pixels),u_image:new o.bZ(g,e.u_image),u_image_height:new o.bp(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new o.c2(g,e.u_translation),u_texsize:new o.c2(g,e.u_texsize),u_ratio:new o.bp(g,e.u_ratio),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_image:new o.bZ(g,e.u_image),u_units_to_pixels:new o.c2(g,e.u_units_to_pixels),u_scale:new o.c1(g,e.u_scale),u_fade:new o.bp(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new o.c2(g,e.u_translation),u_ratio:new o.bp(g,e.u_ratio),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(g,e.u_units_to_pixels),u_image:new o.bZ(g,e.u_image),u_mix:new o.bp(g,e.u_mix),u_tileratio:new o.bp(g,e.u_tileratio),u_crossfade_from:new o.bp(g,e.u_crossfade_from),u_crossfade_to:new o.bp(g,e.u_crossfade_to),u_lineatlas_width:new o.bp(g,e.u_lineatlas_width),u_lineatlas_height:new o.bp(g,e.u_lineatlas_height)}),lineGradientSDF:(g,e)=>({u_translation:new o.c2(g,e.u_translation),u_ratio:new o.bp(g,e.u_ratio),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_units_to_pixels:new o.c2(g,e.u_units_to_pixels),u_image:new o.bZ(g,e.u_image),u_image_height:new o.bp(g,e.u_image_height),u_tileratio:new o.bp(g,e.u_tileratio),u_crossfade_from:new o.bp(g,e.u_crossfade_from),u_crossfade_to:new o.bp(g,e.u_crossfade_to),u_image_dash:new o.bZ(g,e.u_image_dash),u_mix:new o.bp(g,e.u_mix),u_lineatlas_width:new o.bp(g,e.u_lineatlas_width),u_lineatlas_height:new o.bp(g,e.u_lineatlas_height)}),raster:(g,e)=>({u_tl_parent:new o.c2(g,e.u_tl_parent),u_scale_parent:new o.bp(g,e.u_scale_parent),u_buffer_scale:new o.bp(g,e.u_buffer_scale),u_fade_t:new o.bp(g,e.u_fade_t),u_opacity:new o.bp(g,e.u_opacity),u_image0:new o.bZ(g,e.u_image0),u_image1:new o.bZ(g,e.u_image1),u_brightness_low:new o.bp(g,e.u_brightness_low),u_brightness_high:new o.bp(g,e.u_brightness_high),u_saturation_factor:new o.bp(g,e.u_saturation_factor),u_contrast_factor:new o.bp(g,e.u_contrast_factor),u_spin_weights:new o.c1(g,e.u_spin_weights),u_coords_top:new o.c0(g,e.u_coords_top),u_coords_bottom:new o.c0(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new o.bZ(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(g,e.u_is_size_feature_constant),u_size_t:new o.bp(g,e.u_size_t),u_size:new o.bp(g,e.u_size),u_camera_to_center_distance:new o.bp(g,e.u_camera_to_center_distance),u_pitch:new o.bp(g,e.u_pitch),u_rotate_symbol:new o.bZ(g,e.u_rotate_symbol),u_aspect_ratio:new o.bp(g,e.u_aspect_ratio),u_fade_change:new o.bp(g,e.u_fade_change),u_label_plane_matrix:new o.b$(g,e.u_label_plane_matrix),u_coord_matrix:new o.b$(g,e.u_coord_matrix),u_is_text:new o.bZ(g,e.u_is_text),u_pitch_with_map:new o.bZ(g,e.u_pitch_with_map),u_is_along_line:new o.bZ(g,e.u_is_along_line),u_is_variable_anchor:new o.bZ(g,e.u_is_variable_anchor),u_texsize:new o.c2(g,e.u_texsize),u_texture:new o.bZ(g,e.u_texture),u_translation:new o.c2(g,e.u_translation),u_pitched_scale:new o.bp(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new o.bZ(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(g,e.u_is_size_feature_constant),u_size_t:new o.bp(g,e.u_size_t),u_size:new o.bp(g,e.u_size),u_camera_to_center_distance:new o.bp(g,e.u_camera_to_center_distance),u_pitch:new o.bp(g,e.u_pitch),u_rotate_symbol:new o.bZ(g,e.u_rotate_symbol),u_aspect_ratio:new o.bp(g,e.u_aspect_ratio),u_fade_change:new o.bp(g,e.u_fade_change),u_label_plane_matrix:new o.b$(g,e.u_label_plane_matrix),u_coord_matrix:new o.b$(g,e.u_coord_matrix),u_is_text:new o.bZ(g,e.u_is_text),u_pitch_with_map:new o.bZ(g,e.u_pitch_with_map),u_is_along_line:new o.bZ(g,e.u_is_along_line),u_is_variable_anchor:new o.bZ(g,e.u_is_variable_anchor),u_texsize:new o.c2(g,e.u_texsize),u_texture:new o.bZ(g,e.u_texture),u_gamma_scale:new o.bp(g,e.u_gamma_scale),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_is_halo:new o.bZ(g,e.u_is_halo),u_translation:new o.c2(g,e.u_translation),u_pitched_scale:new o.bp(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new o.bZ(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bZ(g,e.u_is_size_feature_constant),u_size_t:new o.bp(g,e.u_size_t),u_size:new o.bp(g,e.u_size),u_camera_to_center_distance:new o.bp(g,e.u_camera_to_center_distance),u_pitch:new o.bp(g,e.u_pitch),u_rotate_symbol:new o.bZ(g,e.u_rotate_symbol),u_aspect_ratio:new o.bp(g,e.u_aspect_ratio),u_fade_change:new o.bp(g,e.u_fade_change),u_label_plane_matrix:new o.b$(g,e.u_label_plane_matrix),u_coord_matrix:new o.b$(g,e.u_coord_matrix),u_is_text:new o.bZ(g,e.u_is_text),u_pitch_with_map:new o.bZ(g,e.u_pitch_with_map),u_is_along_line:new o.bZ(g,e.u_is_along_line),u_is_variable_anchor:new o.bZ(g,e.u_is_variable_anchor),u_texsize:new o.c2(g,e.u_texsize),u_texsize_icon:new o.c2(g,e.u_texsize_icon),u_texture:new o.bZ(g,e.u_texture),u_texture_icon:new o.bZ(g,e.u_texture_icon),u_gamma_scale:new o.bp(g,e.u_gamma_scale),u_device_pixel_ratio:new o.bp(g,e.u_device_pixel_ratio),u_is_halo:new o.bZ(g,e.u_is_halo),u_translation:new o.c2(g,e.u_translation),u_pitched_scale:new o.bp(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new o.bp(g,e.u_opacity),u_color:new o.b_(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new o.bp(g,e.u_opacity),u_image:new o.bZ(g,e.u_image),u_pattern_tl_a:new o.c2(g,e.u_pattern_tl_a),u_pattern_br_a:new o.c2(g,e.u_pattern_br_a),u_pattern_tl_b:new o.c2(g,e.u_pattern_tl_b),u_pattern_br_b:new o.c2(g,e.u_pattern_br_b),u_texsize:new o.c2(g,e.u_texsize),u_mix:new o.bp(g,e.u_mix),u_pattern_size_a:new o.c2(g,e.u_pattern_size_a),u_pattern_size_b:new o.c2(g,e.u_pattern_size_b),u_scale_a:new o.bp(g,e.u_scale_a),u_scale_b:new o.bp(g,e.u_scale_b),u_pixel_coord_upper:new o.c2(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.c2(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bp(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new o.bZ(g,e.u_texture),u_ele_delta:new o.bp(g,e.u_ele_delta),u_fog_matrix:new o.b$(g,e.u_fog_matrix),u_fog_color:new o.b_(g,e.u_fog_color),u_fog_ground_blend:new o.bp(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bp(g,e.u_fog_ground_blend_opacity),u_horizon_color:new o.b_(g,e.u_horizon_color),u_horizon_fog_blend:new o.bp(g,e.u_horizon_fog_blend),u_is_globe_mode:new o.bp(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new o.bp(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new o.bZ(g,e.u_texture),u_terrain_coords_id:new o.bp(g,e.u_terrain_coords_id),u_ele_delta:new o.bp(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new o.bp(g,e.u_input),u_output_expected:new o.bp(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new o.c1(g,e.u_sun_pos),u_atmosphere_blend:new o.bp(g,e.u_atmosphere_blend),u_globe_position:new o.c1(g,e.u_globe_position),u_globe_radius:new o.bp(g,e.u_globe_radius),u_inv_proj_matrix:new o.b$(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new o.b_(g,e.u_sky_color),u_horizon_color:new o.b_(g,e.u_horizon_color),u_horizon:new o.c2(g,e.u_horizon),u_horizon_normal:new o.c2(g,e.u_horizon_normal),u_sky_horizon_blend:new o.bp(g,e.u_sky_horizon_blend),u_sky_blend:new o.bp(g,e.u_sky_blend)})};class m{constructor(e,r,c){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const s={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class l{constructor(e,r,c,d){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.context=e;const _=e.gl;this.buffer=_.createBuffer(),e.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let c=0;c<this.attributes.length;c++){const d=r.attributes[this.attributes[c].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,r,c){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],v=r.attributes[_.name];v!==void 0&&e.vertexAttribPointer(v,_.components,e[s[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class p{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class w extends p{getDefault(){return o.bo.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class D extends p{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class B extends p{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Q extends p{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ht extends p{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vt extends p{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Yt extends p{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ne extends p{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Se extends p{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ve extends p{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class $e extends p{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class tn extends p{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class fn extends p{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Sn extends p{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Bn extends p{getDefault(){return o.bo.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class wi extends p{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ni extends p{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Hr extends p{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ys extends p{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ks extends p{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ya extends p{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Eo extends p{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ps extends p{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Cs extends p{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ko extends p{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class va extends p{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class gn extends p{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class yl extends p{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const c=this.gl;kr(c)?c.bindVertexArray(e):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Gh extends p{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class yc extends p{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Mo extends p{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class mu extends p{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Uh extends mu{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class vc extends mu{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class qh extends mu{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const vl="Framebuffer is not complete";class xl{constructor(e,r,c,d,_){this.context=e,this.width=r,this.height=c;const v=e.gl,k=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Uh(e,k),d)this.depthAttachment=_?new qh(e,k):new vc(e,k);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(vl)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class bl{constructor(e){var r,c;if(this.gl=e,this.clearColor=new w(this),this.clearDepth=new D(this),this.clearStencil=new B(this),this.colorMask=new Q(this),this.depthMask=new ht(this),this.stencilMask=new vt(this),this.stencilFunc=new Yt(this),this.stencilOp=new ne(this),this.stencilTest=new Se(this),this.depthRange=new Ve(this),this.depthTest=new $e(this),this.depthFunc=new tn(this),this.blend=new fn(this),this.blendFunc=new Sn(this),this.blendColor=new Bn(this),this.blendEquation=new wi(this),this.cullFace=new ni(this),this.cullFaceSide=new Hr(this),this.frontFace=new ys(this),this.program=new Ks(this),this.activeTexture=new ya(this),this.viewport=new Eo(this),this.bindFramebuffer=new Ps(this),this.bindRenderbuffer=new Cs(this),this.bindTexture=new ko(this),this.bindVertexBuffer=new va(this),this.bindElementBuffer=new gn(this),this.bindVertexArray=new yl(this),this.pixelStoreUnpack=new Gh(this),this.pixelStoreUnpackPremultiplyAlpha=new yc(this),this.pixelStoreUnpackFlipY=new Mo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),kr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:d?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new m(this,e,r)}createVertexBuffer(e,r,c){return new l(this,e,r,c)}createRenderbuffer(e,r,c){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,e,r,c),this.bindRenderbuffer.set(null),_}createFramebuffer(e,r,c,d){return new xl(this,e,r,c,d)}clear({color:e,depth:r,stencil:c}){const d=this.gl;let _=0;e&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(_)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bQ(e.blendFunction,Fn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return kr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return kr(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let xa;function wl(g,e,r,c,d){const _=g.context,v=g.transform,k=_.gl,C=g.useProgram("collisionBox"),R=[];let O=0,X=0;for(let yt=0;yt<c.length;yt++){const Ct=c[yt],zt=e.getTile(Ct).getBucket(r);if(!zt)continue;const St=d?zt.textCollisionBox:zt.iconCollisionBox,Nt=zt.collisionCircleArray;Nt.length>0&&(R.push({circleArray:Nt,circleOffset:X,coord:Ct}),O+=Nt.length/4,X=O),St&&C.draw(_,k.LINES,mn.disabled,dn.disabled,g.colorModeForRenderPass(),Tn.disabled,_o(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ct),v.getProjectionData({overscaledTileID:Ct,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,g.transform.zoom,null,null,St.collisionVertexBuffer)}if(!d||!R.length)return;const Z=g.useProgram("collisionCircle"),it=new o.c9;it.resize(4*O),it._trim();let ot=0;for(const yt of R)for(let Ct=0;Ct<yt.circleArray.length/4;Ct++){const zt=4*Ct,St=yt.circleArray[zt+0],Nt=yt.circleArray[zt+1],Ft=yt.circleArray[zt+2],At=yt.circleArray[zt+3];it.emplace(ot++,St,Nt,Ft,At,0),it.emplace(ot++,St,Nt,Ft,At,1),it.emplace(ot++,St,Nt,Ft,At,2),it.emplace(ot++,St,Nt,Ft,At,3)}(!xa||xa.length<2*O)&&(xa=(function(yt){const Ct=2*yt,zt=new o.cb;zt.resize(Ct),zt._trim();for(let St=0;St<Ct;St++){const Nt=6*St;zt.uint16[Nt+0]=4*St+0,zt.uint16[Nt+1]=4*St+1,zt.uint16[Nt+2]=4*St+2,zt.uint16[Nt+3]=4*St+2,zt.uint16[Nt+4]=4*St+3,zt.uint16[Nt+5]=4*St+0}return zt})(O));const mt=_.createIndexBuffer(xa,!0),gt=_.createVertexBuffer(it,o.ca.members,!0);for(const yt of R){const Ct=yo(g.transform);Z.draw(_,k.TRIANGLES,mn.disabled,dn.disabled,g.colorModeForRenderPass(),Tn.disabled,Ct,g.style.map.terrain&&g.style.map.terrain.getTerrainData(yt.coord),null,r.id,gt,mt,o.aW.simpleSegment(0,2*yt.circleOffset,yt.circleArray.length,yt.circleArray.length/2),null,g.transform.zoom,null,null,null)}gt.destroy(),mt.destroy()}const xc=o.ar(new Float32Array(16));function Il(g,e,r,c,d,_){const{horizontalAlign:v,verticalAlign:k}=o.aR(g);return new o.P((-(v-.5)*e/d+c[0])*_,(-(k-.5)*r/d+c[1])*_)}function Tl(g,e,r,c,d,_){const v=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let k=c.mult(_);r||(k=k.rotate(-d));const C=v.add(k);return je(C.x,C.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const k=Tr(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),C=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return g.add(c.rotate(C))}return g.add(c)}function Sl(g,e,r,c,d,_,v,k,C,R,O,X){const Z=g.text.placedSymbolArray,it=g.text.dynamicLayoutVertexArray,ot=g.icon.dynamicLayoutVertexArray,mt={};it.clear();for(let gt=0;gt<Z.length;gt++){const yt=Z.get(gt),Ct=yt.hidden||!yt.crossTileID||g.allowVerticalPlacement&&!yt.placedOrientation?null:c[yt.crossTileID];if(Ct){const zt=new o.P(yt.anchorX,yt.anchorY),St={getElevation:X,width:d.width,height:d.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:d,tileAnchorPoint:zt,translation:R,unwrappedTileID:O},Nt=r?es(zt.x,zt.y,St):Tr(zt.x,zt.y,St),Ft=Qe(d.cameraToCenterDistance,Nt.signedDistanceFromCamera);let At=o.az(g.textSizeData,k,yt)*Ft/o.aL;r&&(At*=g.tilePixelRatio/v);const{width:qt,height:oe,anchor:ee,textOffset:ie,textBoxScale:ae}=Ct,De=Il(ee,qt,oe,ie,ae,At),Me=d.getPitchedTextCorrection(zt.x+R[0],zt.y+R[1],O),ve=Tl(Nt.point,St,e,De,-d.bearingInRadians,Me),Ze=g.allowVerticalPlacement&&yt.placedOrientation===o.ay.vertical?Math.PI/2:0;for(let hn=0;hn<yt.numGlyphs;hn++)o.aF(it,ve,Ze);C&&yt.associatedIconIndex>=0&&(mt[yt.associatedIconIndex]={shiftedAnchor:ve,angle:Ze})}else Vr(yt.numGlyphs,it)}if(C){ot.clear();const gt=g.icon.placedSymbolArray;for(let yt=0;yt<gt.length;yt++){const Ct=gt.get(yt);if(Ct.hidden)Vr(Ct.numGlyphs,ot);else{const zt=mt[yt];if(zt)for(let St=0;St<Ct.numGlyphs;St++)o.aF(ot,zt.shiftedAnchor,zt.angle);else Vr(Ct.numGlyphs,ot)}}g.icon.dynamicLayoutVertexBuffer.updateData(ot)}g.text.dynamicLayoutVertexBuffer.updateData(it)}function Ua(g,e,r){return r.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function El(g,e,r,c,d,_,v,k,C,R,O,X,Z){const it=g.context,ot=it.gl,mt=g.transform,gt=k==="map",yt=C==="map",Ct=k!=="viewport"&&r.layout.get("symbol-placement")!=="point",zt=gt&&!yt&&!Ct,St=!r.layout.get("symbol-sort-key").isConstant();let Nt=!1;const Ft=g.getDepthModeForSublayer(0,mn.ReadOnly),At=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),qt=[],oe=mt.getCircleRadiusCorrection();for(const ee of c){const ie=e.getTile(ee),ae=ie.getBucket(r);if(!ae)continue;const De=d?ae.text:ae.icon;if(!De||!De.segments.get().length||!De.hasVisibleVertices)continue;const Me=De.programConfigurations.get(r.id),ve=d||ae.sdfIcons,Ze=d?ae.textSizeData:ae.iconSizeData,hn=yt||mt.pitch!==0,on=g.useProgram(Ua(ve,d,ae),Me),Yn=o.ax(Ze,mt.zoom),Hn=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ee);let ri,Wn,Ci,ti,Ii=[0,0],mi=null;if(d)Wn=ie.glyphAtlasTexture,Ci=ot.LINEAR,ri=ie.glyphAtlasTexture.size,ae.iconsInText&&(Ii=ie.imageAtlasTexture.size,mi=ie.imageAtlasTexture,ti=hn||g.options.rotating||g.options.zooming||Ze.kind==="composite"||Ze.kind==="camera"?ot.LINEAR:ot.NEAREST);else{const ci=r.layout.get("icon-size").constantOr(0)!==1||ae.iconsNeedLinear;Wn=ie.imageAtlasTexture,Ci=ve||g.options.rotating||g.options.zooming||ci||hn?ot.LINEAR:ot.NEAREST,ri=ie.imageAtlasTexture.size}const Ti=o.aM(ie,1,g.transform.zoom),xr=di(gt,g.transform,Ti),Rs=o.N();o.aA(Rs,xr);const vs=Nn(yt,gt,g.transform,Ti),ta=o.aN(mt,ie,_,v),ea=mt.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Ea=At&&ae.hasTextData(),Qr=r.layout.get("icon-text-fit")!=="none"&&Ea&&ae.hasIconData();if(Ct){const ci=g.style.map.terrain?(Ai,Xn)=>g.style.map.terrain.getElevation(ee,Ai,Xn):null,si=r.layout.get("text-rotation-alignment")==="map";or(ae,g,d,xr,Rs,yt,R,si,ee.toUnwrapped(),mt.width,mt.height,ta,ci)}const zs=d&&At||Qr,Dr=Ct||zs?xc:yt?xr:g.transform.clipSpaceToPixelsMatrix,Ns=ve&&r.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ka;ka=ve?ae.iconsInText?_s(Ze.kind,Yn,zt,yt,Ct,zs,g,Dr,vs,ta,ri,Ii,oe):Yr(Ze.kind,Yn,zt,yt,Ct,zs,g,Dr,vs,ta,d,ri,0,oe):_a(Ze.kind,Yn,zt,yt,Ct,zs,g,Dr,vs,ta,d,ri,oe);const Ma={program:on,buffers:De,uniformValues:ka,projectionData:ea,atlasTexture:Wn,atlasTextureIcon:mi,atlasInterpolation:Ci,atlasInterpolationIcon:ti,isSDF:ve,hasHalo:Ns};if(St&&ae.canOverlap){Nt=!0;const ci=De.segments.get();for(const si of ci)qt.push({segments:new o.aW([si]),sortKey:si.sortKey,state:Ma,terrainData:Hn})}else qt.push({segments:De.segments,sortKey:0,state:Ma,terrainData:Hn})}Nt&&qt.sort(((ee,ie)=>ee.sortKey-ie.sortKey));for(const ee of qt){const ie=ee.state;if(it.activeTexture.set(ot.TEXTURE0),ie.atlasTexture.bind(ie.atlasInterpolation,ot.CLAMP_TO_EDGE),ie.atlasTextureIcon&&(it.activeTexture.set(ot.TEXTURE1),ie.atlasTextureIcon&&ie.atlasTextureIcon.bind(ie.atlasInterpolationIcon,ot.CLAMP_TO_EDGE)),ie.isSDF){const ae=ie.uniformValues;ie.hasHalo&&(ae.u_is_halo=1,bc(ie.buffers,ee.segments,r,g,ie.program,Ft,O,X,ae,ie.projectionData,ee.terrainData)),ae.u_is_halo=0}bc(ie.buffers,ee.segments,r,g,ie.program,Ft,O,X,ie.uniformValues,ie.projectionData,ee.terrainData)}}function bc(g,e,r,c,d,_,v,k,C,R,O){const X=c.context;d.draw(X,X.gl.TRIANGLES,_,v,k,Tn.backCCW,C,O,R,r.id,g.layoutVertexBuffer,g.indexBuffer,e,r.paint,c.transform.zoom,g.programConfigurations.get(r.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Po(g,e,r,c,d){const _=g.context,v=_.gl,k=dn.disabled,C=new Fn([v.ONE,v.ONE],o.bo.transparent,[!0,!0,!0,!0]),R=e.getBucket(r);if(!R)return;const O=c.key;let X=r.heatmapFbos.get(O);X||(X=gu(_,e.tileSize,e.tileSize),r.heatmapFbos.set(O,X)),_.bindFramebuffer.set(X.framebuffer),_.viewport.set([0,0,e.tileSize,e.tileSize]),_.clear({color:o.bo.transparent});const Z=R.programConfigurations.get(r.id),it=g.useProgram("heatmap",Z,!d),ot=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),mt=g.style.map.terrain.getTerrainData(c);it.draw(_,v.TRIANGLES,mn.disabled,k,C,Tn.disabled,xo(e,g.transform.zoom,r.paint.get("heatmap-intensity"),1),mt,ot,r.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,r.paint,g.transform.zoom,Z)}function Zh(g,e,r,c,d){const _=g.context,v=_.gl,k=g.transform;_.setColorMode(g.colorModeForRenderPass());const C=Co(_,e),R=r.key,O=e.heatmapFbos.get(R);if(!O)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,O.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),C.bind(v.LINEAR,v.CLAMP_TO_EDGE);const X=k.getProjectionData({overscaledTileID:r,applyTerrainMatrix:d,applyGlobeMatrix:!c});g.useProgram("heatmapTexture").draw(_,v.TRIANGLES,mn.disabled,dn.disabled,g.colorModeForRenderPass(),Tn.disabled,bo(g,e,0,1),null,X,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,k.zoom),O.destroy(),e.heatmapFbos.delete(R)}function gu(g,e,r){var c,d;const _=g.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const k=(c=g.HALF_FLOAT)!==null&&c!==void 0?c:_.UNSIGNED_BYTE,C=(d=g.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,C,e,r,0,_.RGBA,k,null);const R=g.createFramebuffer(e,r,!1,!1);return R.colorAttachment.set(v),R}function Co(g,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function kl(g,e,r,c,d,_,v,k){let C=256;if(d.stepInterpolant){const R=e.getSource().maxzoom,O=v.canonical.z===R?Math.ceil(1<<g.transform.maxZoom-v.canonical.z):1;C=o.an(o.cd(_.maxLineLength/o.a4*1024*O),256,r.maxTextureSize)}return k.gradient=o.ce({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:C,image:k.gradient||void 0,clips:_.lineClipsArray}),k.texture?k.texture.update(k.gradient):k.texture=new o.T(r,k.gradient,c.RGBA),k.version=d.gradientVersion,k.texture}function wc(g,e,r,c,d){g.activeTexture.set(e.TEXTURE0),r.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),c.updatePaintBuffers(d)}function Ic(g,e,r,c,d,_){(d||g.lineAtlas.dirty)&&(e.activeTexture.set(r.TEXTURE0),g.lineAtlas.bind(e)),c.updatePaintBuffers(_)}function Ml(g,e,r,c,d,_,v){const k=_.gradients[d.id];let C=k.texture;d.gradientVersion!==k.version&&(C=kl(g,e,r,c,d,_,v,k)),r.activeTexture.set(c.TEXTURE0),C.bind(d.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function _u(g,e,r,c,d,_,v,k,C){const R=_.gradients[d.id];let O=R.texture;d.gradientVersion!==R.version&&(O=kl(g,e,r,c,d,_,v,R)),r.activeTexture.set(c.TEXTURE0),O.bind(d.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),r.activeTexture.set(c.TEXTURE1),g.lineAtlas.bind(r),k.updatePaintBuffers(C)}function Tc(g,e,r,c,d){if(!r||!c||!c.imageAtlas)return;const _=c.imageAtlas.patternPositions;let v=_[r.to.toString()],k=_[r.from.toString()];if(!v&&k&&(v=k),!k&&v&&(k=v),!v||!k){const C=d.getPaintProperty(e);v=_[C],k=_[C]}v&&k&&g.setConstantPatternPositions(v,k)}function yu(g,e,r,c,d,_,v,k){const C=g.context.gl,R="fill-pattern",O=r.paint.get(R),X=O&&O.constantOr(1),Z=r.getCrossfadeParameters();let it,ot,mt,gt,yt;const Ct=g.transform,zt=r.paint.get("fill-translate"),St=r.paint.get("fill-translate-anchor");v?(ot=X&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",it=C.LINES):(ot=X?"fillPattern":"fill",it=C.TRIANGLES);const Nt=O.constantOr(null);for(const Ft of c){const At=e.getTile(Ft);if(X&&!At.patternsLoaded())continue;const qt=At.getBucket(r);if(!qt)continue;const oe=qt.programConfigurations.get(r.id),ee=g.useProgram(ot,oe),ie=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ft);X&&(g.context.activeTexture.set(C.TEXTURE0),At.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),oe.updatePaintBuffers(Z)),Tc(oe,R,Nt,At,r);const ae=Ct.getProjectionData({overscaledTileID:Ft,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),De=o.aN(Ct,At,zt,St);if(v){gt=qt.indexBuffer2,yt=qt.segments2;const ve=[C.drawingBufferWidth,C.drawingBufferHeight];mt=ot==="fillOutlinePattern"&&X?fu(g,Z,At,ve,De):pl(ve,De)}else gt=qt.indexBuffer,yt=qt.segments,mt=X?fl(g,Z,At,De):{u_fill_translate:De};const Me=g.stencilModeForClipping(Ft);ee.draw(g.context,it,d,Me,_,Tn.backCCW,mt,ie,ae,r.id,qt.layoutVertexBuffer,gt,yt,r.paint,g.transform.zoom,oe)}}function ii(g,e,r,c,d,_,v,k){const C=g.context,R=C.gl,O="fill-extrusion-pattern",X=r.paint.get(O),Z=X.constantOr(1),it=r.getCrossfadeParameters(),ot=r.paint.get("fill-extrusion-opacity"),mt=X.constantOr(null),gt=g.transform;for(const yt of c){const Ct=e.getTile(yt),zt=Ct.getBucket(r);if(!zt)continue;const St=g.style.map.terrain&&g.style.map.terrain.getTerrainData(yt),Nt=zt.programConfigurations.get(r.id),Ft=g.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",Nt);Z&&(g.context.activeTexture.set(R.TEXTURE0),Ct.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Nt.updatePaintBuffers(it));const At=gt.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!k,applyTerrainMatrix:!0});Tc(Nt,O,mt,Ct,r);const qt=o.aN(gt,Ct,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),oe=r.paint.get("fill-extrusion-vertical-gradient"),ee=Z?Xs(g,oe,ot,qt,yt,it,Ct):dl(g,oe,ot,qt);Ft.draw(C,C.gl.TRIANGLES,d,_,v,Tn.backCCW,ee,St,At,r.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,r.paint,g.transform.zoom,Nt,g.style.map.terrain&&zt.centroidVertexBuffer)}}function As(g,e,r,c,d,_,v,k,C){var R;const O=g.style.projection,X=g.context,Z=g.transform,it=X.gl,ot=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],mt=g.useProgram("hillshade",null,!1,ot),gt=!g.options.moving;for(const yt of c){const Ct=e.getTile(yt),zt=Ct.fbo;if(!zt)continue;const St=O.getMeshFromTileID(X,yt.canonical,k,!0,"raster"),Nt=(R=g.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(yt);X.activeTexture.set(it.TEXTURE0),it.bindTexture(it.TEXTURE_2D,zt.colorAttachment.get());const Ft=Z.getProjectionData({overscaledTileID:yt,aligned:gt,applyGlobeMatrix:!C,applyTerrainMatrix:!0});mt.draw(X,it.TRIANGLES,_,d[yt.overscaledZ],v,Tn.backCCW,Ms(g,Ct,r),Nt,Ft,r.id,St.vertexBuffer,St.indexBuffer,St.segments)}}function vr(g,e,r,c,d,_,v,k,C){var R;const O=g.style.projection,X=g.context,Z=g.transform,it=X.gl,ot=g.useProgram("colorRelief"),mt=!g.options.moving;let gt=!0,yt=0;for(const Ct of c){const zt=e.getTile(Ct),St=zt.dem;if(gt){const ee=it.getParameter(it.MAX_TEXTURE_SIZE),{elevationTexture:ie,colorTexture:ae}=r.getColorRampTextures(X,ee,St.getUnpackVector());X.activeTexture.set(it.TEXTURE1),ie.bind(it.NEAREST,it.CLAMP_TO_EDGE),X.activeTexture.set(it.TEXTURE4),ae.bind(it.LINEAR,it.CLAMP_TO_EDGE),gt=!1,yt=ie.size[0]}if(!St||!St.data)continue;const Nt=St.stride,Ft=St.getPixels();if(X.activeTexture.set(it.TEXTURE0),X.pixelStoreUnpackPremultiplyAlpha.set(!1),zt.demTexture=zt.demTexture||g.getTileTexture(Nt),zt.demTexture){const ee=zt.demTexture;ee.update(Ft,{premultiply:!1}),ee.bind(it.LINEAR,it.CLAMP_TO_EDGE)}else zt.demTexture=new o.T(X,Ft,it.RGBA,{premultiply:!1}),zt.demTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE);const At=O.getMeshFromTileID(X,Ct.canonical,k,!0,"raster"),qt=(R=g.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(Ct),oe=Z.getProjectionData({overscaledTileID:Ct,aligned:mt,applyGlobeMatrix:!C,applyTerrainMatrix:!0});ot.draw(X,it.TRIANGLES,_,d[Ct.overscaledZ],v,Tn.backCCW,ma(r,zt.dem,yt),qt,oe,r.id,At.vertexBuffer,At.indexBuffer,At.segments)}}const Ao=[new o.P(0,0),new o.P(o.a4,0),new o.P(o.a4,o.a4),new o.P(0,o.a4)];function ba(g,e,r,c,d,_,v,k,C=!1,R=!1){const O=c[c.length-1].overscaledZ,X=g.context,Z=X.gl,it=g.useProgram("raster"),ot=g.transform,mt=g.style.projection,gt=g.colorModeForRenderPass(),yt=!g.options.moving,Ct=r.paint.get("raster-opacity"),zt=r.paint.get("raster-resampling"),St=r.paint.get("raster-fade-duration"),Nt=!!g.style.map.terrain;for(const Ft of c){const At=g.getDepthModeForSublayer(Ft.overscaledZ-O,Ct===1?mn.ReadWrite:mn.ReadOnly,Z.LESS),qt=e.getTile(Ft),oe=zt==="nearest"?Z.NEAREST:Z.LINEAR;X.activeTexture.set(Z.TEXTURE0),qt.texture.bind(oe,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),X.activeTexture.set(Z.TEXTURE1);const{parentTile:ee,parentScaleBy:ie,parentTopLeft:ae,fadeValues:De}=Sc(qt,e,St,Nt);qt.fadeOpacity=De.tileOpacity,ee?(ee.fadeOpacity=De.parentTileOpacity,ee.texture.bind(oe,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST)):qt.texture.bind(oe,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),qt.texture.useMipmap&&X.extTextureFilterAnisotropic&&g.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const Me=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ft),ve=ot.getProjectionData({overscaledTileID:Ft,aligned:yt,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ze=ja(ae,ie,De.fadeMix,r,k),hn=mt.getMeshFromTileID(X,Ft.canonical,_,v,"raster");it.draw(X,Z.TRIANGLES,At,d?d[Ft.overscaledZ]:dn.disabled,gt,C?Tn.frontCCW:Tn.backCCW,Ze,Me,ve,r.id,hn.vertexBuffer,hn.indexBuffer,hn.segments)}}function Sc(g,e,r,c){const d={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||c)return d;if(g.fadingParentID){const _=e.getLoadedTile(g.fadingParentID);if(!_)return d;const v=Math.pow(2,_.tileID.overscaledZ-g.tileID.overscaledZ),k=[g.tileID.canonical.x*v%1,g.tileID.canonical.y*v%1],C=(function(R,O,X){const Z=J(),it=(Z-O.timeAdded)/X,ot=R.fadingDirection===wt.Incoming,mt=o.an((Z-R.timeAdded)/X,0,1),gt=o.an(1-it,0,1),yt=ot?mt:gt;return{tileOpacity:yt,parentTileOpacity:ot?gt:mt,fadeMix:{opacity:1,mix:1-yt}}})(g,_,r);return{parentTile:_,parentScaleBy:v,parentTopLeft:k,fadeValues:C}}if(g.selfFading){const _=(function(v,k){const C=(J()-v.timeAdded)/k,R=o.an(C,0,1);return{tileOpacity:R,fadeMix:{opacity:R,mix:0}}})(g,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return d}const qa=new o.bo(1,0,0,1),vu=new o.bo(0,1,0,1),Lo=new o.bo(0,0,1,1),xu=new o.bo(1,0,1,1),Ec=new o.bo(0,1,1,1);function bu(g,e,r,c){Do(g,0,e+r/2,g.transform.width,r,c)}function wu(g,e,r,c){Do(g,e-r/2,0,r,g.transform.height,c)}function Do(g,e,r,c,d,_){const v=g.context,k=v.gl;k.enable(k.SCISSOR_TEST),k.scissor(e*g.pixelRatio,r*g.pixelRatio,c*g.pixelRatio,d*g.pixelRatio),v.clear({color:_}),k.disable(k.SCISSOR_TEST)}function kc(g,e,r){const c=g.context,d=c.gl,_=g.useProgram("debug"),v=mn.disabled,k=dn.disabled,C=g.colorModeForRenderPass(),R="$debug",O=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);c.activeTexture.set(d.TEXTURE0);const X=e.getTileByID(r.key).latestRawTileData,Z=Math.floor((X&&X.byteLength||0)/1024),it=e.getTile(r).tileSize,ot=512/Math.min(it,512)*(r.overscaledZ/g.transform.zoom)*.5;let mt=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(mt+=` => ${r.overscaledZ}`),(function(yt,Ct){yt.initDebugOverlayCanvas();const zt=yt.debugOverlayCanvas,St=yt.context.gl,Nt=yt.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,zt.width,zt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(Ct,5,5),Nt.strokeText(Ct,5,5),yt.debugOverlayTexture.update(zt),yt.debugOverlayTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE)})(g,`${mt} ${Z}kB`);const gt=g.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(c,d.TRIANGLES,v,k,Fn.alphaBlended,Tn.disabled,vo(o.bo.transparent,ot),null,gt,R,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(c,d.LINE_STRIP,v,k,C,Tn.disabled,vo(o.bo.red),O,gt,R,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Js(g,e,r,c){const{isRenderingGlobe:d}=c,_=g.context,v=_.gl,k=g.transform,C=g.colorModeForRenderPass(),R=g.getDepthModeFor3D(),O=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const X of r){const Z=e.getTerrainMesh(X.tileID),it=g.renderToTexture.getTexture(X),ot=e.getTerrainData(X.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,it.texture);const mt=e.getMeshFrameDelta(k.zoom),gt=k.calculateFogMatrix(X.tileID.toUnwrapped()),yt=Va(mt,gt,g.style.sky,k.pitch,d),Ct=k.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(_,v.TRIANGLES,R,dn.disabled,C,Tn.backCCW,yt,ot,Ct,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}function Iu(g,e){if(!e.mesh){const r=new o.aV;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new o.aX;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new _i(g.createVertexBuffer(r,Cn.members),g.createIndexBuffer(c),o.aW.simpleSegment(0,0,r.length,c.length))}return e.mesh}class Mc{constructor(e,r){this.context=new bl(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=vn.maxOverzooming+vn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ln}resize(e,r,c){if(this.width=Math.floor(e*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,r=new o.aV;r.emplaceBack(0,0),r.emplaceBack(o.a4,0),r.emplaceBack(0,o.a4),r.emplaceBack(o.a4,o.a4),this.tileExtentBuffer=e.createVertexBuffer(r,Cn.members),this.tileExtentSegments=o.aW.simpleSegment(0,0,4,2);const c=new o.aV;c.emplaceBack(0,0),c.emplaceBack(o.a4,0),c.emplaceBack(0,o.a4),c.emplaceBack(o.a4,o.a4),this.debugBuffer=e.createVertexBuffer(c,Cn.members),this.debugSegments=o.aW.simpleSegment(0,0,4,5);const d=new o.cg;d.emplaceBack(0,0,0,0),d.emplaceBack(o.a4,0,o.a4,0),d.emplaceBack(0,o.a4,0,o.a4),d.emplaceBack(o.a4,o.a4,o.a4,o.a4),this.rasterBoundsBuffer=e.createVertexBuffer(d,Lr.members),this.rasterBoundsSegments=o.aW.simpleSegment(0,0,4,2);const _=new o.aV;_.emplaceBack(0,0),_.emplaceBack(o.a4,0),_.emplaceBack(0,o.a4),_.emplaceBack(o.a4,o.a4),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(_,Cn.members),this.rasterBoundsSegmentsPosOnly=o.aW.simpleSegment(0,0,4,5);const v=new o.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,Cn.members),this.viewportSegments=o.aW.simpleSegment(0,0,4,2);const k=new o.ch;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(k);const C=new o.aX;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(C);const R=this.context.gl;this.stencilClearMode=new dn({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new _i(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=o.N();o.c6(c,0,this.width,this.height,0,0,1),o.Q(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const d={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,mn.disabled,this.stencilClearMode,Fn.disabled,Tn.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const d=this.context;d.setColorMode(Fn.disabled),d.setDepthMode(mn.disabled);const _={};for(const v of r)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,r,c,!0),this._renderTileMasks(_,r,c,!1),this._tileClippingMaskIDs=_}_renderTileMasks(e,r,c,d){const _=this.context,v=_.gl,k=this.style.projection,C=this.transform,R=this.useProgram("clippingMask");for(const O of r){const X=e[O.key],Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),it=k.getMeshFromTileID(this.context,O.canonical,d,!0,"stencil"),ot=C.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!c,applyTerrainMatrix:!0});R.draw(_,v.TRIANGLES,mn.disabled,new dn({func:v.ALWAYS,mask:0},X,255,v.KEEP,v.KEEP,v.REPLACE),Fn.disabled,c?Tn.disabled:Tn.backCCW,null,Z,ot,"$clipping",it.vertexBuffer,it.indexBuffer,it.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,c=this.style.projection,d=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),k=an(d,{tileSize:d.tileSize});for(const C of k){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),O=c.getMeshFromTileID(this.context,C.canonical,!0,!0,"raster"),X=d.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(e,r.TRIANGLES,v,dn.disabled,Fn.disabled,Tn.backCCW,null,R,X,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new dn({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new dn({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,c=e.sort(((v,k)=>k.overscaledZ-v.overscaledZ)),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let k=0;k<_;k++)v[k+d]=new dn({func:r.GEQUAL,mask:255},k+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[v,c]}return[{[d]:dn.disabled},c]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,c=e.sort(((v,k)=>k.overscaledZ-v.overscaledZ)),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(this.clearStencil(),_>1){const v={},k={};for(let C=0;C<_;C++)v[C+d]=new dn({func:r.GREATER,mask:255},_+1+C,255,r.KEEP,r.KEEP,r.REPLACE),k[C+d]=new dn({func:r.GREATER,mask:255},1+C,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[v,k,c]}return this.nextStencilID=3,[{[d]:new dn({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[d]:new dn({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Fn([e.CONSTANT_COLOR,e.ONE],new o.bo(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fn.unblended:Fn.alphaBlended}getDepthModeForSublayer(e,r,c){if(!this.opaquePassEnabledForLayer())return mn.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new mn(c||this.context.gl.LEQUAL,r,[d,d])}getDepthModeFor3D(){return new mn(this.context.gl.LEQUAL,mn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var c,d;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(J()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,k={},C={},R={},O={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const Z in v){const it=v[Z];it.used&&it.prepare(this.context),k[Z]=it.getVisibleCoordinates(!1),C[Z]=k[Z].slice().reverse(),R[Z]=it.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<_.length;Z++)if(this.style._layers[_[Z]].is3D()){this.opaquePassCutoff=Z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Z of _){const it=this.style._layers[Z];if(!it.hasOffscreenPass()||it.isHidden(this.transform.zoom))continue;const ot=C[it.source];(it.type==="custom"||ot.length)&&this.renderLayer(this,v[it.source],it,ot,O)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:Z=>this.useProgram(Z)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.bo.black:o.bo.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(Z,it){const ot=Z.context,mt=ot.gl,gt=((Ft,At,qt)=>{const oe=Math.cos(At.rollInRadians),ee=Math.sin(At.rollInRadians),ie=$t(At),ae=At.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ft.properties.get("sky-color"),u_horizon_color:Ft.properties.get("horizon-color"),u_horizon:[(At.width/2-ie*ee)*qt,(At.height/2+ie*oe)*qt],u_horizon_normal:[-ee,oe],u_sky_horizon_blend:Ft.properties.get("sky-horizon-blend")*At.height/2*qt,u_sky_blend:ae}})(it,Z.style.map.transform,Z.pixelRatio),yt=new mn(mt.LEQUAL,mn.ReadWrite,[0,1]),Ct=dn.disabled,zt=Z.colorModeForRenderPass(),St=Z.useProgram("sky"),Nt=Iu(ot,it);St.draw(ot,mt.TRIANGLES,yt,Ct,zt,Tn.disabled,gt,null,void 0,"sky",Nt.vertexBuffer,Nt.indexBuffer,Nt.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[_[this.currentLayer]],it=v[Z.source],ot=k[Z.source];this._renderTileClippingMasks(Z,ot,!1),this.renderLayer(this,it,Z,ot,O)}this.renderPass="translucent";let X=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const Z=this.style._layers[_[this.currentLayer]],it=v[Z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Z,O))continue;this.opaquePassEnabledForLayer()||X||(X=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ot=(Z.type==="symbol"?R:C)[Z.source];this._renderTileClippingMasks(Z,k[Z.source],!!this.renderToTexture),this.renderLayer(this,it,Z,ot,O)}if(O.isRenderingGlobe&&(function(Z,it,ot){const mt=Z.context,gt=mt.gl,yt=Z.useProgram("atmosphere"),Ct=new mn(gt.LEQUAL,mn.ReadOnly,[0,1]),zt=Z.transform,St=(function(ae,De){const Me=ae.properties.get("position"),ve=[-Me.x,-Me.y,-Me.z],Ze=o.ar(new Float64Array(16));return ae.properties.get("anchor")==="map"&&(o.bf(Ze,Ze,De.rollInRadians),o.bg(Ze,Ze,-De.pitchInRadians),o.bf(Ze,Ze,De.bearingInRadians),o.bg(Ze,Ze,De.center.lat*Math.PI/180),o.bI(Ze,Ze,-De.center.lng*Math.PI/180)),o.cf(ve,ve,Ze),ve})(ot,Z.transform),Nt=zt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ft=it.properties.get("atmosphere-blend")*Nt.projectionTransition;if(Ft===0)return;const At=Ba(zt.worldSize,zt.center.lat),qt=zt.inverseProjectionMatrix,oe=new Float64Array(4);oe[3]=1,o.aG(oe,oe,zt.modelViewProjectionMatrix),oe[0]/=oe[3],oe[1]/=oe[3],oe[2]/=oe[3],oe[3]=1,o.aG(oe,oe,qt),oe[0]/=oe[3],oe[1]/=oe[3],oe[2]/=oe[3],oe[3]=1;const ee=((ae,De,Me,ve,Ze)=>({u_sun_pos:ae,u_atmosphere_blend:De,u_globe_position:Me,u_globe_radius:ve,u_inv_proj_matrix:Ze}))(St,Ft,[oe[0],oe[1],oe[2]],At,qt),ie=Iu(mt,it);yt.draw(mt,gt.TRIANGLES,Ct,dn.disabled,Fn.alphaBlended,Tn.disabled,ee,null,null,"atmosphere",ie.vertexBuffer,ie.indexBuffer,ie.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const Z=(function(it,ot){let mt=null;const gt=Object.values(it._layers).flatMap((St=>St.source&&!St.isHidden(ot)?[it.tileManagers[St.source]]:[])),yt=gt.filter((St=>St.getSource().type==="vector")),Ct=gt.filter((St=>St.getSource().type!=="vector")),zt=St=>{(!mt||mt.getSource().maxzoom<St.getSource().maxzoom)&&(mt=St)};return yt.forEach((St=>zt(St))),mt||Ct.forEach((St=>zt(St))),mt})(this.style,this.transform.zoom);Z&&(function(it,ot,mt){for(let gt=0;gt<mt.length;gt++)kc(it,ot,mt[gt])})(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&(function(Z){const it=Z.transform.padding;bu(Z,Z.transform.height-(it.top||0),3,qa),bu(Z,it.bottom||0,3,vu),wu(Z,it.left||0,3,Lo),wu(Z,Z.transform.width-(it.right||0),3,xu);const ot=Z.transform.centerPoint;(function(mt,gt,yt,Ct){Do(mt,gt-1,yt-10,2,20,Ct),Do(mt,gt-10,yt-1,20,2,Ct)})(Z,ot.x,Z.transform.height-ot.y,Ec)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!o.ci(r,c):!o.cj(r,c)),d||(d=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(o.ck(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const k=_.context,C=k.gl,R=_.transform,O=Fn.unblended,X=new mn(C.LEQUAL,mn.ReadWrite,[0,1]),Z=v.tileManager.getRenderableTiles(),it=_.useProgram("terrainDepth");k.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),k.clear({color:o.bo.transparent,depth:1});for(const ot of Z){const mt=v.getTerrainMesh(ot.tileID),gt=v.getTerrainData(ot.tileID),yt=R.getProjectionData({overscaledTileID:ot.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ct={u_ele_delta:v.getMeshFrameDelta(R.zoom)};it.draw(k,C.TRIANGLES,X,dn.disabled,O,Tn.backCCW,Ct,gt,yt,"terrain",mt.vertexBuffer,mt.indexBuffer,mt.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const k=_.context,C=k.gl,R=_.transform,O=Fn.unblended,X=new mn(C.LEQUAL,mn.ReadWrite,[0,1]),Z=v.getCoordsTexture(),it=v.tileManager.getRenderableTiles(),ot=_.useProgram("terrainCoords");k.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),k.clear({color:o.bo.transparent,depth:1}),v.coordsIndex=[];for(const mt of it){const gt=v.getTerrainMesh(mt.tileID),yt=v.getTerrainData(mt.tileID);k.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,Z.texture);const Ct={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(R.zoom)},zt=R.getProjectionData({overscaledTileID:mt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ot.draw(k,C.TRIANGLES,X,dn.disabled,O,Tn.backCCW,Ct,yt,zt,"terrain",gt.vertexBuffer,gt.indexBuffer,gt.segments),v.coordsIndex.push(mt.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(e,r,c,d,_){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(d||[]).length)&&(this.id=c.id,o.cl(c)?(function(v,k,C,R,O,X){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=X,it=dn.disabled,ot=v.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(mt,gt,yt,Ct,zt,St,Nt,Ft,At){const qt=gt.transform,oe=gt.style.map.terrain,ee=zt==="map",ie=St==="map";for(const ae of mt){const De=Ct.getTile(ae),Me=De.getBucket(yt);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const ve=o.ax(Me.textSizeData,qt.zoom),Ze=o.aM(De,1,gt.transform.zoom),hn=di(ee,gt.transform,Ze),on=yt.layout.get("icon-text-fit")!=="none"&&Me.hasIconData();if(ve){const Yn=Math.pow(2,qt.zoom-De.tileID.overscaledZ),Hn=oe?(ri,Wn)=>oe.getElevation(ae,ri,Wn):null;Sl(Me,ee,ie,At,qt,hn,Yn,ve,on,o.aN(qt,De,Nt,Ft),ae.toUnwrapped(),Hn)}}})(R,v,C,k,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),O),C.paint.get("icon-opacity").constantOr(1)!==0&&El(v,k,C,R,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),it,ot,Z),C.paint.get("text-opacity").constantOr(1)!==0&&El(v,k,C,R,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),it,ot,Z),k.map.showCollisionBoxes&&(wl(v,k,C,R,!0),wl(v,k,C,R,!1))})(e,r,c,d,this.style.placement.variableOffsets,_):o.cm(c)?(function(v,k,C,R,O){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:X}=O,Z=C.paint.get("circle-opacity"),it=C.paint.get("circle-stroke-width"),ot=C.paint.get("circle-stroke-opacity"),mt=!C.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(it.constantOr(1)===0||ot.constantOr(1)===0))return;const gt=v.context,yt=gt.gl,Ct=v.transform,zt=v.getDepthModeForSublayer(0,mn.ReadOnly),St=dn.disabled,Nt=v.colorModeForRenderPass(),Ft=[],At=Ct.getCircleRadiusCorrection();for(let qt=0;qt<R.length;qt++){const oe=R[qt],ee=k.getTile(oe),ie=ee.getBucket(C);if(!ie)continue;const ae=C.paint.get("circle-translate"),De=C.paint.get("circle-translate-anchor"),Me=o.aN(Ct,ee,ae,De),ve=ie.programConfigurations.get(C.id),Ze=v.useProgram("circle",ve),hn=ie.layoutVertexBuffer,on=ie.indexBuffer,Yn=v.style.map.terrain&&v.style.map.terrain.getTerrainData(oe),Hn={programConfiguration:ve,program:Ze,layoutVertexBuffer:hn,indexBuffer:on,uniformValues:go(v,ee,C,Me,At),terrainData:Yn,projectionData:Ct.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!X,applyTerrainMatrix:!0})};if(mt){const ri=ie.segments.get();for(const Wn of ri)Ft.push({segments:new o.aW([Wn]),sortKey:Wn.sortKey,state:Hn})}else Ft.push({segments:ie.segments,sortKey:0,state:Hn})}mt&&Ft.sort(((qt,oe)=>qt.sortKey-oe.sortKey));for(const qt of Ft){const{programConfiguration:oe,program:ee,layoutVertexBuffer:ie,indexBuffer:ae,uniformValues:De,terrainData:Me,projectionData:ve}=qt.state;ee.draw(gt,yt.TRIANGLES,zt,St,Nt,Tn.backCCW,De,Me,ve,C.id,ie,ae,qt.segments,C.paint,v.transform.zoom,oe)}})(e,r,c,d,_):o.cn(c)?(function(v,k,C,R,O){if(C.paint.get("heatmap-opacity")===0)return;const X=v.context,{isRenderingToTexture:Z,isRenderingGlobe:it}=O;if(v.style.map.terrain){for(const ot of R){const mt=k.getTile(ot);k.hasRenderableParent(ot)||(v.renderPass==="offscreen"?Po(v,mt,C,ot,it):v.renderPass==="translucent"&&Zh(v,C,ot,Z,it))}X.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(ot,mt,gt,yt){const Ct=ot.context,zt=Ct.gl,St=ot.transform,Nt=dn.disabled,Ft=new Fn([zt.ONE,zt.ONE],o.bo.transparent,[!0,!0,!0,!0]);(function(At,qt,oe){const ee=At.gl;At.activeTexture.set(ee.TEXTURE1),At.viewport.set([0,0,qt.width/4,qt.height/4]);let ie=oe.heatmapFbos.get(o.cc);ie?(ee.bindTexture(ee.TEXTURE_2D,ie.colorAttachment.get()),At.bindFramebuffer.set(ie.framebuffer)):(ie=gu(At,qt.width/4,qt.height/4),oe.heatmapFbos.set(o.cc,ie))})(Ct,ot,gt),Ct.clear({color:o.bo.transparent});for(let At=0;At<yt.length;At++){const qt=yt[At];if(mt.hasRenderableParent(qt))continue;const oe=mt.getTile(qt),ee=oe.getBucket(gt);if(!ee)continue;const ie=ee.programConfigurations.get(gt.id),ae=ot.useProgram("heatmap",ie),De=St.getProjectionData({overscaledTileID:qt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Me=St.getCircleRadiusCorrection();ae.draw(Ct,zt.TRIANGLES,mn.disabled,Nt,Ft,Tn.backCCW,xo(oe,St.zoom,gt.paint.get("heatmap-intensity"),Me),null,De,gt.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,gt.paint,St.zoom,ie)}Ct.viewport.set([0,0,ot.width,ot.height])})(v,k,C,R):v.renderPass==="translucent"&&(function(ot,mt){const gt=ot.context,yt=gt.gl;gt.setColorMode(ot.colorModeForRenderPass());const Ct=mt.heatmapFbos.get(o.cc);Ct&&(gt.activeTexture.set(yt.TEXTURE0),yt.bindTexture(yt.TEXTURE_2D,Ct.colorAttachment.get()),gt.activeTexture.set(yt.TEXTURE1),Co(gt,mt).bind(yt.LINEAR,yt.CLAMP_TO_EDGE),ot.useProgram("heatmapTexture").draw(gt,yt.TRIANGLES,mn.disabled,dn.disabled,ot.colorModeForRenderPass(),Tn.disabled,bo(ot,mt,0,1),null,null,mt.id,ot.viewportBuffer,ot.quadTriangleIndexBuffer,ot.viewportSegments,mt.paint,ot.transform.zoom))})(v,C)})(e,r,c,d,_):o.co(c)?(function(v,k,C,R,O){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:X}=O,Z=C.paint.get("line-opacity"),it=C.paint.get("line-width");if(Z.constantOr(1)===0||it.constantOr(1)===0)return;const ot=v.getDepthModeForSublayer(0,mn.ReadOnly),mt=v.colorModeForRenderPass(),gt=C.paint.get("line-dasharray"),yt=gt.constantOr(1),Ct=C.paint.get("line-pattern"),zt=Ct.constantOr(1),St=C.paint.get("line-gradient"),Nt=C.getCrossfadeParameters();let Ft;Ft=zt?"linePattern":yt&&St?"lineGradientSDF":yt?"lineSDF":St?"lineGradient":"line";const At=v.context,qt=At.gl,oe=v.transform;let ee=!0;for(const ie of R){const ae=k.getTile(ie);if(zt&&!ae.patternsLoaded())continue;const De=ae.getBucket(C);if(!De)continue;const Me=De.programConfigurations.get(C.id),ve=v.context.program.get(),Ze=v.useProgram(Ft,Me),hn=ee||Ze.program!==ve,on=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ie),Yn=Ct.constantOr(null),Hn=gt&&gt.constantOr(null);if(Yn&&ae.imageAtlas){const Ii=ae.imageAtlas,mi=Ii.patternPositions[Yn.to.toString()],Ti=Ii.patternPositions[Yn.from.toString()];mi&&Ti&&Me.setConstantPatternPositions(mi,Ti)}else if(Hn){const Ii=C.layout.get("line-cap")==="round",mi=v.lineAtlas.getDash(Hn.to,Ii),Ti=v.lineAtlas.getDash(Hn.from,Ii);Me.setConstantDashPositions(mi,Ti)}const ri=oe.getProjectionData({overscaledTileID:ie,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),Wn=oe.getPixelScale();let Ci;zt?(Ci=_l(v,ae,C,Wn,Nt),wc(At,qt,ae,Me,Nt)):yt&&St?(Ci=wo(v,ae,C,Wn,Nt,De.lineClipsArray.length),_u(v,k,At,qt,C,De,ie,Me,Nt)):yt?(Ci=pu(v,ae,C,Wn,Nt),Ic(v,At,qt,Me,hn,Nt)):St?(Ci=Ys(v,ae,C,Wn,De.lineClipsArray.length),Ml(v,k,At,qt,C,De,ie)):Ci=ga(v,ae,C,Wn);const ti=v.stencilModeForClipping(ie);Ze.draw(At,qt.TRIANGLES,ot,ti,mt,Tn.disabled,Ci,on,ri,C.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,C.paint,v.transform.zoom,Me,De.layoutVertexBuffer2),ee=!1}})(e,r,c,d,_):o.cp(c)?(function(v,k,C,R,O){const X=C.paint.get("fill-color"),Z=C.paint.get("fill-opacity");if(Z.constantOr(1)===0)return;const{isRenderingToTexture:it}=O,ot=v.colorModeForRenderPass(),mt=C.paint.get("fill-pattern"),gt=v.opaquePassEnabledForLayer()&&!mt.constantOr(1)&&X.constantOr(o.bo.transparent).a===1&&Z.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===gt){const yt=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?mn.ReadWrite:mn.ReadOnly);yu(v,k,C,R,yt,ot,!1,it)}if(v.renderPass==="translucent"&&C.paint.get("fill-antialias")){const yt=v.getDepthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,mn.ReadOnly);yu(v,k,C,R,yt,ot,!0,it)}})(e,r,c,d,_):o.cq(c)?(function(v,k,C,R,O){const X=C.paint.get("fill-extrusion-opacity");if(X===0)return;const{isRenderingToTexture:Z}=O;if(v.renderPass==="translucent"){const it=new mn(v.context.gl.LEQUAL,mn.ReadWrite,v.depthRangeFor3D);if(X!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))ii(v,k,C,R,it,dn.disabled,Fn.disabled,Z),ii(v,k,C,R,it,v.stencilModeFor3D(),v.colorModeForRenderPass(),Z);else{const ot=v.colorModeForRenderPass();ii(v,k,C,R,it,dn.disabled,ot,Z)}}})(e,r,c,d,_):o.cr(c)?(function(v,k,C,R,O){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:X}=O,Z=v.context,it=v.style.projection.useSubdivision,ot=v.getDepthModeForSublayer(0,mn.ReadOnly),mt=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(gt,yt,Ct,zt,St,Nt,Ft){const At=gt.context,qt=At.gl;for(const oe of Ct){const ee=yt.getTile(oe),ie=ee.dem;if(!ie||!ie.data||!ee.needsHillshadePrepare)continue;const ae=ie.dim,De=ie.stride,Me=ie.getPixels();if(At.activeTexture.set(qt.TEXTURE1),At.pixelStoreUnpackPremultiplyAlpha.set(!1),ee.demTexture=ee.demTexture||gt.getTileTexture(De),ee.demTexture){const Ze=ee.demTexture;Ze.update(Me,{premultiply:!1}),Ze.bind(qt.NEAREST,qt.CLAMP_TO_EDGE)}else ee.demTexture=new o.T(At,Me,qt.RGBA,{premultiply:!1}),ee.demTexture.bind(qt.NEAREST,qt.CLAMP_TO_EDGE);At.activeTexture.set(qt.TEXTURE0);let ve=ee.fbo;if(!ve){const Ze=new o.T(At,{width:ae,height:ae,data:null},qt.RGBA);Ze.bind(qt.LINEAR,qt.CLAMP_TO_EDGE),ve=ee.fbo=At.createFramebuffer(ae,ae,!0,!1),ve.colorAttachment.set(Ze.texture)}At.bindFramebuffer.set(ve.framebuffer),At.viewport.set([0,0,ae,ae]),gt.useProgram("hillshadePrepare").draw(At,qt.TRIANGLES,St,Nt,Ft,Tn.disabled,ml(ee.tileID,ie),null,null,zt.id,gt.rasterBoundsBuffer,gt.quadTriangleIndexBuffer,gt.rasterBoundsSegments),ee.needsHillshadePrepare=!1}})(v,k,R,C,ot,dn.disabled,mt),Z.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(it){const[gt,yt,Ct]=v.stencilConfigForOverlapTwoPass(R);As(v,k,C,Ct,gt,ot,mt,!1,X),As(v,k,C,Ct,yt,ot,mt,!0,X)}else{const[gt,yt]=v.getStencilConfigForOverlapAndUpdateStencilID(R);As(v,k,C,yt,gt,ot,mt,!1,X)}})(e,r,c,d,_):o.cs(c)?(function(v,k,C,R,O){if(v.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:X}=O,Z=v.style.projection.useSubdivision,it=v.getDepthModeForSublayer(0,mn.ReadOnly),ot=v.colorModeForRenderPass();if(Z){const[mt,gt,yt]=v.stencilConfigForOverlapTwoPass(R);vr(v,k,C,yt,mt,it,ot,!1,X),vr(v,k,C,yt,gt,it,ot,!0,X)}else{const[mt,gt]=v.getStencilConfigForOverlapAndUpdateStencilID(R);vr(v,k,C,gt,mt,it,ot,!1,X)}})(e,r,c,d,_):o.bT(c)?(function(v,k,C,R,O){if(v.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:X}=O,Z=k.getSource(),it=v.style.projection.useSubdivision;if(Z instanceof Ce)ba(v,k,C,R,null,!1,!1,Z.tileCoords,Z.flippedWindingOrder,X);else if(it){const[ot,mt,gt]=v.stencilConfigForOverlapTwoPass(R);ba(v,k,C,gt,ot,!1,!0,Ao,!1,X),ba(v,k,C,gt,mt,!0,!0,Ao,!1,X)}else{const[ot,mt]=v.getStencilConfigForOverlapAndUpdateStencilID(R);ba(v,k,C,mt,ot,!1,!0,Ao,!1,X)}})(e,r,c,d,_):o.ct(c)?(function(v,k,C,R,O){const X=C.paint.get("background-color"),Z=C.paint.get("background-opacity");if(Z===0)return;const{isRenderingToTexture:it}=O,ot=v.context,mt=ot.gl,gt=v.style.projection,yt=v.transform,Ct=yt.tileSize,zt=C.paint.get("background-pattern");if(v.isPatternMissing(zt))return;const St=!zt&&X.a===1&&Z===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==St)return;const Nt=dn.disabled,Ft=v.getDepthModeForSublayer(0,St==="opaque"?mn.ReadWrite:mn.ReadOnly),At=v.colorModeForRenderPass(),qt=v.useProgram(zt?"backgroundPattern":"background"),oe=R||an(yt,{tileSize:Ct,terrain:v.style.map.terrain});zt&&(ot.activeTexture.set(mt.TEXTURE0),v.imageManager.bind(v.context));const ee=C.getCrossfadeParameters();for(const ie of oe){const ae=yt.getProjectionData({overscaledTileID:ie,applyGlobeMatrix:!it,applyTerrainMatrix:!0}),De=zt?Ga(Z,v,zt,{tileID:ie,tileSize:Ct},ee):So(Z,X),Me=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ie),ve=gt.getMeshFromTileID(ot,ie.canonical,!1,!0,"raster");qt.draw(ot,mt.TRIANGLES,Ft,Nt,At,Tn.backCCW,De,Me,ae,C.id,ve.vertexBuffer,ve.indexBuffer,ve.segments)}})(e,0,c,d,_):o.cu(c)&&(function(v,k,C,R){const{isRenderingGlobe:O}=R,X=v.context,Z=C.implementation,it=v.style.projection,ot=v.transform,mt=ot.getProjectionDataForCustomLayer(O),gt={farZ:ot.farZ,nearZ:ot.nearZ,fov:ot.fov*Math.PI/180,modelViewProjectionMatrix:ot.modelViewProjectionMatrix,projectionMatrix:ot.projectionMatrix,shaderData:{variantName:it.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${it.shaderPreludeCode.vertexSource}`,define:it.shaderDefine},defaultProjectionData:mt},yt=Z.renderingMode?Z.renderingMode:"2d";if(v.renderPass==="offscreen"){const Ct=Z.prerender;Ct&&(v.setCustomLayerDefaults(),X.setColorMode(v.colorModeForRenderPass()),Ct.call(Z,X.gl,gt),X.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),X.setColorMode(v.colorModeForRenderPass()),X.setStencilMode(dn.disabled);const Ct=yt==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,mn.ReadOnly);X.setDepthMode(Ct),Z.render(X.gl,gt),X.setDirty(),v.setBaseState(),X.bindFramebuffer.set(null)}})(e,0,c,_))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!r||!c}useProgram(e,r,c=!1,d=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,k=c?gr.projectionMercator:v.shaderPreludeCode,C=c?yi:v.shaderDefine,R=e+(r?r.cacheKey:"")+`/${c?Oi:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[R]||(this.cache[R]=new du(this.context,gr[e],r,yr[e],this._showOverdrawInspector,_,k,C,d)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,r;if(this._tileTextures){for(const c in this._tileTextures){const d=this._tileTextures[c];if(d)for(const _ of d)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((r=this.tileExtentMesh.indexBuffer)===null||r===void 0||r.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const d=this.cache[c];d&&d.program&&this.context.gl.deleteProgram(d.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Tu(g,e){let r,c=!1,d=null,_=null;const v=()=>{d=null,c&&(g.apply(_,r),d=setTimeout(v,e),c=!1)};return(...k)=>(c=!0,_=this,r=k,d||v(),d)}class Su{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(c=d)})),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let d=c;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${c}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Tu(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),v=Math.round(r.lng*_)/_,k=Math.round(r.lat*_)/_,C=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=e?`/${v}/${k}/${c}`:`${c}/${k}/${v}`,(C||R)&&(O+="/"+Math.round(10*C)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const X=this._hashName;let Z=!1;const it=window.location.hash.slice(1).split("&").map((ot=>{const mt=ot.split("=")[0];return mt===X?(Z=!0,`${mt}=${O}`):ot})).filter((ot=>ot));return Z||it.push(`${X}=${O}`),`#${it.join("&")}`}return`#${O}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.V(+e[2],+e[1])}catch{return!1}const r=+e[0],c=+(e[3]||0),d=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const Za={linearity:.3,easing:o.cv(0,0,.3,1)},Pc=o.e({deceleration:2500,maxSpeed:1400},Za),Cc=o.e({deceleration:20,maxSpeed:1400},Za),Ac=o.e({deceleration:1e3,maxSpeed:360},Za),Pl=o.e({deceleration:1e3,maxSpeed:90},Za),Lc=o.e({deceleration:1e3,maxSpeed:360},Za);class Kr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:J(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=J();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const _=$a(r.pan.mag(),c,o.e({},Pc,e||{})),v=r.pan.mult(_.amount/r.pan.mag()),k=this._map.cameraHelper.handlePanInertia(v,this._map.transform);d.center=k.easingCenter,d.offset=k.easingOffset,lr(d,_)}if(r.zoom){const _=$a(r.zoom,c,Cc);d.zoom=this._map.transform.zoom+_.amount,lr(d,_)}if(r.bearing){const _=$a(r.bearing,c,Ac);d.bearing=this._map.transform.bearing+o.an(_.amount,-179,179),lr(d,_)}if(r.pitch){const _=$a(r.pitch,c,Pl);d.pitch=this._map.transform.pitch+_.amount,lr(d,_)}if(r.roll){const _=$a(r.roll,c,Lc);d.roll=this._map.transform.roll+o.an(_.amount,-179,179),lr(d,_)}if(d.zoom||d.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),o.e(d,{noMoveStart:!0})}}function lr(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function $a(g,e,r){const{maxSpeed:c,linearity:d,deceleration:_}=r,v=o.an(g*d/(e/1e3),-c,c),k=Math.abs(v)/(_*d);return{easing:r.easing,duration:1e3*k,amount:v*(k/2)}}class ui extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c,d={}){c=c instanceof MouseEvent?c:new MouseEvent(e,c);const _=W.mousePos(r.getCanvas(),c),v=r.unproject(_);super(e,o.e({point:_,lngLat:v,originalEvent:c},d)),this._defaultPrevented=!1,this.target=r}}class Ro extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){const d=e==="touchend"?c.changedTouches:c.touches,_=W.touchPos(r.getCanvasContainer(),d),v=_.map((C=>r.unproject(C))),k=_.reduce(((C,R,O,X)=>C.add(R.div(X.length))),new o.P(0,0));super(e,{points:_,point:k,lngLats:v,lngLat:r.unproject(k),originalEvent:c}),this._defaultPrevented=!1}}class wa extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class $h{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new wa(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new ui(e.type,this._map,e))}mouseup(e){this._map.fire(new ui(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new ui(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ui(e.type,this._map,e))}mouseover(e){this._map.fire(new ui(e.type,this._map,e))}mouseout(e){this._map.fire(new ui(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ro(e.type,this._map,e))}touchmove(e){this._map.fire(new Ro(e.type,this._map,e))}touchend(e){this._map.fire(new Ro(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ro(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wh{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ui(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ui(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class Dc{constructor(e,r){this._map=e,this._tr=new zo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(W.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=W.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const _=Math.min(d.x,c.x),v=Math.max(d.x,c.x),k=Math.min(d.y,c.y),C=Math.max(d.y,c.y);W.setTransform(this._box,`translate(${_}px,${k}px)`),this._box.style.width=v-_+"px",this._box.style.height=C-k+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const c=this._startPos,d=r;if(this.reset(),W.suppressClick(),c.x!==d.x||c.y!==d.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:_=>_.fitScreenCoordinates(c,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new o.l(e,{originalEvent:r}))}}function Cl(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const r={};for(let c=0;c<g.length;c++)r[g[c].identifier]=e[c];return r}class No{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=(function(d){const _=new o.P(0,0);for(const v of d)_._add(v);return _.div(d.length)})(r),this.touches=Cl(c,r)))}touchmove(e,r,c){if(this.aborted||!this.centroid)return;const d=Cl(c,r);for(const _ in this.touches){const v=d[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(e,r,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class os{constructor(e){this.singleTap=new No(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,c){this.singleTap.touchstart(e,r,c)}touchmove(e,r,c){this.singleTap.touchmove(e,r,c)}touchend(e,r,c){const d=this.singleTap.touchend(e,r,c);if(d){const _=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(d)<30;if(_&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Ue{constructor(e){this._tr=new zo(e),this._zoomIn=new os({numTouches:1,numTaps:2}),this._zoomOut=new os({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,c){this._zoomIn.touchstart(e,r,c),this._zoomOut.touchstart(e,r,c)}touchmove(e,r,c){this._zoomIn.touchmove(e,r,c),this._zoomOut.touchmove(e,r,c)}touchend(e,r,c){const d=this._zoomIn.touchend(e,r,c),_=this._zoomOut.touchend(e,r,c),v=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(d)},{originalEvent:e})}):_?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wa{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(r)?r[0]:r;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&W.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Eu=0,Rc=2,Oo={[Eu]:1,[Rc]:2};class Ls{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=W.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,c){const d=Oo[c];return r.buttons===void 0||(r.buttons&d)!==d})(e,this._eventButton)}isValidEndEvent(e){return W.mouseButton(e)===this._eventButton}}class ku{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Xh{constructor(e=new Ls({checkCorrectEvent:()=>!0}),r=new ku){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,c){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const Xa=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class zc{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,c){return this._calculateTransform(e,r,c)}touchmove(e,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,c){this._calculateTransform(e,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,c){c.length>0&&(this._active=!0);const d=Cl(c,r),_=new o.P(0,0),v=new o.P(0,0);let k=0;for(const R in d){const O=d[R],X=this._touches[R];X&&(_._add(O),v._add(O.sub(X)),k++,d[R]=O)}if(this._touches=d,this._shouldBePrevented(k)||!v.mag())return;const C=v.div(k);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(k),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,c){if(!this._firstTwoTouches)return;e.preventDefault();const[d,_]=this._firstTwoTouches,v=Al(c,r,d),k=Al(c,r,_);if(!v||!k)return;const C=this._aroundCenter?null:v.add(k).div(2);return this._move([v,k],C,e)}touchend(e,r,c){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,v=Al(c,r,d),k=Al(c,r,_);v&&k||(this._active&&W.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Al(g,e,r){for(let c=0;c<g.length;c++)if(g[c].identifier===r)return e[c]}function Mu(g,e){return Math.log(g/e)/Math.LN2}class Nc extends Fo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,c),pinchAround:r}}}function Oc(g,e){return 180*g.angleWith(e)/Math.PI}class Pu extends Fo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,c){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oc(this._vector,d),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,c=Oc(e,this._startVector);return Math.abs(c)<r}}function Cu(g){return Math.abs(g.y)>Math.abs(g.x)}class Au extends Fo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,c){super.touchstart(e,r,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Cu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),_=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,c){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,_=r.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const v=e.y>0==r.y>0;return Cu(e)&&Cu(r)&&v}}const Yh={panStep:100,bearingStep:15,pitchStep:10};class Fc{constructor(e){this._tr=new zo(e);const r=Yh;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,c=0,d=0,_=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),_=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),_=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:k=>{const C=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:Qs,zoom:r?Math.round(C.zoom)+r*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+c*this._bearingStep,pitch:C.pitch+d*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qs(g){return g*(2-g)}const qn=4.000244140625,Hh=1/450;class Bo{constructor(e,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new zo(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Hh}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=J(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%qn==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=W.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(o.V.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const k=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=k),typeof this._targetZoom=="number"&&(this._targetZoom+=k)}if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>qn?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&C!==0&&(C=1/C);const R=typeof this._targetZoom!="number"?e.scale:o.aq(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),o.at(R*C)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,d=this._easing;let _,v=!1;if(this._type==="wheel"&&c&&d){const k=J()-this._lastWheelEventTime,C=Math.min((k+5)/200,1),R=d(C);_=o.G.number(c,r,R),C<1?this._frameId||(this._frameId=!0):v=!0}else _=r,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=o.cx;if(this._prevEase){const c=this._prevEase,d=(J()-c.start)/c.duration,_=c.easing(d+.01)-c.easing(d),v=.27/Math.sqrt(_*_+1e-4)*.01,k=Math.sqrt(.0729-v*v);r=o.cv(v,k,.25,1)}return this._prevEase={start:J(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Vo{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Lu{constructor(e){this._tr=new zo(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bc{constructor(){this._tap=new os({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,c){if(!this._swipePoint)if(this._tapTime){const d=r[0],_=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(d)<30;_&&v?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,r,c)}touchmove(e,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=r[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(e,r,c)}touchend(e,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const d=this._tap.touchend(e,r,c);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Du{constructor(e,r,c){this._el=e,this._mousePan=r,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ru{constructor(e,r,c,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Vc{constructor(e,r,c,d){this._el=e,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ls{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=W.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=r,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=c,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(W.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Ia=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class We extends o.l{}function en(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class jo{constructor(e,r){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=d.type==="renderFrame"?void 0:d,k={needsRenderFrame:!1},C={},R={};for(const{handlerName:Z,handler:it,allowed:ot}of this._handlers){if(!it.isEnabled())continue;let mt;if(this._blockedByActive(R,ot,Z))it.reset();else if(it[_||d.type]){if(o.cy(d,_||d.type)){const gt=W.mousePos(this._map.getCanvas(),d);mt=it[_||d.type](d,gt)}else if(o.cz(d,_||d.type)){const gt=this._getMapTouches(d.touches),yt=W.touchPos(this._map.getCanvas(),gt);mt=it[_||d.type](d,yt,gt)}else o.cA(_||d.type)||(mt=it[_||d.type](d));this.mergeHandlerResult(k,C,mt,Z,v),mt&&mt.needsRenderFrame&&this._triggerRenderFrame()}(mt||it.isActive())&&(R[Z]=it)}const O={};for(const Z in this._previousActiveHandlers)R[Z]||(O[Z]=v);this._previousActiveHandlers=R,(Object.keys(O).length||en(k))&&(this._changes.push([k,C,O]),this._triggerRenderFrame()),(Object.keys(R).length||en(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=k;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,v]of this._listeners)W.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,r,c]of this._listeners)W.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new $h(r,e));const d=r.boxZoom=new Dc(r,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const _=r.cooperativeGestures=new ls(r,e.cooperativeGestures);this._add("cooperativeGestures",_),e.cooperativeGestures&&_.enable();const v=new Ue(r),k=new Lu(r);r.doubleClickZoom=new Vo(k,v),this._add("tapZoom",v),this._add("clickZoom",k),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const C=new Bc;this._add("tapDragZoom",C);const R=r.touchPitch=new Au(r);this._add("touchPitch",R),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const O=()=>r.project(r.getCenter()),X=(function({enable:St,clickTolerance:Nt,aroundCenter:Ft=!0,minPixelCenterThreshold:At=100,rotateDegreesPerPixelMoved:qt=.8},oe){const ee=new Ls({checkCorrectEvent:ie=>W.mouseButton(ie)===0&&ie.ctrlKey||W.mouseButton(ie)===2&&!ie.ctrlKey});return new Wa({clickTolerance:Nt,move:(ie,ae)=>{const De=oe();if(Ft&&Math.abs(De.y-ie.y)>At)return{bearingDelta:o.cw(new o.P(ie.x,ae.y),ae,De)};let Me=(ae.x-ie.x)*qt;return Ft&&ae.y<De.y&&(Me=-Me),{bearingDelta:Me}},moveStateManager:ee,enable:St,assignEvents:Xa})})(e,O),Z=(function({enable:St,clickTolerance:Nt,pitchDegreesPerPixelMoved:Ft=-.5}){const At=new Ls({checkCorrectEvent:qt=>W.mouseButton(qt)===0&&qt.ctrlKey||W.mouseButton(qt)===2});return new Wa({clickTolerance:Nt,move:(qt,oe)=>({pitchDelta:(oe.y-qt.y)*Ft}),moveStateManager:At,enable:St,assignEvents:Xa})})(e),it=(function({enable:St,clickTolerance:Nt,rollDegreesPerPixelMoved:Ft=.3},At){const qt=new Ls({checkCorrectEvent:oe=>W.mouseButton(oe)===2&&oe.ctrlKey});return new Wa({clickTolerance:Nt,move:(oe,ee)=>{const ie=At();let ae=(ee.x-oe.x)*Ft;return ee.y<ie.y&&(ae=-ae),{rollDelta:ae}},moveStateManager:qt,enable:St,assignEvents:Xa})})(e,O);r.dragRotate=new Ru(e,X,Z,it),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate","mouseRoll"]),this._add("mouseRoll",it,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const ot=(function({enable:St,clickTolerance:Nt}){const Ft=new Ls({checkCorrectEvent:At=>W.mouseButton(At)===0&&!At.ctrlKey});return new Wa({clickTolerance:Nt,move:(At,qt)=>({around:qt,panDelta:qt.sub(At)}),activateOnStart:!0,moveStateManager:Ft,enable:St,assignEvents:Xa})})(e),mt=new zc(e,r);r.dragPan=new Du(c,ot,mt),this._add("mousePan",ot),this._add("touchPan",mt,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const gt=new Pu,yt=new Nc;r.touchZoomRotate=new Vc(c,yt,gt,C),this._add("touchRotate",gt,["touchPan","touchZoom"]),this._add("touchZoom",yt,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new Wh(r));const Ct=r.scrollZoom=new Bo(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Ct,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const zt=r.keyboard=new Fc(r);this._add("keyboard",zt),e.interactive&&e.keyboard&&r.keyboard.enable()}_add(e,r,c){this._handlers.push({handlerName:e,handler:r,allowed:c}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ia(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,c){for(const d in e)if(d!==c&&(!r||r.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const c of e)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(e,r,c,d,_){if(!c)return;o.e(e,c);const v={handlerName:d,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(r.zoom=v),c.panDelta!==void 0&&(r.drag=v),c.rollDelta!==void 0&&(r.roll=v),c.pitchDelta!==void 0&&(r.pitch=v),c.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const e={},r={},c={};for(const[d,_,v]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),o.e(r,_),o.e(c,v);this._updateMapTransform(e,r,c),this._changes=[]}_updateMapTransform(e,r,c){const d=this._map,_=d._getTransformForUpdate(),v=d.terrain;if(!(en(e)||v&&this._terrainMovement))return this._fireEvents(r,c,!0);d._stop(!0);let{panDelta:k,zoomDelta:C,bearingDelta:R,pitchDelta:O,rollDelta:X,around:Z,pinchAround:it}=e;it!==void 0&&(Z=it),Z=Z||d.transform.centerPoint,v&&!_.isPointOnMapSurface(Z)&&(Z=_.centerPoint);const ot={panDelta:k,zoomDelta:C,rollDelta:X,pitchDelta:O,bearingDelta:R,around:Z};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(Z)&&(Z=_.centerPoint);const mt=Z.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(k?Z.sub(k):Z);this._handleMapControls({terrain:v,tr:_,deltasForHelper:ot,preZoomAroundLoc:mt,combinedEventsInProgress:r,panDelta:k}),d._applyUpdatedTransform(_),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,c,!0)}_handleMapControls({terrain:e,tr:r,deltasForHelper:c,preZoomAroundLoc:d,combinedEventsInProgress:_,panDelta:v}){const k=this._map.cameraHelper;if(k.handleMapControlsRollPitchBearingZoom(c,r),e)return k.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void k.handleMapControlsPan(c,r,d)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(v))):k.handleMapControlsPan(c,r,d)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void k.handleMapControlsPan(c,r,d));k.handleMapControlsPan(c,r,d)}_fireEvents(e,r,c){const d=Ia(this._eventsInProgress),_=Ia(e),v={};for(const X in e){const{originalEvent:Z}=e[X];this._eventsInProgress[X]||(v[`${X}start`]=Z),this._eventsInProgress[X]=e[X]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const X in v)this._fireEvent(X,v[X]);_&&this._fireEvent("move",_.originalEvent);for(const X in e){const{originalEvent:Z}=e[X];this._fireEvent(X,Z)}const k={};let C;for(const X in this._eventsInProgress){const{handlerName:Z,originalEvent:it}=this._eventsInProgress[X];this._handlersById[Z].isActive()||(delete this._eventsInProgress[X],C=r[Z]||it,k[`${X}end`]=C)}for(const X in k)this._fireEvent(X,k[X]);const R=Ia(this._eventsInProgress),O=(d||_)&&!R;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&X.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(X)}if(c&&O){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=it=>it!==0&&-this._bearingSnap<it&&it<this._bearingSnap;!X||!X.essential&&q.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:C})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new o.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new We("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class jc extends o.E{constructor(e,r,c){super(),this._renderFrameCallback=()=>{const d=Math.min((J()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new o.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,c){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},r),c)}panTo(e,r,c){return this.easeTo(o.e({center:e},r),c)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,c){return this.easeTo(o.e({zoom:e},r),c)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)).fire(new o.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,c){return this.easeTo(o.e({bearing:e},r),c)}resetNorth(e,r){return this.rotateTo(0,o.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Pt.convert(e).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,r)}_cameraForBoxAndBearing(e,r,c,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=o.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const R=d.padding;d.padding={top:R,bottom:R,right:R,left:R}}const v=o.e(_,d.padding);d.padding=v;const k=this.transform,C=new Pt(e,r);return this.cameraHelper.cameraForBoxAndBearing(d,v,C,c,k)}fitBounds(e,r,c){return this._fitInternal(this.cameraForBounds(e,r),r,c)}fitScreenCoordinates(e,r,c,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(r)),c,d),d,_)}_fitInternal(e,r,c){return e?(delete(r=o.e(e,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(e,r){this.stop();const c=this._getTransformForUpdate();let d=!1,_=!1,v=!1;const k=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);const C=c.zoom!==k;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(d=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(_=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(v=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)),C&&this.fire(new o.l("zoomstart",r)).fire(new o.l("zoom",r)).fire(new o.l("zoomend",r)),d&&this.fire(new o.l("rotatestart",r)).fire(new o.l("rotate",r)).fire(new o.l("rotateend",r)),_&&this.fire(new o.l("pitchstart",r)).fire(new o.l("pitch",r)).fire(new o.l("pitchend",r)),v&&this.fire(new o.l("rollstart",r)).fire(new o.l("roll",r)).fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}calculateCameraOptionsFromTo(e,r,c,d=0){const _=o.aa.fromLngLat(e,r),v=o.aa.fromLngLat(c,d),k=v.x-_.x,C=v.y-_.y,R=v.z-_.z,O=Math.hypot(k,C,R);if(O===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(k,C),Z=o.at(this.transform.cameraToCenterDistance/O/this.transform.tileSize),it=180*Math.atan2(k,-C)/Math.PI;let ot=180*Math.acos(X/O)/Math.PI;return ot=R<0?90-ot:90+ot,{center:v.toLngLat(),elevation:d,zoom:Z,pitch:ot,bearing:it}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,c,d,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(e,r,c,d);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:c,pitch:d,roll:_}}easeTo(e,r){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.cx},e)).animate===!1||!e.essential&&q.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),d=this.getBearing(),_=c.pitch,v=c.roll,k="bearing"in e?this._normalizeBearing(e.bearing,d):d,C="pitch"in e?+e.pitch:_,R="roll"in e?this._normalizeBearing(e.roll,v):v,O="padding"in e?e.padding:c.padding,X=o.P.convert(e.offset);let Z,it;e.around&&(Z=o.V.convert(e.around),it=c.locationToScreenPoint(Z));const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},mt=this.cameraHelper.handleEaseTo(c,{bearing:k,pitch:C,roll:R,padding:O,around:Z,aroundPoint:it,offsetAsPoint:X,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==k,this._pitching=this._pitching||C!==_,this._rolling=this._rolling||R!==v,this._padding=!c.isPaddingEqual(O),this._zooming=this._zooming||mt.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,ot),this.terrain&&this._prepareElevation(mt.elevationCenter),this._ease((gt=>{mt.easeFunc(gt),this.terrain&&!e.freezeElevation&&this._updateElevation(gt),this._applyUpdatedTransform(c),this._fireMoveEvents(r)}),(gt=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,gt)}),e),this}_prepareEase(e,r,c={}){this._moving=!0,r||c.moving||this.fire(new o.l("movestart",e)),this._zooming&&!c.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(r-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(o.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),c=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(c<d){const _=this.calculateCameraOptionsFromTo(r,d,e.center,e.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&r.push((d=>this.transformCameraUpdate(d))),!r.length)return;const c=e.clone();for(const d of r){const _=c.clone(),{center:v,zoom:k,roll:C,pitch:R,bearing:O,elevation:X}=d(_);v&&_.setCenter(v),X!==void 0&&_.setElevation(X),k!==void 0&&_.setZoom(k),C!==void 0&&_.setRoll(C),R!==void 0&&_.setPitch(R),O!==void 0&&_.setBearing(O),c.apply(_)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,d=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new o.l("zoomend",e)),d&&this.fire(new o.l("rotateend",e)),_&&this.fire(new o.l("pitchend",e)),v&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,r){if(!e.essential&&q.prefersReducedMotion){const ae=o.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(ae,r)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cx},e);const c=this._getTransformForUpdate(),d=c.bearing,_=c.pitch,v=c.roll,k=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,d):d,R="pitch"in e?+e.pitch:_,O="roll"in e?this._normalizeBearing(e.roll,v):v,X="padding"in e?e.padding:c.padding,Z=o.P.convert(e.offset);let it=c.centerPoint.add(Z);const ot=c.screenPointToLocation(it),mt=this.cameraHelper.handleFlyTo(c,{bearing:C,pitch:R,roll:O,padding:X,locationAtOffset:ot,offsetAsPoint:Z,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let gt=e.curve;const yt=Math.max(c.width,c.height),Ct=yt/mt.scaleOfZoom,zt=mt.pixelPathLength;typeof mt.scaleOfMinZoom=="number"&&(gt=Math.sqrt(yt/mt.scaleOfMinZoom/zt*2));const St=gt*gt;function Nt(ae){const De=(Ct*Ct-yt*yt+(ae?-1:1)*St*St*zt*zt)/(2*(ae?Ct:yt)*St*zt);return Math.log(Math.sqrt(De*De+1)-De)}function Ft(ae){return(Math.exp(ae)-Math.exp(-ae))/2}function At(ae){return(Math.exp(ae)+Math.exp(-ae))/2}const qt=Nt(!1);let oe=function(ae){return At(qt)/At(qt+gt*ae)},ee=function(ae){return yt*((At(qt)*(Ft(De=qt+gt*ae)/At(De))-Ft(qt))/St)/zt;var De},ie=(Nt(!0)-qt)/gt;if(Math.abs(zt)<2e-6||!isFinite(ie)){if(Math.abs(yt-Ct)<1e-6)return this.easeTo(e,r);const ae=Ct<yt?-1:1;ie=Math.abs(Math.log(Ct/yt))/gt,ee=()=>0,oe=De=>Math.exp(ae*gt*De)}return e.duration="duration"in e?+e.duration:1e3*ie/("screenSpeed"in e?+e.screenSpeed/gt:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==C,this._pitching=R!==_,this._rolling=O!==v,this._padding=!c.isPaddingEqual(X),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(mt.targetCenter),this._ease((ae=>{const De=ae*ie,Me=1/oe(De),ve=ee(De);this._rotating&&c.setBearing(o.G.number(d,C,ae)),this._pitching&&c.setPitch(o.G.number(_,R,ae)),this._rolling&&c.setRoll(o.G.number(v,O,ae)),this._padding&&(c.interpolatePadding(k,X,ae),it=c.centerPoint.add(Z)),mt.easeFunc(ae,Me,ve,it),this.terrain&&!e.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(c),this._fireMoveEvents(r)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,r)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,r,c){c.animate===!1||c.duration===0?(e(1),r()):(this._easeStart=J(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=o.W(e,-180,180);const c=Math.abs(e-r);return Math.abs(e-360-r)<c&&(e-=360),Math.abs(e+360-r)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.V.convert(e),this.transform.tileZoom):null}}const Go={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Qi{constructor(e=Go){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=W.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=W.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const c=this._map._getUIString(`AttributionControl.${r}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style.tileManagers;for(const d in r){const _=r[d];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter((d=>String(d).trim())),e.sort(((d,_)=>d.length-_.length)),e=e.filter(((d,_)=>{for(let v=_+1;v<e.length;v++)if(e[v].indexOf(d)>=0)return!1;return!0}));const c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=W.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jr{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=W.create("div","maplibregl-ctrl");const r=W.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){W.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Gc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const d of c)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Kh=o.aT([{name:"a_pos3d",type:"Int16",components:3}]);class Jh extends o.E{constructor(e){super(),this._lastTilesetChange=J(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,r){this.tileManager.update(e,r),this._renderableTilesKeys=[];const c={};for(const d of an(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),o.c6(d.terrainRttPosMatrix32f,0,o.a4,o.a4,0,0,1),this._tiles[d.key]=new nt(d,this.tileSize),this._lastTilesetChange=J());for(const d in this._tiles)c[d]||delete this._tiles[d]}freeRtt(e){for(const r in this._tiles){const c=this._tiles[r];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID,_=e.clone(),v=o.bj();if(d.canonical.equals(e.canonical))o.c6(v,0,o.a4,o.a4,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const k=d.canonical.z-e.canonical.z,C=d.canonical.x-(d.canonical.x>>k<<k),R=d.canonical.y-(d.canonical.y>>k<<k),O=o.a4>>k;o.c6(v,0,O,O,0,0,1),o.O(v,v,[-C*O,-R*O,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const k=e.canonical.z-d.canonical.z,C=e.canonical.x-(e.canonical.x>>k<<k),R=e.canonical.y-(e.canonical.y>>k<<k),O=o.a4>>k;o.c6(v,0,o.a4,o.a4,0,0,1),o.O(v,v,[C*O,R*O,0]),o.Q(v,v,[1/2**k,1/2**k,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),r[c]=_}return r}_getTerrainCoordsForTileRanges(e,r){const c={};for(const d of this._renderableTilesKeys){const _=this._tiles[d].tileID;if(!this._isWithinTileRanges(_,r))continue;const v=e.clone(),k=o.bj();if(_.canonical.z===e.canonical.z){const C=e.canonical.x-_.canonical.x,R=e.canonical.y-_.canonical.y;o.c6(k,0,o.a4,o.a4,0,0,1),o.O(k,k,[C*o.a4,R*o.a4,0])}else if(_.canonical.z>e.canonical.z){const C=_.canonical.z-e.canonical.z,R=_.canonical.x-(_.canonical.x>>C<<C),O=_.canonical.y-(_.canonical.y>>C<<C),X=e.canonical.x-(_.canonical.x>>C),Z=e.canonical.y-(_.canonical.y>>C),it=o.a4>>C;o.c6(k,0,it,it,0,0,1),o.O(k,k,[-R*it+X*o.a4,-O*it+Z*o.a4,0])}else{const C=e.canonical.z-_.canonical.z,R=e.canonical.x-(e.canonical.x>>C<<C),O=e.canonical.y-(e.canonical.y>>C<<C),X=(e.canonical.x>>C)-_.canonical.x,Z=(e.canonical.y>>C)-_.canonical.y,it=o.a4<<C;o.c6(k,0,it,it,0,0,1),o.O(k,k,[R*o.a4+X*it,O*o.a4+Z*it,0])}v.terrainRttPosMatrix32f=new Float32Array(k),c[d]=v}return c}getSourceTile(e,r){const c=this.tileManager._source;let d=e.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let _=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!_||!_.dem)&&r)for(;d>=c.minzoom&&(!_||!_.dem);)_=this.tileManager.getTileByID(e.scaledTo(d--).key);return _}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class Qh{constructor(e,r,c){this._meshCache={},this.painter=e,this.tileManager=new Jh(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,c,d=o.a4){var _;if(!(r>=0&&r<d&&c>=0&&c<d))return 0;const v=this.getTerrainData(e),k=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!k)return 0;const C=o.cB([],[r/d*o.a4,c/d*o.a4],v.u_terrain_matrix),R=[C[0]*k.dim,C[1]*k.dim],O=Math.floor(R[0]),X=Math.floor(R[1]),Z=R[0]-O,it=R[1]-X;return k.get(O,X)*(1-Z)*(1-it)+k.get(O+1,X)*Z*(1-it)+k.get(O,X+1)*(1-Z)*it+k.get(O+1,X+1)*Z*it}getElevationForLngLatZoom(e,r){if(!o.cC(r,e.wrap()))return 0;const{tileID:c,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(c,d%o.a4,_%o.a4,o.a4)}getElevation(e,r,c,d=o.a4){return this.getDEMElevation(e,r,c,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,_=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(d,new o.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}const r=this.tileManager.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const d=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new o.T(d,r.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),r.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){const d=this.tileManager.getSource().maxzoom;let _=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?_=e.canonical.z-d:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>_<<_),k=e.canonical.y-(e.canonical.y>>_<<_),C=o.cD(new Float64Array(16),[1/(o.a4<<_),1/(o.a4<<_),0]);o.O(C,C,[v*o.a4,k*o.a4,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,c=r.width/devicePixelRatio,d=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,d,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let k=0;k<this._coordsTextureSize;k++,v+=4)r[v+0]=255&k,r[v+1]=255&_,r[v+2]=k>>8<<4|_>>8,r[v+3]=0;const c=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),d=new o.T(e,c,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,d=c.gl,_=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,k-v-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const C=r[0]+(r[2]>>4<<8),R=r[1]+((15&r[2])<<8),O=this.coordsIndex[255-r[3]],X=O&&this.tileManager.getTileByID(O);if(!X)return null;const Z=this._coordsTextureSize,it=(1<<X.tileID.canonical.z)*Z;return new o.aa((X.tileID.canonical.x*Z+C)/it+X.tileID.wrap,(X.tileID.canonical.y*Z+R)/it,this.getElevation(X.tileID,C,R,Z))}depthAtPoint(e){const r=new Uint8Array(4),c=this.painter.context,d=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,d=c&&e.canonical.y===0,_=c&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${d?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const k=this.painter.context,C=new o.cE,R=new o.aX,O=this.meshSize,X=o.a4/O,Z=O*O;for(let At=0;At<=O;At++)for(let qt=0;qt<=O;qt++)C.emplaceBack(qt*X,At*X,0);for(let At=0;At<Z;At+=O+1)for(let qt=0;qt<O;qt++)R.emplaceBack(qt+At,O+qt+At+1,O+qt+At+2),R.emplaceBack(qt+At,O+qt+At+2,qt+At+1);const it=C.length,ot=it+(O+1),mt=(O+1)*O,gt=d?o.bq:0,yt=d?0:1,Ct=_?o.br:o.a4,zt=_?0:1;for(let At=0;At<=O;At++)C.emplaceBack(At*X,gt,yt);for(let At=0;At<=O;At++)C.emplaceBack(At*X,Ct,zt);for(let At=0;At<O;At++)R.emplaceBack(mt+At,ot+At,ot+At+1),R.emplaceBack(mt+At,ot+At+1,mt+At+1),R.emplaceBack(0+At,it+At+1,it+At),R.emplaceBack(0+At,0+At+1,it+At+1);const St=C.length,Nt=St+2*(O+1);for(const At of[0,1])for(let qt=0;qt<=O;qt++)for(const oe of[0,1])C.emplaceBack(At*o.a4,qt*X,oe);for(let At=0;At<2*O;At+=2)R.emplaceBack(St+At,St+At+1,St+At+3),R.emplaceBack(St+At,St+At+3,St+At+2),R.emplaceBack(Nt+At,Nt+At+3,Nt+At+1),R.emplaceBack(Nt+At,Nt+At+2,Nt+At+3);const Ft=new _i(k.createVertexBuffer(C,Kh.members),k.createIndexBuffer(R),o.aW.simpleSegment(0,0,C.length,R.length));return this._meshCache[v]=Ft,Ft}getMeshFrameDelta(e){return 2*Math.PI*o.bD/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var c;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(c=this.getMinMaxElevation(d).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,r){const c=o.aa.fromLngLat(e.wrap()),d=(1<<r)*o.a4,_=c.x*d,v=c.y*d,k=Math.floor(_/o.a4),C=Math.floor(v/o.a4);return{tileID:new o.a1(r,0,r,k,C),mercatorX:_,mercatorY:v}}}class Uo{constructor(e,r,c){this._context=e,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:e,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>e.id!==r)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const Zn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class pi{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Uo(e.context,30,r.tileManager.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((c=>!e._layers[c].isHidden(r))),this._coordsAscending={};for(const c in e.tileManagers){this._coordsAscending[c]={};const d=e.tileManagers[c].getVisibleCoordinates(),_=e.tileManagers[c].getSource(),v=_ instanceof Ce?_.terrainTileRanges:null;for(const k of d){const C=this.terrain.tileManager.getTerrainCoords(k,v);for(const R in C)this._coordsAscending[c][R]||(this._coordsAscending[c][R]=[]),this._coordsAscending[c][R].push(C[R])}}this._coordsAscendingStr={};for(const c of e._order){const d=e._layers[c],_=d.source;if(Zn[d.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map((k=>k.key)).sort().join()}}for(const c of this._renderableTiles)for(const d in this._coordsAscendingStr){const _=this._coordsAscendingStr[d][c.tileID.key];_&&_!==c.rttCoords[d]&&(c.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),d=e.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Zn[d]&&(this._prevType&&Zn[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(Zn[this._prevType]||Zn[d]&&v){this._prevType=d;const k=this._stacks.length-1,C=this._stacks[k]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(Js(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[k]){const X=this.pool.getObjectForId(R.rtt[k].id);if(X.stamp===R.rtt[k].stamp){this.pool.useObject(X);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),R.rtt[k]={id:O.id,stamp:O.stamp},_.context.bindFramebuffer.set(O.fbo.framebuffer),_.context.clear({color:o.bo.transparent,stencil:0}),_.currentStencilSource=void 0;for(let X=0;X<C.length;X++){const Z=_.style._layers[C[X]],it=Z.source?this._coordsAscending[Z.source][R.tileID.key]:[R.tileID];_.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),_._renderTileClippingMasks(Z,it,!0),_.renderLayer(_,_.style.tileManagers[Z.source],Z,it,c),Z.source&&(R.rttCoords[Z.source]=this._coordsAscendingStr[Z.source][R.tileID.key])}}return Js(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),Zn[d]}return!1}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},qo=N,Zo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Go,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},zu={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Nu{constructor(e,r,c=!1){this.mousedown=_=>{this.startMove(_,W.mousePos(this.element,_)),W.addEventListener(window,"mousemove",this.mousemove),W.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,W.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),W.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const d=new Xh;this._rotatePitchHandler=new Wa({clickTolerance:3,move:(_,v)=>{const k=r.getBoundingClientRect(),C=new o.P((k.bottom-k.top)/2,(k.right-k.left)/2);return{bearingDelta:o.cw(new o.P(_.x,v.y),v,C),pitchDelta:c?-.5*(v.y-_.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,W.addEventListener(r,"mousedown",this.mousedown),W.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),W.disableDrag()}move(e,r){const c=this.map,{bearingDelta:d,pitchDelta:_}=this._rotatePitchHandler.dragMove(e,r)||{};d&&c.setBearing(c.getBearing()+d),_&&c.setPitch(c.getPitch()+_)}off(){const e=this.element;W.removeEventListener(e,"mousedown",this.mousedown),W.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend),W.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){W.enableDrag(),W.removeEventListener(window,"mousemove",this.mousemove),W.removeEventListener(window,"mouseup",this.mouseup),W.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),W.removeEventListener(window,"touchend",this.touchend)}}let Ds;function Ya(g,e,r,c=!1){if(c||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const d=new o.V(g.lng,g.lat);if(g=new o.V(g.lng,g.lat),e){const _=new o.V(g.lng-360,g.lat),v=new o.V(g.lng+360,g.lat),k=r.locationToScreenPoint(g).distSqr(e);r.locationToScreenPoint(_).distSqr(e)<k?g=_:r.locationToScreenPoint(v).distSqr(e)<k&&(g=v)}for(;Math.abs(g.lng-r.center.lng)>180;){const _=r.locationToScreenPoint(g);if(_.x>=0&&_.y>=0&&_.x<=r.width&&_.y<=r.height)break;g.lng>r.center.lng?g.lng-=360:g.lng+=360}return g.lng!==d.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(g))?g:d}const $o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ll(g,e,r){const c=g.classList;for(const d in $o)c.remove(`maplibregl-${r}-anchor-${d}`);c.add(`maplibregl-${r}-anchor-${e}`)}class Wo extends o.E{constructor(e){if(super(),this._onKeyPress=r=>{const c=r.code,d=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Ya(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,`${$o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),q.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div");const r=W.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${d}px`),r.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const _=W.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=W.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const k=W.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const yt of C){const Ct=W.createNS("http://www.w3.org/2000/svg","ellipse");Ct.setAttributeNS(null,"opacity","0.04"),Ct.setAttributeNS(null,"cx","10.5"),Ct.setAttributeNS(null,"cy","5.80029008"),Ct.setAttributeNS(null,"rx",yt.rx),Ct.setAttributeNS(null,"ry",yt.ry),k.appendChild(Ct)}const R=W.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const O=W.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(O);const X=W.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const Z=W.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(Z);const it=W.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"transform","translate(6.0, 7.0)"),it.setAttributeNS(null,"fill","#FFFFFF");const ot=W.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");const mt=W.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#000000"),mt.setAttributeNS(null,"opacity","0.25"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962");const gt=W.createNS("http://www.w3.org/2000/svg","circle");gt.setAttributeNS(null,"fill","#FFFFFF"),gt.setAttributeNS(null,"cx","5.5"),gt.setAttributeNS(null,"cy","5.5"),gt.setAttributeNS(null,"r","5.4999962"),ot.appendChild(mt),ot.appendChild(gt),v.appendChild(k),v.appendChild(R),v.appendChild(X),v.appendChild(it),v.appendChild(ot),r.appendChild(v),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(r),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),Ll(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,c;const d=(r=this._map)===null||r===void 0?void 0:r.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!d||_){const it=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==it&&(this._element.style.opacity=it))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,k=v.terrain.depthAtPoint(this._pos),C=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,C)-k<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/v.transform.pixelsPerMeter,O=Math.sin(v.getPitch()*Math.PI/180)*R,X=v.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),Z=v.transform.lngLatToCameraDepth(this._lngLat,C+O)-X>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&Z&&this._popup.remove(),this._element.style.opacity=Z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Ou={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ha=0,Ta=!1;const Fu={maxWidth:100,unit:"metric"};function Dl(g,e,r){const c=r&&r.maxWidth||100,d=g._container.clientHeight/2,_=g._container.clientWidth/2,v=g.unproject([_-c/2,d]),k=g.unproject([_+c/2,d]),C=Math.round(g.project(k).x-g.project(v).x),R=Math.min(c,C,g._container.clientWidth),O=v.distanceTo(k);if(r&&r.unit==="imperial"){const X=3.2808*O;X>5280?Sa(e,R,X/5280,g._getUIString("ScaleControl.Miles")):Sa(e,R,X,g._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Sa(e,R,O/1852,g._getUIString("ScaleControl.NauticalMiles")):O>=1e3?Sa(e,R,O/1e3,g._getUIString("ScaleControl.Kilometers")):Sa(e,R,O,g._getUIString("ScaleControl.Meters"))}function Sa(g,e,r,c){const d=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let k=_/v;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:(function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R})(k),v*k})(r);g.style.width=e*(d/r)+"px",g.innerHTML=`${d}&nbsp;${c}`}const Rl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Bu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zl(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,g),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-g),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(g,0),right:new o.P(-g,0)}}if(g instanceof o.P||Array.isArray(g)){const e=o.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(g.center||[0,0]),top:o.P.convert(g.top||[0,0]),"top-left":o.P.convert(g["top-left"]||[0,0]),"top-right":o.P.convert(g["top-right"]||[0,0]),bottom:o.P.convert(g.bottom||[0,0]),"bottom-left":o.P.convert(g["bottom-left"]||[0,0]),"bottom-right":o.P.convert(g["bottom-right"]||[0,0]),left:o.P.convert(g.left||[0,0]),right:o.P.convert(g.right||[0,0])}}return zl(new o.P(0,0))}const Nl=N;b.AJAXError=o.cI,b.Event=o.l,b.Evented=o.E,b.LngLat=o.V,b.MercatorCoordinate=o.aa,b.Point=o.P,b.addProtocol=o.cJ,b.config=o.a,b.removeProtocol=o.cK,b.AttributionControl=Qi,b.BoxZoomHandler=Dc,b.CanvasSource=kn,b.CooperativeGesturesHandler=ls,b.DoubleClickZoomHandler=Vo,b.DragPanHandler=Du,b.DragRotateHandler=Ru,b.EdgeInsets=On,b.FullscreenControl=class extends o.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){W.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=W.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);W.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=be,b.GeolocateControl=class extends o.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new o.V(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,d=this._map.getBearing(),_=o.e({bearing:d},this.options.fitBoundsOptions),v=Pt.fromLngLat(r,c);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new o.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ta)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=W.create("button","maplibregl-ctrl-geolocate",this._container),W.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wo({element:this._dotElement}),this._circleElement=W.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const c=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Ou,g)}onAdd(g){return this._map=g,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(e=!1){if(Ds!==void 0&&!e)return Ds;if(window.navigator.permissions===void 0)return Ds=!!window.navigator.geolocation,Ds;try{Ds=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ds=!!window.navigator.geolocation}return Ds}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ha=0,Ta=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),r=g.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const g=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&g))return;const e=this._map.project(g),r=this._map.unproject([e.x+100,e.y]),c=g.distanceTo(r)/100,d=2*this._accuracy/c;this._circleElement.style.width=`${d.toFixed(2)}px`,this._circleElement.style.height=`${d.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ha--,Ta=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ha++,Ha>1?(g={maximumAge:6e5,timeout:0},Ta=!0):(g=this.options.positionOptions,Ta=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=W.create("button","maplibregl-ctrl-globe",this._container),W.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){W.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=Su,b.ImageSource=Ce,b.KeyboardHandler=Fc,b.LngLatBounds=Pt,b.LogoControl=Jr,b.Map=class extends jc{constructor(g){var e,r;o.cF.mark(o.cG.create);const c=Object.assign(Object.assign(Object.assign({},Zo),g),{canvasContextAttributes:Object.assign(Object.assign({},Zo.canvasContextAttributes),g.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new Un,_=new Xi;if(c.minZoom!==void 0&&d.setMinZoom(c.minZoom),c.maxZoom!==void 0&&d.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&d.setMinPitch(c.minPitch),c.maxPitch!==void 0&&d.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&d.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&d.setConstrainOverride(c.transformConstrain),super(d,_,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Gc,this._controls=[],this._mapId=o.ag(),this._lostContextStyle={style:null,images:null},this._contextLost=k=>{k.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const C of Object.values(this.style._layers))if(C.type==="custom"&&console.warn(`Custom layer with id '${C.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),C._listeners)for(const[R]of Object.entries(C._listeners))console.warn(`Custom layer with id '${C.id}' had event listeners for event '${R}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new o.l("webglcontextlost",{originalEvent:k}))},this._contextRestored=k=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:k}))},this._onMapScroll=k=>{if(k.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uc),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(q.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=Mt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Wt(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let k=!1;const C=Tu((R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())}),50);this._resizeObserver=new ResizeObserver((R=>{k?C(R):k=!0})),this._resizeObserver.observe(this._container)}this.handlers=new jo(this,c),this._hash=c.hash&&new Su(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0}))));const v=typeof c.style=="string"||((r=(e=c.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Qi(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Jr,c.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const k=o.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(k)}})),this.on("data",(k=>{this._update(k.dataType==="style"),this.fire(new o.l(`${k.dataType}data`,k))})),this.on("dataloading",(k=>{this.fire(new o.l(`${k.dataType}dataloading`,k))})),this.on("dataabort",(k=>{this.fire(new o.l("sourcedataabort",k))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,e){return this.style.setGlobalStateProperty(g,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=g.onAdd(this);this._controls.push(g);const c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}coveringTiles(g){return an(this.transform,g)}calculateCameraOptionsFromTo(g,e,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,r,c)}resize(g,e=!0){const[r,c]=this._containerDimensions(),d=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,d),this.painter.resize(r,c,d),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const k=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,k),this.painter.resize(r,c,k)}this._resizeTransform(e);const _=!this._moving;return _&&(this.stop(),this.fire(new o.l("movestart",g)).fire(new o.l("move",g))),this.fire(new o.l("resize",g)),_&&this.fire(new o.l("moveend",g)),this}_resizeTransform(g=!0){var e;const[r,c]=this._containerDimensions();this.transform.resize(r,c,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,c,g)}_getClampedPixelRatio(g,e){const{0:r,1:c}=this._maxCanvasSize,d=this.getPixelRatio(),_=g*d,v=e*d;return Math.min(_>r?r/_:1,v>c?c/v:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Pt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}setTransformConstrain(g){return this.transform.setConstrainOverride(g),this._update()}project(g){return this.transform.locationToScreenPoint(o.V.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(o.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,r){if(g==="mouseenter"||g==="mouseover"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:_=>{const v=e.filter((C=>this.getLayer(C))),k=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];k.length?c||(c=!0,r.call(this,new ui(g,this,_.originalEvent,{features:k}))):c=!1},mouseout:()=>{c=!1}}}}if(g==="mouseleave"||g==="mouseout"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:v=>{const k=e.filter((C=>this.getLayer(C)));(k.length!==0?this.queryRenderedFeatures(v.point,{layers:k}):[]).length?c=!0:c&&(c=!1,r.call(this,new ui(g,this,v.originalEvent)))},mouseout:v=>{c&&(c=!1,r.call(this,new ui(g,this,v.originalEvent)))}}}}{const c=d=>{const _=e.filter((k=>this.getLayer(k))),v=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];v.length&&(d.features=v,r.call(this,d),delete d.features)};return{layers:e,listener:r,delegates:{[g]:c}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,r){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const c=this._delegatedListeners[g];for(let d=0;d<c.length;d++){const _=c[d];if(_.listener===r&&_.layers.length===e.length&&_.layers.every((v=>e.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void c.splice(d,1)}}}on(g,e,r){if(r===void 0)return super.on(g,e);const c=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,c,r);this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,c,r)}}}once(g,e,r){if(r===void 0)return super.once(g,e);const c=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,c,r);for(const _ in d.delegates){const v=d.delegates[_];d.delegates[_]=(...k)=>{this._removeDelegatedListener(g,c,r),v(...k)}}this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(g,e,r){return r===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let r;const c=g instanceof o.P||Array.isArray(g),d=c?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:g)||{},d instanceof o.P||typeof d[0]=="number")r=[o.P.convert(d)];else{const _=o.P.convert(d[0]),v=o.P.convert(d[1]);r=[_,new o.P(v.x,_.y),v,new o.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var r,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,e)));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new fa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,d):this.style.loadJSON(g,e,d),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const r=this._requestManager.transformRequest(g,"Style");o.j(r,new AbortController).then((c=>{this._updateDiff(c.data,e)})).catch((c=>{c&&this.fire(new o.k(c))}))}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(r){o.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.tileManagers[g];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no tile manager with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.tileManagers[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===g.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===g.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qh(this.painter,e,g),this.painter.renderToTexture=new pi(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var c;r.dataType==="style"?this.terrain.tileManager.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=r.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.tileManagers;for(const e in g){const r=g[e]._tiles;for(const c in r){const d=r[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,e,r){if(r){const c=this.getSource(r);if(!c)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);c.calculateTileZoom=ce(Math.max(1,g),Math.max(1,e))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=ce(Math.max(1,g),Math.max(1,e));return this._update(!0),this}refreshTiles(g,e){const r=this.style.tileManagers[g];if(!r)throw new Error(`There is no tile manager with ID "${g}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map((c=>new o.ad(c.z,c.x,c.y))))}addImage(g,e,r={}){const{pixelRatio:c=1,sdf:d=!1,stretchX:_,stretchY:v,content:k,textFitWidth:C,textFitHeight:R}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:X,data:Z}=e,it=e;return this.style.addImage(g,{data:new o.R({width:O,height:X},new Uint8Array(Z)),pixelRatio:c,stretchX:_,stretchY:v,content:k,textFitWidth:C,textFitHeight:R,sdf:d,version:0,userImage:it}),it.onAdd&&it.onAdd(this,g),this}}{const{width:O,height:X,data:Z}=q.getImageData(e);this.style.addImage(g,{data:new o.R({width:O,height:X},Z),pixelRatio:c,stretchX:_,stretchY:v,content:k,textFitWidth:C,textFitHeight:R,sdf:d,version:0})}}updateImage(g,e){const r=this.style.getImage(g);if(!r)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=e instanceof HTMLImageElement||o.b(e)?q.getImageData(e):e,{width:d,height:_,data:v}=c;if(d===void 0||_===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==r.data.width||_!==r.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(e instanceof HTMLImageElement||o.b(e));return r.data.replace(v,k),this.style.updateImage(g,r),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return Mt.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,r){return this.style.setLayerZoomRange(g,e,r),this._update(!0)}setFilter(g,e,r={}){return this.style.setFilter(g,e,r),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,r,c={}){return this.style.setPaintProperty(g,e,r,c),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,r,c={}){return this.style.setLayoutProperty(g,e,r,c),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,r,(c=>{c||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,(r=>{r||this._update(!0)})),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=W.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=W.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const d=this._controlContainer=W.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=W.create("div",`maplibregl-ctrl-${v} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,r){this._canvas.width=Math.floor(r*g),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{e={requestedAttributes:g},c&&(e.statusMessage=c.statusMessage,e.type=c.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!r){const c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new Mc(r,this.transform),at.testSupport(r)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,r,c,d,_;const v=this._idleTriggered?this._fadeDuration:0,k=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let C=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const X=this.transform.zoom,Z=J();this.style.zoomHistory.update(X,Z);const it=new o.H(X,{now:Z,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ot=it.crossFadingFactor();ot===1&&ot===this._crossFadingFactor||(C=!0,this._crossFadingFactor=ot),this.style.update(it)}const R=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==k;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cF.mark(o.cG.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,o.cF.mark(o.cG.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Mt.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),W.remove(this._canvasContainer),W.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cF.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,q.frame(this._frameRequest,(g=>{o.cF.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!o.cH(e)&&!(function(r){return r.message===vl})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return qo}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},b.MapMouseEvent=ui,b.MapTouchEvent=Ro,b.MapWheelEvent=wa,b.Marker=Wo,b.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);e.title=c,e.setAttribute("aria-label",c)},this.options=o.e({},zu,g),this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),W.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),W.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=W.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const r=W.create("button",g,this._container);return r.type="button",r.addEventListener("click",e),r}},b.Popup=class extends o.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=W.create("div","maplibregl-popup",this._map.getContainer()),this._tip=W.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ya(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const d=zl(this.options.offset);if(!c){const v=this._container.offsetWidth,k=this._container.offsetHeight;let C;C=r.y+d.bottom.y<k?["top"]:r.y>this._map.transform.height-k?["bottom"]:[],r.x<v/2?C.push("left"):r.x>this._map.transform.width-v/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}let _=r.add(d[c]);this.options.subpixelPositioning||(_=_.round()),W.setTransform(this._container,`${$o[c]} translate(${_.x}px,${_.y}px)`),Ll(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Rl),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.V.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=g;c=r.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Bu);g&&g.focus()}},b.RasterDEMTileSource=Ee,b.RasterTileSource=Te,b.ScaleControl=class{constructor(g){this._onMove=()=>{Dl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Dl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Fu),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Bo,b.Style=fa,b.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=W.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=W.create("button","maplibregl-ctrl-terrain",this._container),W.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){W.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=Au,b.TwoFingersTouchRotateHandler=Pu,b.TwoFingersTouchZoomHandler=Nc,b.TwoFingersTouchZoomRotateHandler=Vc,b.VectorTileSource=Tt,b.VideoSource=Je,b.addSourceType=(g,e)=>o._(void 0,void 0,void 0,(function*(){if(li(g))throw new Error(`A source type called "${g}" already exists.`);((r,c)=>{Oe[r]=c})(g,e)})),b.clearPrewarmedResources=function(){const g=Pn;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(ye),Pn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=Fa,b.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return yn().getRTLTextPluginStatus()},b.getVersion=function(){return Nl},b.getWorkerCount=function(){return Pe.workerCount},b.getWorkerUrl=function(){return o.a.WORKER_URL},b.importScriptInWorkers=function(g){return Be().broadcast("IS",g)},b.isTimeFrozen=function(){return Y.isFrozen()},b.now=J,b.prewarm=function(){bn().acquire(ye)},b.restoreNow=function(){Y.restoreNow()},b.setMaxParallelImageRequests=function(g){o.a.MAX_PARALLEL_IMAGE_REQUESTS=g},b.setNow=function(g){Y.setNow(g)},b.setRTLTextPlugin=function(g,e){return yn().setRTLTextPlugin(g,e)},b.setWorkerCount=function(g){Pe.workerCount=g},b.setWorkerUrl=function(g){o.a.WORKER_URL=g}}));var P=T;return P}))})(Ch)),Ch.exports}var of=nv();const pr=pf(of),wm={colors:{background:"#0b0f15",Walls:"#2f2f3a",ExteriorWalls:"#3b3f4b",Rooms:"#3a3d49",Hallways:"#1c2330",Corridors:"#1f2734",Desks:"#202632",Points:"#2a2f3a",Restrooms:"#1d2533",Bathrooms:"#2a2f3a",Stairs:"#1f2730",Elevators:"#2b3342",Doors:"#6a758a",Outline:"#1a1f2a",Default:"#2a2f3a"},mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"};function bh(A){throw new Error('Could not dynamically require "'+A+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Kd={exports:{}};var Im;function iv(){return Im||(Im=1,(function(A,I){(function(T){A.exports=T()})(function(){return(function T(E,S,P){function b($,G){if(!S[$]){if(!E[$]){var V=typeof bh=="function"&&bh;if(!G&&V)return V($,!0);if(o)return o($,!0);var K=new Error("Cannot find module '"+$+"'");throw K.code="MODULE_NOT_FOUND",K}var q=S[$]={exports:{}};E[$][0].call(q.exports,function(Y){var J=E[$][1][Y];return b(J||Y)},q,q.exports,T,E,S,P)}return S[$].exports}for(var o=typeof bh=="function"&&bh,N=0;N<P.length;N++)b(P[N]);return b})({1:[function(T,E,S){var P=T("./utils"),b=T("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";S.encode=function(N){for(var $,G,V,K,q,Y,J,W=[],at=0,ut=N.length,dt=ut,Lt=P.getTypeOf(N)!=="string";at<N.length;)dt=ut-at,V=Lt?($=N[at++],G=at<ut?N[at++]:0,at<ut?N[at++]:0):($=N.charCodeAt(at++),G=at<ut?N.charCodeAt(at++):0,at<ut?N.charCodeAt(at++):0),K=$>>2,q=(3&$)<<4|G>>4,Y=1<dt?(15&G)<<2|V>>6:64,J=2<dt?63&V:64,W.push(o.charAt(K)+o.charAt(q)+o.charAt(Y)+o.charAt(J));return W.join("")},S.decode=function(N){var $,G,V,K,q,Y,J=0,W=0,at="data:";if(N.substr(0,at.length)===at)throw new Error("Invalid base64 input, it looks like a data url.");var ut,dt=3*(N=N.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(N.charAt(N.length-1)===o.charAt(64)&&dt--,N.charAt(N.length-2)===o.charAt(64)&&dt--,dt%1!=0)throw new Error("Invalid base64 input, bad content length.");for(ut=b.uint8array?new Uint8Array(0|dt):new Array(0|dt);J<N.length;)$=o.indexOf(N.charAt(J++))<<2|(K=o.indexOf(N.charAt(J++)))>>4,G=(15&K)<<4|(q=o.indexOf(N.charAt(J++)))>>2,V=(3&q)<<6|(Y=o.indexOf(N.charAt(J++))),ut[W++]=$,q!==64&&(ut[W++]=G),Y!==64&&(ut[W++]=V);return ut}},{"./support":30,"./utils":32}],2:[function(T,E,S){var P=T("./external"),b=T("./stream/DataWorker"),o=T("./stream/Crc32Probe"),N=T("./stream/DataLengthProbe");function $(G,V,K,q,Y){this.compressedSize=G,this.uncompressedSize=V,this.crc32=K,this.compression=q,this.compressedContent=Y}$.prototype={getContentWorker:function(){var G=new b(P.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new N("data_length")),V=this;return G.on("end",function(){if(this.streamInfo.data_length!==V.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),G},getCompressedWorker:function(){return new b(P.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},$.createWorkerFrom=function(G,V,K){return G.pipe(new o).pipe(new N("uncompressedSize")).pipe(V.compressWorker(K)).pipe(new N("compressedSize")).withStreamInfo("compression",V)},E.exports=$},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(T,E,S){var P=T("./stream/GenericWorker");S.STORE={magic:"\0\0",compressWorker:function(){return new P("STORE compression")},uncompressWorker:function(){return new P("STORE decompression")}},S.DEFLATE=T("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(T,E,S){var P=T("./utils"),b=(function(){for(var o,N=[],$=0;$<256;$++){o=$;for(var G=0;G<8;G++)o=1&o?3988292384^o>>>1:o>>>1;N[$]=o}return N})();E.exports=function(o,N){return o!==void 0&&o.length?P.getTypeOf(o)!=="string"?(function($,G,V,K){var q=b,Y=K+V;$^=-1;for(var J=K;J<Y;J++)$=$>>>8^q[255&($^G[J])];return-1^$})(0|N,o,o.length,0):(function($,G,V,K){var q=b,Y=K+V;$^=-1;for(var J=K;J<Y;J++)$=$>>>8^q[255&($^G.charCodeAt(J))];return-1^$})(0|N,o,o.length,0):0}},{"./utils":32}],5:[function(T,E,S){S.base64=!1,S.binary=!1,S.dir=!1,S.createFolders=!0,S.date=null,S.compression=null,S.compressionOptions=null,S.comment=null,S.unixPermissions=null,S.dosPermissions=null},{}],6:[function(T,E,S){var P=null;P=typeof Promise<"u"?Promise:T("lie"),E.exports={Promise:P}},{lie:37}],7:[function(T,E,S){var P=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",b=T("pako"),o=T("./utils"),N=T("./stream/GenericWorker"),$=P?"uint8array":"array";function G(V,K){N.call(this,"FlateWorker/"+V),this._pako=null,this._pakoAction=V,this._pakoOptions=K,this.meta={}}S.magic="\b\0",o.inherits(G,N),G.prototype.processChunk=function(V){this.meta=V.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo($,V.data),!1)},G.prototype.flush=function(){N.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},G.prototype.cleanUp=function(){N.prototype.cleanUp.call(this),this._pako=null},G.prototype._createPako=function(){this._pako=new b[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var V=this;this._pako.onData=function(K){V.push({data:K,meta:V.meta})}},S.compressWorker=function(V){return new G("Deflate",V)},S.uncompressWorker=function(){return new G("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(T,E,S){function P(q,Y){var J,W="";for(J=0;J<Y;J++)W+=String.fromCharCode(255&q),q>>>=8;return W}function b(q,Y,J,W,at,ut){var dt,Lt,kt=q.file,jt=q.compression,Mt=ut!==$.utf8encode,Wt=o.transformTo("string",ut(kt.name)),Ot=o.transformTo("string",$.utf8encode(kt.name)),Kt=kt.comment,ge=o.transformTo("string",ut(Kt)),Et=o.transformTo("string",$.utf8encode(Kt)),Ht=Ot.length!==kt.name.length,tt=Et.length!==Kt.length,Jt="",ze="",te="",Ne=kt.dir,he=kt.date,_e={crc32:0,compressedSize:0,uncompressedSize:0};Y&&!J||(_e.crc32=q.crc32,_e.compressedSize=q.compressedSize,_e.uncompressedSize=q.uncompressedSize);var Zt=0;Y&&(Zt|=8),Mt||!Ht&&!tt||(Zt|=2048);var Xt=0,Ge=0;Ne&&(Xt|=16),at==="UNIX"?(Ge=798,Xt|=(function(Pe,_n){var Pn=Pe;return Pe||(Pn=_n?16893:33204),(65535&Pn)<<16})(kt.unixPermissions,Ne)):(Ge=20,Xt|=(function(Pe){return 63&(Pe||0)})(kt.dosPermissions)),dt=he.getUTCHours(),dt<<=6,dt|=he.getUTCMinutes(),dt<<=5,dt|=he.getUTCSeconds()/2,Lt=he.getUTCFullYear()-1980,Lt<<=4,Lt|=he.getUTCMonth()+1,Lt<<=5,Lt|=he.getUTCDate(),Ht&&(ze=P(1,1)+P(G(Wt),4)+Ot,Jt+="up"+P(ze.length,2)+ze),tt&&(te=P(1,1)+P(G(ge),4)+Et,Jt+="uc"+P(te.length,2)+te);var ye="";return ye+=`
\0`,ye+=P(Zt,2),ye+=jt.magic,ye+=P(dt,2),ye+=P(Lt,2),ye+=P(_e.crc32,4),ye+=P(_e.compressedSize,4),ye+=P(_e.uncompressedSize,4),ye+=P(Wt.length,2),ye+=P(Jt.length,2),{fileRecord:V.LOCAL_FILE_HEADER+ye+Wt+Jt,dirRecord:V.CENTRAL_FILE_HEADER+P(Ge,2)+ye+P(ge.length,2)+"\0\0\0\0"+P(Xt,4)+P(W,4)+Wt+Jt+ge}}var o=T("../utils"),N=T("../stream/GenericWorker"),$=T("../utf8"),G=T("../crc32"),V=T("../signature");function K(q,Y,J,W){N.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=Y,this.zipPlatform=J,this.encodeFileName=W,this.streamFiles=q,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(K,N),K.prototype.push=function(q){var Y=q.meta.percent||0,J=this.entriesCount,W=this._sources.length;this.accumulate?this.contentBuffer.push(q):(this.bytesWritten+=q.data.length,N.prototype.push.call(this,{data:q.data,meta:{currentFile:this.currentFile,percent:J?(Y+100*(J-W-1))/J:100}}))},K.prototype.openedSource=function(q){this.currentSourceOffset=this.bytesWritten,this.currentFile=q.file.name;var Y=this.streamFiles&&!q.file.dir;if(Y){var J=b(q,Y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:J.fileRecord,meta:{percent:0}})}else this.accumulate=!0},K.prototype.closedSource=function(q){this.accumulate=!1;var Y=this.streamFiles&&!q.file.dir,J=b(q,Y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(J.dirRecord),Y)this.push({data:(function(W){return V.DATA_DESCRIPTOR+P(W.crc32,4)+P(W.compressedSize,4)+P(W.uncompressedSize,4)})(q),meta:{percent:100}});else for(this.push({data:J.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},K.prototype.flush=function(){for(var q=this.bytesWritten,Y=0;Y<this.dirRecords.length;Y++)this.push({data:this.dirRecords[Y],meta:{percent:100}});var J=this.bytesWritten-q,W=(function(at,ut,dt,Lt,kt){var jt=o.transformTo("string",kt(Lt));return V.CENTRAL_DIRECTORY_END+"\0\0\0\0"+P(at,2)+P(at,2)+P(ut,4)+P(dt,4)+P(jt.length,2)+jt})(this.dirRecords.length,J,q,this.zipComment,this.encodeFileName);this.push({data:W,meta:{percent:100}})},K.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},K.prototype.registerPrevious=function(q){this._sources.push(q);var Y=this;return q.on("data",function(J){Y.processChunk(J)}),q.on("end",function(){Y.closedSource(Y.previous.streamInfo),Y._sources.length?Y.prepareNextSource():Y.end()}),q.on("error",function(J){Y.error(J)}),this},K.prototype.resume=function(){return!!N.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},K.prototype.error=function(q){var Y=this._sources;if(!N.prototype.error.call(this,q))return!1;for(var J=0;J<Y.length;J++)try{Y[J].error(q)}catch{}return!0},K.prototype.lock=function(){N.prototype.lock.call(this);for(var q=this._sources,Y=0;Y<q.length;Y++)q[Y].lock()},E.exports=K},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(T,E,S){var P=T("../compressions"),b=T("./ZipFileWorker");S.generateWorker=function(o,N,$){var G=new b(N.streamFiles,$,N.platform,N.encodeFileName),V=0;try{o.forEach(function(K,q){V++;var Y=(function(ut,dt){var Lt=ut||dt,kt=P[Lt];if(!kt)throw new Error(Lt+" is not a valid compression method !");return kt})(q.options.compression,N.compression),J=q.options.compressionOptions||N.compressionOptions||{},W=q.dir,at=q.date;q._compressWorker(Y,J).withStreamInfo("file",{name:K,dir:W,date:at,comment:q.comment||"",unixPermissions:q.unixPermissions,dosPermissions:q.dosPermissions}).pipe(G)}),G.entriesCount=V}catch(K){G.error(K)}return G}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(T,E,S){function P(){if(!(this instanceof P))return new P;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var b=new P;for(var o in this)typeof this[o]!="function"&&(b[o]=this[o]);return b}}(P.prototype=T("./object")).loadAsync=T("./load"),P.support=T("./support"),P.defaults=T("./defaults"),P.version="3.10.1",P.loadAsync=function(b,o){return new P().loadAsync(b,o)},P.external=T("./external"),E.exports=P},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(T,E,S){var P=T("./utils"),b=T("./external"),o=T("./utf8"),N=T("./zipEntries"),$=T("./stream/Crc32Probe"),G=T("./nodejsUtils");function V(K){return new b.Promise(function(q,Y){var J=K.decompressed.getContentWorker().pipe(new $);J.on("error",function(W){Y(W)}).on("end",function(){J.streamInfo.crc32!==K.decompressed.crc32?Y(new Error("Corrupted zip : CRC32 mismatch")):q()}).resume()})}E.exports=function(K,q){var Y=this;return q=P.extend(q||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),G.isNode&&G.isStream(K)?b.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):P.prepareContent("the loaded zip file",K,!0,q.optimizedBinaryString,q.base64).then(function(J){var W=new N(q);return W.load(J),W}).then(function(J){var W=[b.Promise.resolve(J)],at=J.files;if(q.checkCRC32)for(var ut=0;ut<at.length;ut++)W.push(V(at[ut]));return b.Promise.all(W)}).then(function(J){for(var W=J.shift(),at=W.files,ut=0;ut<at.length;ut++){var dt=at[ut],Lt=dt.fileNameStr,kt=P.resolve(dt.fileNameStr);Y.file(kt,dt.decompressed,{binary:!0,optimizedBinaryString:!0,date:dt.date,dir:dt.dir,comment:dt.fileCommentStr.length?dt.fileCommentStr:null,unixPermissions:dt.unixPermissions,dosPermissions:dt.dosPermissions,createFolders:q.createFolders}),dt.dir||(Y.file(kt).unsafeOriginalName=Lt)}return W.zipComment.length&&(Y.comment=W.zipComment),Y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(T,E,S){var P=T("../utils"),b=T("../stream/GenericWorker");function o(N,$){b.call(this,"Nodejs stream input adapter for "+N),this._upstreamEnded=!1,this._bindStream($)}P.inherits(o,b),o.prototype._bindStream=function(N){var $=this;(this._stream=N).pause(),N.on("data",function(G){$.push({data:G,meta:{percent:0}})}).on("error",function(G){$.isPaused?this.generatedError=G:$.error(G)}).on("end",function(){$.isPaused?$._upstreamEnded=!0:$.end()})},o.prototype.pause=function(){return!!b.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!b.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},E.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(T,E,S){var P=T("readable-stream").Readable;function b(o,N,$){P.call(this,N),this._helper=o;var G=this;o.on("data",function(V,K){G.push(V)||G._helper.pause(),$&&$(K)}).on("error",function(V){G.emit("error",V)}).on("end",function(){G.push(null)})}T("../utils").inherits(b,P),b.prototype._read=function(){this._helper.resume()},E.exports=b},{"../utils":32,"readable-stream":16}],14:[function(T,E,S){E.exports={isNode:typeof Buffer<"u",newBufferFrom:function(P,b){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(P,b);if(typeof P=="number")throw new Error('The "data" argument must not be a number');return new Buffer(P,b)},allocBuffer:function(P){if(Buffer.alloc)return Buffer.alloc(P);var b=new Buffer(P);return b.fill(0),b},isBuffer:function(P){return Buffer.isBuffer(P)},isStream:function(P){return P&&typeof P.on=="function"&&typeof P.pause=="function"&&typeof P.resume=="function"}}},{}],15:[function(T,E,S){function P(kt,jt,Mt){var Wt,Ot=o.getTypeOf(jt),Kt=o.extend(Mt||{},G);Kt.date=Kt.date||new Date,Kt.compression!==null&&(Kt.compression=Kt.compression.toUpperCase()),typeof Kt.unixPermissions=="string"&&(Kt.unixPermissions=parseInt(Kt.unixPermissions,8)),Kt.unixPermissions&&16384&Kt.unixPermissions&&(Kt.dir=!0),Kt.dosPermissions&&16&Kt.dosPermissions&&(Kt.dir=!0),Kt.dir&&(kt=at(kt)),Kt.createFolders&&(Wt=W(kt))&&ut.call(this,Wt,!0);var ge=Ot==="string"&&Kt.binary===!1&&Kt.base64===!1;Mt&&Mt.binary!==void 0||(Kt.binary=!ge),(jt instanceof V&&jt.uncompressedSize===0||Kt.dir||!jt||jt.length===0)&&(Kt.base64=!1,Kt.binary=!0,jt="",Kt.compression="STORE",Ot="string");var Et=null;Et=jt instanceof V||jt instanceof N?jt:Y.isNode&&Y.isStream(jt)?new J(kt,jt):o.prepareContent(kt,jt,Kt.binary,Kt.optimizedBinaryString,Kt.base64);var Ht=new K(kt,Et,Kt);this.files[kt]=Ht}var b=T("./utf8"),o=T("./utils"),N=T("./stream/GenericWorker"),$=T("./stream/StreamHelper"),G=T("./defaults"),V=T("./compressedObject"),K=T("./zipObject"),q=T("./generate"),Y=T("./nodejsUtils"),J=T("./nodejs/NodejsStreamInputAdapter"),W=function(kt){kt.slice(-1)==="/"&&(kt=kt.substring(0,kt.length-1));var jt=kt.lastIndexOf("/");return 0<jt?kt.substring(0,jt):""},at=function(kt){return kt.slice(-1)!=="/"&&(kt+="/"),kt},ut=function(kt,jt){return jt=jt!==void 0?jt:G.createFolders,kt=at(kt),this.files[kt]||P.call(this,kt,null,{dir:!0,createFolders:jt}),this.files[kt]};function dt(kt){return Object.prototype.toString.call(kt)==="[object RegExp]"}var Lt={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(kt){var jt,Mt,Wt;for(jt in this.files)Wt=this.files[jt],(Mt=jt.slice(this.root.length,jt.length))&&jt.slice(0,this.root.length)===this.root&&kt(Mt,Wt)},filter:function(kt){var jt=[];return this.forEach(function(Mt,Wt){kt(Mt,Wt)&&jt.push(Wt)}),jt},file:function(kt,jt,Mt){if(arguments.length!==1)return kt=this.root+kt,P.call(this,kt,jt,Mt),this;if(dt(kt)){var Wt=kt;return this.filter(function(Kt,ge){return!ge.dir&&Wt.test(Kt)})}var Ot=this.files[this.root+kt];return Ot&&!Ot.dir?Ot:null},folder:function(kt){if(!kt)return this;if(dt(kt))return this.filter(function(Ot,Kt){return Kt.dir&&kt.test(Ot)});var jt=this.root+kt,Mt=ut.call(this,jt),Wt=this.clone();return Wt.root=Mt.name,Wt},remove:function(kt){kt=this.root+kt;var jt=this.files[kt];if(jt||(kt.slice(-1)!=="/"&&(kt+="/"),jt=this.files[kt]),jt&&!jt.dir)delete this.files[kt];else for(var Mt=this.filter(function(Ot,Kt){return Kt.name.slice(0,kt.length)===kt}),Wt=0;Wt<Mt.length;Wt++)delete this.files[Mt[Wt].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(kt){var jt,Mt={};try{if((Mt=o.extend(kt||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:b.utf8encode})).type=Mt.type.toLowerCase(),Mt.compression=Mt.compression.toUpperCase(),Mt.type==="binarystring"&&(Mt.type="string"),!Mt.type)throw new Error("No output type specified.");o.checkSupport(Mt.type),Mt.platform!=="darwin"&&Mt.platform!=="freebsd"&&Mt.platform!=="linux"&&Mt.platform!=="sunos"||(Mt.platform="UNIX"),Mt.platform==="win32"&&(Mt.platform="DOS");var Wt=Mt.comment||this.comment||"";jt=q.generateWorker(this,Mt,Wt)}catch(Ot){(jt=new N("error")).error(Ot)}return new $(jt,Mt.type||"string",Mt.mimeType)},generateAsync:function(kt,jt){return this.generateInternalStream(kt).accumulate(jt)},generateNodeStream:function(kt,jt){return(kt=kt||{}).type||(kt.type="nodebuffer"),this.generateInternalStream(kt).toNodejsStream(jt)}};E.exports=Lt},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(T,E,S){E.exports=T("stream")},{stream:void 0}],17:[function(T,E,S){var P=T("./DataReader");function b(o){P.call(this,o);for(var N=0;N<this.data.length;N++)o[N]=255&o[N]}T("../utils").inherits(b,P),b.prototype.byteAt=function(o){return this.data[this.zero+o]},b.prototype.lastIndexOfSignature=function(o){for(var N=o.charCodeAt(0),$=o.charCodeAt(1),G=o.charCodeAt(2),V=o.charCodeAt(3),K=this.length-4;0<=K;--K)if(this.data[K]===N&&this.data[K+1]===$&&this.data[K+2]===G&&this.data[K+3]===V)return K-this.zero;return-1},b.prototype.readAndCheckSignature=function(o){var N=o.charCodeAt(0),$=o.charCodeAt(1),G=o.charCodeAt(2),V=o.charCodeAt(3),K=this.readData(4);return N===K[0]&&$===K[1]&&G===K[2]&&V===K[3]},b.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var N=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,N},E.exports=b},{"../utils":32,"./DataReader":18}],18:[function(T,E,S){var P=T("../utils");function b(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}b.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var N,$=0;for(this.checkOffset(o),N=this.index+o-1;N>=this.index;N--)$=($<<8)+this.byteAt(N);return this.index+=o,$},readString:function(o){return P.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},E.exports=b},{"../utils":32}],19:[function(T,E,S){var P=T("./Uint8ArrayReader");function b(o){P.call(this,o)}T("../utils").inherits(b,P),b.prototype.readData=function(o){this.checkOffset(o);var N=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,N},E.exports=b},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(T,E,S){var P=T("./DataReader");function b(o){P.call(this,o)}T("../utils").inherits(b,P),b.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},b.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},b.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},b.prototype.readData=function(o){this.checkOffset(o);var N=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,N},E.exports=b},{"../utils":32,"./DataReader":18}],21:[function(T,E,S){var P=T("./ArrayReader");function b(o){P.call(this,o)}T("../utils").inherits(b,P),b.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var N=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,N},E.exports=b},{"../utils":32,"./ArrayReader":17}],22:[function(T,E,S){var P=T("../utils"),b=T("../support"),o=T("./ArrayReader"),N=T("./StringReader"),$=T("./NodeBufferReader"),G=T("./Uint8ArrayReader");E.exports=function(V){var K=P.getTypeOf(V);return P.checkSupport(K),K!=="string"||b.uint8array?K==="nodebuffer"?new $(V):b.uint8array?new G(P.transformTo("uint8array",V)):new o(P.transformTo("array",V)):new N(V)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(T,E,S){S.LOCAL_FILE_HEADER="PK",S.CENTRAL_FILE_HEADER="PK",S.CENTRAL_DIRECTORY_END="PK",S.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",S.ZIP64_CENTRAL_DIRECTORY_END="PK",S.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(T,E,S){var P=T("./GenericWorker"),b=T("../utils");function o(N){P.call(this,"ConvertWorker to "+N),this.destType=N}b.inherits(o,P),o.prototype.processChunk=function(N){this.push({data:b.transformTo(this.destType,N.data),meta:N.meta})},E.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(T,E,S){var P=T("./GenericWorker"),b=T("../crc32");function o(){P.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}T("../utils").inherits(o,P),o.prototype.processChunk=function(N){this.streamInfo.crc32=b(N.data,this.streamInfo.crc32||0),this.push(N)},E.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(T,E,S){var P=T("../utils"),b=T("./GenericWorker");function o(N){b.call(this,"DataLengthProbe for "+N),this.propName=N,this.withStreamInfo(N,0)}P.inherits(o,b),o.prototype.processChunk=function(N){if(N){var $=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=$+N.data.length}b.prototype.processChunk.call(this,N)},E.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(T,E,S){var P=T("../utils"),b=T("./GenericWorker");function o(N){b.call(this,"DataWorker");var $=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,N.then(function(G){$.dataIsReady=!0,$.data=G,$.max=G&&G.length||0,$.type=P.getTypeOf(G),$.isPaused||$._tickAndRepeat()},function(G){$.error(G)})}P.inherits(o,b),o.prototype.cleanUp=function(){b.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!b.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,P.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(P.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var N=null,$=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":N=this.data.substring(this.index,$);break;case"uint8array":N=this.data.subarray(this.index,$);break;case"array":case"nodebuffer":N=this.data.slice(this.index,$)}return this.index=$,this.push({data:N,meta:{percent:this.max?this.index/this.max*100:0}})},E.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(T,E,S){function P(b){this.name=b||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}P.prototype={push:function(b){this.emit("data",b)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(b){this.emit("error",b)}return!0},error:function(b){return!this.isFinished&&(this.isPaused?this.generatedError=b:(this.isFinished=!0,this.emit("error",b),this.previous&&this.previous.error(b),this.cleanUp()),!0)},on:function(b,o){return this._listeners[b].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(b,o){if(this._listeners[b])for(var N=0;N<this._listeners[b].length;N++)this._listeners[b][N].call(this,o)},pipe:function(b){return b.registerPrevious(this)},registerPrevious:function(b){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=b.streamInfo,this.mergeStreamInfo(),this.previous=b;var o=this;return b.on("data",function(N){o.processChunk(N)}),b.on("end",function(){o.end()}),b.on("error",function(N){o.error(N)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var b=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),b=!0),this.previous&&this.previous.resume(),!b},flush:function(){},processChunk:function(b){this.push(b)},withStreamInfo:function(b,o){return this.extraStreamInfo[b]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var b in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,b)&&(this.streamInfo[b]=this.extraStreamInfo[b])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var b="Worker "+this.name;return this.previous?this.previous+" -> "+b:b}},E.exports=P},{}],29:[function(T,E,S){var P=T("../utils"),b=T("./ConvertWorker"),o=T("./GenericWorker"),N=T("../base64"),$=T("../support"),G=T("../external"),V=null;if($.nodestream)try{V=T("../nodejs/NodejsStreamOutputAdapter")}catch{}function K(Y,J){return new G.Promise(function(W,at){var ut=[],dt=Y._internalType,Lt=Y._outputType,kt=Y._mimeType;Y.on("data",function(jt,Mt){ut.push(jt),J&&J(Mt)}).on("error",function(jt){ut=[],at(jt)}).on("end",function(){try{var jt=(function(Mt,Wt,Ot){switch(Mt){case"blob":return P.newBlob(P.transformTo("arraybuffer",Wt),Ot);case"base64":return N.encode(Wt);default:return P.transformTo(Mt,Wt)}})(Lt,(function(Mt,Wt){var Ot,Kt=0,ge=null,Et=0;for(Ot=0;Ot<Wt.length;Ot++)Et+=Wt[Ot].length;switch(Mt){case"string":return Wt.join("");case"array":return Array.prototype.concat.apply([],Wt);case"uint8array":for(ge=new Uint8Array(Et),Ot=0;Ot<Wt.length;Ot++)ge.set(Wt[Ot],Kt),Kt+=Wt[Ot].length;return ge;case"nodebuffer":return Buffer.concat(Wt);default:throw new Error("concat : unsupported type '"+Mt+"'")}})(dt,ut),kt);W(jt)}catch(Mt){at(Mt)}ut=[]}).resume()})}function q(Y,J,W){var at=J;switch(J){case"blob":case"arraybuffer":at="uint8array";break;case"base64":at="string"}try{this._internalType=at,this._outputType=J,this._mimeType=W,P.checkSupport(at),this._worker=Y.pipe(new b(at)),Y.lock()}catch(ut){this._worker=new o("error"),this._worker.error(ut)}}q.prototype={accumulate:function(Y){return K(this,Y)},on:function(Y,J){var W=this;return Y==="data"?this._worker.on(Y,function(at){J.call(W,at.data,at.meta)}):this._worker.on(Y,function(){P.delay(J,arguments,W)}),this},resume:function(){return P.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(Y){if(P.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new V(this,{objectMode:this._outputType!=="nodebuffer"},Y)}},E.exports=q},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(T,E,S){if(S.base64=!0,S.array=!0,S.string=!0,S.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",S.nodebuffer=typeof Buffer<"u",S.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")S.blob=!1;else{var P=new ArrayBuffer(0);try{S.blob=new Blob([P],{type:"application/zip"}).size===0}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);b.append(P),S.blob=b.getBlob("application/zip").size===0}catch{S.blob=!1}}}try{S.nodestream=!!T("readable-stream").Readable}catch{S.nodestream=!1}},{"readable-stream":16}],31:[function(T,E,S){for(var P=T("./utils"),b=T("./support"),o=T("./nodejsUtils"),N=T("./stream/GenericWorker"),$=new Array(256),G=0;G<256;G++)$[G]=252<=G?6:248<=G?5:240<=G?4:224<=G?3:192<=G?2:1;$[254]=$[254]=1;function V(){N.call(this,"utf-8 decode"),this.leftOver=null}function K(){N.call(this,"utf-8 encode")}S.utf8encode=function(q){return b.nodebuffer?o.newBufferFrom(q,"utf-8"):(function(Y){var J,W,at,ut,dt,Lt=Y.length,kt=0;for(ut=0;ut<Lt;ut++)(64512&(W=Y.charCodeAt(ut)))==55296&&ut+1<Lt&&(64512&(at=Y.charCodeAt(ut+1)))==56320&&(W=65536+(W-55296<<10)+(at-56320),ut++),kt+=W<128?1:W<2048?2:W<65536?3:4;for(J=b.uint8array?new Uint8Array(kt):new Array(kt),ut=dt=0;dt<kt;ut++)(64512&(W=Y.charCodeAt(ut)))==55296&&ut+1<Lt&&(64512&(at=Y.charCodeAt(ut+1)))==56320&&(W=65536+(W-55296<<10)+(at-56320),ut++),W<128?J[dt++]=W:(W<2048?J[dt++]=192|W>>>6:(W<65536?J[dt++]=224|W>>>12:(J[dt++]=240|W>>>18,J[dt++]=128|W>>>12&63),J[dt++]=128|W>>>6&63),J[dt++]=128|63&W);return J})(q)},S.utf8decode=function(q){return b.nodebuffer?P.transformTo("nodebuffer",q).toString("utf-8"):(function(Y){var J,W,at,ut,dt=Y.length,Lt=new Array(2*dt);for(J=W=0;J<dt;)if((at=Y[J++])<128)Lt[W++]=at;else if(4<(ut=$[at]))Lt[W++]=65533,J+=ut-1;else{for(at&=ut===2?31:ut===3?15:7;1<ut&&J<dt;)at=at<<6|63&Y[J++],ut--;1<ut?Lt[W++]=65533:at<65536?Lt[W++]=at:(at-=65536,Lt[W++]=55296|at>>10&1023,Lt[W++]=56320|1023&at)}return Lt.length!==W&&(Lt.subarray?Lt=Lt.subarray(0,W):Lt.length=W),P.applyFromCharCode(Lt)})(q=P.transformTo(b.uint8array?"uint8array":"array",q))},P.inherits(V,N),V.prototype.processChunk=function(q){var Y=P.transformTo(b.uint8array?"uint8array":"array",q.data);if(this.leftOver&&this.leftOver.length){if(b.uint8array){var J=Y;(Y=new Uint8Array(J.length+this.leftOver.length)).set(this.leftOver,0),Y.set(J,this.leftOver.length)}else Y=this.leftOver.concat(Y);this.leftOver=null}var W=(function(ut,dt){var Lt;for((dt=dt||ut.length)>ut.length&&(dt=ut.length),Lt=dt-1;0<=Lt&&(192&ut[Lt])==128;)Lt--;return Lt<0||Lt===0?dt:Lt+$[ut[Lt]]>dt?Lt:dt})(Y),at=Y;W!==Y.length&&(b.uint8array?(at=Y.subarray(0,W),this.leftOver=Y.subarray(W,Y.length)):(at=Y.slice(0,W),this.leftOver=Y.slice(W,Y.length))),this.push({data:S.utf8decode(at),meta:q.meta})},V.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:S.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},S.Utf8DecodeWorker=V,P.inherits(K,N),K.prototype.processChunk=function(q){this.push({data:S.utf8encode(q.data),meta:q.meta})},S.Utf8EncodeWorker=K},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(T,E,S){var P=T("./support"),b=T("./base64"),o=T("./nodejsUtils"),N=T("./external");function $(J){return J}function G(J,W){for(var at=0;at<J.length;++at)W[at]=255&J.charCodeAt(at);return W}T("setimmediate"),S.newBlob=function(J,W){S.checkSupport("blob");try{return new Blob([J],{type:W})}catch{try{var at=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return at.append(J),at.getBlob(W)}catch{throw new Error("Bug : can't construct the Blob.")}}};var V={stringifyByChunk:function(J,W,at){var ut=[],dt=0,Lt=J.length;if(Lt<=at)return String.fromCharCode.apply(null,J);for(;dt<Lt;)W==="array"||W==="nodebuffer"?ut.push(String.fromCharCode.apply(null,J.slice(dt,Math.min(dt+at,Lt)))):ut.push(String.fromCharCode.apply(null,J.subarray(dt,Math.min(dt+at,Lt)))),dt+=at;return ut.join("")},stringifyByChar:function(J){for(var W="",at=0;at<J.length;at++)W+=String.fromCharCode(J[at]);return W},applyCanBeUsed:{uint8array:(function(){try{return P.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return P.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function K(J){var W=65536,at=S.getTypeOf(J),ut=!0;if(at==="uint8array"?ut=V.applyCanBeUsed.uint8array:at==="nodebuffer"&&(ut=V.applyCanBeUsed.nodebuffer),ut)for(;1<W;)try{return V.stringifyByChunk(J,at,W)}catch{W=Math.floor(W/2)}return V.stringifyByChar(J)}function q(J,W){for(var at=0;at<J.length;at++)W[at]=J[at];return W}S.applyFromCharCode=K;var Y={};Y.string={string:$,array:function(J){return G(J,new Array(J.length))},arraybuffer:function(J){return Y.string.uint8array(J).buffer},uint8array:function(J){return G(J,new Uint8Array(J.length))},nodebuffer:function(J){return G(J,o.allocBuffer(J.length))}},Y.array={string:K,array:$,arraybuffer:function(J){return new Uint8Array(J).buffer},uint8array:function(J){return new Uint8Array(J)},nodebuffer:function(J){return o.newBufferFrom(J)}},Y.arraybuffer={string:function(J){return K(new Uint8Array(J))},array:function(J){return q(new Uint8Array(J),new Array(J.byteLength))},arraybuffer:$,uint8array:function(J){return new Uint8Array(J)},nodebuffer:function(J){return o.newBufferFrom(new Uint8Array(J))}},Y.uint8array={string:K,array:function(J){return q(J,new Array(J.length))},arraybuffer:function(J){return J.buffer},uint8array:$,nodebuffer:function(J){return o.newBufferFrom(J)}},Y.nodebuffer={string:K,array:function(J){return q(J,new Array(J.length))},arraybuffer:function(J){return Y.nodebuffer.uint8array(J).buffer},uint8array:function(J){return q(J,new Uint8Array(J.length))},nodebuffer:$},S.transformTo=function(J,W){if(W=W||"",!J)return W;S.checkSupport(J);var at=S.getTypeOf(W);return Y[at][J](W)},S.resolve=function(J){for(var W=J.split("/"),at=[],ut=0;ut<W.length;ut++){var dt=W[ut];dt==="."||dt===""&&ut!==0&&ut!==W.length-1||(dt===".."?at.pop():at.push(dt))}return at.join("/")},S.getTypeOf=function(J){return typeof J=="string"?"string":Object.prototype.toString.call(J)==="[object Array]"?"array":P.nodebuffer&&o.isBuffer(J)?"nodebuffer":P.uint8array&&J instanceof Uint8Array?"uint8array":P.arraybuffer&&J instanceof ArrayBuffer?"arraybuffer":void 0},S.checkSupport=function(J){if(!P[J.toLowerCase()])throw new Error(J+" is not supported by this platform")},S.MAX_VALUE_16BITS=65535,S.MAX_VALUE_32BITS=-1,S.pretty=function(J){var W,at,ut="";for(at=0;at<(J||"").length;at++)ut+="\\x"+((W=J.charCodeAt(at))<16?"0":"")+W.toString(16).toUpperCase();return ut},S.delay=function(J,W,at){setImmediate(function(){J.apply(at||null,W||[])})},S.inherits=function(J,W){function at(){}at.prototype=W.prototype,J.prototype=new at},S.extend=function(){var J,W,at={};for(J=0;J<arguments.length;J++)for(W in arguments[J])Object.prototype.hasOwnProperty.call(arguments[J],W)&&at[W]===void 0&&(at[W]=arguments[J][W]);return at},S.prepareContent=function(J,W,at,ut,dt){return N.Promise.resolve(W).then(function(Lt){return P.blob&&(Lt instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(Lt))!==-1)&&typeof FileReader<"u"?new N.Promise(function(kt,jt){var Mt=new FileReader;Mt.onload=function(Wt){kt(Wt.target.result)},Mt.onerror=function(Wt){jt(Wt.target.error)},Mt.readAsArrayBuffer(Lt)}):Lt}).then(function(Lt){var kt=S.getTypeOf(Lt);return kt?(kt==="arraybuffer"?Lt=S.transformTo("uint8array",Lt):kt==="string"&&(dt?Lt=b.decode(Lt):at&&ut!==!0&&(Lt=(function(jt){return G(jt,P.uint8array?new Uint8Array(jt.length):new Array(jt.length))})(Lt))),Lt):N.Promise.reject(new Error("Can't read the data of '"+J+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(T,E,S){var P=T("./reader/readerFor"),b=T("./utils"),o=T("./signature"),N=T("./zipEntry"),$=T("./support");function G(V){this.files=[],this.loadOptions=V}G.prototype={checkSignature:function(V){if(!this.reader.readAndCheckSignature(V)){this.reader.index-=4;var K=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+b.pretty(K)+", expected "+b.pretty(V)+")")}},isSignature:function(V,K){var q=this.reader.index;this.reader.setIndex(V);var Y=this.reader.readString(4)===K;return this.reader.setIndex(q),Y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var V=this.reader.readData(this.zipCommentLength),K=$.uint8array?"uint8array":"array",q=b.transformTo(K,V);this.zipComment=this.loadOptions.decodeFileName(q)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var V,K,q,Y=this.zip64EndOfCentralSize-44;0<Y;)V=this.reader.readInt(2),K=this.reader.readInt(4),q=this.reader.readData(K),this.zip64ExtensibleData[V]={id:V,length:K,value:q}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var V,K;for(V=0;V<this.files.length;V++)K=this.files[V],this.reader.setIndex(K.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),K.readLocalPart(this.reader),K.handleUTF8(),K.processAttributes()},readCentralDir:function(){var V;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(V=new N({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(V);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var V=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(V<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(V);var K=V;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===b.MAX_VALUE_16BITS||this.diskWithCentralDirStart===b.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===b.MAX_VALUE_16BITS||this.centralDirRecords===b.MAX_VALUE_16BITS||this.centralDirSize===b.MAX_VALUE_32BITS||this.centralDirOffset===b.MAX_VALUE_32BITS){if(this.zip64=!0,(V=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(V),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var q=this.centralDirOffset+this.centralDirSize;this.zip64&&(q+=20,q+=12+this.zip64EndOfCentralSize);var Y=K-q;if(0<Y)this.isSignature(K,o.CENTRAL_FILE_HEADER)||(this.reader.zero=Y);else if(Y<0)throw new Error("Corrupted zip: missing "+Math.abs(Y)+" bytes.")},prepareReader:function(V){this.reader=P(V)},load:function(V){this.prepareReader(V),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},E.exports=G},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(T,E,S){var P=T("./reader/readerFor"),b=T("./utils"),o=T("./compressedObject"),N=T("./crc32"),$=T("./utf8"),G=T("./compressions"),V=T("./support");function K(q,Y){this.options=q,this.loadOptions=Y}K.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(q){var Y,J;if(q.skip(22),this.fileNameLength=q.readInt(2),J=q.readInt(2),this.fileName=q.readData(this.fileNameLength),q.skip(J),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((Y=(function(W){for(var at in G)if(Object.prototype.hasOwnProperty.call(G,at)&&G[at].magic===W)return G[at];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+b.pretty(this.compressionMethod)+" unknown (inner file : "+b.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,Y,q.readData(this.compressedSize))},readCentralPart:function(q){this.versionMadeBy=q.readInt(2),q.skip(2),this.bitFlag=q.readInt(2),this.compressionMethod=q.readString(2),this.date=q.readDate(),this.crc32=q.readInt(4),this.compressedSize=q.readInt(4),this.uncompressedSize=q.readInt(4);var Y=q.readInt(2);if(this.extraFieldsLength=q.readInt(2),this.fileCommentLength=q.readInt(2),this.diskNumberStart=q.readInt(2),this.internalFileAttributes=q.readInt(2),this.externalFileAttributes=q.readInt(4),this.localHeaderOffset=q.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");q.skip(Y),this.readExtraFields(q),this.parseZIP64ExtraField(q),this.fileComment=q.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var q=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),q==0&&(this.dosPermissions=63&this.externalFileAttributes),q==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var q=P(this.extraFields[1].value);this.uncompressedSize===b.MAX_VALUE_32BITS&&(this.uncompressedSize=q.readInt(8)),this.compressedSize===b.MAX_VALUE_32BITS&&(this.compressedSize=q.readInt(8)),this.localHeaderOffset===b.MAX_VALUE_32BITS&&(this.localHeaderOffset=q.readInt(8)),this.diskNumberStart===b.MAX_VALUE_32BITS&&(this.diskNumberStart=q.readInt(4))}},readExtraFields:function(q){var Y,J,W,at=q.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});q.index+4<at;)Y=q.readInt(2),J=q.readInt(2),W=q.readData(J),this.extraFields[Y]={id:Y,length:J,value:W};q.setIndex(at)},handleUTF8:function(){var q=V.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=$.utf8decode(this.fileName),this.fileCommentStr=$.utf8decode(this.fileComment);else{var Y=this.findExtraFieldUnicodePath();if(Y!==null)this.fileNameStr=Y;else{var J=b.transformTo(q,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(J)}var W=this.findExtraFieldUnicodeComment();if(W!==null)this.fileCommentStr=W;else{var at=b.transformTo(q,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(at)}}},findExtraFieldUnicodePath:function(){var q=this.extraFields[28789];if(q){var Y=P(q.value);return Y.readInt(1)!==1||N(this.fileName)!==Y.readInt(4)?null:$.utf8decode(Y.readData(q.length-5))}return null},findExtraFieldUnicodeComment:function(){var q=this.extraFields[25461];if(q){var Y=P(q.value);return Y.readInt(1)!==1||N(this.fileComment)!==Y.readInt(4)?null:$.utf8decode(Y.readData(q.length-5))}return null}},E.exports=K},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(T,E,S){function P(Y,J,W){this.name=Y,this.dir=W.dir,this.date=W.date,this.comment=W.comment,this.unixPermissions=W.unixPermissions,this.dosPermissions=W.dosPermissions,this._data=J,this._dataBinary=W.binary,this.options={compression:W.compression,compressionOptions:W.compressionOptions}}var b=T("./stream/StreamHelper"),o=T("./stream/DataWorker"),N=T("./utf8"),$=T("./compressedObject"),G=T("./stream/GenericWorker");P.prototype={internalStream:function(Y){var J=null,W="string";try{if(!Y)throw new Error("No output type specified.");var at=(W=Y.toLowerCase())==="string"||W==="text";W!=="binarystring"&&W!=="text"||(W="string"),J=this._decompressWorker();var ut=!this._dataBinary;ut&&!at&&(J=J.pipe(new N.Utf8EncodeWorker)),!ut&&at&&(J=J.pipe(new N.Utf8DecodeWorker))}catch(dt){(J=new G("error")).error(dt)}return new b(J,W,"")},async:function(Y,J){return this.internalStream(Y).accumulate(J)},nodeStream:function(Y,J){return this.internalStream(Y||"nodebuffer").toNodejsStream(J)},_compressWorker:function(Y,J){if(this._data instanceof $&&this._data.compression.magic===Y.magic)return this._data.getCompressedWorker();var W=this._decompressWorker();return this._dataBinary||(W=W.pipe(new N.Utf8EncodeWorker)),$.createWorkerFrom(W,Y,J)},_decompressWorker:function(){return this._data instanceof $?this._data.getContentWorker():this._data instanceof G?this._data:new o(this._data)}};for(var V=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],K=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},q=0;q<V.length;q++)P.prototype[V[q]]=K;E.exports=P},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(T,E,S){(function(P){var b,o,N=P.MutationObserver||P.WebKitMutationObserver;if(N){var $=0,G=new N(Y),V=P.document.createTextNode("");G.observe(V,{characterData:!0}),b=function(){V.data=$=++$%2}}else if(P.setImmediate||P.MessageChannel===void 0)b="document"in P&&"onreadystatechange"in P.document.createElement("script")?function(){var J=P.document.createElement("script");J.onreadystatechange=function(){Y(),J.onreadystatechange=null,J.parentNode.removeChild(J),J=null},P.document.documentElement.appendChild(J)}:function(){setTimeout(Y,0)};else{var K=new P.MessageChannel;K.port1.onmessage=Y,b=function(){K.port2.postMessage(0)}}var q=[];function Y(){var J,W;o=!0;for(var at=q.length;at;){for(W=q,q=[],J=-1;++J<at;)W[J]();at=q.length}o=!1}E.exports=function(J){q.push(J)!==1||o||b()}}).call(this,typeof xh<"u"?xh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(T,E,S){var P=T("immediate");function b(){}var o={},N=["REJECTED"],$=["FULFILLED"],G=["PENDING"];function V(at){if(typeof at!="function")throw new TypeError("resolver must be a function");this.state=G,this.queue=[],this.outcome=void 0,at!==b&&J(this,at)}function K(at,ut,dt){this.promise=at,typeof ut=="function"&&(this.onFulfilled=ut,this.callFulfilled=this.otherCallFulfilled),typeof dt=="function"&&(this.onRejected=dt,this.callRejected=this.otherCallRejected)}function q(at,ut,dt){P(function(){var Lt;try{Lt=ut(dt)}catch(kt){return o.reject(at,kt)}Lt===at?o.reject(at,new TypeError("Cannot resolve promise with itself")):o.resolve(at,Lt)})}function Y(at){var ut=at&&at.then;if(at&&(typeof at=="object"||typeof at=="function")&&typeof ut=="function")return function(){ut.apply(at,arguments)}}function J(at,ut){var dt=!1;function Lt(Mt){dt||(dt=!0,o.reject(at,Mt))}function kt(Mt){dt||(dt=!0,o.resolve(at,Mt))}var jt=W(function(){ut(kt,Lt)});jt.status==="error"&&Lt(jt.value)}function W(at,ut){var dt={};try{dt.value=at(ut),dt.status="success"}catch(Lt){dt.status="error",dt.value=Lt}return dt}(E.exports=V).prototype.finally=function(at){if(typeof at!="function")return this;var ut=this.constructor;return this.then(function(dt){return ut.resolve(at()).then(function(){return dt})},function(dt){return ut.resolve(at()).then(function(){throw dt})})},V.prototype.catch=function(at){return this.then(null,at)},V.prototype.then=function(at,ut){if(typeof at!="function"&&this.state===$||typeof ut!="function"&&this.state===N)return this;var dt=new this.constructor(b);return this.state!==G?q(dt,this.state===$?at:ut,this.outcome):this.queue.push(new K(dt,at,ut)),dt},K.prototype.callFulfilled=function(at){o.resolve(this.promise,at)},K.prototype.otherCallFulfilled=function(at){q(this.promise,this.onFulfilled,at)},K.prototype.callRejected=function(at){o.reject(this.promise,at)},K.prototype.otherCallRejected=function(at){q(this.promise,this.onRejected,at)},o.resolve=function(at,ut){var dt=W(Y,ut);if(dt.status==="error")return o.reject(at,dt.value);var Lt=dt.value;if(Lt)J(at,Lt);else{at.state=$,at.outcome=ut;for(var kt=-1,jt=at.queue.length;++kt<jt;)at.queue[kt].callFulfilled(ut)}return at},o.reject=function(at,ut){at.state=N,at.outcome=ut;for(var dt=-1,Lt=at.queue.length;++dt<Lt;)at.queue[dt].callRejected(ut);return at},V.resolve=function(at){return at instanceof this?at:o.resolve(new this(b),at)},V.reject=function(at){var ut=new this(b);return o.reject(ut,at)},V.all=function(at){var ut=this;if(Object.prototype.toString.call(at)!=="[object Array]")return this.reject(new TypeError("must be an array"));var dt=at.length,Lt=!1;if(!dt)return this.resolve([]);for(var kt=new Array(dt),jt=0,Mt=-1,Wt=new this(b);++Mt<dt;)Ot(at[Mt],Mt);return Wt;function Ot(Kt,ge){ut.resolve(Kt).then(function(Et){kt[ge]=Et,++jt!==dt||Lt||(Lt=!0,o.resolve(Wt,kt))},function(Et){Lt||(Lt=!0,o.reject(Wt,Et))})}},V.race=function(at){var ut=this;if(Object.prototype.toString.call(at)!=="[object Array]")return this.reject(new TypeError("must be an array"));var dt=at.length,Lt=!1;if(!dt)return this.resolve([]);for(var kt=-1,jt=new this(b);++kt<dt;)Mt=at[kt],ut.resolve(Mt).then(function(Wt){Lt||(Lt=!0,o.resolve(jt,Wt))},function(Wt){Lt||(Lt=!0,o.reject(jt,Wt))});var Mt;return jt}},{immediate:36}],38:[function(T,E,S){var P={};(0,T("./lib/utils/common").assign)(P,T("./lib/deflate"),T("./lib/inflate"),T("./lib/zlib/constants")),E.exports=P},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(T,E,S){var P=T("./zlib/deflate"),b=T("./utils/common"),o=T("./utils/strings"),N=T("./zlib/messages"),$=T("./zlib/zstream"),G=Object.prototype.toString,V=0,K=-1,q=0,Y=8;function J(at){if(!(this instanceof J))return new J(at);this.options=b.assign({level:K,method:Y,chunkSize:16384,windowBits:15,memLevel:8,strategy:q,to:""},at||{});var ut=this.options;ut.raw&&0<ut.windowBits?ut.windowBits=-ut.windowBits:ut.gzip&&0<ut.windowBits&&ut.windowBits<16&&(ut.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $,this.strm.avail_out=0;var dt=P.deflateInit2(this.strm,ut.level,ut.method,ut.windowBits,ut.memLevel,ut.strategy);if(dt!==V)throw new Error(N[dt]);if(ut.header&&P.deflateSetHeader(this.strm,ut.header),ut.dictionary){var Lt;if(Lt=typeof ut.dictionary=="string"?o.string2buf(ut.dictionary):G.call(ut.dictionary)==="[object ArrayBuffer]"?new Uint8Array(ut.dictionary):ut.dictionary,(dt=P.deflateSetDictionary(this.strm,Lt))!==V)throw new Error(N[dt]);this._dict_set=!0}}function W(at,ut){var dt=new J(ut);if(dt.push(at,!0),dt.err)throw dt.msg||N[dt.err];return dt.result}J.prototype.push=function(at,ut){var dt,Lt,kt=this.strm,jt=this.options.chunkSize;if(this.ended)return!1;Lt=ut===~~ut?ut:ut===!0?4:0,typeof at=="string"?kt.input=o.string2buf(at):G.call(at)==="[object ArrayBuffer]"?kt.input=new Uint8Array(at):kt.input=at,kt.next_in=0,kt.avail_in=kt.input.length;do{if(kt.avail_out===0&&(kt.output=new b.Buf8(jt),kt.next_out=0,kt.avail_out=jt),(dt=P.deflate(kt,Lt))!==1&&dt!==V)return this.onEnd(dt),!(this.ended=!0);kt.avail_out!==0&&(kt.avail_in!==0||Lt!==4&&Lt!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(b.shrinkBuf(kt.output,kt.next_out))):this.onData(b.shrinkBuf(kt.output,kt.next_out)))}while((0<kt.avail_in||kt.avail_out===0)&&dt!==1);return Lt===4?(dt=P.deflateEnd(this.strm),this.onEnd(dt),this.ended=!0,dt===V):Lt!==2||(this.onEnd(V),!(kt.avail_out=0))},J.prototype.onData=function(at){this.chunks.push(at)},J.prototype.onEnd=function(at){at===V&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=at,this.msg=this.strm.msg},S.Deflate=J,S.deflate=W,S.deflateRaw=function(at,ut){return(ut=ut||{}).raw=!0,W(at,ut)},S.gzip=function(at,ut){return(ut=ut||{}).gzip=!0,W(at,ut)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(T,E,S){var P=T("./zlib/inflate"),b=T("./utils/common"),o=T("./utils/strings"),N=T("./zlib/constants"),$=T("./zlib/messages"),G=T("./zlib/zstream"),V=T("./zlib/gzheader"),K=Object.prototype.toString;function q(J){if(!(this instanceof q))return new q(J);this.options=b.assign({chunkSize:16384,windowBits:0,to:""},J||{});var W=this.options;W.raw&&0<=W.windowBits&&W.windowBits<16&&(W.windowBits=-W.windowBits,W.windowBits===0&&(W.windowBits=-15)),!(0<=W.windowBits&&W.windowBits<16)||J&&J.windowBits||(W.windowBits+=32),15<W.windowBits&&W.windowBits<48&&(15&W.windowBits)==0&&(W.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new G,this.strm.avail_out=0;var at=P.inflateInit2(this.strm,W.windowBits);if(at!==N.Z_OK)throw new Error($[at]);this.header=new V,P.inflateGetHeader(this.strm,this.header)}function Y(J,W){var at=new q(W);if(at.push(J,!0),at.err)throw at.msg||$[at.err];return at.result}q.prototype.push=function(J,W){var at,ut,dt,Lt,kt,jt,Mt=this.strm,Wt=this.options.chunkSize,Ot=this.options.dictionary,Kt=!1;if(this.ended)return!1;ut=W===~~W?W:W===!0?N.Z_FINISH:N.Z_NO_FLUSH,typeof J=="string"?Mt.input=o.binstring2buf(J):K.call(J)==="[object ArrayBuffer]"?Mt.input=new Uint8Array(J):Mt.input=J,Mt.next_in=0,Mt.avail_in=Mt.input.length;do{if(Mt.avail_out===0&&(Mt.output=new b.Buf8(Wt),Mt.next_out=0,Mt.avail_out=Wt),(at=P.inflate(Mt,N.Z_NO_FLUSH))===N.Z_NEED_DICT&&Ot&&(jt=typeof Ot=="string"?o.string2buf(Ot):K.call(Ot)==="[object ArrayBuffer]"?new Uint8Array(Ot):Ot,at=P.inflateSetDictionary(this.strm,jt)),at===N.Z_BUF_ERROR&&Kt===!0&&(at=N.Z_OK,Kt=!1),at!==N.Z_STREAM_END&&at!==N.Z_OK)return this.onEnd(at),!(this.ended=!0);Mt.next_out&&(Mt.avail_out!==0&&at!==N.Z_STREAM_END&&(Mt.avail_in!==0||ut!==N.Z_FINISH&&ut!==N.Z_SYNC_FLUSH)||(this.options.to==="string"?(dt=o.utf8border(Mt.output,Mt.next_out),Lt=Mt.next_out-dt,kt=o.buf2string(Mt.output,dt),Mt.next_out=Lt,Mt.avail_out=Wt-Lt,Lt&&b.arraySet(Mt.output,Mt.output,dt,Lt,0),this.onData(kt)):this.onData(b.shrinkBuf(Mt.output,Mt.next_out)))),Mt.avail_in===0&&Mt.avail_out===0&&(Kt=!0)}while((0<Mt.avail_in||Mt.avail_out===0)&&at!==N.Z_STREAM_END);return at===N.Z_STREAM_END&&(ut=N.Z_FINISH),ut===N.Z_FINISH?(at=P.inflateEnd(this.strm),this.onEnd(at),this.ended=!0,at===N.Z_OK):ut!==N.Z_SYNC_FLUSH||(this.onEnd(N.Z_OK),!(Mt.avail_out=0))},q.prototype.onData=function(J){this.chunks.push(J)},q.prototype.onEnd=function(J){J===N.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=J,this.msg=this.strm.msg},S.Inflate=q,S.inflate=Y,S.inflateRaw=function(J,W){return(W=W||{}).raw=!0,Y(J,W)},S.ungzip=Y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(T,E,S){var P=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";S.assign=function(N){for(var $=Array.prototype.slice.call(arguments,1);$.length;){var G=$.shift();if(G){if(typeof G!="object")throw new TypeError(G+"must be non-object");for(var V in G)G.hasOwnProperty(V)&&(N[V]=G[V])}}return N},S.shrinkBuf=function(N,$){return N.length===$?N:N.subarray?N.subarray(0,$):(N.length=$,N)};var b={arraySet:function(N,$,G,V,K){if($.subarray&&N.subarray)N.set($.subarray(G,G+V),K);else for(var q=0;q<V;q++)N[K+q]=$[G+q]},flattenChunks:function(N){var $,G,V,K,q,Y;for($=V=0,G=N.length;$<G;$++)V+=N[$].length;for(Y=new Uint8Array(V),$=K=0,G=N.length;$<G;$++)q=N[$],Y.set(q,K),K+=q.length;return Y}},o={arraySet:function(N,$,G,V,K){for(var q=0;q<V;q++)N[K+q]=$[G+q]},flattenChunks:function(N){return[].concat.apply([],N)}};S.setTyped=function(N){N?(S.Buf8=Uint8Array,S.Buf16=Uint16Array,S.Buf32=Int32Array,S.assign(S,b)):(S.Buf8=Array,S.Buf16=Array,S.Buf32=Array,S.assign(S,o))},S.setTyped(P)},{}],42:[function(T,E,S){var P=T("./common"),b=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{b=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var N=new P.Buf8(256),$=0;$<256;$++)N[$]=252<=$?6:248<=$?5:240<=$?4:224<=$?3:192<=$?2:1;function G(V,K){if(K<65537&&(V.subarray&&o||!V.subarray&&b))return String.fromCharCode.apply(null,P.shrinkBuf(V,K));for(var q="",Y=0;Y<K;Y++)q+=String.fromCharCode(V[Y]);return q}N[254]=N[254]=1,S.string2buf=function(V){var K,q,Y,J,W,at=V.length,ut=0;for(J=0;J<at;J++)(64512&(q=V.charCodeAt(J)))==55296&&J+1<at&&(64512&(Y=V.charCodeAt(J+1)))==56320&&(q=65536+(q-55296<<10)+(Y-56320),J++),ut+=q<128?1:q<2048?2:q<65536?3:4;for(K=new P.Buf8(ut),J=W=0;W<ut;J++)(64512&(q=V.charCodeAt(J)))==55296&&J+1<at&&(64512&(Y=V.charCodeAt(J+1)))==56320&&(q=65536+(q-55296<<10)+(Y-56320),J++),q<128?K[W++]=q:(q<2048?K[W++]=192|q>>>6:(q<65536?K[W++]=224|q>>>12:(K[W++]=240|q>>>18,K[W++]=128|q>>>12&63),K[W++]=128|q>>>6&63),K[W++]=128|63&q);return K},S.buf2binstring=function(V){return G(V,V.length)},S.binstring2buf=function(V){for(var K=new P.Buf8(V.length),q=0,Y=K.length;q<Y;q++)K[q]=V.charCodeAt(q);return K},S.buf2string=function(V,K){var q,Y,J,W,at=K||V.length,ut=new Array(2*at);for(q=Y=0;q<at;)if((J=V[q++])<128)ut[Y++]=J;else if(4<(W=N[J]))ut[Y++]=65533,q+=W-1;else{for(J&=W===2?31:W===3?15:7;1<W&&q<at;)J=J<<6|63&V[q++],W--;1<W?ut[Y++]=65533:J<65536?ut[Y++]=J:(J-=65536,ut[Y++]=55296|J>>10&1023,ut[Y++]=56320|1023&J)}return G(ut,Y)},S.utf8border=function(V,K){var q;for((K=K||V.length)>V.length&&(K=V.length),q=K-1;0<=q&&(192&V[q])==128;)q--;return q<0||q===0?K:q+N[V[q]]>K?q:K}},{"./common":41}],43:[function(T,E,S){E.exports=function(P,b,o,N){for(var $=65535&P|0,G=P>>>16&65535|0,V=0;o!==0;){for(o-=V=2e3<o?2e3:o;G=G+($=$+b[N++]|0)|0,--V;);$%=65521,G%=65521}return $|G<<16|0}},{}],44:[function(T,E,S){E.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(T,E,S){var P=(function(){for(var b,o=[],N=0;N<256;N++){b=N;for(var $=0;$<8;$++)b=1&b?3988292384^b>>>1:b>>>1;o[N]=b}return o})();E.exports=function(b,o,N,$){var G=P,V=$+N;b^=-1;for(var K=$;K<V;K++)b=b>>>8^G[255&(b^o[K])];return-1^b}},{}],46:[function(T,E,S){var P,b=T("../utils/common"),o=T("./trees"),N=T("./adler32"),$=T("./crc32"),G=T("./messages"),V=0,K=4,q=0,Y=-2,J=-1,W=4,at=2,ut=8,dt=9,Lt=286,kt=30,jt=19,Mt=2*Lt+1,Wt=15,Ot=3,Kt=258,ge=Kt+Ot+1,Et=42,Ht=113,tt=1,Jt=2,ze=3,te=4;function Ne(et,fe){return et.msg=G[fe],fe}function he(et){return(et<<1)-(4<et?9:0)}function _e(et){for(var fe=et.length;0<=--fe;)et[fe]=0}function Zt(et){var fe=et.state,de=fe.pending;de>et.avail_out&&(de=et.avail_out),de!==0&&(b.arraySet(et.output,fe.pending_buf,fe.pending_out,de,et.next_out),et.next_out+=de,fe.pending_out+=de,et.total_out+=de,et.avail_out-=de,fe.pending-=de,fe.pending===0&&(fe.pending_out=0))}function Xt(et,fe){o._tr_flush_block(et,0<=et.block_start?et.block_start:-1,et.strstart-et.block_start,fe),et.block_start=et.strstart,Zt(et.strm)}function Ge(et,fe){et.pending_buf[et.pending++]=fe}function ye(et,fe){et.pending_buf[et.pending++]=fe>>>8&255,et.pending_buf[et.pending++]=255&fe}function Pe(et,fe){var de,Pt,bt=et.max_chain_length,Tt=et.strstart,Te=et.prev_length,Ee=et.nice_match,Qt=et.strstart>et.w_size-ge?et.strstart-(et.w_size-ge):0,Re=et.window,be=et.w_mask,Ce=et.prev,Je=et.strstart+Kt,kn=Re[Tt+Te-1],Oe=Re[Tt+Te];et.prev_length>=et.good_match&&(bt>>=2),Ee>et.lookahead&&(Ee=et.lookahead);do if(Re[(de=fe)+Te]===Oe&&Re[de+Te-1]===kn&&Re[de]===Re[Tt]&&Re[++de]===Re[Tt+1]){Tt+=2,de++;do;while(Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Re[++Tt]===Re[++de]&&Tt<Je);if(Pt=Kt-(Je-Tt),Tt=Je-Kt,Te<Pt){if(et.match_start=fe,Ee<=(Te=Pt))break;kn=Re[Tt+Te-1],Oe=Re[Tt+Te]}}while((fe=Ce[fe&be])>Qt&&--bt!=0);return Te<=et.lookahead?Te:et.lookahead}function _n(et){var fe,de,Pt,bt,Tt,Te,Ee,Qt,Re,be,Ce=et.w_size;do{if(bt=et.window_size-et.lookahead-et.strstart,et.strstart>=Ce+(Ce-ge)){for(b.arraySet(et.window,et.window,Ce,Ce,0),et.match_start-=Ce,et.strstart-=Ce,et.block_start-=Ce,fe=de=et.hash_size;Pt=et.head[--fe],et.head[fe]=Ce<=Pt?Pt-Ce:0,--de;);for(fe=de=Ce;Pt=et.prev[--fe],et.prev[fe]=Ce<=Pt?Pt-Ce:0,--de;);bt+=Ce}if(et.strm.avail_in===0)break;if(Te=et.strm,Ee=et.window,Qt=et.strstart+et.lookahead,Re=bt,be=void 0,be=Te.avail_in,Re<be&&(be=Re),de=be===0?0:(Te.avail_in-=be,b.arraySet(Ee,Te.input,Te.next_in,be,Qt),Te.state.wrap===1?Te.adler=N(Te.adler,Ee,be,Qt):Te.state.wrap===2&&(Te.adler=$(Te.adler,Ee,be,Qt)),Te.next_in+=be,Te.total_in+=be,be),et.lookahead+=de,et.lookahead+et.insert>=Ot)for(Tt=et.strstart-et.insert,et.ins_h=et.window[Tt],et.ins_h=(et.ins_h<<et.hash_shift^et.window[Tt+1])&et.hash_mask;et.insert&&(et.ins_h=(et.ins_h<<et.hash_shift^et.window[Tt+Ot-1])&et.hash_mask,et.prev[Tt&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=Tt,Tt++,et.insert--,!(et.lookahead+et.insert<Ot)););}while(et.lookahead<ge&&et.strm.avail_in!==0)}function Pn(et,fe){for(var de,Pt;;){if(et.lookahead<ge){if(_n(et),et.lookahead<ge&&fe===V)return tt;if(et.lookahead===0)break}if(de=0,et.lookahead>=Ot&&(et.ins_h=(et.ins_h<<et.hash_shift^et.window[et.strstart+Ot-1])&et.hash_mask,de=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart),de!==0&&et.strstart-de<=et.w_size-ge&&(et.match_length=Pe(et,de)),et.match_length>=Ot)if(Pt=o._tr_tally(et,et.strstart-et.match_start,et.match_length-Ot),et.lookahead-=et.match_length,et.match_length<=et.max_lazy_match&&et.lookahead>=Ot){for(et.match_length--;et.strstart++,et.ins_h=(et.ins_h<<et.hash_shift^et.window[et.strstart+Ot-1])&et.hash_mask,de=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart,--et.match_length!=0;);et.strstart++}else et.strstart+=et.match_length,et.match_length=0,et.ins_h=et.window[et.strstart],et.ins_h=(et.ins_h<<et.hash_shift^et.window[et.strstart+1])&et.hash_mask;else Pt=o._tr_tally(et,0,et.window[et.strstart]),et.lookahead--,et.strstart++;if(Pt&&(Xt(et,!1),et.strm.avail_out===0))return tt}return et.insert=et.strstart<Ot-1?et.strstart:Ot-1,fe===K?(Xt(et,!0),et.strm.avail_out===0?ze:te):et.last_lit&&(Xt(et,!1),et.strm.avail_out===0)?tt:Jt}function Gt(et,fe){for(var de,Pt,bt;;){if(et.lookahead<ge){if(_n(et),et.lookahead<ge&&fe===V)return tt;if(et.lookahead===0)break}if(de=0,et.lookahead>=Ot&&(et.ins_h=(et.ins_h<<et.hash_shift^et.window[et.strstart+Ot-1])&et.hash_mask,de=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart),et.prev_length=et.match_length,et.prev_match=et.match_start,et.match_length=Ot-1,de!==0&&et.prev_length<et.max_lazy_match&&et.strstart-de<=et.w_size-ge&&(et.match_length=Pe(et,de),et.match_length<=5&&(et.strategy===1||et.match_length===Ot&&4096<et.strstart-et.match_start)&&(et.match_length=Ot-1)),et.prev_length>=Ot&&et.match_length<=et.prev_length){for(bt=et.strstart+et.lookahead-Ot,Pt=o._tr_tally(et,et.strstart-1-et.prev_match,et.prev_length-Ot),et.lookahead-=et.prev_length-1,et.prev_length-=2;++et.strstart<=bt&&(et.ins_h=(et.ins_h<<et.hash_shift^et.window[et.strstart+Ot-1])&et.hash_mask,de=et.prev[et.strstart&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=et.strstart),--et.prev_length!=0;);if(et.match_available=0,et.match_length=Ot-1,et.strstart++,Pt&&(Xt(et,!1),et.strm.avail_out===0))return tt}else if(et.match_available){if((Pt=o._tr_tally(et,0,et.window[et.strstart-1]))&&Xt(et,!1),et.strstart++,et.lookahead--,et.strm.avail_out===0)return tt}else et.match_available=1,et.strstart++,et.lookahead--}return et.match_available&&(Pt=o._tr_tally(et,0,et.window[et.strstart-1]),et.match_available=0),et.insert=et.strstart<Ot-1?et.strstart:Ot-1,fe===K?(Xt(et,!0),et.strm.avail_out===0?ze:te):et.last_lit&&(Xt(et,!1),et.strm.avail_out===0)?tt:Jt}function bn(et,fe,de,Pt,bt){this.good_length=et,this.max_lazy=fe,this.nice_length=de,this.max_chain=Pt,this.func=bt}function sn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ut,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new b.Buf16(2*Mt),this.dyn_dtree=new b.Buf16(2*(2*kt+1)),this.bl_tree=new b.Buf16(2*(2*jt+1)),_e(this.dyn_ltree),_e(this.dyn_dtree),_e(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new b.Buf16(Wt+1),this.heap=new b.Buf16(2*Lt+1),_e(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new b.Buf16(2*Lt+1),_e(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Be(et){var fe;return et&&et.state?(et.total_in=et.total_out=0,et.data_type=at,(fe=et.state).pending=0,fe.pending_out=0,fe.wrap<0&&(fe.wrap=-fe.wrap),fe.status=fe.wrap?Et:Ht,et.adler=fe.wrap===2?0:1,fe.last_flush=V,o._tr_init(fe),q):Ne(et,Y)}function Dt(et){var fe=Be(et);return fe===q&&(function(de){de.window_size=2*de.w_size,_e(de.head),de.max_lazy_match=P[de.level].max_lazy,de.good_match=P[de.level].good_length,de.nice_match=P[de.level].nice_length,de.max_chain_length=P[de.level].max_chain,de.strstart=0,de.block_start=0,de.lookahead=0,de.insert=0,de.match_length=de.prev_length=Ot-1,de.match_available=0,de.ins_h=0})(et.state),fe}function $n(et,fe,de,Pt,bt,Tt){if(!et)return Y;var Te=1;if(fe===J&&(fe=6),Pt<0?(Te=0,Pt=-Pt):15<Pt&&(Te=2,Pt-=16),bt<1||dt<bt||de!==ut||Pt<8||15<Pt||fe<0||9<fe||Tt<0||W<Tt)return Ne(et,Y);Pt===8&&(Pt=9);var Ee=new sn;return(et.state=Ee).strm=et,Ee.wrap=Te,Ee.gzhead=null,Ee.w_bits=Pt,Ee.w_size=1<<Ee.w_bits,Ee.w_mask=Ee.w_size-1,Ee.hash_bits=bt+7,Ee.hash_size=1<<Ee.hash_bits,Ee.hash_mask=Ee.hash_size-1,Ee.hash_shift=~~((Ee.hash_bits+Ot-1)/Ot),Ee.window=new b.Buf8(2*Ee.w_size),Ee.head=new b.Buf16(Ee.hash_size),Ee.prev=new b.Buf16(Ee.w_size),Ee.lit_bufsize=1<<bt+6,Ee.pending_buf_size=4*Ee.lit_bufsize,Ee.pending_buf=new b.Buf8(Ee.pending_buf_size),Ee.d_buf=1*Ee.lit_bufsize,Ee.l_buf=3*Ee.lit_bufsize,Ee.level=fe,Ee.strategy=Tt,Ee.method=de,Dt(et)}P=[new bn(0,0,0,0,function(et,fe){var de=65535;for(de>et.pending_buf_size-5&&(de=et.pending_buf_size-5);;){if(et.lookahead<=1){if(_n(et),et.lookahead===0&&fe===V)return tt;if(et.lookahead===0)break}et.strstart+=et.lookahead,et.lookahead=0;var Pt=et.block_start+de;if((et.strstart===0||et.strstart>=Pt)&&(et.lookahead=et.strstart-Pt,et.strstart=Pt,Xt(et,!1),et.strm.avail_out===0)||et.strstart-et.block_start>=et.w_size-ge&&(Xt(et,!1),et.strm.avail_out===0))return tt}return et.insert=0,fe===K?(Xt(et,!0),et.strm.avail_out===0?ze:te):(et.strstart>et.block_start&&(Xt(et,!1),et.strm.avail_out),tt)}),new bn(4,4,8,4,Pn),new bn(4,5,16,8,Pn),new bn(4,6,32,32,Pn),new bn(4,4,16,16,Gt),new bn(8,16,32,32,Gt),new bn(8,16,128,128,Gt),new bn(8,32,128,256,Gt),new bn(32,128,258,1024,Gt),new bn(32,258,258,4096,Gt)],S.deflateInit=function(et,fe){return $n(et,fe,ut,15,8,0)},S.deflateInit2=$n,S.deflateReset=Dt,S.deflateResetKeep=Be,S.deflateSetHeader=function(et,fe){return et&&et.state?et.state.wrap!==2?Y:(et.state.gzhead=fe,q):Y},S.deflate=function(et,fe){var de,Pt,bt,Tt;if(!et||!et.state||5<fe||fe<0)return et?Ne(et,Y):Y;if(Pt=et.state,!et.output||!et.input&&et.avail_in!==0||Pt.status===666&&fe!==K)return Ne(et,et.avail_out===0?-5:Y);if(Pt.strm=et,de=Pt.last_flush,Pt.last_flush=fe,Pt.status===Et)if(Pt.wrap===2)et.adler=0,Ge(Pt,31),Ge(Pt,139),Ge(Pt,8),Pt.gzhead?(Ge(Pt,(Pt.gzhead.text?1:0)+(Pt.gzhead.hcrc?2:0)+(Pt.gzhead.extra?4:0)+(Pt.gzhead.name?8:0)+(Pt.gzhead.comment?16:0)),Ge(Pt,255&Pt.gzhead.time),Ge(Pt,Pt.gzhead.time>>8&255),Ge(Pt,Pt.gzhead.time>>16&255),Ge(Pt,Pt.gzhead.time>>24&255),Ge(Pt,Pt.level===9?2:2<=Pt.strategy||Pt.level<2?4:0),Ge(Pt,255&Pt.gzhead.os),Pt.gzhead.extra&&Pt.gzhead.extra.length&&(Ge(Pt,255&Pt.gzhead.extra.length),Ge(Pt,Pt.gzhead.extra.length>>8&255)),Pt.gzhead.hcrc&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending,0)),Pt.gzindex=0,Pt.status=69):(Ge(Pt,0),Ge(Pt,0),Ge(Pt,0),Ge(Pt,0),Ge(Pt,0),Ge(Pt,Pt.level===9?2:2<=Pt.strategy||Pt.level<2?4:0),Ge(Pt,3),Pt.status=Ht);else{var Te=ut+(Pt.w_bits-8<<4)<<8;Te|=(2<=Pt.strategy||Pt.level<2?0:Pt.level<6?1:Pt.level===6?2:3)<<6,Pt.strstart!==0&&(Te|=32),Te+=31-Te%31,Pt.status=Ht,ye(Pt,Te),Pt.strstart!==0&&(ye(Pt,et.adler>>>16),ye(Pt,65535&et.adler)),et.adler=1}if(Pt.status===69)if(Pt.gzhead.extra){for(bt=Pt.pending;Pt.gzindex<(65535&Pt.gzhead.extra.length)&&(Pt.pending!==Pt.pending_buf_size||(Pt.gzhead.hcrc&&Pt.pending>bt&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending-bt,bt)),Zt(et),bt=Pt.pending,Pt.pending!==Pt.pending_buf_size));)Ge(Pt,255&Pt.gzhead.extra[Pt.gzindex]),Pt.gzindex++;Pt.gzhead.hcrc&&Pt.pending>bt&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending-bt,bt)),Pt.gzindex===Pt.gzhead.extra.length&&(Pt.gzindex=0,Pt.status=73)}else Pt.status=73;if(Pt.status===73)if(Pt.gzhead.name){bt=Pt.pending;do{if(Pt.pending===Pt.pending_buf_size&&(Pt.gzhead.hcrc&&Pt.pending>bt&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending-bt,bt)),Zt(et),bt=Pt.pending,Pt.pending===Pt.pending_buf_size)){Tt=1;break}Tt=Pt.gzindex<Pt.gzhead.name.length?255&Pt.gzhead.name.charCodeAt(Pt.gzindex++):0,Ge(Pt,Tt)}while(Tt!==0);Pt.gzhead.hcrc&&Pt.pending>bt&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending-bt,bt)),Tt===0&&(Pt.gzindex=0,Pt.status=91)}else Pt.status=91;if(Pt.status===91)if(Pt.gzhead.comment){bt=Pt.pending;do{if(Pt.pending===Pt.pending_buf_size&&(Pt.gzhead.hcrc&&Pt.pending>bt&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending-bt,bt)),Zt(et),bt=Pt.pending,Pt.pending===Pt.pending_buf_size)){Tt=1;break}Tt=Pt.gzindex<Pt.gzhead.comment.length?255&Pt.gzhead.comment.charCodeAt(Pt.gzindex++):0,Ge(Pt,Tt)}while(Tt!==0);Pt.gzhead.hcrc&&Pt.pending>bt&&(et.adler=$(et.adler,Pt.pending_buf,Pt.pending-bt,bt)),Tt===0&&(Pt.status=103)}else Pt.status=103;if(Pt.status===103&&(Pt.gzhead.hcrc?(Pt.pending+2>Pt.pending_buf_size&&Zt(et),Pt.pending+2<=Pt.pending_buf_size&&(Ge(Pt,255&et.adler),Ge(Pt,et.adler>>8&255),et.adler=0,Pt.status=Ht)):Pt.status=Ht),Pt.pending!==0){if(Zt(et),et.avail_out===0)return Pt.last_flush=-1,q}else if(et.avail_in===0&&he(fe)<=he(de)&&fe!==K)return Ne(et,-5);if(Pt.status===666&&et.avail_in!==0)return Ne(et,-5);if(et.avail_in!==0||Pt.lookahead!==0||fe!==V&&Pt.status!==666){var Ee=Pt.strategy===2?(function(Qt,Re){for(var be;;){if(Qt.lookahead===0&&(_n(Qt),Qt.lookahead===0)){if(Re===V)return tt;break}if(Qt.match_length=0,be=o._tr_tally(Qt,0,Qt.window[Qt.strstart]),Qt.lookahead--,Qt.strstart++,be&&(Xt(Qt,!1),Qt.strm.avail_out===0))return tt}return Qt.insert=0,Re===K?(Xt(Qt,!0),Qt.strm.avail_out===0?ze:te):Qt.last_lit&&(Xt(Qt,!1),Qt.strm.avail_out===0)?tt:Jt})(Pt,fe):Pt.strategy===3?(function(Qt,Re){for(var be,Ce,Je,kn,Oe=Qt.window;;){if(Qt.lookahead<=Kt){if(_n(Qt),Qt.lookahead<=Kt&&Re===V)return tt;if(Qt.lookahead===0)break}if(Qt.match_length=0,Qt.lookahead>=Ot&&0<Qt.strstart&&(Ce=Oe[Je=Qt.strstart-1])===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]){kn=Qt.strstart+Kt;do;while(Ce===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]&&Ce===Oe[++Je]&&Je<kn);Qt.match_length=Kt-(kn-Je),Qt.match_length>Qt.lookahead&&(Qt.match_length=Qt.lookahead)}if(Qt.match_length>=Ot?(be=o._tr_tally(Qt,1,Qt.match_length-Ot),Qt.lookahead-=Qt.match_length,Qt.strstart+=Qt.match_length,Qt.match_length=0):(be=o._tr_tally(Qt,0,Qt.window[Qt.strstart]),Qt.lookahead--,Qt.strstart++),be&&(Xt(Qt,!1),Qt.strm.avail_out===0))return tt}return Qt.insert=0,Re===K?(Xt(Qt,!0),Qt.strm.avail_out===0?ze:te):Qt.last_lit&&(Xt(Qt,!1),Qt.strm.avail_out===0)?tt:Jt})(Pt,fe):P[Pt.level].func(Pt,fe);if(Ee!==ze&&Ee!==te||(Pt.status=666),Ee===tt||Ee===ze)return et.avail_out===0&&(Pt.last_flush=-1),q;if(Ee===Jt&&(fe===1?o._tr_align(Pt):fe!==5&&(o._tr_stored_block(Pt,0,0,!1),fe===3&&(_e(Pt.head),Pt.lookahead===0&&(Pt.strstart=0,Pt.block_start=0,Pt.insert=0))),Zt(et),et.avail_out===0))return Pt.last_flush=-1,q}return fe!==K?q:Pt.wrap<=0?1:(Pt.wrap===2?(Ge(Pt,255&et.adler),Ge(Pt,et.adler>>8&255),Ge(Pt,et.adler>>16&255),Ge(Pt,et.adler>>24&255),Ge(Pt,255&et.total_in),Ge(Pt,et.total_in>>8&255),Ge(Pt,et.total_in>>16&255),Ge(Pt,et.total_in>>24&255)):(ye(Pt,et.adler>>>16),ye(Pt,65535&et.adler)),Zt(et),0<Pt.wrap&&(Pt.wrap=-Pt.wrap),Pt.pending!==0?q:1)},S.deflateEnd=function(et){var fe;return et&&et.state?(fe=et.state.status)!==Et&&fe!==69&&fe!==73&&fe!==91&&fe!==103&&fe!==Ht&&fe!==666?Ne(et,Y):(et.state=null,fe===Ht?Ne(et,-3):q):Y},S.deflateSetDictionary=function(et,fe){var de,Pt,bt,Tt,Te,Ee,Qt,Re,be=fe.length;if(!et||!et.state||(Tt=(de=et.state).wrap)===2||Tt===1&&de.status!==Et||de.lookahead)return Y;for(Tt===1&&(et.adler=N(et.adler,fe,be,0)),de.wrap=0,be>=de.w_size&&(Tt===0&&(_e(de.head),de.strstart=0,de.block_start=0,de.insert=0),Re=new b.Buf8(de.w_size),b.arraySet(Re,fe,be-de.w_size,de.w_size,0),fe=Re,be=de.w_size),Te=et.avail_in,Ee=et.next_in,Qt=et.input,et.avail_in=be,et.next_in=0,et.input=fe,_n(de);de.lookahead>=Ot;){for(Pt=de.strstart,bt=de.lookahead-(Ot-1);de.ins_h=(de.ins_h<<de.hash_shift^de.window[Pt+Ot-1])&de.hash_mask,de.prev[Pt&de.w_mask]=de.head[de.ins_h],de.head[de.ins_h]=Pt,Pt++,--bt;);de.strstart=Pt,de.lookahead=Ot-1,_n(de)}return de.strstart+=de.lookahead,de.block_start=de.strstart,de.insert=de.lookahead,de.lookahead=0,de.match_length=de.prev_length=Ot-1,de.match_available=0,et.next_in=Ee,et.input=Qt,et.avail_in=Te,de.wrap=Tt,q},S.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(T,E,S){E.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(T,E,S){E.exports=function(P,b){var o,N,$,G,V,K,q,Y,J,W,at,ut,dt,Lt,kt,jt,Mt,Wt,Ot,Kt,ge,Et,Ht,tt,Jt;o=P.state,N=P.next_in,tt=P.input,$=N+(P.avail_in-5),G=P.next_out,Jt=P.output,V=G-(b-P.avail_out),K=G+(P.avail_out-257),q=o.dmax,Y=o.wsize,J=o.whave,W=o.wnext,at=o.window,ut=o.hold,dt=o.bits,Lt=o.lencode,kt=o.distcode,jt=(1<<o.lenbits)-1,Mt=(1<<o.distbits)-1;t:do{dt<15&&(ut+=tt[N++]<<dt,dt+=8,ut+=tt[N++]<<dt,dt+=8),Wt=Lt[ut&jt];e:for(;;){if(ut>>>=Ot=Wt>>>24,dt-=Ot,(Ot=Wt>>>16&255)===0)Jt[G++]=65535&Wt;else{if(!(16&Ot)){if((64&Ot)==0){Wt=Lt[(65535&Wt)+(ut&(1<<Ot)-1)];continue e}if(32&Ot){o.mode=12;break t}P.msg="invalid literal/length code",o.mode=30;break t}Kt=65535&Wt,(Ot&=15)&&(dt<Ot&&(ut+=tt[N++]<<dt,dt+=8),Kt+=ut&(1<<Ot)-1,ut>>>=Ot,dt-=Ot),dt<15&&(ut+=tt[N++]<<dt,dt+=8,ut+=tt[N++]<<dt,dt+=8),Wt=kt[ut&Mt];n:for(;;){if(ut>>>=Ot=Wt>>>24,dt-=Ot,!(16&(Ot=Wt>>>16&255))){if((64&Ot)==0){Wt=kt[(65535&Wt)+(ut&(1<<Ot)-1)];continue n}P.msg="invalid distance code",o.mode=30;break t}if(ge=65535&Wt,dt<(Ot&=15)&&(ut+=tt[N++]<<dt,(dt+=8)<Ot&&(ut+=tt[N++]<<dt,dt+=8)),q<(ge+=ut&(1<<Ot)-1)){P.msg="invalid distance too far back",o.mode=30;break t}if(ut>>>=Ot,dt-=Ot,(Ot=G-V)<ge){if(J<(Ot=ge-Ot)&&o.sane){P.msg="invalid distance too far back",o.mode=30;break t}if(Ht=at,(Et=0)===W){if(Et+=Y-Ot,Ot<Kt){for(Kt-=Ot;Jt[G++]=at[Et++],--Ot;);Et=G-ge,Ht=Jt}}else if(W<Ot){if(Et+=Y+W-Ot,(Ot-=W)<Kt){for(Kt-=Ot;Jt[G++]=at[Et++],--Ot;);if(Et=0,W<Kt){for(Kt-=Ot=W;Jt[G++]=at[Et++],--Ot;);Et=G-ge,Ht=Jt}}}else if(Et+=W-Ot,Ot<Kt){for(Kt-=Ot;Jt[G++]=at[Et++],--Ot;);Et=G-ge,Ht=Jt}for(;2<Kt;)Jt[G++]=Ht[Et++],Jt[G++]=Ht[Et++],Jt[G++]=Ht[Et++],Kt-=3;Kt&&(Jt[G++]=Ht[Et++],1<Kt&&(Jt[G++]=Ht[Et++]))}else{for(Et=G-ge;Jt[G++]=Jt[Et++],Jt[G++]=Jt[Et++],Jt[G++]=Jt[Et++],2<(Kt-=3););Kt&&(Jt[G++]=Jt[Et++],1<Kt&&(Jt[G++]=Jt[Et++]))}break}}break}}while(N<$&&G<K);N-=Kt=dt>>3,ut&=(1<<(dt-=Kt<<3))-1,P.next_in=N,P.next_out=G,P.avail_in=N<$?$-N+5:5-(N-$),P.avail_out=G<K?K-G+257:257-(G-K),o.hold=ut,o.bits=dt}},{}],49:[function(T,E,S){var P=T("../utils/common"),b=T("./adler32"),o=T("./crc32"),N=T("./inffast"),$=T("./inftrees"),G=1,V=2,K=0,q=-2,Y=1,J=852,W=592;function at(Et){return(Et>>>24&255)+(Et>>>8&65280)+((65280&Et)<<8)+((255&Et)<<24)}function ut(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new P.Buf16(320),this.work=new P.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function dt(Et){var Ht;return Et&&Et.state?(Ht=Et.state,Et.total_in=Et.total_out=Ht.total=0,Et.msg="",Ht.wrap&&(Et.adler=1&Ht.wrap),Ht.mode=Y,Ht.last=0,Ht.havedict=0,Ht.dmax=32768,Ht.head=null,Ht.hold=0,Ht.bits=0,Ht.lencode=Ht.lendyn=new P.Buf32(J),Ht.distcode=Ht.distdyn=new P.Buf32(W),Ht.sane=1,Ht.back=-1,K):q}function Lt(Et){var Ht;return Et&&Et.state?((Ht=Et.state).wsize=0,Ht.whave=0,Ht.wnext=0,dt(Et)):q}function kt(Et,Ht){var tt,Jt;return Et&&Et.state?(Jt=Et.state,Ht<0?(tt=0,Ht=-Ht):(tt=1+(Ht>>4),Ht<48&&(Ht&=15)),Ht&&(Ht<8||15<Ht)?q:(Jt.window!==null&&Jt.wbits!==Ht&&(Jt.window=null),Jt.wrap=tt,Jt.wbits=Ht,Lt(Et))):q}function jt(Et,Ht){var tt,Jt;return Et?(Jt=new ut,(Et.state=Jt).window=null,(tt=kt(Et,Ht))!==K&&(Et.state=null),tt):q}var Mt,Wt,Ot=!0;function Kt(Et){if(Ot){var Ht;for(Mt=new P.Buf32(512),Wt=new P.Buf32(32),Ht=0;Ht<144;)Et.lens[Ht++]=8;for(;Ht<256;)Et.lens[Ht++]=9;for(;Ht<280;)Et.lens[Ht++]=7;for(;Ht<288;)Et.lens[Ht++]=8;for($(G,Et.lens,0,288,Mt,0,Et.work,{bits:9}),Ht=0;Ht<32;)Et.lens[Ht++]=5;$(V,Et.lens,0,32,Wt,0,Et.work,{bits:5}),Ot=!1}Et.lencode=Mt,Et.lenbits=9,Et.distcode=Wt,Et.distbits=5}function ge(Et,Ht,tt,Jt){var ze,te=Et.state;return te.window===null&&(te.wsize=1<<te.wbits,te.wnext=0,te.whave=0,te.window=new P.Buf8(te.wsize)),Jt>=te.wsize?(P.arraySet(te.window,Ht,tt-te.wsize,te.wsize,0),te.wnext=0,te.whave=te.wsize):(Jt<(ze=te.wsize-te.wnext)&&(ze=Jt),P.arraySet(te.window,Ht,tt-Jt,ze,te.wnext),(Jt-=ze)?(P.arraySet(te.window,Ht,tt-Jt,Jt,0),te.wnext=Jt,te.whave=te.wsize):(te.wnext+=ze,te.wnext===te.wsize&&(te.wnext=0),te.whave<te.wsize&&(te.whave+=ze))),0}S.inflateReset=Lt,S.inflateReset2=kt,S.inflateResetKeep=dt,S.inflateInit=function(Et){return jt(Et,15)},S.inflateInit2=jt,S.inflate=function(Et,Ht){var tt,Jt,ze,te,Ne,he,_e,Zt,Xt,Ge,ye,Pe,_n,Pn,Gt,bn,sn,Be,Dt,$n,et,fe,de,Pt,bt=0,Tt=new P.Buf8(4),Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Et||!Et.state||!Et.output||!Et.input&&Et.avail_in!==0)return q;(tt=Et.state).mode===12&&(tt.mode=13),Ne=Et.next_out,ze=Et.output,_e=Et.avail_out,te=Et.next_in,Jt=Et.input,he=Et.avail_in,Zt=tt.hold,Xt=tt.bits,Ge=he,ye=_e,fe=K;t:for(;;)switch(tt.mode){case Y:if(tt.wrap===0){tt.mode=13;break}for(;Xt<16;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(2&tt.wrap&&Zt===35615){Tt[tt.check=0]=255&Zt,Tt[1]=Zt>>>8&255,tt.check=o(tt.check,Tt,2,0),Xt=Zt=0,tt.mode=2;break}if(tt.flags=0,tt.head&&(tt.head.done=!1),!(1&tt.wrap)||(((255&Zt)<<8)+(Zt>>8))%31){Et.msg="incorrect header check",tt.mode=30;break}if((15&Zt)!=8){Et.msg="unknown compression method",tt.mode=30;break}if(Xt-=4,et=8+(15&(Zt>>>=4)),tt.wbits===0)tt.wbits=et;else if(et>tt.wbits){Et.msg="invalid window size",tt.mode=30;break}tt.dmax=1<<et,Et.adler=tt.check=1,tt.mode=512&Zt?10:12,Xt=Zt=0;break;case 2:for(;Xt<16;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(tt.flags=Zt,(255&tt.flags)!=8){Et.msg="unknown compression method",tt.mode=30;break}if(57344&tt.flags){Et.msg="unknown header flags set",tt.mode=30;break}tt.head&&(tt.head.text=Zt>>8&1),512&tt.flags&&(Tt[0]=255&Zt,Tt[1]=Zt>>>8&255,tt.check=o(tt.check,Tt,2,0)),Xt=Zt=0,tt.mode=3;case 3:for(;Xt<32;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}tt.head&&(tt.head.time=Zt),512&tt.flags&&(Tt[0]=255&Zt,Tt[1]=Zt>>>8&255,Tt[2]=Zt>>>16&255,Tt[3]=Zt>>>24&255,tt.check=o(tt.check,Tt,4,0)),Xt=Zt=0,tt.mode=4;case 4:for(;Xt<16;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}tt.head&&(tt.head.xflags=255&Zt,tt.head.os=Zt>>8),512&tt.flags&&(Tt[0]=255&Zt,Tt[1]=Zt>>>8&255,tt.check=o(tt.check,Tt,2,0)),Xt=Zt=0,tt.mode=5;case 5:if(1024&tt.flags){for(;Xt<16;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}tt.length=Zt,tt.head&&(tt.head.extra_len=Zt),512&tt.flags&&(Tt[0]=255&Zt,Tt[1]=Zt>>>8&255,tt.check=o(tt.check,Tt,2,0)),Xt=Zt=0}else tt.head&&(tt.head.extra=null);tt.mode=6;case 6:if(1024&tt.flags&&(he<(Pe=tt.length)&&(Pe=he),Pe&&(tt.head&&(et=tt.head.extra_len-tt.length,tt.head.extra||(tt.head.extra=new Array(tt.head.extra_len)),P.arraySet(tt.head.extra,Jt,te,Pe,et)),512&tt.flags&&(tt.check=o(tt.check,Jt,Pe,te)),he-=Pe,te+=Pe,tt.length-=Pe),tt.length))break t;tt.length=0,tt.mode=7;case 7:if(2048&tt.flags){if(he===0)break t;for(Pe=0;et=Jt[te+Pe++],tt.head&&et&&tt.length<65536&&(tt.head.name+=String.fromCharCode(et)),et&&Pe<he;);if(512&tt.flags&&(tt.check=o(tt.check,Jt,Pe,te)),he-=Pe,te+=Pe,et)break t}else tt.head&&(tt.head.name=null);tt.length=0,tt.mode=8;case 8:if(4096&tt.flags){if(he===0)break t;for(Pe=0;et=Jt[te+Pe++],tt.head&&et&&tt.length<65536&&(tt.head.comment+=String.fromCharCode(et)),et&&Pe<he;);if(512&tt.flags&&(tt.check=o(tt.check,Jt,Pe,te)),he-=Pe,te+=Pe,et)break t}else tt.head&&(tt.head.comment=null);tt.mode=9;case 9:if(512&tt.flags){for(;Xt<16;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(Zt!==(65535&tt.check)){Et.msg="header crc mismatch",tt.mode=30;break}Xt=Zt=0}tt.head&&(tt.head.hcrc=tt.flags>>9&1,tt.head.done=!0),Et.adler=tt.check=0,tt.mode=12;break;case 10:for(;Xt<32;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}Et.adler=tt.check=at(Zt),Xt=Zt=0,tt.mode=11;case 11:if(tt.havedict===0)return Et.next_out=Ne,Et.avail_out=_e,Et.next_in=te,Et.avail_in=he,tt.hold=Zt,tt.bits=Xt,2;Et.adler=tt.check=1,tt.mode=12;case 12:if(Ht===5||Ht===6)break t;case 13:if(tt.last){Zt>>>=7&Xt,Xt-=7&Xt,tt.mode=27;break}for(;Xt<3;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}switch(tt.last=1&Zt,Xt-=1,3&(Zt>>>=1)){case 0:tt.mode=14;break;case 1:if(Kt(tt),tt.mode=20,Ht!==6)break;Zt>>>=2,Xt-=2;break t;case 2:tt.mode=17;break;case 3:Et.msg="invalid block type",tt.mode=30}Zt>>>=2,Xt-=2;break;case 14:for(Zt>>>=7&Xt,Xt-=7&Xt;Xt<32;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if((65535&Zt)!=(Zt>>>16^65535)){Et.msg="invalid stored block lengths",tt.mode=30;break}if(tt.length=65535&Zt,Xt=Zt=0,tt.mode=15,Ht===6)break t;case 15:tt.mode=16;case 16:if(Pe=tt.length){if(he<Pe&&(Pe=he),_e<Pe&&(Pe=_e),Pe===0)break t;P.arraySet(ze,Jt,te,Pe,Ne),he-=Pe,te+=Pe,_e-=Pe,Ne+=Pe,tt.length-=Pe;break}tt.mode=12;break;case 17:for(;Xt<14;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(tt.nlen=257+(31&Zt),Zt>>>=5,Xt-=5,tt.ndist=1+(31&Zt),Zt>>>=5,Xt-=5,tt.ncode=4+(15&Zt),Zt>>>=4,Xt-=4,286<tt.nlen||30<tt.ndist){Et.msg="too many length or distance symbols",tt.mode=30;break}tt.have=0,tt.mode=18;case 18:for(;tt.have<tt.ncode;){for(;Xt<3;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}tt.lens[Te[tt.have++]]=7&Zt,Zt>>>=3,Xt-=3}for(;tt.have<19;)tt.lens[Te[tt.have++]]=0;if(tt.lencode=tt.lendyn,tt.lenbits=7,de={bits:tt.lenbits},fe=$(0,tt.lens,0,19,tt.lencode,0,tt.work,de),tt.lenbits=de.bits,fe){Et.msg="invalid code lengths set",tt.mode=30;break}tt.have=0,tt.mode=19;case 19:for(;tt.have<tt.nlen+tt.ndist;){for(;bn=(bt=tt.lencode[Zt&(1<<tt.lenbits)-1])>>>16&255,sn=65535&bt,!((Gt=bt>>>24)<=Xt);){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(sn<16)Zt>>>=Gt,Xt-=Gt,tt.lens[tt.have++]=sn;else{if(sn===16){for(Pt=Gt+2;Xt<Pt;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(Zt>>>=Gt,Xt-=Gt,tt.have===0){Et.msg="invalid bit length repeat",tt.mode=30;break}et=tt.lens[tt.have-1],Pe=3+(3&Zt),Zt>>>=2,Xt-=2}else if(sn===17){for(Pt=Gt+3;Xt<Pt;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}Xt-=Gt,et=0,Pe=3+(7&(Zt>>>=Gt)),Zt>>>=3,Xt-=3}else{for(Pt=Gt+7;Xt<Pt;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}Xt-=Gt,et=0,Pe=11+(127&(Zt>>>=Gt)),Zt>>>=7,Xt-=7}if(tt.have+Pe>tt.nlen+tt.ndist){Et.msg="invalid bit length repeat",tt.mode=30;break}for(;Pe--;)tt.lens[tt.have++]=et}}if(tt.mode===30)break;if(tt.lens[256]===0){Et.msg="invalid code -- missing end-of-block",tt.mode=30;break}if(tt.lenbits=9,de={bits:tt.lenbits},fe=$(G,tt.lens,0,tt.nlen,tt.lencode,0,tt.work,de),tt.lenbits=de.bits,fe){Et.msg="invalid literal/lengths set",tt.mode=30;break}if(tt.distbits=6,tt.distcode=tt.distdyn,de={bits:tt.distbits},fe=$(V,tt.lens,tt.nlen,tt.ndist,tt.distcode,0,tt.work,de),tt.distbits=de.bits,fe){Et.msg="invalid distances set",tt.mode=30;break}if(tt.mode=20,Ht===6)break t;case 20:tt.mode=21;case 21:if(6<=he&&258<=_e){Et.next_out=Ne,Et.avail_out=_e,Et.next_in=te,Et.avail_in=he,tt.hold=Zt,tt.bits=Xt,N(Et,ye),Ne=Et.next_out,ze=Et.output,_e=Et.avail_out,te=Et.next_in,Jt=Et.input,he=Et.avail_in,Zt=tt.hold,Xt=tt.bits,tt.mode===12&&(tt.back=-1);break}for(tt.back=0;bn=(bt=tt.lencode[Zt&(1<<tt.lenbits)-1])>>>16&255,sn=65535&bt,!((Gt=bt>>>24)<=Xt);){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(bn&&(240&bn)==0){for(Be=Gt,Dt=bn,$n=sn;bn=(bt=tt.lencode[$n+((Zt&(1<<Be+Dt)-1)>>Be)])>>>16&255,sn=65535&bt,!(Be+(Gt=bt>>>24)<=Xt);){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}Zt>>>=Be,Xt-=Be,tt.back+=Be}if(Zt>>>=Gt,Xt-=Gt,tt.back+=Gt,tt.length=sn,bn===0){tt.mode=26;break}if(32&bn){tt.back=-1,tt.mode=12;break}if(64&bn){Et.msg="invalid literal/length code",tt.mode=30;break}tt.extra=15&bn,tt.mode=22;case 22:if(tt.extra){for(Pt=tt.extra;Xt<Pt;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}tt.length+=Zt&(1<<tt.extra)-1,Zt>>>=tt.extra,Xt-=tt.extra,tt.back+=tt.extra}tt.was=tt.length,tt.mode=23;case 23:for(;bn=(bt=tt.distcode[Zt&(1<<tt.distbits)-1])>>>16&255,sn=65535&bt,!((Gt=bt>>>24)<=Xt);){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if((240&bn)==0){for(Be=Gt,Dt=bn,$n=sn;bn=(bt=tt.distcode[$n+((Zt&(1<<Be+Dt)-1)>>Be)])>>>16&255,sn=65535&bt,!(Be+(Gt=bt>>>24)<=Xt);){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}Zt>>>=Be,Xt-=Be,tt.back+=Be}if(Zt>>>=Gt,Xt-=Gt,tt.back+=Gt,64&bn){Et.msg="invalid distance code",tt.mode=30;break}tt.offset=sn,tt.extra=15&bn,tt.mode=24;case 24:if(tt.extra){for(Pt=tt.extra;Xt<Pt;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}tt.offset+=Zt&(1<<tt.extra)-1,Zt>>>=tt.extra,Xt-=tt.extra,tt.back+=tt.extra}if(tt.offset>tt.dmax){Et.msg="invalid distance too far back",tt.mode=30;break}tt.mode=25;case 25:if(_e===0)break t;if(Pe=ye-_e,tt.offset>Pe){if((Pe=tt.offset-Pe)>tt.whave&&tt.sane){Et.msg="invalid distance too far back",tt.mode=30;break}_n=Pe>tt.wnext?(Pe-=tt.wnext,tt.wsize-Pe):tt.wnext-Pe,Pe>tt.length&&(Pe=tt.length),Pn=tt.window}else Pn=ze,_n=Ne-tt.offset,Pe=tt.length;for(_e<Pe&&(Pe=_e),_e-=Pe,tt.length-=Pe;ze[Ne++]=Pn[_n++],--Pe;);tt.length===0&&(tt.mode=21);break;case 26:if(_e===0)break t;ze[Ne++]=tt.length,_e--,tt.mode=21;break;case 27:if(tt.wrap){for(;Xt<32;){if(he===0)break t;he--,Zt|=Jt[te++]<<Xt,Xt+=8}if(ye-=_e,Et.total_out+=ye,tt.total+=ye,ye&&(Et.adler=tt.check=tt.flags?o(tt.check,ze,ye,Ne-ye):b(tt.check,ze,ye,Ne-ye)),ye=_e,(tt.flags?Zt:at(Zt))!==tt.check){Et.msg="incorrect data check",tt.mode=30;break}Xt=Zt=0}tt.mode=28;case 28:if(tt.wrap&&tt.flags){for(;Xt<32;){if(he===0)break t;he--,Zt+=Jt[te++]<<Xt,Xt+=8}if(Zt!==(4294967295&tt.total)){Et.msg="incorrect length check",tt.mode=30;break}Xt=Zt=0}tt.mode=29;case 29:fe=1;break t;case 30:fe=-3;break t;case 31:return-4;case 32:default:return q}return Et.next_out=Ne,Et.avail_out=_e,Et.next_in=te,Et.avail_in=he,tt.hold=Zt,tt.bits=Xt,(tt.wsize||ye!==Et.avail_out&&tt.mode<30&&(tt.mode<27||Ht!==4))&&ge(Et,Et.output,Et.next_out,ye-Et.avail_out)?(tt.mode=31,-4):(Ge-=Et.avail_in,ye-=Et.avail_out,Et.total_in+=Ge,Et.total_out+=ye,tt.total+=ye,tt.wrap&&ye&&(Et.adler=tt.check=tt.flags?o(tt.check,ze,ye,Et.next_out-ye):b(tt.check,ze,ye,Et.next_out-ye)),Et.data_type=tt.bits+(tt.last?64:0)+(tt.mode===12?128:0)+(tt.mode===20||tt.mode===15?256:0),(Ge==0&&ye===0||Ht===4)&&fe===K&&(fe=-5),fe)},S.inflateEnd=function(Et){if(!Et||!Et.state)return q;var Ht=Et.state;return Ht.window&&(Ht.window=null),Et.state=null,K},S.inflateGetHeader=function(Et,Ht){var tt;return Et&&Et.state?(2&(tt=Et.state).wrap)==0?q:((tt.head=Ht).done=!1,K):q},S.inflateSetDictionary=function(Et,Ht){var tt,Jt=Ht.length;return Et&&Et.state?(tt=Et.state).wrap!==0&&tt.mode!==11?q:tt.mode===11&&b(1,Ht,Jt,0)!==tt.check?-3:ge(Et,Ht,Jt,Jt)?(tt.mode=31,-4):(tt.havedict=1,K):q},S.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(T,E,S){var P=T("../utils/common"),b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],N=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],$=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];E.exports=function(G,V,K,q,Y,J,W,at){var ut,dt,Lt,kt,jt,Mt,Wt,Ot,Kt,ge=at.bits,Et=0,Ht=0,tt=0,Jt=0,ze=0,te=0,Ne=0,he=0,_e=0,Zt=0,Xt=null,Ge=0,ye=new P.Buf16(16),Pe=new P.Buf16(16),_n=null,Pn=0;for(Et=0;Et<=15;Et++)ye[Et]=0;for(Ht=0;Ht<q;Ht++)ye[V[K+Ht]]++;for(ze=ge,Jt=15;1<=Jt&&ye[Jt]===0;Jt--);if(Jt<ze&&(ze=Jt),Jt===0)return Y[J++]=20971520,Y[J++]=20971520,at.bits=1,0;for(tt=1;tt<Jt&&ye[tt]===0;tt++);for(ze<tt&&(ze=tt),Et=he=1;Et<=15;Et++)if(he<<=1,(he-=ye[Et])<0)return-1;if(0<he&&(G===0||Jt!==1))return-1;for(Pe[1]=0,Et=1;Et<15;Et++)Pe[Et+1]=Pe[Et]+ye[Et];for(Ht=0;Ht<q;Ht++)V[K+Ht]!==0&&(W[Pe[V[K+Ht]]++]=Ht);if(Mt=G===0?(Xt=_n=W,19):G===1?(Xt=b,Ge-=257,_n=o,Pn-=257,256):(Xt=N,_n=$,-1),Et=tt,jt=J,Ne=Ht=Zt=0,Lt=-1,kt=(_e=1<<(te=ze))-1,G===1&&852<_e||G===2&&592<_e)return 1;for(;;){for(Wt=Et-Ne,Kt=W[Ht]<Mt?(Ot=0,W[Ht]):W[Ht]>Mt?(Ot=_n[Pn+W[Ht]],Xt[Ge+W[Ht]]):(Ot=96,0),ut=1<<Et-Ne,tt=dt=1<<te;Y[jt+(Zt>>Ne)+(dt-=ut)]=Wt<<24|Ot<<16|Kt|0,dt!==0;);for(ut=1<<Et-1;Zt&ut;)ut>>=1;if(ut!==0?(Zt&=ut-1,Zt+=ut):Zt=0,Ht++,--ye[Et]==0){if(Et===Jt)break;Et=V[K+W[Ht]]}if(ze<Et&&(Zt&kt)!==Lt){for(Ne===0&&(Ne=ze),jt+=tt,he=1<<(te=Et-Ne);te+Ne<Jt&&!((he-=ye[te+Ne])<=0);)te++,he<<=1;if(_e+=1<<te,G===1&&852<_e||G===2&&592<_e)return 1;Y[Lt=Zt&kt]=ze<<24|te<<16|jt-J|0}}return Zt!==0&&(Y[jt+Zt]=Et-Ne<<24|64<<16|0),at.bits=ze,0}},{"../utils/common":41}],51:[function(T,E,S){E.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(T,E,S){var P=T("../utils/common"),b=0,o=1;function N(bt){for(var Tt=bt.length;0<=--Tt;)bt[Tt]=0}var $=0,G=29,V=256,K=V+1+G,q=30,Y=19,J=2*K+1,W=15,at=16,ut=7,dt=256,Lt=16,kt=17,jt=18,Mt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Wt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Kt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ge=new Array(2*(K+2));N(ge);var Et=new Array(2*q);N(Et);var Ht=new Array(512);N(Ht);var tt=new Array(256);N(tt);var Jt=new Array(G);N(Jt);var ze,te,Ne,he=new Array(q);function _e(bt,Tt,Te,Ee,Qt){this.static_tree=bt,this.extra_bits=Tt,this.extra_base=Te,this.elems=Ee,this.max_length=Qt,this.has_stree=bt&&bt.length}function Zt(bt,Tt){this.dyn_tree=bt,this.max_code=0,this.stat_desc=Tt}function Xt(bt){return bt<256?Ht[bt]:Ht[256+(bt>>>7)]}function Ge(bt,Tt){bt.pending_buf[bt.pending++]=255&Tt,bt.pending_buf[bt.pending++]=Tt>>>8&255}function ye(bt,Tt,Te){bt.bi_valid>at-Te?(bt.bi_buf|=Tt<<bt.bi_valid&65535,Ge(bt,bt.bi_buf),bt.bi_buf=Tt>>at-bt.bi_valid,bt.bi_valid+=Te-at):(bt.bi_buf|=Tt<<bt.bi_valid&65535,bt.bi_valid+=Te)}function Pe(bt,Tt,Te){ye(bt,Te[2*Tt],Te[2*Tt+1])}function _n(bt,Tt){for(var Te=0;Te|=1&bt,bt>>>=1,Te<<=1,0<--Tt;);return Te>>>1}function Pn(bt,Tt,Te){var Ee,Qt,Re=new Array(W+1),be=0;for(Ee=1;Ee<=W;Ee++)Re[Ee]=be=be+Te[Ee-1]<<1;for(Qt=0;Qt<=Tt;Qt++){var Ce=bt[2*Qt+1];Ce!==0&&(bt[2*Qt]=_n(Re[Ce]++,Ce))}}function Gt(bt){var Tt;for(Tt=0;Tt<K;Tt++)bt.dyn_ltree[2*Tt]=0;for(Tt=0;Tt<q;Tt++)bt.dyn_dtree[2*Tt]=0;for(Tt=0;Tt<Y;Tt++)bt.bl_tree[2*Tt]=0;bt.dyn_ltree[2*dt]=1,bt.opt_len=bt.static_len=0,bt.last_lit=bt.matches=0}function bn(bt){8<bt.bi_valid?Ge(bt,bt.bi_buf):0<bt.bi_valid&&(bt.pending_buf[bt.pending++]=bt.bi_buf),bt.bi_buf=0,bt.bi_valid=0}function sn(bt,Tt,Te,Ee){var Qt=2*Tt,Re=2*Te;return bt[Qt]<bt[Re]||bt[Qt]===bt[Re]&&Ee[Tt]<=Ee[Te]}function Be(bt,Tt,Te){for(var Ee=bt.heap[Te],Qt=Te<<1;Qt<=bt.heap_len&&(Qt<bt.heap_len&&sn(Tt,bt.heap[Qt+1],bt.heap[Qt],bt.depth)&&Qt++,!sn(Tt,Ee,bt.heap[Qt],bt.depth));)bt.heap[Te]=bt.heap[Qt],Te=Qt,Qt<<=1;bt.heap[Te]=Ee}function Dt(bt,Tt,Te){var Ee,Qt,Re,be,Ce=0;if(bt.last_lit!==0)for(;Ee=bt.pending_buf[bt.d_buf+2*Ce]<<8|bt.pending_buf[bt.d_buf+2*Ce+1],Qt=bt.pending_buf[bt.l_buf+Ce],Ce++,Ee===0?Pe(bt,Qt,Tt):(Pe(bt,(Re=tt[Qt])+V+1,Tt),(be=Mt[Re])!==0&&ye(bt,Qt-=Jt[Re],be),Pe(bt,Re=Xt(--Ee),Te),(be=Wt[Re])!==0&&ye(bt,Ee-=he[Re],be)),Ce<bt.last_lit;);Pe(bt,dt,Tt)}function $n(bt,Tt){var Te,Ee,Qt,Re=Tt.dyn_tree,be=Tt.stat_desc.static_tree,Ce=Tt.stat_desc.has_stree,Je=Tt.stat_desc.elems,kn=-1;for(bt.heap_len=0,bt.heap_max=J,Te=0;Te<Je;Te++)Re[2*Te]!==0?(bt.heap[++bt.heap_len]=kn=Te,bt.depth[Te]=0):Re[2*Te+1]=0;for(;bt.heap_len<2;)Re[2*(Qt=bt.heap[++bt.heap_len]=kn<2?++kn:0)]=1,bt.depth[Qt]=0,bt.opt_len--,Ce&&(bt.static_len-=be[2*Qt+1]);for(Tt.max_code=kn,Te=bt.heap_len>>1;1<=Te;Te--)Be(bt,Re,Te);for(Qt=Je;Te=bt.heap[1],bt.heap[1]=bt.heap[bt.heap_len--],Be(bt,Re,1),Ee=bt.heap[1],bt.heap[--bt.heap_max]=Te,bt.heap[--bt.heap_max]=Ee,Re[2*Qt]=Re[2*Te]+Re[2*Ee],bt.depth[Qt]=(bt.depth[Te]>=bt.depth[Ee]?bt.depth[Te]:bt.depth[Ee])+1,Re[2*Te+1]=Re[2*Ee+1]=Qt,bt.heap[1]=Qt++,Be(bt,Re,1),2<=bt.heap_len;);bt.heap[--bt.heap_max]=bt.heap[1],(function(Oe,li){var ln,Ye,ar,yn,Mi,wt,nt=li.dyn_tree,st=li.max_code,lt=li.stat_desc.static_tree,xt=li.stat_desc.has_stree,Rt=li.stat_desc.extra_bits,$t=li.stat_desc.extra_base,pt=li.stat_desc.max_length,Ut=0;for(yn=0;yn<=W;yn++)Oe.bl_count[yn]=0;for(nt[2*Oe.heap[Oe.heap_max]+1]=0,ln=Oe.heap_max+1;ln<J;ln++)pt<(yn=nt[2*nt[2*(Ye=Oe.heap[ln])+1]+1]+1)&&(yn=pt,Ut++),nt[2*Ye+1]=yn,st<Ye||(Oe.bl_count[yn]++,Mi=0,$t<=Ye&&(Mi=Rt[Ye-$t]),wt=nt[2*Ye],Oe.opt_len+=wt*(yn+Mi),xt&&(Oe.static_len+=wt*(lt[2*Ye+1]+Mi)));if(Ut!==0){do{for(yn=pt-1;Oe.bl_count[yn]===0;)yn--;Oe.bl_count[yn]--,Oe.bl_count[yn+1]+=2,Oe.bl_count[pt]--,Ut-=2}while(0<Ut);for(yn=pt;yn!==0;yn--)for(Ye=Oe.bl_count[yn];Ye!==0;)st<(ar=Oe.heap[--ln])||(nt[2*ar+1]!==yn&&(Oe.opt_len+=(yn-nt[2*ar+1])*nt[2*ar],nt[2*ar+1]=yn),Ye--)}})(bt,Tt),Pn(Re,kn,bt.bl_count)}function et(bt,Tt,Te){var Ee,Qt,Re=-1,be=Tt[1],Ce=0,Je=7,kn=4;for(be===0&&(Je=138,kn=3),Tt[2*(Te+1)+1]=65535,Ee=0;Ee<=Te;Ee++)Qt=be,be=Tt[2*(Ee+1)+1],++Ce<Je&&Qt===be||(Ce<kn?bt.bl_tree[2*Qt]+=Ce:Qt!==0?(Qt!==Re&&bt.bl_tree[2*Qt]++,bt.bl_tree[2*Lt]++):Ce<=10?bt.bl_tree[2*kt]++:bt.bl_tree[2*jt]++,Re=Qt,kn=(Ce=0)===be?(Je=138,3):Qt===be?(Je=6,3):(Je=7,4))}function fe(bt,Tt,Te){var Ee,Qt,Re=-1,be=Tt[1],Ce=0,Je=7,kn=4;for(be===0&&(Je=138,kn=3),Ee=0;Ee<=Te;Ee++)if(Qt=be,be=Tt[2*(Ee+1)+1],!(++Ce<Je&&Qt===be)){if(Ce<kn)for(;Pe(bt,Qt,bt.bl_tree),--Ce!=0;);else Qt!==0?(Qt!==Re&&(Pe(bt,Qt,bt.bl_tree),Ce--),Pe(bt,Lt,bt.bl_tree),ye(bt,Ce-3,2)):Ce<=10?(Pe(bt,kt,bt.bl_tree),ye(bt,Ce-3,3)):(Pe(bt,jt,bt.bl_tree),ye(bt,Ce-11,7));Re=Qt,kn=(Ce=0)===be?(Je=138,3):Qt===be?(Je=6,3):(Je=7,4)}}N(he);var de=!1;function Pt(bt,Tt,Te,Ee){ye(bt,($<<1)+(Ee?1:0),3),(function(Qt,Re,be,Ce){bn(Qt),Ge(Qt,be),Ge(Qt,~be),P.arraySet(Qt.pending_buf,Qt.window,Re,be,Qt.pending),Qt.pending+=be})(bt,Tt,Te)}S._tr_init=function(bt){de||((function(){var Tt,Te,Ee,Qt,Re,be=new Array(W+1);for(Qt=Ee=0;Qt<G-1;Qt++)for(Jt[Qt]=Ee,Tt=0;Tt<1<<Mt[Qt];Tt++)tt[Ee++]=Qt;for(tt[Ee-1]=Qt,Qt=Re=0;Qt<16;Qt++)for(he[Qt]=Re,Tt=0;Tt<1<<Wt[Qt];Tt++)Ht[Re++]=Qt;for(Re>>=7;Qt<q;Qt++)for(he[Qt]=Re<<7,Tt=0;Tt<1<<Wt[Qt]-7;Tt++)Ht[256+Re++]=Qt;for(Te=0;Te<=W;Te++)be[Te]=0;for(Tt=0;Tt<=143;)ge[2*Tt+1]=8,Tt++,be[8]++;for(;Tt<=255;)ge[2*Tt+1]=9,Tt++,be[9]++;for(;Tt<=279;)ge[2*Tt+1]=7,Tt++,be[7]++;for(;Tt<=287;)ge[2*Tt+1]=8,Tt++,be[8]++;for(Pn(ge,K+1,be),Tt=0;Tt<q;Tt++)Et[2*Tt+1]=5,Et[2*Tt]=_n(Tt,5);ze=new _e(ge,Mt,V+1,K,W),te=new _e(Et,Wt,0,q,W),Ne=new _e(new Array(0),Ot,0,Y,ut)})(),de=!0),bt.l_desc=new Zt(bt.dyn_ltree,ze),bt.d_desc=new Zt(bt.dyn_dtree,te),bt.bl_desc=new Zt(bt.bl_tree,Ne),bt.bi_buf=0,bt.bi_valid=0,Gt(bt)},S._tr_stored_block=Pt,S._tr_flush_block=function(bt,Tt,Te,Ee){var Qt,Re,be=0;0<bt.level?(bt.strm.data_type===2&&(bt.strm.data_type=(function(Ce){var Je,kn=4093624447;for(Je=0;Je<=31;Je++,kn>>>=1)if(1&kn&&Ce.dyn_ltree[2*Je]!==0)return b;if(Ce.dyn_ltree[18]!==0||Ce.dyn_ltree[20]!==0||Ce.dyn_ltree[26]!==0)return o;for(Je=32;Je<V;Je++)if(Ce.dyn_ltree[2*Je]!==0)return o;return b})(bt)),$n(bt,bt.l_desc),$n(bt,bt.d_desc),be=(function(Ce){var Je;for(et(Ce,Ce.dyn_ltree,Ce.l_desc.max_code),et(Ce,Ce.dyn_dtree,Ce.d_desc.max_code),$n(Ce,Ce.bl_desc),Je=Y-1;3<=Je&&Ce.bl_tree[2*Kt[Je]+1]===0;Je--);return Ce.opt_len+=3*(Je+1)+5+5+4,Je})(bt),Qt=bt.opt_len+3+7>>>3,(Re=bt.static_len+3+7>>>3)<=Qt&&(Qt=Re)):Qt=Re=Te+5,Te+4<=Qt&&Tt!==-1?Pt(bt,Tt,Te,Ee):bt.strategy===4||Re===Qt?(ye(bt,2+(Ee?1:0),3),Dt(bt,ge,Et)):(ye(bt,4+(Ee?1:0),3),(function(Ce,Je,kn,Oe){var li;for(ye(Ce,Je-257,5),ye(Ce,kn-1,5),ye(Ce,Oe-4,4),li=0;li<Oe;li++)ye(Ce,Ce.bl_tree[2*Kt[li]+1],3);fe(Ce,Ce.dyn_ltree,Je-1),fe(Ce,Ce.dyn_dtree,kn-1)})(bt,bt.l_desc.max_code+1,bt.d_desc.max_code+1,be+1),Dt(bt,bt.dyn_ltree,bt.dyn_dtree)),Gt(bt),Ee&&bn(bt)},S._tr_tally=function(bt,Tt,Te){return bt.pending_buf[bt.d_buf+2*bt.last_lit]=Tt>>>8&255,bt.pending_buf[bt.d_buf+2*bt.last_lit+1]=255&Tt,bt.pending_buf[bt.l_buf+bt.last_lit]=255&Te,bt.last_lit++,Tt===0?bt.dyn_ltree[2*Te]++:(bt.matches++,Tt--,bt.dyn_ltree[2*(tt[Te]+V+1)]++,bt.dyn_dtree[2*Xt(Tt)]++),bt.last_lit===bt.lit_bufsize-1},S._tr_align=function(bt){ye(bt,2,3),Pe(bt,dt,ge),(function(Tt){Tt.bi_valid===16?(Ge(Tt,Tt.bi_buf),Tt.bi_buf=0,Tt.bi_valid=0):8<=Tt.bi_valid&&(Tt.pending_buf[Tt.pending++]=255&Tt.bi_buf,Tt.bi_buf>>=8,Tt.bi_valid-=8)})(bt)}},{"../utils/common":41}],53:[function(T,E,S){E.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(T,E,S){(function(P){(function(b,o){if(!b.setImmediate){var N,$,G,V,K=1,q={},Y=!1,J=b.document,W=Object.getPrototypeOf&&Object.getPrototypeOf(b);W=W&&W.setTimeout?W:b,N={}.toString.call(b.process)==="[object process]"?function(Lt){process.nextTick(function(){ut(Lt)})}:(function(){if(b.postMessage&&!b.importScripts){var Lt=!0,kt=b.onmessage;return b.onmessage=function(){Lt=!1},b.postMessage("","*"),b.onmessage=kt,Lt}})()?(V="setImmediate$"+Math.random()+"$",b.addEventListener?b.addEventListener("message",dt,!1):b.attachEvent("onmessage",dt),function(Lt){b.postMessage(V+Lt,"*")}):b.MessageChannel?((G=new MessageChannel).port1.onmessage=function(Lt){ut(Lt.data)},function(Lt){G.port2.postMessage(Lt)}):J&&"onreadystatechange"in J.createElement("script")?($=J.documentElement,function(Lt){var kt=J.createElement("script");kt.onreadystatechange=function(){ut(Lt),kt.onreadystatechange=null,$.removeChild(kt),kt=null},$.appendChild(kt)}):function(Lt){setTimeout(ut,0,Lt)},W.setImmediate=function(Lt){typeof Lt!="function"&&(Lt=new Function(""+Lt));for(var kt=new Array(arguments.length-1),jt=0;jt<kt.length;jt++)kt[jt]=arguments[jt+1];var Mt={callback:Lt,args:kt};return q[K]=Mt,N(K),K++},W.clearImmediate=at}function at(Lt){delete q[Lt]}function ut(Lt){if(Y)setTimeout(ut,0,Lt);else{var kt=q[Lt];if(kt){Y=!0;try{(function(jt){var Mt=jt.callback,Wt=jt.args;switch(Wt.length){case 0:Mt();break;case 1:Mt(Wt[0]);break;case 2:Mt(Wt[0],Wt[1]);break;case 3:Mt(Wt[0],Wt[1],Wt[2]);break;default:Mt.apply(o,Wt)}})(kt)}finally{at(Lt),Y=!1}}}}function dt(Lt){Lt.source===b&&typeof Lt.data=="string"&&Lt.data.indexOf(V)===0&&ut(+Lt.data.slice(V.length))}})(typeof self>"u"?P===void 0?this:P:self)}).call(this,typeof xh<"u"?xh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Kd)),Kd.exports}var rv=iv();const sv=pf(rv);async function av(A){const T=await(await fetch(A)).blob(),E=await sv.loadAsync(T),S=E.file("manifest.geojson");if(!S)throw new Error("manifest.geojson not found!");const P=JSON.parse(await S.async("string")),b=E.file("default-style.json"),o=b?JSON.parse(await b.async("string")):{},N=E.file("locations.json"),$=N?JSON.parse(await N.async("string")):[],G=E.file("floors.geojson"),K=(G?JSON.parse(await G.async("string")):{features:[]}).features.sort((te,Ne)=>te.properties.elevation-Ne.properties.elevation),q=E.folder("entrance-aesthetic").filter(te=>te.endsWith(".json")),Y=new Set,J=new Map;for(const te of q){const Ne=JSON.parse(await te.async("string")),he=te.name.split("/").pop().replace(".json","");Ne.forEach(_e=>{Y.add(_e.geometryId),J.set(_e.geometryId,he)})}const W=E.folder("geometry"),at=[];W.forEach((te,Ne)=>{(te.endsWith(".geojson")||te.endsWith(".json"))&&at.push(Ne)});let ut=[];for(const te of at){const Ne=JSON.parse(await te.async("string")),he=te.name.split("/").pop().replace(".geojson","").replace(".json","");if(Ne.features){const _e=Ne.features.map(Zt=>({...Zt,properties:{...Zt.properties,floorId:he}}));ut=ut.concat(_e)}}const dt={type:"FeatureCollection",features:ut},Lt=E.file("connections.json"),kt=Lt?JSON.parse(await Lt.async("string")):[],jt=E.file("navigationFlags.json"),Mt=jt?JSON.parse(await jt.async("string")):null,Wt=async(te,Ne=!1)=>{const he=E.folder(te).filter(Zt=>Zt.endsWith(".json")),_e=new Set;for(const Zt of he){const Xt=JSON.parse(await Zt.async("string"));Ne?Xt.forEach(Ge=>_e.add(Ge.geometryId)):Object.keys(Xt).forEach(Ge=>_e.add(Ge))}return _e},Ot=await Wt("walkable"),Kt=await Wt("nonwalkable"),ge=await Wt("kinds"),Et=await Wt("entrance-aesthetic",!0),Ht=await Wt("annotations",!0),tt=new Set;$.forEach(te=>{te.geometryAnchors&&te.geometryAnchors.forEach(Ne=>tt.add(Ne.geometryId))});const Jt=new Set,ze=new Set($.map(te=>te.details?.name));return ut&&ut.forEach(te=>{const Ne=te.properties;Jt.add(Ne.id),Ne&&Ne.name&&!ze.has(Ne.name)&&($.push({details:{name:Ne.name},geometryAnchors:[{geometryId:Ne.id,floorId:Ne.floorId}]}),ze.add(Ne.name))}),{manifest:P,styles:o,locations:$,floors:K,entranceIds:Y,entranceGeometryToFloorMap:J,geometry:dt,connections:kt,navigationFlags:Mt,walkableIds:Ot,nonwalkableIds:Kt,kindsIds:ge,entranceAestheticIds:Et,annotationsIds:Ht,locationsIds:tt,geometryIds:Jt}}var fr=63710088e-1,hg={centimeters:fr*100,centimetres:fr*100,degrees:360/(2*Math.PI),feet:fr*3.28084,inches:fr*39.37,kilometers:fr/1e3,kilometres:fr/1e3,meters:fr,metres:fr,miles:fr/1609.344,millimeters:fr*1e3,millimetres:fr*1e3,nauticalmiles:fr/1852,radians:1,yards:fr*1.0936};function oa(A,I,T={}){const E={type:"Feature"};return(T.id===0||T.id)&&(E.id=T.id),T.bbox&&(E.bbox=T.bbox),E.properties=I||{},E.geometry=A,E}function Mn(A,I,T={}){if(!A)throw new Error("coordinates is required");if(!Array.isArray(A))throw new Error("coordinates must be an Array");if(A.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Sm(A[0])||!Sm(A[1]))throw new Error("coordinates must contain numbers");return oa({type:"Point",coordinates:A},I,T)}function Na(A,I,T={}){if(A.length<2)throw new Error("coordinates must be an array of two or more positions");return oa({type:"LineString",coordinates:A},I,T)}function pc(A,I={}){const T={type:"FeatureCollection"};return I.id&&(T.id=I.id),I.bbox&&(T.bbox=I.bbox),T.features=A,T}function mf(A,I="kilometers"){const T=hg[I];if(!T)throw new Error(I+" units is invalid");return A*T}function dg(A,I="kilometers"){const T=hg[I];if(!T)throw new Error(I+" units is invalid");return A/T}function Tm(A){return A%(2*Math.PI)*180/Math.PI}function ru(A){return A%360*Math.PI/180}function fg(A,I="kilometers",T="kilometers"){if(!(A>=0))throw new Error("length must be a positive number");return mf(dg(A,I),T)}function Sm(A){return!isNaN(A)&&A!==null&&!Array.isArray(A)}function ov(A){return A!==null&&typeof A=="object"&&!Array.isArray(A)}function Ra(A){if(!A)throw new Error("coord is required");if(!Array.isArray(A)){if(A.type==="Feature"&&A.geometry!==null&&A.geometry.type==="Point")return[...A.geometry.coordinates];if(A.type==="Point")return[...A.coordinates]}if(Array.isArray(A)&&A.length>=2&&!Array.isArray(A[0])&&!Array.isArray(A[1]))return[...A];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function au(A){if(Array.isArray(A))return A;if(A.type==="Feature"){if(A.geometry!==null)return A.geometry.coordinates}else if(A.coordinates)return A.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Em(A,I,T){if(!A)throw new Error("No feature passed");if(!T)throw new Error(".featureOf() requires a name");if(!A||A.type!=="Feature"||!A.geometry)throw new Error("Invalid input to "+T+", Feature with geometry required");if(!A.geometry||A.geometry.type!==I)throw new Error("Invalid input to "+T+": must be a "+I+", given "+A.geometry.type)}function pg(A){return A.type==="Feature"?A.geometry:A}function lv(A,I){return A.type==="FeatureCollection"?"FeatureCollection":A.type==="GeometryCollection"?"GeometryCollection":A.type==="Feature"&&A.geometry!==null?A.geometry.type:A.type}function Ir(A,I,T={}){var E=Ra(A),S=Ra(I),P=ru(S[1]-E[1]),b=ru(S[0]-E[0]),o=ru(E[1]),N=ru(S[1]),$=Math.pow(Math.sin(P/2),2)+Math.pow(Math.sin(b/2),2)*Math.cos(o)*Math.cos(N);return mf(2*Math.atan2(Math.sqrt($),Math.sqrt(1-$)),T.units)}function jh(A,I,T){if(A!==null)for(var E,S,P,b,o,N,$,G=0,V=0,K,q=A.type,Y=q==="FeatureCollection",J=q==="Feature",W=Y?A.features.length:1,at=0;at<W;at++){$=Y?A.features[at].geometry:J?A.geometry:A,K=$?$.type==="GeometryCollection":!1,o=K?$.geometries.length:1;for(var ut=0;ut<o;ut++){var dt=0,Lt=0;if(b=K?$.geometries[ut]:$,b!==null){N=b.coordinates;var kt=b.type;switch(G=T&&(kt==="Polygon"||kt==="MultiPolygon")?1:0,kt){case null:break;case"Point":if(I(N,V,at,dt,Lt)===!1)return!1;V++,dt++;break;case"LineString":case"MultiPoint":for(E=0;E<N.length;E++){if(I(N[E],V,at,dt,Lt)===!1)return!1;V++,kt==="MultiPoint"&&dt++}kt==="LineString"&&dt++;break;case"Polygon":case"MultiLineString":for(E=0;E<N.length;E++){for(S=0;S<N[E].length-G;S++){if(I(N[E][S],V,at,dt,Lt)===!1)return!1;V++}kt==="MultiLineString"&&dt++,kt==="Polygon"&&Lt++}kt==="Polygon"&&dt++;break;case"MultiPolygon":for(E=0;E<N.length;E++){for(Lt=0,S=0;S<N[E].length;S++){for(P=0;P<N[E][S].length-G;P++){if(I(N[E][S][P],V,at,dt,Lt)===!1)return!1;V++}Lt++}dt++}break;case"GeometryCollection":for(E=0;E<b.geometries.length;E++)if(jh(b.geometries[E],I,T)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function km(A,I){if(A.type==="Feature")I(A,0);else if(A.type==="FeatureCollection")for(var T=0;T<A.features.length&&I(A.features[T],T)!==!1;T++);}function gc(A,I){var T,E,S,P,b,o,N,$,G,V,K=0,q=A.type==="FeatureCollection",Y=A.type==="Feature",J=q?A.features.length:1;for(T=0;T<J;T++){for(o=q?A.features[T].geometry:Y?A.geometry:A,$=q?A.features[T].properties:Y?A.properties:{},G=q?A.features[T].bbox:Y?A.bbox:void 0,V=q?A.features[T].id:Y?A.id:void 0,N=o?o.type==="GeometryCollection":!1,b=N?o.geometries.length:1,S=0;S<b;S++){if(P=N?o.geometries[S]:o,P===null){if(I(null,K,$,G,V)===!1)return!1;continue}switch(P.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(I(P,K,$,G,V)===!1)return!1;break}case"GeometryCollection":{for(E=0;E<P.geometries.length;E++)if(I(P.geometries[E],K,$,G,V)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}K++}}function uv(A,I,T){var E=T;return gc(A,function(S,P,b,o,N){E=I(E,S,P,b,o,N)}),E}function mg(A,I){gc(A,function(T,E,S,P,b){var o=T===null?null:T.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return I(oa(T,S,{bbox:P,id:b}),E,0)===!1?!1:void 0}var N;switch(o){case"MultiPoint":N="Point";break;case"MultiLineString":N="LineString";break;case"MultiPolygon":N="Polygon";break}for(var $=0;$<T.coordinates.length;$++){var G=T.coordinates[$],V={type:N,coordinates:G};if(I(oa(V,S),E,$)===!1)return!1}})}function cv(A,I){mg(A,function(T,E,S){var P=0;if(T.geometry){var b=T.geometry.type;if(!(b==="Point"||b==="MultiPoint")){var o,N=0,$=0,G=0;if(jh(T,function(V,K,q,Y,J){if(o===void 0||E>N||Y>$||J>G){o=V,N=E,$=Y,G=J,P=0;return}var W=Na([o,V],T.properties);if(I(W,E,S,J,P)===!1)return!1;P++,o=V})===!1)return!1}}})}function hv(A){return uv(A,(I,T)=>I+dv(T),0)}function dv(A){let I=0,T;switch(A.type){case"Polygon":return Mm(A.coordinates);case"MultiPolygon":for(T=0;T<A.coordinates.length;T++)I+=Mm(A.coordinates[T]);return I;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function Mm(A){let I=0;if(A&&A.length>0){I+=Math.abs(Pm(A[0]));for(let T=1;T<A.length;T++)I-=Math.abs(Pm(A[T]))}return I}var fv=fr*fr/2,Jd=Math.PI/180;function Pm(A){const I=A.length-1;if(I<=2)return 0;let T=0,E=0;for(;E<I;){const S=A[E],P=A[E+1===I?0:E+1],b=A[E+2>=I?(E+2)%I:E+2],o=S[0]*Jd,N=P[1]*Jd,$=b[0]*Jd;T+=($-o)*Math.sin(N),E++}return T*fv}function Rh(A,I={}){if(A.bbox!=null&&I.recompute!==!0)return A.bbox;const T=[1/0,1/0,-1/0,-1/0];return jh(A,E=>{T[0]>E[0]&&(T[0]=E[0]),T[1]>E[1]&&(T[1]=E[1]),T[2]<E[0]&&(T[2]=E[0]),T[3]<E[1]&&(T[3]=E[1])}),T}var pv=class{constructor(A){this.points=A.points||[],this.duration=A.duration||1e4,this.sharpness=A.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=A.stepLength||60,this.length=this.points.length,this.delay=0;for(let I=0;I<this.length;I++)this.points[I].z=this.points[I].z||0;for(let I=0;I<this.length-1;I++){const T=this.points[I],E=this.points[I+1];this.centers.push({x:(T.x+E.x)/2,y:(T.y+E.y)/2,z:(T.z+E.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(let I=0;I<this.centers.length-1;I++){const T=this.points[I+1].x-(this.centers[I].x+this.centers[I+1].x)/2,E=this.points[I+1].y-(this.centers[I].y+this.centers[I+1].y)/2,S=this.points[I+1].z-(this.centers[I].y+this.centers[I+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[I+1].x+this.sharpness*(this.centers[I].x+T),y:(1-this.sharpness)*this.points[I+1].y+this.sharpness*(this.centers[I].y+E),z:(1-this.sharpness)*this.points[I+1].z+this.sharpness*(this.centers[I].z+S)},{x:(1-this.sharpness)*this.points[I+1].x+this.sharpness*(this.centers[I+1].x+T),y:(1-this.sharpness)*this.points[I+1].y+this.sharpness*(this.centers[I+1].y+E),z:(1-this.sharpness)*this.points[I+1].z+this.sharpness*(this.centers[I+1].z+S)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}cacheSteps(A){const I=[];let T=this.pos(0);I.push(0);for(let E=0;E<this.duration;E+=10){const S=this.pos(E);Math.sqrt((S.x-T.x)*(S.x-T.x)+(S.y-T.y)*(S.y-T.y)+(S.z-T.z)*(S.z-T.z))>A&&(I.push(E),T=S)}return I}vector(A){const I=this.pos(A+10),T=this.pos(A-10);return{angle:180*Math.atan2(I.y-T.y,I.x-T.x)/3.14,speed:Math.sqrt((T.x-I.x)*(T.x-I.x)+(T.y-I.y)*(T.y-I.y)+(T.z-I.z)*(T.z-I.z))}}pos(A){let I=A-this.delay;I<0&&(I=0),I>this.duration&&(I=this.duration-1);const T=I/this.duration;if(T>=1)return this.points[this.length-1];const E=Math.floor((this.points.length-1)*T),S=(this.length-1)*T-E;return mv(S,this.points[E],this.controls[E][1],this.controls[E+1][0],this.points[E+1])}};function mv(A,I,T,E,S){const P=gv(A);return{x:S.x*P[0]+E.x*P[1]+T.x*P[2]+I.x*P[3],y:S.y*P[0]+E.y*P[1]+T.y*P[2]+I.y*P[3],z:S.z*P[0]+E.z*P[1]+T.z*P[2]+I.z*P[3]}}function gv(A){const I=A*A;return[I*A,3*I*(1-A),3*A*(1-A)*(1-A),(1-A)*(1-A)*(1-A)]}function _v(A,I={}){const T=I.resolution||1e4,E=I.sharpness||.85,S=[],P=pg(A).coordinates.map($=>({x:$[0],y:$[1]})),b=new pv({duration:T,points:P,sharpness:E}),o=$=>{var G=b.pos($);Math.floor($/100)%2===0&&S.push([G.x,G.y])};for(var N=0;N<b.duration;N+=10)o(N);return o(b.duration),Na(S,I.properties)}const za=11102230246251565e-32,wr=134217729,yv=(3+8*za)*za;function Qd(A,I,T,E,S){let P,b,o,N,$=I[0],G=E[0],V=0,K=0;G>$==G>-$?(P=$,$=I[++V]):(P=G,G=E[++K]);let q=0;if(V<A&&K<T)for(G>$==G>-$?(b=$+P,o=P-(b-$),$=I[++V]):(b=G+P,o=P-(b-G),G=E[++K]),P=b,o!==0&&(S[q++]=o);V<A&&K<T;)G>$==G>-$?(b=P+$,N=b-P,o=P-(b-N)+($-N),$=I[++V]):(b=P+G,N=b-P,o=P-(b-N)+(G-N),G=E[++K]),P=b,o!==0&&(S[q++]=o);for(;V<A;)b=P+$,N=b-P,o=P-(b-N)+($-N),$=I[++V],P=b,o!==0&&(S[q++]=o);for(;K<T;)b=P+G,N=b-P,o=P-(b-N)+(G-N),G=E[++K],P=b,o!==0&&(S[q++]=o);return(P!==0||q===0)&&(S[q++]=P),q}function vv(A,I){let T=I[0];for(let E=1;E<A;E++)T+=I[E];return T}function _c(A){return new Float64Array(A)}const xv=(3+16*za)*za,bv=(2+12*za)*za,wv=(9+64*za)*za*za,iu=_c(4),Cm=_c(8),Am=_c(12),Lm=_c(16),Or=_c(4);function Iv(A,I,T,E,S,P,b){let o,N,$,G,V,K,q,Y,J,W,at,ut,dt,Lt,kt,jt,Mt,Wt;const Ot=A-S,Kt=T-S,ge=I-P,Et=E-P;Lt=Ot*Et,K=wr*Ot,q=K-(K-Ot),Y=Ot-q,K=wr*Et,J=K-(K-Et),W=Et-J,kt=Y*W-(Lt-q*J-Y*J-q*W),jt=ge*Kt,K=wr*ge,q=K-(K-ge),Y=ge-q,K=wr*Kt,J=K-(K-Kt),W=Kt-J,Mt=Y*W-(jt-q*J-Y*J-q*W),at=kt-Mt,V=kt-at,iu[0]=kt-(at+V)+(V-Mt),ut=Lt+at,V=ut-Lt,dt=Lt-(ut-V)+(at-V),at=dt-jt,V=dt-at,iu[1]=dt-(at+V)+(V-jt),Wt=ut+at,V=Wt-ut,iu[2]=ut-(Wt-V)+(at-V),iu[3]=Wt;let Ht=vv(4,iu),tt=bv*b;if(Ht>=tt||-Ht>=tt||(V=A-Ot,o=A-(Ot+V)+(V-S),V=T-Kt,$=T-(Kt+V)+(V-S),V=I-ge,N=I-(ge+V)+(V-P),V=E-Et,G=E-(Et+V)+(V-P),o===0&&N===0&&$===0&&G===0)||(tt=wv*b+yv*Math.abs(Ht),Ht+=Ot*G+Et*o-(ge*$+Kt*N),Ht>=tt||-Ht>=tt))return Ht;Lt=o*Et,K=wr*o,q=K-(K-o),Y=o-q,K=wr*Et,J=K-(K-Et),W=Et-J,kt=Y*W-(Lt-q*J-Y*J-q*W),jt=N*Kt,K=wr*N,q=K-(K-N),Y=N-q,K=wr*Kt,J=K-(K-Kt),W=Kt-J,Mt=Y*W-(jt-q*J-Y*J-q*W),at=kt-Mt,V=kt-at,Or[0]=kt-(at+V)+(V-Mt),ut=Lt+at,V=ut-Lt,dt=Lt-(ut-V)+(at-V),at=dt-jt,V=dt-at,Or[1]=dt-(at+V)+(V-jt),Wt=ut+at,V=Wt-ut,Or[2]=ut-(Wt-V)+(at-V),Or[3]=Wt;const Jt=Qd(4,iu,4,Or,Cm);Lt=Ot*G,K=wr*Ot,q=K-(K-Ot),Y=Ot-q,K=wr*G,J=K-(K-G),W=G-J,kt=Y*W-(Lt-q*J-Y*J-q*W),jt=ge*$,K=wr*ge,q=K-(K-ge),Y=ge-q,K=wr*$,J=K-(K-$),W=$-J,Mt=Y*W-(jt-q*J-Y*J-q*W),at=kt-Mt,V=kt-at,Or[0]=kt-(at+V)+(V-Mt),ut=Lt+at,V=ut-Lt,dt=Lt-(ut-V)+(at-V),at=dt-jt,V=dt-at,Or[1]=dt-(at+V)+(V-jt),Wt=ut+at,V=Wt-ut,Or[2]=ut-(Wt-V)+(at-V),Or[3]=Wt;const ze=Qd(Jt,Cm,4,Or,Am);Lt=o*G,K=wr*o,q=K-(K-o),Y=o-q,K=wr*G,J=K-(K-G),W=G-J,kt=Y*W-(Lt-q*J-Y*J-q*W),jt=N*$,K=wr*N,q=K-(K-N),Y=N-q,K=wr*$,J=K-(K-$),W=$-J,Mt=Y*W-(jt-q*J-Y*J-q*W),at=kt-Mt,V=kt-at,Or[0]=kt-(at+V)+(V-Mt),ut=Lt+at,V=ut-Lt,dt=Lt-(ut-V)+(at-V),at=dt-jt,V=dt-at,Or[1]=dt-(at+V)+(V-jt),Wt=ut+at,V=Wt-ut,Or[2]=ut-(Wt-V)+(at-V),Or[3]=Wt;const te=Qd(ze,Am,4,Or,Lm);return Lm[te-1]}function Tv(A,I,T,E,S,P){const b=(I-P)*(T-S),o=(A-S)*(E-P),N=b-o,$=Math.abs(b+o);return Math.abs(N)>=xv*$?N:-Iv(A,I,T,E,S,P,$)}function Sv(A,I){var T,E,S=0,P,b,o,N,$,G,V,K=A[0],q=A[1],Y=I.length;for(T=0;T<Y;T++){E=0;var J=I[T],W=J.length-1;if(G=J[0],G[0]!==J[W][0]&&G[1]!==J[W][1])throw new Error("First and last coordinates in a ring must be the same");for(b=G[0]-K,o=G[1]-q,E;E<W;E++){if(V=J[E+1],N=V[0]-K,$=V[1]-q,o===0&&$===0){if(N<=0&&b>=0||b<=0&&N>=0)return 0}else if($>=0&&o<=0||$<=0&&o>=0){if(P=Tv(b,N,o,$,0,0),P===0)return 0;(P>0&&$>0&&o<=0||P<0&&$<=0&&o>0)&&S++}G=V,o=$,b=N}}return S%2!==0}function gf(A,I,T={}){if(!A)throw new Error("point is required");if(!I)throw new Error("polygon is required");const E=Ra(A),S=pg(I),P=S.type,b=I.bbox;let o=S.coordinates;if(b&&Ev(E,b)===!1)return!1;P==="Polygon"&&(o=[o]);let N=!1;for(var $=0;$<o.length;++$){const G=Sv(E,o[$]);if(G===0)return!T.ignoreBoundary;G&&(N=!0)}return N}function Ev(A,I){return I[0]<=A[0]&&I[1]<=A[1]&&I[2]>=A[0]&&I[3]>=A[1]}function Dm(A,I,T={}){const E=Ra(A),S=au(I);for(let P=0;P<S.length-1;P++){let b=!1;if(T.ignoreEndVertices&&(P===0&&(b="start"),P===S.length-2&&(b="end"),P===0&&P+1===S.length-1&&(b="both")),kv(S[P],S[P+1],E,b,typeof T.epsilon>"u"?null:T.epsilon))return!0}return!1}function kv(A,I,T,E,S){const P=T[0],b=T[1],o=A[0],N=A[1],$=I[0],G=I[1],V=T[0]-o,K=T[1]-N,q=$-o,Y=G-N,J=V*Y-K*q;if(S!==null){if(Math.abs(J)>S)return!1}else if(J!==0)return!1;if(Math.abs(q)===Math.abs(Y)&&Math.abs(q)===0)return E?!1:T[0]===A[0]&&T[1]===A[1];if(E){if(E==="start")return Math.abs(q)>=Math.abs(Y)?q>0?o<P&&P<=$:$<=P&&P<o:Y>0?N<b&&b<=G:G<=b&&b<N;if(E==="end")return Math.abs(q)>=Math.abs(Y)?q>0?o<=P&&P<$:$<P&&P<=o:Y>0?N<=b&&b<G:G<b&&b<=N;if(E==="both")return Math.abs(q)>=Math.abs(Y)?q>0?o<P&&P<$:$<P&&P<o:Y>0?N<b&&b<G:G<b&&b<N}else return Math.abs(q)>=Math.abs(Y)?q>0?o<=P&&P<=$:$<=P&&P<=o:Y>0?N<=b&&b<=G:G<=b&&b<=N;return!1}class gg{constructor(I=[],T=Mv){if(this.data=I,this.length=this.data.length,this.compare=T,this.length>0)for(let E=(this.length>>1)-1;E>=0;E--)this._down(E)}push(I){this.data.push(I),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const I=this.data[0],T=this.data.pop();return this.length--,this.length>0&&(this.data[0]=T,this._down(0)),I}peek(){return this.data[0]}_up(I){const{data:T,compare:E}=this,S=T[I];for(;I>0;){const P=I-1>>1,b=T[P];if(E(S,b)>=0)break;T[I]=b,I=P}T[I]=S}_down(I){const{data:T,compare:E}=this,S=this.length>>1,P=T[I];for(;I<S;){let b=(I<<1)+1,o=T[b];const N=b+1;if(N<this.length&&E(T[N],o)<0&&(b=N,o=T[N]),E(o,P)>=0)break;T[I]=o,I=b}T[I]=P}}function Mv(A,I){return A<I?-1:A>I?1:0}function _g(A,I){return A.p.x>I.p.x?1:A.p.x<I.p.x?-1:A.p.y!==I.p.y?A.p.y>I.p.y?1:-1:1}function Pv(A,I){return A.rightSweepEvent.p.x>I.rightSweepEvent.p.x?1:A.rightSweepEvent.p.x<I.rightSweepEvent.p.x?-1:A.rightSweepEvent.p.y!==I.rightSweepEvent.p.y?A.rightSweepEvent.p.y<I.rightSweepEvent.p.y?1:-1:1}let Rm=class{constructor(I,T,E,S){this.p={x:I[0],y:I[1]},this.featureId=T,this.ringId=E,this.eventId=S,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(I){return this.p.x===I.p.x&&this.p.y===I.p.y}};function Cv(A,I){if(A.type==="FeatureCollection"){const T=A.features;for(let E=0;E<T.length;E++)zm(T[E],I)}else zm(A,I)}let wh=0,Ih=0,Th=0;function zm(A,I){const T=A.type==="Feature"?A.geometry:A;let E=T.coordinates;(T.type==="Polygon"||T.type==="MultiLineString")&&(E=[E]),T.type==="LineString"&&(E=[[E]]);for(let S=0;S<E.length;S++)for(let P=0;P<E[S].length;P++){let b=E[S][P][0],o=null;Ih=Ih+1;for(let N=0;N<E[S][P].length-1;N++){o=E[S][P][N+1];const $=new Rm(b,wh,Ih,Th),G=new Rm(o,wh,Ih,Th+1);$.otherEvent=G,G.otherEvent=$,_g($,G)>0?(G.isLeftEndpoint=!0,$.isLeftEndpoint=!1):($.isLeftEndpoint=!0,G.isLeftEndpoint=!1),I.push($),I.push(G),b=o,Th=Th+1}}wh=wh+1}class Av{constructor(I){this.leftSweepEvent=I,this.rightSweepEvent=I.otherEvent}}function Lv(A,I){if(A===null||I===null||A.leftSweepEvent.ringId===I.leftSweepEvent.ringId&&(A.rightSweepEvent.isSamePoint(I.leftSweepEvent)||A.rightSweepEvent.isSamePoint(I.leftSweepEvent)||A.rightSweepEvent.isSamePoint(I.rightSweepEvent)||A.leftSweepEvent.isSamePoint(I.leftSweepEvent)||A.leftSweepEvent.isSamePoint(I.rightSweepEvent)))return!1;const T=A.leftSweepEvent.p.x,E=A.leftSweepEvent.p.y,S=A.rightSweepEvent.p.x,P=A.rightSweepEvent.p.y,b=I.leftSweepEvent.p.x,o=I.leftSweepEvent.p.y,N=I.rightSweepEvent.p.x,$=I.rightSweepEvent.p.y,G=($-o)*(S-T)-(N-b)*(P-E),V=(N-b)*(E-o)-($-o)*(T-b),K=(S-T)*(E-o)-(P-E)*(T-b);if(G===0)return!1;const q=V/G,Y=K/G;if(q>=0&&q<=1&&Y>=0&&Y<=1){const J=T+q*(S-T),W=E+q*(P-E);return[J,W]}return!1}function Dv(A,I){I=I||!1;const T=[],E=new gg([],Pv);for(;A.length;){const S=A.pop();if(S.isLeftEndpoint){const P=new Av(S);for(let b=0;b<E.data.length;b++){const o=E.data[b];if(I&&o.leftSweepEvent.featureId===S.featureId)continue;const N=Lv(P,o);N!==!1&&T.push(N)}E.push(P)}else S.isLeftEndpoint===!1&&E.pop()}return T}function Rv(A,I){const T=new gg([],_g);return Cv(A,T),Dv(T,I)}var zv=Rv;function Nv(A,I,T={}){const{removeDuplicates:E=!0,ignoreSelfIntersections:S=!0}=T;let P=[];A.type==="FeatureCollection"?P=P.concat(A.features):A.type==="Feature"?P.push(A):(A.type==="LineString"||A.type==="Polygon"||A.type==="MultiLineString"||A.type==="MultiPolygon")&&P.push(oa(A)),I.type==="FeatureCollection"?P=P.concat(I.features):I.type==="Feature"?P.push(I):(I.type==="LineString"||I.type==="Polygon"||I.type==="MultiLineString"||I.type==="MultiPolygon")&&P.push(oa(I));const b=zv(pc(P),S);let o=[];if(E){const N={};b.forEach($=>{const G=$.join(",");N[G]||(N[G]=!0,o.push($))})}else o=b;return pc(o.map(N=>Mn(N)))}function Ov(A,I={}){var T=typeof I=="object"?I.mutate:I;if(!A)throw new Error("geojson is required");var E=lv(A),S=[];switch(E){case"LineString":S=tf(A,E);break;case"MultiLineString":case"Polygon":au(A).forEach(function(b){S.push(tf(b,E))});break;case"MultiPolygon":au(A).forEach(function(b){var o=[];b.forEach(function(N){o.push(tf(N,E))}),S.push(o)});break;case"Point":return A;case"MultiPoint":var P={};au(A).forEach(function(b){var o=b.join("-");Object.prototype.hasOwnProperty.call(P,o)||(S.push(b),P[o]=!0)});break;default:throw new Error(E+" geometry not supported")}return A.coordinates?T===!0?(A.coordinates=S,A):{type:E,coordinates:S}:T===!0?(A.geometry.coordinates=S,A):oa({type:E,coordinates:S},A.properties,{bbox:A.bbox,id:A.id})}function tf(A,I){const T=au(A);if(T.length===2&&!Nm(T[0],T[1]))return T;const E=[];let S=0,P=1,b=2;for(E.push(T[S]);b<T.length;)Dm(T[P],Na([T[S],T[b]]))?P=b:(E.push(T[P]),S=P,P++,b=P),b++;if(E.push(T[P]),I==="Polygon"||I==="MultiPolygon"){if(Dm(E[0],Na([E[1],E[E.length-2]]))&&(E.shift(),E.pop(),E.push(E[0])),E.length<4)throw new Error("invalid polygon, fewer than 4 points");if(!Nm(E[0],E[E.length-1]))throw new Error("invalid polygon, first and last points not equal")}return E}function Nm(A,I){return A[0]===I[0]&&A[1]===I[1]}var Fv=Object.defineProperty,Bv=Object.defineProperties,Vv=Object.getOwnPropertyDescriptors,Om=Object.getOwnPropertySymbols,jv=Object.prototype.hasOwnProperty,Gv=Object.prototype.propertyIsEnumerable,Fm=(A,I,T)=>I in A?Fv(A,I,{enumerable:!0,configurable:!0,writable:!0,value:T}):A[I]=T,Bm=(A,I)=>{for(var T in I||(I={}))jv.call(I,T)&&Fm(A,T,I[T]);if(Om)for(var T of Om(I))Gv.call(I,T)&&Fm(A,T,I[T]);return A},Vm=(A,I)=>Bv(A,Vv(I));function Uv(A,I,T={}){if(!A||!I)throw new Error("lines and pt are required arguments");const E=Ra(I);let S=Mn([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),P=0;return mg(A,function(b,o,N){const $=au(b);for(let G=0;G<$.length-1;G++){const V=Mn($[G]),K=Ra(V),q=Mn($[G+1]),Y=Ra(q),J=Ir(V,q,T);let W,at;Y[0]===E[0]&&Y[1]===E[1]?[W,at]=[Y,!0]:K[0]===E[0]&&K[1]===E[1]?[W,at]=[K,!1]:[W,at]=$v(K,Y,E);const ut=Mn(W,{dist:Ir(I,W,T),multiFeatureIndex:N,location:P+Ir(V,W,T)});ut.properties.dist<S.properties.dist&&(S=Vm(Bm({},ut),{properties:Vm(Bm({},ut.properties),{index:at?G+1:G})})),P+=J}}),S}function il(A,I){const[T,E,S]=A,[P,b,o]=I;return T*P+E*b+S*o}function cc(A,I){const[T,E,S]=A,[P,b,o]=I;return[E*o-S*b,S*P-T*o,T*b-E*P]}function qv(A){return Math.sqrt(Math.pow(A[0],2)+Math.pow(A[1],2)+Math.pow(A[2],2))}function jm(A){const I=qv(A);return[A[0]/I,A[1]/I,A[2]/I]}function ef(A){const I=ru(A[1]),T=ru(A[0]);return[Math.cos(I)*Math.cos(T),Math.cos(I)*Math.sin(T),Math.sin(I)]}function Zv(A){const[I,T,E]=A,S=Math.min(Math.max(E,-1),1),P=Tm(Math.asin(S));return[Tm(Math.atan2(T,I)),P]}function $v(A,I,T){const E=ef(A),S=ef(I),P=ef(T),b=cc(E,S);if(b[0]===0&&b[1]===0&&b[2]===0)return il(E,S)>0?[[...I],!0]:[[...T],!1];const o=cc(b,P);if(o[0]===0&&o[1]===0&&o[2]===0)return[[...I],!0];const N=cc(o,b),$=jm(N),G=[-$[0],-$[1],-$[2]],V=il(P,$)>il(P,G)?$:G,K=jm(b),q=il(cc(E,V),K),Y=il(cc(V,S),K);return q>=0&&Y>=0?[Zv(V),!1]:il(E,P)>il(S,P)?[[...A],!1]:[[...I],!0]}function Wv(A,I={}){const T=Rh(A),E=(T[0]+T[2])/2,S=(T[1]+T[3])/2;return Mn([E,S],I.properties,I)}var Ah={exports:{}},Xv=Ah.exports,Gm;function Yv(){return Gm||(Gm=1,(function(A,I){(function(T,E){A.exports=E()})(Xv,(function(){function T(m,s){(s==null||s>m.length)&&(s=m.length);for(var l=0,p=Array(s);l<s;l++)p[l]=m[l];return p}function E(m,s,l){return s=G(s),(function(p,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(D){if(D===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D})(p)})(m,K()?Reflect.construct(s,l||[],G(m).constructor):s.apply(m,l))}function S(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")}function P(m,s,l){if(K())return Reflect.construct.apply(null,arguments);var p=[null];p.push.apply(p,s);var w=new(m.bind.apply(m,p));return l&&q(w,l.prototype),w}function b(m,s){for(var l=0;l<s.length;l++){var p=s[l];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(m,W(p.key),p)}}function o(m,s,l){return s&&b(m.prototype,s),l&&b(m,l),Object.defineProperty(m,"prototype",{writable:!1}),m}function N(m,s){var l=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(!l){if(Array.isArray(m)||(l=at(m))||s){l&&(m=l);var p=0,w=function(){};return{s:w,n:function(){return p>=m.length?{done:!0}:{done:!1,value:m[p++]}},e:function(ht){throw ht},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D,B=!0,Q=!1;return{s:function(){l=l.call(m)},n:function(){var ht=l.next();return B=ht.done,ht},e:function(ht){Q=!0,D=ht},f:function(){try{B||l.return==null||l.return()}finally{if(Q)throw D}}}}function $(){return $=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(m,s,l){var p=(function(D,B){for(;!{}.hasOwnProperty.call(D,B)&&(D=G(D))!==null;);return D})(m,s);if(p){var w=Object.getOwnPropertyDescriptor(p,s);return w.get?w.get.call(arguments.length<3?m:l):w.value}},$.apply(null,arguments)}function G(m){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},G(m)}function V(m,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(s&&s.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),s&&q(m,s)}function K(){try{var m=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(K=function(){return!!m})()}function q(m,s){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,p){return l.__proto__=p,l},q(m,s)}function Y(m,s,l,p){var w=$(G(1&p?m.prototype:m),s,l);return 2&p&&typeof w=="function"?function(D){return w.apply(l,D)}:w}function J(m){return(function(s){if(Array.isArray(s))return T(s)})(m)||(function(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)})(m)||at(m)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function W(m){var s=(function(l,p){if(typeof l!="object"||!l)return l;var w=l[Symbol.toPrimitive];if(w!==void 0){var D=w.call(l,p);if(typeof D!="object")return D;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)})(m,"string");return typeof s=="symbol"?s:s+""}function at(m,s){if(m){if(typeof m=="string")return T(m,s);var l={}.toString.call(m).slice(8,-1);return l==="Object"&&m.constructor&&(l=m.constructor.name),l==="Map"||l==="Set"?Array.from(m):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?T(m,s):void 0}}function ut(m){var s=typeof Map=="function"?new Map:void 0;return ut=function(l){if(l===null||!(function(w){try{return Function.toString.call(w).indexOf("[native code]")!==-1}catch{return typeof w=="function"}})(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(l))return s.get(l);s.set(l,p)}function p(){return P(l,arguments,G(this).constructor)}return p.prototype=Object.create(l.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),q(p,l)},ut(m)}var dt=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(s){this._quadrantSegments=s,this._quadrantSegments===0&&(this._joinStyle=m.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=m.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),s<=0&&(this._quadrantSegments=1),this._joinStyle!==m.JOIN_ROUND&&(this._quadrantSegments=m.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(s){this._joinStyle=s}},{key:"setSimplifyFactor",value:function(s){this._simplifyFactor=s<0?0:s}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(s){this._endCapStyle=s}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(s){this._mitreLimit=s}},{key:"setSingleSided",value:function(s){this._isSingleSided=s}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=m.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=m.CAP_ROUND,this._joinStyle=m.JOIN_ROUND,this._mitreLimit=m.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=m.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.setQuadrantSegments(s)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];this.setQuadrantSegments(l),this.setEndCapStyle(p)}else if(arguments.length===4){var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3];this.setQuadrantSegments(w),this.setEndCapStyle(D),this.setJoinStyle(B),this.setMitreLimit(Q)}}}},{key:"bufferDistanceError",value:function(s){var l=Math.PI/2/s;return 1-Math.cos(l/2)}}])})();dt.CAP_ROUND=1,dt.CAP_FLAT=2,dt.CAP_SQUARE=3,dt.JOIN_ROUND=1,dt.JOIN_MITRE=2,dt.JOIN_BEVEL=3,dt.DEFAULT_QUADRANT_SEGMENTS=8,dt.DEFAULT_MITRE_LIMIT=5,dt.DEFAULT_SIMPLIFY_FACTOR=.01;var Lt=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({Exception:s})[0],p}return V(s,m),o(s,[{key:"toString",value:function(){return this.message}}])})(ut(Error)),kt=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({IllegalArgumentException:s})[0],p}return V(s,m),o(s)})(Lt),jt=(function(){return o((function m(){S(this,m)}),[{key:"filter",value:function(m){}}])})();function Mt(){}function Wt(){}function Ot(){}var Kt,ge,Et,Ht,tt,Jt,ze,te,Ne=(function(){return o((function m(){S(this,m)}),null,[{key:"equalsWithTolerance",value:function(m,s,l){return Math.abs(m-s)<=l}}])})(),he=(function(){return o((function m(s,l){S(this,m),this.low=l||0,this.high=s||0}),null,[{key:"toBinaryString",value:function(m){var s,l="";for(s=2147483648;s>0;s>>>=1)l+=(m.high&s)===s?"1":"0";for(s=2147483648;s>0;s>>>=1)l+=(m.low&s)===s?"1":"0";return l}}])})();function _e(){}function Zt(){}_e.NaN=NaN,_e.isNaN=function(m){return Number.isNaN(m)},_e.isInfinite=function(m){return!Number.isFinite(m)},_e.MAX_VALUE=Number.MAX_VALUE,_e.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,_e.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(Jt=2146435072,ze=new Float64Array(1),te=new Int32Array(ze.buffer),_e.doubleToLongBits=function(m){ze[0]=m;var s=0|te[0],l=0|te[1];return(l&Jt)===Jt&&1048575&l&&s!==0&&(s=0,l=2146959360),new he(l,s)},_e.longBitsToDouble=function(m){return te[0]=m.low,te[1]=m.high,ze[0]}):(Kt=1023,ge=Math.log2,Et=Math.floor,Ht=Math.pow,tt=(function(){for(var m=53;m>0;m--){var s=Ht(2,m)-1;if(Et(ge(s))+1===m)return s}return 0})(),_e.doubleToLongBits=function(m){var s,l,p,w,D,B,Q,ht,vt;if(m<0||1/m===Number.NEGATIVE_INFINITY?(B=1<<31,m=-m):B=0,m===0)return new he(ht=B,vt=0);if(m===1/0)return new he(ht=2146435072|B,vt=0);if(m!=m)return new he(ht=2146959360,vt=0);if(w=0,vt=0,(s=Et(m))>1)if(s<=tt)(w=Et(ge(s)))<=20?(vt=0,ht=s<<20-w&1048575):(vt=s%(l=Ht(2,p=w-20))<<32-p,ht=s/l&1048575);else for(p=s,vt=0;(p=Et(l=p/2))!==0;)w++,vt>>>=1,vt|=(1&ht)<<31,ht>>>=1,l!==p&&(ht|=524288);if(Q=w+Kt,D=s===0,s=m-s,w<52&&s!==0)for(p=0;;){if((l=2*s)>=1?(s=l-1,D?(Q--,D=!1):(p<<=1,p|=1,w++)):(s=l,D?--Q==0&&(w++,D=!1):(p<<=1,w++)),w===20)ht|=p,p=0;else if(w===52){vt|=p;break}if(l===1){w<20?ht|=p<<20-w:w<52&&(vt|=p<<52-w);break}}return ht|=Q<<20,new he(ht|=B,vt)},_e.longBitsToDouble=function(m){var s,l,p,w,D=m.high,B=m.low,Q=D&1<<31?-1:1;for(p=((2146435072&D)>>20)-Kt,w=0,l=1<<19,s=1;s<=20;s++)D&l&&(w+=Ht(2,-s)),l>>>=1;for(l=1<<31,s=21;s<=52;s++)B&l&&(w+=Ht(2,-s)),l>>>=1;if(p===-1023){if(w===0)return 0*Q;p=-1022}else{if(p===1024)return w===0?Q/0:NaN;w+=1}return Q*w*Ht(2,p)});var Xt=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({RuntimeException:s})[0],p}return V(s,m),o(s)})(Lt),Ge=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,null,[{key:"constructor_",value:function(){if(arguments.length===0)Xt.constructor_.call(this);else if(arguments.length===1){var l=arguments[0];Xt.constructor_.call(this,l)}}}])})(Xt),ye=(function(){function m(){S(this,m)}return o(m,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)m.shouldNeverReachHere(null);else if(arguments.length===1){var s=arguments[0];throw new Ge("Should never reach here"+(s!==null?": "+s:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var s=arguments[0];m.isTrue(s,null)}else if(arguments.length===2){var l=arguments[1];if(!arguments[0])throw l===null?new Ge:new Ge(l)}}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],l=arguments[1];m.equals(s,l,null)}else if(arguments.length===3){var p=arguments[0],w=arguments[1],D=arguments[2];if(!w.equals(p))throw new Ge("Expected "+p+" but encountered "+w+(D!==null?": "+D:""))}}}])})(),Pe=new ArrayBuffer(8),_n=new Float64Array(Pe),Pn=new Int32Array(Pe),Gt=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getM",value:function(){return _e.NaN}},{key:"setOrdinate",value:function(s,l){switch(s){case m.X:this.x=l;break;case m.Y:this.y=l;break;case m.Z:this.setZ(l);break;default:throw new kt("Invalid ordinate index: "+s)}}},{key:"equals2D",value:function(){if(arguments.length===1){var s=arguments[0];return this.x===s.x&&this.y===s.y}if(arguments.length===2){var l=arguments[0],p=arguments[1];return!!Ne.equalsWithTolerance(this.x,l.x,p)&&!!Ne.equalsWithTolerance(this.y,l.y,p)}}},{key:"setM",value:function(s){throw new kt("Invalid ordinate index: "+m.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(s){switch(s){case m.X:return this.x;case m.Y:return this.y;case m.Z:return this.getZ()}throw new kt("Invalid ordinate index: "+s)}},{key:"equals3D",value:function(s){return this.x===s.x&&this.y===s.y&&(this.getZ()===s.getZ()||_e.isNaN(this.getZ())&&_e.isNaN(s.getZ()))}},{key:"equals",value:function(s){return s instanceof m&&this.equals2D(s)}},{key:"equalInZ",value:function(s,l){return Ne.equalsWithTolerance(this.getZ(),s.getZ(),l)}},{key:"setX",value:function(s){this.x=s}},{key:"compareTo",value:function(s){var l=s;return this.x<l.x?-1:this.x>l.x?1:this.y<l.y?-1:this.y>l.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(s){this.z=s}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return ye.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw s}}},{key:"copy",value:function(){return new m(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(s){var l=this.x-s.x,p=this.y-s.y,w=this.getZ()-s.getZ();return Math.sqrt(l*l+p*p+w*w)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(s){this.y=s}},{key:"distance",value:function(s){var l=this.x-s.x,p=this.y-s.y;return Math.sqrt(l*l+p*p)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*s+m.hashCode(this.x))+m.hashCode(this.y)}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}},{key:"interfaces_",get:function(){return[Mt,Wt,Ot]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)m.constructor_.call(this,0,0);else if(arguments.length===1){var s=arguments[0];m.constructor_.call(this,s.x,s.y,s.getZ())}else if(arguments.length===2){var l=arguments[0],p=arguments[1];m.constructor_.call(this,l,p,m.NULL_ORDINATE)}else if(arguments.length===3){var w=arguments[0],D=arguments[1],B=arguments[2];this.x=w,this.y=D,this.z=B}}},{key:"hashCode",value:function(s){return _n[0]=s,Pn[0]^Pn[1]}}])})(),bn=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"compare",value:function(s,l){var p=m.compare(s.x,l.x);if(p!==0)return p;var w=m.compare(s.y,l.y);return w!==0?w:this._dimensionsToTest<=2?0:m.compare(s.getZ(),l.getZ())}},{key:"interfaces_",get:function(){return[Zt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)m.constructor_.call(this,2);else if(arguments.length===1){var s=arguments[0];if(s!==2&&s!==3)throw new kt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=s}}},{key:"compare",value:function(s,l){return s<l?-1:s>l?1:_e.isNaN(s)?_e.isNaN(l)?0:-1:_e.isNaN(l)?1:0}}])})();Gt.DimensionalComparator=bn,Gt.NULL_ORDINATE=_e.NaN,Gt.X=0,Gt.Y=1,Gt.Z=2,Gt.M=3;var sn=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(s){if(!(s instanceof m))return!1;var l=s;return this.isNull()?l.isNull():this._maxx===l.getMaxX()&&this._maxy===l.getMaxY()&&this._minx===l.getMinX()&&this._miny===l.getMinY()}},{key:"intersection",value:function(s){if(this.isNull()||s.isNull()||!this.intersects(s))return new m;var l=this._minx>s._minx?this._minx:s._minx,p=this._miny>s._miny?this._miny:s._miny;return new m(l,this._maxx<s._maxx?this._maxx:s._maxx,p,this._maxy<s._maxy?this._maxy:s._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Gt){var s=arguments[0];return this.covers(s.x,s.y)}if(arguments[0]instanceof m){var l=arguments[0];return!this.isNull()&&!l.isNull()&&l.getMinX()>=this._minx&&l.getMaxX()<=this._maxx&&l.getMinY()>=this._miny&&l.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];return!this.isNull()&&p>=this._minx&&p<=this._maxx&&w>=this._miny&&w<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof m){var s=arguments[0];return!this.isNull()&&!s.isNull()&&!(s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny)}if(arguments[0]instanceof Gt){var l=arguments[0];return this.intersects(l.x,l.y)}}else if(arguments.length===2){if(arguments[0]instanceof Gt&&arguments[1]instanceof Gt){var p=arguments[0],w=arguments[1];return!this.isNull()&&!((p.x<w.x?p.x:w.x)>this._maxx)&&!((p.x>w.x?p.x:w.x)<this._minx)&&!((p.y<w.y?p.y:w.y)>this._maxy)&&!((p.y>w.y?p.y:w.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var D=arguments[0],B=arguments[1];return!this.isNull()&&!(D>this._maxx||D<this._minx||B>this._maxy||B<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var s=this.getWidth(),l=this.getHeight();return Math.sqrt(s*s+l*l)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Gt){var s=arguments[0];this.expandToInclude(s.x,s.y)}else if(arguments[0]instanceof m){var l=arguments[0];if(l.isNull())return null;this.isNull()?(this._minx=l.getMinX(),this._maxx=l.getMaxX(),this._miny=l.getMinY(),this._maxy=l.getMaxY()):(l._minx<this._minx&&(this._minx=l._minx),l._maxx>this._maxx&&(this._maxx=l._maxx),l._miny<this._miny&&(this._miny=l._miny),l._maxy>this._maxy&&(this._maxy=l._maxy))}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=w,this._maxy=w):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),w<this._miny&&(this._miny=w),w>this._maxy&&(this._maxy=w))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),l=this.getHeight();return s<l?s:l}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(s){var l=s;return this.isNull()?l.isNull()?0:-1:l.isNull()?1:this._minx<l._minx?-1:this._minx>l._minx?1:this._miny<l._miny?-1:this._miny>l._miny?1:this._maxx<l._maxx?-1:this._maxx>l._maxx?1:this._maxy<l._maxy?-1:this._maxy>l._maxy?1:0}},{key:"translate",value:function(s,l){if(this.isNull())return null;this.init(this.getMinX()+s,this.getMaxX()+s,this.getMinY()+l,this.getMaxY()+l)}},{key:"copy",value:function(){return new m(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(s){return!(!this.isNull()&&!s.isNull())||s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),l=this.getHeight();return s>l?s:l}},{key:"expandBy",value:function(){if(arguments.length===1){var s=arguments[0];this.expandBy(s,s)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=l,this._maxx+=l,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof m){var s=arguments[0];return this.covers(s)}if(arguments[0]instanceof Gt){var l=arguments[0];return this.covers(l)}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];return this.covers(p,w)}}},{key:"centre",value:function(){return this.isNull()?null:new Gt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Gt){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof m){var l=arguments[0];this._minx=l._minx,this._maxx=l._maxx,this._miny=l._miny,this._maxy=l._maxy}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this.init(p.x,w.x,p.y,w.y)}else if(arguments.length===4){var D=arguments[0],B=arguments[1],Q=arguments[2],ht=arguments[3];D<B?(this._minx=D,this._maxx=B):(this._minx=B,this._maxx=D),Q<ht?(this._miny=Q,this._maxy=ht):(this._miny=ht,this._maxy=Q)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(s){if(this.intersects(s))return 0;var l=0;this._maxx<s._minx?l=s._minx-this._maxx:this._minx>s._maxx&&(l=this._minx-s._maxx);var p=0;return this._maxy<s._miny?p=s._miny-this._maxy:this._miny>s._maxy&&(p=this._miny-s._maxy),l===0?p:p===0?l:Math.sqrt(l*l+p*p)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*(s=37*(s=37*s+Gt.hashCode(this._minx))+Gt.hashCode(this._maxx))+Gt.hashCode(this._miny))+Gt.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[Mt,Ot]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Gt){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof m){var l=arguments[0];this.init(l)}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this.init(p.x,w.x,p.y,w.y)}else if(arguments.length===4){var D=arguments[0],B=arguments[1],Q=arguments[2],ht=arguments[3];this.init(D,B,Q,ht)}}},{key:"intersects",value:function(){if(arguments.length===3){var s=arguments[0],l=arguments[1],p=arguments[2];return p.x>=(s.x<l.x?s.x:l.x)&&p.x<=(s.x>l.x?s.x:l.x)&&p.y>=(s.y<l.y?s.y:l.y)&&p.y<=(s.y>l.y?s.y:l.y)}if(arguments.length===4){var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3],ht=Math.min(B.x,Q.x),vt=Math.max(B.x,Q.x),Yt=Math.min(w.x,D.x),ne=Math.max(w.x,D.x);return!(Yt>vt)&&!(ne<ht)&&(ht=Math.min(B.y,Q.y),vt=Math.max(B.y,Q.y),Yt=Math.min(w.y,D.y),ne=Math.max(w.y,D.y),!(Yt>vt)&&!(ne<ht))}}}])})(),Be=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===m.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(s){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(s){return this===s||this.equalsExact(s,0)}},{key:"geometryChanged",value:function(){this.apply(m.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(s){return s!==null&&this.norm().equalsExact(s.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var s;if(arguments.length===1){var l=arguments[0];return s=l,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(l)}if(arguments.length===2){var p=arguments[0],w=arguments[1];return s=p,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(p,w)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(s){if(s.getTypeCode()===m.TYPECODE_GEOMETRYCOLLECTION)throw new kt("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(s,l,p){return p===0?s.equals(l):s.distance(l)<=p}},{key:"norm",value:function(){var s=this.copy();return s.normalize(),s}},{key:"reverse",value:function(){var s=this.reverseInternal();return this.envelope!=null&&(s.envelope=this.envelope.copy()),s.setSRID(this.getSRID()),s}},{key:"copy",value:function(){var s=this.copyInternal();return s.envelope=this._envelope==null?null:this._envelope.copy(),s._SRID=this._SRID,s._userData=this._userData,s}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new sn(this._envelope)}},{key:"setSRID",value:function(s){this._SRID=s}},{key:"setUserData",value:function(s){this._userData=s}},{key:"compare",value:function(s,l){for(var p=s.iterator(),w=l.iterator();p.hasNext()&&w.hasNext();){var D=p.next(),B=w.next(),Q=D.compareTo(B);if(Q!==0)return Q}return p.hasNext()?1:w.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(s){return this.getClass()===s.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===m.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===m.TYPECODE_MULTIPOINT||this.getTypeCode()===m.TYPECODE_MULTILINESTRING||this.getTypeCode()===m.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Wt,Mt,Ot]}},{key:"getClass",value:function(){return m}}],[{key:"hasNonEmptyElements",value:function(s){for(var l=0;l<s.length;l++)if(!s[l].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(s){for(var l=0;l<s.length;l++)if(s[l]===null)return!0;return!1}}])})();Be.constructor_=function(m){m&&(this._envelope=null,this._userData=null,this._factory=m,this._SRID=m.getSRID())},Be.TYPECODE_POINT=0,Be.TYPECODE_MULTIPOINT=1,Be.TYPECODE_LINESTRING=2,Be.TYPECODE_LINEARRING=3,Be.TYPECODE_MULTILINESTRING=4,Be.TYPECODE_POLYGON=5,Be.TYPECODE_MULTIPOLYGON=6,Be.TYPECODE_GEOMETRYCOLLECTION=7,Be.TYPENAME_POINT="Point",Be.TYPENAME_MULTIPOINT="MultiPoint",Be.TYPENAME_LINESTRING="LineString",Be.TYPENAME_LINEARRING="LinearRing",Be.TYPENAME_MULTILINESTRING="MultiLineString",Be.TYPENAME_POLYGON="Polygon",Be.TYPENAME_MULTIPOLYGON="MultiPolygon",Be.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Be.geometryChangedFilter={get interfaces_(){return[jt]},filter:function(m){m.geometryChangedAction()}};var Dt=(function(){function m(){S(this,m)}return o(m,null,[{key:"toLocationSymbol",value:function(s){switch(s){case m.EXTERIOR:return"e";case m.BOUNDARY:return"b";case m.INTERIOR:return"i";case m.NONE:return"-"}throw new kt("Unknown location value: "+s)}}])})();Dt.INTERIOR=0,Dt.BOUNDARY=1,Dt.EXTERIOR=2,Dt.NONE=-1;var $n=(function(){return o((function m(){S(this,m)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),et=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({NoSuchElementException:s})[0],p}return V(s,m),o(s)})(Lt),fe=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({UnsupportedOperationException:s})[0],p}return V(s,m),o(s)})(Lt),de=(function(m){function s(){return S(this,s),E(this,s,arguments)}return V(s,m),o(s,[{key:"contains",value:function(){}}])})($n),Pt=(function(m){function s(l){var p;return S(this,s),(p=E(this,s)).map=new Map,l instanceof $n&&p.addAll(l),p}return V(s,m),o(s,[{key:"contains",value:function(l){var p=l.hashCode?l.hashCode():l;return!!this.map.has(p)}},{key:"add",value:function(l){var p=l.hashCode?l.hashCode():l;return!this.map.has(p)&&!!this.map.set(p,l)}},{key:"addAll",value:function(l){var p,w=N(l);try{for(w.s();!(p=w.n()).done;){var D=p.value;this.add(D)}}catch(B){w.e(B)}finally{w.f()}return!0}},{key:"remove",value:function(){throw new fe}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new bt(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(de),bt=(function(){return o((function m(s){S(this,m),this.iterator=s.values();var l=this.iterator.next(),p=l.done,w=l.value;this.done=p,this.value=w}),[{key:"next",value:function(){if(this.done)throw new et;var m=this.value,s=this.iterator.next(),l=s.done,p=s.value;return this.done=l,this.value=p,m}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new fe}}])})(),Tt=(function(){function m(){S(this,m)}return o(m,null,[{key:"opposite",value:function(s){return s===m.LEFT?m.RIGHT:s===m.RIGHT?m.LEFT:s}}])})();Tt.ON=0,Tt.LEFT=1,Tt.RIGHT=2;var Te=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({EmptyStackException:s})[0],p}return V(s,m),o(s)})(Lt),Ee=(function(m){function s(l){var p;return S(this,s),(p=E(this,s,[l])).name=Object.keys({IndexOutOfBoundsException:s})[0],p}return V(s,m),o(s)})(Lt),Qt=(function(m){function s(){return S(this,s),E(this,s,arguments)}return V(s,m),o(s,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})($n),Re=(function(m){function s(){var l;return S(this,s),(l=E(this,s)).array=[],l}return V(s,m),o(s,[{key:"add",value:function(l){return this.array.push(l),!0}},{key:"get",value:function(l){if(l<0||l>=this.size())throw new Ee;return this.array[l]}},{key:"push",value:function(l){return this.array.push(l),l}},{key:"pop",value:function(){if(this.array.length===0)throw new Te;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Te;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(l){return this.array.indexOf(l)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(Qt);function be(m,s){return m.interfaces_&&m.interfaces_.indexOf(s)>-1}var Ce=(function(){return o((function m(s){S(this,m),this.str=s}),[{key:"append",value:function(m){this.str+=m}},{key:"setCharAt",value:function(m,s){this.str=this.str.substr(0,m)+s+this.str.substr(m+1)}},{key:"toString",value:function(){return this.str}}])})(),Je=(function(){function m(s){S(this,m),this.value=s}return o(m,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(s){return this.value<s?-1:this.value>s?1:0}}],[{key:"compare",value:function(s,l){return s<l?-1:s>l?1:0}},{key:"isNan",value:function(s){return Number.isNaN(s)}},{key:"valueOf",value:function(s){return new m(s)}}])})(),kn=(function(){return o((function m(){S(this,m)}),null,[{key:"isWhitespace",value:function(m){return m<=32&&m>=0||m===127}},{key:"toUpperCase",value:function(m){return m.toUpperCase()}}])})(),Oe=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"le",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<=s._lo}},{key:"extractSignificantDigits",value:function(s,l){var p=this.abs(),w=m.magnitude(p._hi),D=m.TEN.pow(w);(p=p.divide(D)).gt(m.TEN)?(p=p.divide(m.TEN),w+=1):p.lt(m.ONE)&&(p=p.multiply(m.TEN),w-=1);for(var B=w+1,Q=new Ce,ht=m.MAX_PRINT_DIGITS-1,vt=0;vt<=ht;vt++){s&&vt===B&&Q.append(".");var Yt=Math.trunc(p._hi);if(Yt<0)break;var ne=!1,Se=0;Yt>9?(ne=!0,Se="9"):Se="0"+Yt,Q.append(Se),p=p.subtract(m.valueOf(Yt)).multiply(m.TEN),ne&&p.selfAdd(m.TEN);var Ve=!0,$e=m.magnitude(p._hi);if($e<0&&Math.abs($e)>=ht-vt&&(Ve=!1),!Ve)break}return l[0]=w,Q.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof m){var s=arguments[0];return this.add(s.negate())}if(typeof arguments[0]=="number"){var l=arguments[0];return this.add(-l)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof m){var s=arguments[0];return this._hi===s._hi&&this._lo===s._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof m){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s._hi,-s._lo)}if(typeof arguments[0]=="number"){var l=arguments[0];return this.isNaN()?this:this.selfAdd(-l,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(s){return this.le(s)?this:s}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof m){var s=arguments[0];return this.selfDivide(s._hi,s._lo)}if(typeof arguments[0]=="number"){var l=arguments[0];return this.selfDivide(l,0)}}else if(arguments.length===2){var p,w,D,B,Q=arguments[0],ht=arguments[1],vt=null,Yt=null,ne=null,Se=null;return D=this._hi/Q,Se=(vt=(ne=m.SPLIT*D)-(vt=ne-D))*(Yt=(Se=m.SPLIT*Q)-(Yt=Se-Q))-(B=D*Q)+vt*(w=Q-Yt)+(p=D-vt)*Yt+p*w,Se=D+(ne=(this._hi-B-Se+this._lo-D*ht)/Q),this._hi=Se,this._lo=D-Se+ne,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof m){var s,l,p,w,D=arguments[0],B=null,Q=null,ht=null,vt=null;return s=(p=this._hi/D._hi)-(B=(ht=m.SPLIT*p)-(B=ht-p)),vt=B*(Q=(vt=m.SPLIT*D._hi)-(Q=vt-D._hi))-(w=p*D._hi)+B*(l=D._hi-Q)+s*Q+s*l,new m(vt=p+(ht=(this._hi-w-vt+this._lo-p*D._lo)/D._hi),p-vt+ht)}if(typeof arguments[0]=="number"){var Yt=arguments[0];return _e.isNaN(Yt)?m.createNaN():m.copy(this).selfDivide(Yt,0)}}},{key:"ge",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>=s._lo}},{key:"pow",value:function(s){if(s===0)return m.valueOf(1);var l=new m(this),p=m.valueOf(1),w=Math.abs(s);if(w>1)for(;w>0;)w%2==1&&p.selfMultiply(l),(w/=2)>0&&(l=l.sqr());else p=l;return s<0?p.reciprocal():p}},{key:"ceil",value:function(){if(this.isNaN())return m.NaN;var s=Math.ceil(this._hi),l=0;return s===this._hi&&(l=Math.ceil(this._lo)),new m(s,l)}},{key:"compareTo",value:function(s){var l=s;return this._hi<l._hi?-1:this._hi>l._hi?1:this._lo<l._lo?-1:this._lo>l._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof m){var s=arguments[0];return this.init(s),this}if(typeof arguments[0]=="number"){var l=arguments[0];return this.init(l),this}}},{key:"max",value:function(s){return this.ge(s)?this:s}},{key:"sqrt",value:function(){if(this.isZero())return m.valueOf(0);if(this.isNegative())return m.NaN;var s=1/Math.sqrt(this._hi),l=this._hi*s,p=m.valueOf(l),w=this.subtract(p.sqr())._hi*(.5*s);return p.add(w)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof m){var s=arguments[0];return this.selfAdd(s._hi,s._lo)}if(typeof arguments[0]=="number"){var l,p,w,D,B,Q=arguments[0],ht=null;return ht=(w=this._hi+Q)-(D=w-this._hi),p=(B=(ht=Q-D+(this._hi-ht))+this._lo)+(w-(l=w+B)),this._hi=l+p,this._lo=p+(l-this._hi),this}}else if(arguments.length===2){var vt,Yt,ne,Se,Ve=arguments[0],$e=arguments[1],tn=null,fn=null,Sn=null;ne=this._hi+Ve,Yt=this._lo+$e,fn=ne-(Sn=ne-this._hi),tn=Yt-(Se=Yt-this._lo);var Bn=(vt=ne+(Sn=(fn=Ve-Sn+(this._hi-fn))+Yt))+(Sn=(tn=$e-Se+(this._lo-tn))+(Sn+(ne-vt))),wi=Sn+(vt-Bn);return this._hi=Bn,this._lo=wi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof m){var s=arguments[0];return this.selfMultiply(s._hi,s._lo)}if(typeof arguments[0]=="number"){var l=arguments[0];return this.selfMultiply(l,0)}}else if(arguments.length===2){var p,w,D=arguments[0],B=arguments[1],Q=null,ht=null,vt=null,Yt=null;Q=(vt=m.SPLIT*this._hi)-this._hi,Yt=m.SPLIT*D,Q=vt-Q,p=this._hi-Q,ht=Yt-D;var ne=(vt=this._hi*D)+(Yt=Q*(ht=Yt-ht)-vt+Q*(w=D-ht)+p*ht+p*w+(this._hi*B+this._lo*D)),Se=Yt+(Q=vt-ne);return this._hi=ne,this._lo=Se,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return m.NaN;var s=Math.floor(this._hi),l=0;return s===this._hi&&(l=Math.floor(this._lo)),new m(s,l)}},{key:"negate",value:function(){return this.isNaN()?this:new m(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return null;throw s}}},{key:"multiply",value:function(){if(arguments[0]instanceof m){var s=arguments[0];return s.isNaN()?m.createNaN():m.copy(this).selfMultiply(s)}if(typeof arguments[0]=="number"){var l=arguments[0];return _e.isNaN(l)?m.createNaN():m.copy(this).selfMultiply(l,0)}}},{key:"isNaN",value:function(){return _e.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var s=m.magnitude(this._hi);return s>=-3&&s<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var s=this.getSpecialNumberString();if(s!==null)return s;var l=new Array(1).fill(null),p=this.extractSignificantDigits(!0,l),w=l[0]+1,D=p;if(p.charAt(0)===".")D="0"+p;else if(w<0)D="0."+m.stringOfChar("0",-w)+p;else if(p.indexOf(".")===-1){var B=w-p.length;D=p+m.stringOfChar("0",B)+".0"}return this.isNegative()?"-"+D:D}},{key:"reciprocal",value:function(){var s,l,p,w,D=null,B=null,Q=null,ht=null;s=(p=1/this._hi)-(D=(Q=m.SPLIT*p)-(D=Q-p)),B=(ht=m.SPLIT*this._hi)-this._hi;var vt=p+(Q=(1-(w=p*this._hi)-(ht=D*(B=ht-B)-w+D*(l=this._hi-B)+s*B+s*l)-p*this._lo)/this._hi);return new m(vt,p-vt+Q)}},{key:"toSciNotation",value:function(){if(this.isZero())return m.SCI_NOT_ZERO;var s=this.getSpecialNumberString();if(s!==null)return s;var l=new Array(1).fill(null),p=this.extractSignificantDigits(!1,l),w=m.SCI_NOT_EXPONENT_CHAR+l[0];if(p.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+p);var D="";p.length>1&&(D=p.substring(1));var B=p.charAt(0)+"."+D;return this.isNegative()?"-"+B+w:B+w}},{key:"abs",value:function(){return this.isNaN()?m.NaN:this.isNegative()?this.negate():new m(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<s._lo}},{key:"add",value:function(){if(arguments[0]instanceof m){var s=arguments[0];return m.copy(this).selfAdd(s)}if(typeof arguments[0]=="number"){var l=arguments[0];return m.copy(this).selfAdd(l)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this._hi=s,this._lo=0}else if(arguments[0]instanceof m){var l=arguments[0];this._hi=l._hi,this._lo=l._lo}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this._hi=p,this._lo=w}}},{key:"gt",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>s._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?m.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[Ot,Mt,Wt]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this.init(s)}else if(arguments[0]instanceof m){var l=arguments[0];this.init(l)}else if(typeof arguments[0]=="string"){var p=arguments[0];m.constructor_.call(this,m.parse(p))}}else if(arguments.length===2){var w=arguments[0],D=arguments[1];this.init(w,D)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],l=arguments[1],p=arguments[2],w=arguments[3];return m.determinant(m.valueOf(s),m.valueOf(l),m.valueOf(p),m.valueOf(w))}if(arguments[3]instanceof m&&arguments[2]instanceof m&&arguments[0]instanceof m&&arguments[1]instanceof m){var D=arguments[1],B=arguments[2],Q=arguments[3];return arguments[0].multiply(Q).selfSubtract(D.multiply(B))}}},{key:"sqr",value:function(s){return m.valueOf(s).selfMultiply(s)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var s=arguments[0];return m.parse(s)}if(typeof arguments[0]=="number")return new m(arguments[0])}},{key:"sqrt",value:function(s){return m.valueOf(s).sqrt()}},{key:"parse",value:function(s){for(var l=0,p=s.length;kn.isWhitespace(s.charAt(l));)l++;var w=!1;if(l<p){var D=s.charAt(l);D!=="-"&&D!=="+"||(l++,D==="-"&&(w=!0))}for(var B=new m,Q=0,ht=0,vt=0,Yt=!1;!(l>=p);){var ne=s.charAt(l);if(l++,kn.isDigit(ne)){var Se=ne-"0";B.selfMultiply(m.TEN),B.selfAdd(Se),Q++}else{if(ne!=="."){if(ne==="e"||ne==="E"){var Ve=s.substring(l);try{vt=Je.parseInt(Ve)}catch(Bn){throw Bn instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Ve+" in string "+s):Bn}break}throw new NumberFormatException("Unexpected character '"+ne+"' at position "+l+" in string "+s)}ht=Q,Yt=!0}}var $e=B;Yt||(ht=Q);var tn=Q-ht-vt;if(tn===0)$e=B;else if(tn>0){var fn=m.TEN.pow(tn);$e=B.divide(fn)}else if(tn<0){var Sn=m.TEN.pow(-tn);$e=B.multiply(Sn)}return w?$e.negate():$e}},{key:"createNaN",value:function(){return new m(_e.NaN,_e.NaN)}},{key:"copy",value:function(s){return new m(s)}},{key:"magnitude",value:function(s){var l=Math.abs(s),p=Math.log(l)/Math.log(10),w=Math.trunc(Math.floor(p));return 10*Math.pow(10,w)<=l&&(w+=1),w}},{key:"stringOfChar",value:function(s,l){for(var p=new Ce,w=0;w<l;w++)p.append(s);return p.toString()}}])})();Oe.PI=new Oe(3.141592653589793,12246467991473532e-32),Oe.TWO_PI=new Oe(6.283185307179586,24492935982947064e-32),Oe.PI_2=new Oe(1.5707963267948966,6123233995736766e-32),Oe.E=new Oe(2.718281828459045,14456468917292502e-32),Oe.NaN=new Oe(_e.NaN,_e.NaN),Oe.EPS=123259516440783e-46,Oe.SPLIT=134217729,Oe.MAX_PRINT_DIGITS=32,Oe.TEN=Oe.valueOf(10),Oe.ONE=Oe.valueOf(1),Oe.SCI_NOT_EXPONENT_CHAR="E",Oe.SCI_NOT_ZERO="0.0E0";var li=(function(){function m(){S(this,m)}return o(m,null,[{key:"orientationIndex",value:function(s,l,p){var w=m.orientationIndexFilter(s,l,p);if(w<=1)return w;var D=Oe.valueOf(l.x).selfAdd(-s.x),B=Oe.valueOf(l.y).selfAdd(-s.y),Q=Oe.valueOf(p.x).selfAdd(-l.x),ht=Oe.valueOf(p.y).selfAdd(-l.y);return D.selfMultiply(ht).selfSubtract(B.selfMultiply(Q)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof Oe&&arguments[2]instanceof Oe&&arguments[0]instanceof Oe&&arguments[1]instanceof Oe){var s=arguments[1],l=arguments[2],p=arguments[3];return arguments[0].multiply(p).selfSubtract(s.multiply(l)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3],ht=Oe.valueOf(w),vt=Oe.valueOf(D),Yt=Oe.valueOf(B),ne=Oe.valueOf(Q);return ht.multiply(ne).selfSubtract(vt.multiply(Yt)).signum()}}},{key:"intersection",value:function(s,l,p,w){var D=new Oe(s.y).selfSubtract(l.y),B=new Oe(l.x).selfSubtract(s.x),Q=new Oe(s.x).selfMultiply(l.y).selfSubtract(new Oe(l.x).selfMultiply(s.y)),ht=new Oe(p.y).selfSubtract(w.y),vt=new Oe(w.x).selfSubtract(p.x),Yt=new Oe(p.x).selfMultiply(w.y).selfSubtract(new Oe(w.x).selfMultiply(p.y)),ne=B.multiply(Yt).selfSubtract(vt.multiply(Q)),Se=ht.multiply(Q).selfSubtract(D.multiply(Yt)),Ve=D.multiply(vt).selfSubtract(ht.multiply(B)),$e=ne.selfDivide(Ve).doubleValue(),tn=Se.selfDivide(Ve).doubleValue();return _e.isNaN($e)||_e.isInfinite($e)||_e.isNaN(tn)||_e.isInfinite(tn)?null:new Gt($e,tn)}},{key:"orientationIndexFilter",value:function(s,l,p){var w=null,D=(s.x-p.x)*(l.y-p.y),B=(s.y-p.y)*(l.x-p.x),Q=D-B;if(D>0){if(B<=0)return m.signum(Q);w=D+B}else{if(!(D<0)||B>=0)return m.signum(Q);w=-D-B}var ht=m.DP_SAFE_EPSILON*w;return Q>=ht||-Q>=ht?m.signum(Q):2}},{key:"signum",value:function(s){return s>0?1:s<0?-1:0}}])})();li.DP_SAFE_EPSILON=1e-15;var ln=(function(){return o((function m(){S(this,m)}),[{key:"getM",value:function(m){if(this.hasM()){var s=this.getDimension()-this.getMeasures();return this.getOrdinate(m,s)}return _e.NaN}},{key:"setOrdinate",value:function(m,s,l){}},{key:"getZ",value:function(m){return this.hasZ()?this.getOrdinate(m,2):_e.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(m,s){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(m){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(m){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(m){}},{key:"copy",value:function(){}},{key:"getY",value:function(m){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[Wt]}}])})();ln.X=0,ln.Y=1,ln.Z=2,ln.M=3;var Ye=(function(){function m(){S(this,m)}return o(m,null,[{key:"index",value:function(s,l,p){return li.orientationIndex(s,l,p)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var s=arguments[0],l=s.length-1;if(l<3)throw new kt("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=s[0],w=0,D=1;D<=l;D++){var B=s[D];B.y>p.y&&(p=B,w=D)}var Q=w;do(Q-=1)<0&&(Q=l);while(s[Q].equals2D(p)&&Q!==w);var ht=w;do ht=(ht+1)%l;while(s[ht].equals2D(p)&&ht!==w);var vt=s[Q],Yt=s[ht];if(vt.equals2D(p)||Yt.equals2D(p)||vt.equals2D(Yt))return!1;var ne=m.index(vt,p,Yt);return ne===0?vt.x>Yt.x:ne>0}if(be(arguments[0],ln)){var Se=arguments[0],Ve=Se.size()-1;if(Ve<3)throw new kt("Ring has fewer than 4 points, so orientation cannot be determined");for(var $e=Se.getCoordinate(0),tn=0,fn=1;fn<=Ve;fn++){var Sn=Se.getCoordinate(fn);Sn.y>$e.y&&($e=Sn,tn=fn)}var Bn=null,wi=tn;do(wi-=1)<0&&(wi=Ve),Bn=Se.getCoordinate(wi);while(Bn.equals2D($e)&&wi!==tn);var ni=null,Hr=tn;do Hr=(Hr+1)%Ve,ni=Se.getCoordinate(Hr);while(ni.equals2D($e)&&Hr!==tn);if(Bn.equals2D($e)||ni.equals2D($e)||Bn.equals2D(ni))return!1;var ys=m.index(Bn,$e,ni);return ys===0?Bn.x>ni.x:ys>0}}}])})();Ye.CLOCKWISE=-1,Ye.RIGHT=Ye.CLOCKWISE,Ye.COUNTERCLOCKWISE=1,Ye.LEFT=Ye.COUNTERCLOCKWISE,Ye.COLLINEAR=0,Ye.STRAIGHT=Ye.COLLINEAR;var ar=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(m,s){var l=this.getRightmostSideOfSegment(m,s);return l<0&&(l=this.getRightmostSideOfSegment(m,s-1)),l<0&&(this._minCoord=null,this.checkForRightmostCoordinate(m)),l}},{key:"findRightmostEdgeAtVertex",value:function(){var m=this._minDe.getEdge().getCoordinates();ye.isTrue(this._minIndex>0&&this._minIndex<m.length,"rightmost point expected to be interior vertex of edge");var s=m[this._minIndex-1],l=m[this._minIndex+1],p=Ye.index(this._minCoord,l,s),w=!1;(s.y<this._minCoord.y&&l.y<this._minCoord.y&&p===Ye.COUNTERCLOCKWISE||s.y>this._minCoord.y&&l.y>this._minCoord.y&&p===Ye.CLOCKWISE)&&(w=!0),w&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(m,s){var l=m.getEdge().getCoordinates();if(s<0||s+1>=l.length||l[s].y===l[s+1].y)return-1;var p=Tt.LEFT;return l[s].y<l[s+1].y&&(p=Tt.RIGHT),p}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(m){for(var s=m.getEdge().getCoordinates(),l=0;l<s.length-1;l++)(this._minCoord===null||s[l].x>this._minCoord.x)&&(this._minDe=m,this._minIndex=l,this._minCoord=s[l])}},{key:"findRightmostEdgeAtNode",value:function(){var m=this._minDe.getNode().getEdges();this._minDe=m.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(m){for(var s=m.iterator();s.hasNext();){var l=s.next();l.isForward()&&this.checkForRightmostCoordinate(l)}ye.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Tt.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),yn=(function(m){function s(l,p){var w;return S(this,s),(w=E(this,s,[p?l+" [ "+p+" ]":l])).pt=p?new Gt(p):void 0,w.name=Object.keys({TopologyException:s})[0],w}return V(s,m),o(s,[{key:"getCoordinate",value:function(){return this.pt}}])})(Xt),Mi=(function(){return o((function m(){S(this,m),this.array=[]}),[{key:"addLast",value:function(m){this.array.push(m)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),wt=(function(m){function s(l){var p;return S(this,s),(p=E(this,s)).array=[],l instanceof $n&&p.addAll(l),p}return V(s,m),o(s,[{key:"interfaces_",get:function(){return[Qt,$n]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(l){return arguments.length===1?this.array.push(l):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(l){var p,w=N(l);try{for(w.s();!(p=w.n()).done;){var D=p.value;this.array.push(D)}}catch(B){w.e(B)}finally{w.f()}}},{key:"set",value:function(l,p){var w=this.array[l];return this.array[l]=p,w}},{key:"iterator",value:function(){return new nt(this)}},{key:"get",value:function(l){if(l<0||l>=this.size())throw new Ee;return this.array[l]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(l){l?this.array.sort((function(p,w){return l.compare(p,w)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(l){for(var p=0,w=this.array.length;p<w;p++)if(this.array[p]===l)return!!this.array.splice(p,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(Qt),nt=(function(){return o((function m(s){S(this,m),this.arrayList=s,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new et;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(m){return this.arrayList.set(this.position-1,m)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),st=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var m=this._dirEdgeList.iterator();m.hasNext();)m.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(m){for(var s=null,l=m.getEdges().iterator();l.hasNext();){var p=l.next();if(p.isVisited()||p.getSym().isVisited()){s=p;break}}if(s===null)throw new yn("unable to find edge to compute depths at "+m.getCoordinate());m.getEdges().computeDepths(s);for(var w=m.getEdges().iterator();w.hasNext();){var D=w.next();D.setVisited(!0),this.copySymDepths(D)}}},{key:"computeDepth",value:function(m){this.clearVisitedEdges();var s=this._finder.getEdge();s.getNode(),s.getLabel(),s.setEdgeDepths(Tt.RIGHT,m),this.copySymDepths(s),this.computeDepths(s)}},{key:"create",value:function(m){this.addReachable(m),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var m=this._dirEdgeList.iterator();m.hasNext();){var s=m.next();s.getDepth(Tt.RIGHT)>=1&&s.getDepth(Tt.LEFT)<=0&&!s.isInteriorAreaEdge()&&s.setInResult(!0)}}},{key:"computeDepths",value:function(m){var s=new Pt,l=new Mi,p=m.getNode();for(l.addLast(p),s.add(p),m.setVisited(!0);!l.isEmpty();){var w=l.removeFirst();s.add(w),this.computeNodeDepth(w);for(var D=w.getEdges().iterator();D.hasNext();){var B=D.next().getSym();if(!B.isVisited()){var Q=B.getNode();s.contains(Q)||(l.addLast(Q),s.add(Q))}}}}},{key:"compareTo",value:function(m){var s=m;return this._rightMostCoord.x<s._rightMostCoord.x?-1:this._rightMostCoord.x>s._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var m=new sn,s=this._dirEdgeList.iterator();s.hasNext();)for(var l=s.next().getEdge().getCoordinates(),p=0;p<l.length-1;p++)m.expandToInclude(l[p]);this._env=m}return this._env}},{key:"addReachable",value:function(m){var s=new Re;for(s.add(m);!s.empty();){var l=s.pop();this.add(l,s)}}},{key:"copySymDepths",value:function(m){var s=m.getSym();s.setDepth(Tt.LEFT,m.getDepth(Tt.RIGHT)),s.setDepth(Tt.RIGHT,m.getDepth(Tt.LEFT))}},{key:"add",value:function(m,s){m.setVisited(!0),this._nodes.add(m);for(var l=m.getEdges().iterator();l.hasNext();){var p=l.next();this._dirEdgeList.add(p);var w=p.getSym().getNode();w.isVisited()||s.push(w)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new wt,this._nodes=new wt,this._rightMostCoord=null,this._env=null,this._finder=new ar}}])})(),lt=(function(){return o((function m(){S(this,m)}),null,[{key:"intersection",value:function(m,s,l,p){var w=m.x<s.x?m.x:s.x,D=m.y<s.y?m.y:s.y,B=m.x>s.x?m.x:s.x,Q=m.y>s.y?m.y:s.y,ht=l.x<p.x?l.x:p.x,vt=l.y<p.y?l.y:p.y,Yt=l.x>p.x?l.x:p.x,ne=l.y>p.y?l.y:p.y,Se=((w>ht?w:ht)+(B<Yt?B:Yt))/2,Ve=((D>vt?D:vt)+(Q<ne?Q:ne))/2,$e=m.x-Se,tn=m.y-Ve,fn=s.x-Se,Sn=s.y-Ve,Bn=l.x-Se,wi=l.y-Ve,ni=p.x-Se,Hr=p.y-Ve,ys=tn-Sn,Ks=fn-$e,ya=$e*Sn-fn*tn,Eo=wi-Hr,Ps=ni-Bn,Cs=Bn*Hr-ni*wi,ko=ys*Ps-Eo*Ks,va=(Ks*Cs-Ps*ya)/ko,gn=(Eo*ya-ys*Cs)/ko;return _e.isNaN(va)||_e.isInfinite(va)||_e.isNaN(gn)||_e.isInfinite(gn)?null:new Gt(va+Se,gn+Ve)}}])})(),xt=(function(){return o((function m(){S(this,m)}),null,[{key:"arraycopy",value:function(m,s,l,p,w){for(var D=0,B=s;B<s+w;B++)l[p+D]=m[B],D++}},{key:"getProperty",value:function(m){return{"line.separator":`
`}[m]}}])})(),Rt=(function(){function m(){S(this,m)}return o(m,null,[{key:"log10",value:function(s){var l=Math.log(s);return _e.isInfinite(l)||_e.isNaN(l)?l:l/m.LOG_10}},{key:"min",value:function(s,l,p,w){var D=s;return l<D&&(D=l),p<D&&(D=p),w<D&&(D=w),D}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],l=arguments[1],p=arguments[2];return s<l?l:s>p?p:s}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var w=arguments[0],D=arguments[1],B=arguments[2];return w<D?D:w>B?B:w}}},{key:"wrap",value:function(s,l){return s<0?l- -s%l:s%l}},{key:"max",value:function(){if(arguments.length===3){var s=arguments[1],l=arguments[2],p=arguments[0];return s>p&&(p=s),l>p&&(p=l),p}if(arguments.length===4){var w=arguments[1],D=arguments[2],B=arguments[3],Q=arguments[0];return w>Q&&(Q=w),D>Q&&(Q=D),B>Q&&(Q=B),Q}}},{key:"average",value:function(s,l){return(s+l)/2}}])})();Rt.LOG_10=Math.log(10);var $t=(function(){function m(){S(this,m)}return o(m,null,[{key:"segmentToSegment",value:function(s,l,p,w){if(s.equals(l))return m.pointToSegment(s,p,w);if(p.equals(w))return m.pointToSegment(w,s,l);var D=!1;if(sn.intersects(s,l,p,w)){var B=(l.x-s.x)*(w.y-p.y)-(l.y-s.y)*(w.x-p.x);if(B===0)D=!0;else{var Q=(s.y-p.y)*(w.x-p.x)-(s.x-p.x)*(w.y-p.y),ht=((s.y-p.y)*(l.x-s.x)-(s.x-p.x)*(l.y-s.y))/B,vt=Q/B;(vt<0||vt>1||ht<0||ht>1)&&(D=!0)}}else D=!0;return D?Rt.min(m.pointToSegment(s,p,w),m.pointToSegment(l,p,w),m.pointToSegment(p,s,l),m.pointToSegment(w,s,l)):0}},{key:"pointToSegment",value:function(s,l,p){if(l.x===p.x&&l.y===p.y)return s.distance(l);var w=(p.x-l.x)*(p.x-l.x)+(p.y-l.y)*(p.y-l.y),D=((s.x-l.x)*(p.x-l.x)+(s.y-l.y)*(p.y-l.y))/w;if(D<=0)return s.distance(l);if(D>=1)return s.distance(p);var B=((l.y-s.y)*(p.x-l.x)-(l.x-s.x)*(p.y-l.y))/w;return Math.abs(B)*Math.sqrt(w)}},{key:"pointToLinePerpendicular",value:function(s,l,p){var w=(p.x-l.x)*(p.x-l.x)+(p.y-l.y)*(p.y-l.y),D=((l.y-s.y)*(p.x-l.x)-(l.x-s.x)*(p.y-l.y))/w;return Math.abs(D)*Math.sqrt(w)}},{key:"pointToSegmentString",value:function(s,l){if(l.length===0)throw new kt("Line array must contain at least one vertex");for(var p=s.distance(l[0]),w=0;w<l.length-1;w++){var D=m.pointToSegment(s,l[w],l[w+1]);D<p&&(p=D)}return p}}])})(),pt=(function(){return o((function m(){S(this,m)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||be(arguments[0],ln);else if(arguments.length!==2){if(arguments.length===3){var m=arguments[0],s=arguments[1];return this.create(m,s)}}}}])})(),Ut=(function(){return o((function m(){S(this,m)}),[{key:"filter",value:function(m){}}])})(),le=(function(){return o((function m(){S(this,m)}),null,[{key:"ofLine",value:function(m){var s=m.size();if(s<=1)return 0;var l=0,p=new Gt;m.getCoordinate(0,p);for(var w=p.x,D=p.y,B=1;B<s;B++){m.getCoordinate(B,p);var Q=p.x,ht=p.y,vt=Q-w,Yt=ht-D;l+=Math.sqrt(vt*vt+Yt*Yt),w=Q,D=ht}return l}}])})(),ue=o((function m(){S(this,m)})),ce=(function(){function m(){S(this,m)}return o(m,null,[{key:"copyCoord",value:function(s,l,p,w){for(var D=Math.min(s.getDimension(),p.getDimension()),B=0;B<D;B++)p.setOrdinate(w,B,s.getOrdinate(l,B))}},{key:"isRing",value:function(s){var l=s.size();return l===0||!(l<=3)&&s.getOrdinate(0,ln.X)===s.getOrdinate(l-1,ln.X)&&s.getOrdinate(0,ln.Y)===s.getOrdinate(l-1,ln.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(be(arguments[0],ln)&&Number.isInteger(arguments[1])){var s=arguments[0],l=arguments[1];m.scroll(s,l,m.isRing(s))}else if(be(arguments[0],ln)&&arguments[1]instanceof Gt){var p=arguments[0],w=arguments[1],D=m.indexOf(w,p);if(D<=0)return null;m.scroll(p,D)}}else if(arguments.length===3){var B=arguments[0],Q=arguments[1],ht=arguments[2];if(Q<=0)return null;for(var vt=B.copy(),Yt=ht?B.size()-1:B.size(),ne=0;ne<Yt;ne++)for(var Se=0;Se<B.getDimension();Se++)B.setOrdinate(ne,Se,vt.getOrdinate((Q+ne)%Yt,Se));if(ht)for(var Ve=0;Ve<B.getDimension();Ve++)B.setOrdinate(Yt,Ve,B.getOrdinate(0,Ve))}}},{key:"isEqual",value:function(s,l){var p=s.size();if(p!==l.size())return!1;for(var w=Math.min(s.getDimension(),l.getDimension()),D=0;D<p;D++)for(var B=0;B<w;B++){var Q=s.getOrdinate(D,B),ht=l.getOrdinate(D,B);if(s.getOrdinate(D,B)!==l.getOrdinate(D,B)&&(!_e.isNaN(Q)||!_e.isNaN(ht)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var s=arguments[0];return m.minCoordinateIndex(s,0,s.size()-1)}if(arguments.length===3){for(var l=arguments[0],p=arguments[2],w=-1,D=null,B=arguments[1];B<=p;B++){var Q=l.getCoordinate(B);(D===null||D.compareTo(Q)>0)&&(D=Q,w=B)}return w}}},{key:"extend",value:function(s,l,p){var w=s.create(p,l.getDimension()),D=l.size();if(m.copy(l,0,w,0,D),D>0)for(var B=D;B<p;B++)m.copy(l,D-1,w,B,1);return w}},{key:"reverse",value:function(s){for(var l=s.size()-1,p=Math.trunc(l/2),w=0;w<=p;w++)m.swap(s,w,l-w)}},{key:"swap",value:function(s,l,p){if(l===p)return null;for(var w=0;w<s.getDimension();w++){var D=s.getOrdinate(l,w);s.setOrdinate(l,w,s.getOrdinate(p,w)),s.setOrdinate(p,w,D)}}},{key:"copy",value:function(s,l,p,w,D){for(var B=0;B<D;B++)m.copyCoord(s,l+B,p,w+B)}},{key:"ensureValidRing",value:function(s,l){var p=l.size();return p===0?l:p<=3?m.createClosedRing(s,l,4):l.getOrdinate(0,ln.X)===l.getOrdinate(p-1,ln.X)&&l.getOrdinate(0,ln.Y)===l.getOrdinate(p-1,ln.Y)?l:m.createClosedRing(s,l,p+1)}},{key:"indexOf",value:function(s,l){for(var p=0;p<l.size();p++)if(s.x===l.getOrdinate(p,ln.X)&&s.y===l.getOrdinate(p,ln.Y))return p;return-1}},{key:"createClosedRing",value:function(s,l,p){var w=s.create(p,l.getDimension()),D=l.size();m.copy(l,0,w,0,D);for(var B=D;B<p;B++)m.copy(l,0,w,B,1);return w}},{key:"minCoordinate",value:function(s){for(var l=null,p=0;p<s.size();p++){var w=s.getCoordinate(p);(l===null||l.compareTo(w)>0)&&(l=w)}return l}}])})(),se=(function(){function m(){S(this,m)}return o(m,null,[{key:"toDimensionSymbol",value:function(s){switch(s){case m.FALSE:return m.SYM_FALSE;case m.TRUE:return m.SYM_TRUE;case m.DONTCARE:return m.SYM_DONTCARE;case m.P:return m.SYM_P;case m.L:return m.SYM_L;case m.A:return m.SYM_A}throw new kt("Unknown dimension value: "+s)}},{key:"toDimensionValue",value:function(s){switch(kn.toUpperCase(s)){case m.SYM_FALSE:return m.FALSE;case m.SYM_TRUE:return m.TRUE;case m.SYM_DONTCARE:return m.DONTCARE;case m.SYM_P:return m.P;case m.SYM_L:return m.L;case m.SYM_A:return m.A}throw new kt("Unknown dimension symbol: "+s)}}])})();se.P=0,se.L=1,se.A=2,se.FALSE=-1,se.TRUE=-2,se.DONTCARE=-3,se.SYM_FALSE="F",se.SYM_TRUE="T",se.SYM_DONTCARE="*",se.SYM_P="0",se.SYM_L="1",se.SYM_A="2";var Xe=(function(){return o((function m(){S(this,m)}),[{key:"filter",value:function(m){}}])})(),an=(function(){return o((function m(){S(this,m)}),[{key:"filter",value:function(m,s){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),jn=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new sn:this._points.expandEnvelope(new sn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new s(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];if(!this.isEquivalentClass(l))return!1;var w=l;if(this._points.size()!==w._points.size())return!1;for(var D=0;D<this._points.size();D++)if(!this.equal(this._points.getCoordinate(D),w._points.getCoordinate(D),p))return!1;return!0}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var l=0;l<Math.trunc(this._points.size()/2);l++){var p=this._points.size()-1-l;if(!this._points.getCoordinate(l).equals(this._points.getCoordinate(p))){if(this._points.getCoordinate(l).compareTo(this._points.getCoordinate(p))>0){var w=this._points.copy();ce.reverse(w),this._points=w}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?se.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var l=this._points.copy();return ce.reverse(l),this.getFactory().createLineString(l)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Be.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return le.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var l=arguments[0],p=0,w=0;p<this._points.size()&&w<l._points.size();){var D=this._points.getCoordinate(p).compareTo(l._points.getCoordinate(w));if(D!==0)return D;p++,w++}return p<this._points.size()?1:w<l._points.size()?-1:0}if(arguments.length===2){var B=arguments[0];return arguments[1].compare(this._points,B._points)}}},{key:"apply",value:function(){if(be(arguments[0],Ut))for(var l=arguments[0],p=0;p<this._points.size();p++)l.filter(this._points.getCoordinate(p));else if(be(arguments[0],an)){var w=arguments[0];if(this._points.size()===0)return null;for(var D=0;D<this._points.size()&&(w.filter(this._points,D),!w.isDone());D++);w.isGeometryChanged()&&this.geometryChanged()}else be(arguments[0],Xe)?arguments[0].filter(this):be(arguments[0],jt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new fe}},{key:"isEquivalentClass",value:function(l){return l instanceof s}},{key:"getCoordinateN",value:function(l){return this._points.getCoordinate(l)}},{key:"getGeometryType",value:function(){return Be.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(l){if(l===null&&(l=this.getFactory().getCoordinateSequenceFactory().create([])),l.size()===1)throw new kt("Invalid number of points in LineString (found "+l.size()+" - must be 0 or >= 2)");this._points=l}},{key:"isCoordinate",value:function(l){for(var p=0;p<this._points.size();p++)if(this._points.getCoordinate(p).equals(l))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(l){return this.getFactory().createPoint(this._points.getCoordinate(l))}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var l=arguments[0],p=arguments[1];Be.constructor_.call(this,p),this.init(l)}}}}])})(Be),vn=o((function m(){S(this,m)})),En=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new sn;var l=new sn;return l.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),l}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new s(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];return!!this.isEquivalentClass(l)&&(!(!this.isEmpty()||!l.isEmpty())||this.isEmpty()===l.isEmpty()&&this.equal(l.getCoordinate(),this.getCoordinate(),p))}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return se.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Be.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var l=arguments[0];return this.getCoordinate().compareTo(l.getCoordinate())}if(arguments.length===2){var p=arguments[0];return arguments[1].compare(this._coordinates,p._coordinates)}}},{key:"apply",value:function(){if(be(arguments[0],Ut)){var l=arguments[0];if(this.isEmpty())return null;l.filter(this.getCoordinate())}else if(be(arguments[0],an)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this._coordinates,0),p.isGeometryChanged()&&this.geometryChanged()}else be(arguments[0],Xe)?arguments[0].filter(this):be(arguments[0],jt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Be.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(l){l===null&&(l=this.getFactory().getCoordinateSequenceFactory().create([])),ye.isTrue(l.size()<=1),this._coordinates=l}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[vn]}}],[{key:"constructor_",value:function(){this._coordinates=null;var l=arguments[0],p=arguments[1];Be.constructor_.call(this,p),this.init(l)}}])})(Be),zn=(function(){function m(){S(this,m)}return o(m,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];return Math.abs(m.ofRingSigned(s))}if(be(arguments[0],ln)){var l=arguments[0];return Math.abs(m.ofRingSigned(l))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];if(s.length<3)return 0;for(var l=0,p=s[0].x,w=1;w<s.length-1;w++){var D=s[w].x-p,B=s[w+1].y;l+=D*(s[w-1].y-B)}return l/2}if(be(arguments[0],ln)){var Q=arguments[0],ht=Q.size();if(ht<3)return 0;var vt=new Gt,Yt=new Gt,ne=new Gt;Q.getCoordinate(0,Yt),Q.getCoordinate(1,ne);var Se=Yt.x;ne.x-=Se;for(var Ve=0,$e=1;$e<ht-1;$e++)vt.y=Yt.y,Yt.x=ne.x,Yt.y=ne.y,Q.getCoordinate($e+1,ne),ne.x-=Se,Ve+=Yt.x*(vt.y-ne.y);return Ve/2}}}])})(),we=(function(){return o((function m(){S(this,m)}),null,[{key:"sort",value:function(){var m=arguments,s=arguments[0];if(arguments.length===1)s.sort((function(Se,Ve){return Se.compareTo(Ve)}));else if(arguments.length===2)s.sort((function(Se,Ve){return m[1].compare(Se,Ve)}));else if(arguments.length===3){var l=s.slice(arguments[1],arguments[2]);l.sort();var p=s.slice(0,arguments[1]).concat(l,s.slice(arguments[2],s.length));s.splice(0,s.length);var w,D=N(p);try{for(D.s();!(w=D.n()).done;){var B=w.value;s.push(B)}}catch(Se){D.e(Se)}finally{D.f()}}else if(arguments.length===4){var Q=s.slice(arguments[1],arguments[2]);Q.sort((function(Se,Ve){return m[3].compare(Se,Ve)}));var ht=s.slice(0,arguments[1]).concat(Q,s.slice(arguments[2],s.length));s.splice(0,s.length);var vt,Yt=N(ht);try{for(Yt.s();!(vt=Yt.n()).done;){var ne=vt.value;s.push(ne)}}catch(Se){Yt.e(Se)}finally{Yt.f()}}}},{key:"asList",value:function(m){var s,l=new wt,p=N(m);try{for(p.s();!(s=p.n()).done;){var w=s.value;l.add(w)}}catch(D){p.e(D)}finally{p.f()}return l}},{key:"copyOf",value:function(m,s){return m.slice(0,s)}}])})(),Gn=o((function m(){S(this,m)})),An=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var l=new Array(this.getNumPoints()).fill(null),p=-1,w=this._shell.getCoordinates(),D=0;D<w.length;D++)l[++p]=w[D];for(var B=0;B<this._holes.length;B++)for(var Q=this._holes[B].getCoordinates(),ht=0;ht<Q.length;ht++)l[++p]=Q[ht];return l}},{key:"getArea",value:function(){var l=0;l+=zn.ofRing(this._shell.getCoordinateSequence());for(var p=0;p<this._holes.length;p++)l-=zn.ofRing(this._holes[p].getCoordinateSequence());return l}},{key:"copyInternal",value:function(){for(var l=this._shell.copy(),p=new Array(this._holes.length).fill(null),w=0;w<this._holes.length;w++)p[w]=this._holes[w].copy();return new s(l,p,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var l=this._shell.getCoordinateSequence(),p=this.getEnvelopeInternal(),w=0;w<5;w++){var D=l.getX(w);if(D!==p.getMinX()&&D!==p.getMaxX())return!1;var B=l.getY(w);if(B!==p.getMinY()&&B!==p.getMaxY())return!1}for(var Q=l.getX(0),ht=l.getY(0),vt=1;vt<=4;vt++){var Yt=l.getX(vt),ne=l.getY(vt);if(Yt!==Q==(ne!==ht))return!1;Q=Yt,ht=ne}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];if(!this.isEquivalentClass(l))return!1;var w=l,D=this._shell,B=w._shell;if(!D.equalsExact(B,p)||this._holes.length!==w._holes.length)return!1;for(var Q=0;Q<this._holes.length;Q++)if(!this._holes[Q].equalsExact(w._holes[Q],p))return!1;return!0}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var l=0;l<this._holes.length;l++)this._holes[l]=this.normalized(this._holes[l],!1);we.sort(this._holes)}else if(arguments.length===2){var p=arguments[0],w=arguments[1];if(p.isEmpty())return null;var D=p.getCoordinateSequence(),B=ce.minCoordinateIndex(D,0,D.size()-2);ce.scroll(D,B,!0),Ye.isCCW(D)===w&&ce.reverse(D)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var l=this.getExteriorRing().reverse(),p=new Array(this.getNumInteriorRing()).fill(null),w=0;w<p.length;w++)p[w]=this.getInteriorRingN(w).reverse();return this.getFactory().createPolygon(l,p)}},{key:"getTypeCode",value:function(){return Be.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var l=0;l+=this._shell.getLength();for(var p=0;p<this._holes.length;p++)l+=this._holes[p].getLength();return l}},{key:"getNumPoints",value:function(){for(var l=this._shell.getNumPoints(),p=0;p<this._holes.length;p++)l+=this._holes[p].getNumPoints();return l}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(l,p){var w=l.copy();return this.normalize(w,p),w}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var l=arguments[0],p=this._shell,w=l._shell;return p.compareToSameClass(w)}if(arguments.length===2){var D=arguments[1],B=arguments[0],Q=this._shell,ht=B._shell,vt=Q.compareToSameClass(ht,D);if(vt!==0)return vt;for(var Yt=this.getNumInteriorRing(),ne=B.getNumInteriorRing(),Se=0;Se<Yt&&Se<ne;){var Ve=this.getInteriorRingN(Se),$e=B.getInteriorRingN(Se),tn=Ve.compareToSameClass($e,D);if(tn!==0)return tn;Se++}return Se<Yt?1:Se<ne?-1:0}}},{key:"apply",value:function(){if(be(arguments[0],Ut)){var l=arguments[0];this._shell.apply(l);for(var p=0;p<this._holes.length;p++)this._holes[p].apply(l)}else if(be(arguments[0],an)){var w=arguments[0];if(this._shell.apply(w),!w.isDone())for(var D=0;D<this._holes.length&&(this._holes[D].apply(w),!w.isDone());D++);w.isGeometryChanged()&&this.geometryChanged()}else if(be(arguments[0],Xe))arguments[0].filter(this);else if(be(arguments[0],jt)){var B=arguments[0];B.filter(this),this._shell.apply(B);for(var Q=0;Q<this._holes.length;Q++)this._holes[Q].apply(B)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var l=new Array(this._holes.length+1).fill(null);l[0]=this._shell;for(var p=0;p<this._holes.length;p++)l[p+1]=this._holes[p];return l.length<=1?this.getFactory().createLinearRing(l[0].getCoordinateSequence()):this.getFactory().createMultiLineString(l)}},{key:"getGeometryType",value:function(){return Be.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(l){return this._holes[l]}},{key:"interfaces_",get:function(){return[Gn]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var l=arguments[0],p=arguments[1],w=arguments[2];if(Be.constructor_.call(this,w),l===null&&(l=this.getFactory().createLinearRing()),p===null&&(p=[]),Be.hasNullElements(p))throw new kt("holes must not contain null elements");if(l.isEmpty()&&Be.hasNonEmptyElements(p))throw new kt("shell is empty but holes are not");this._shell=l,this._holes=p}}])})(Be),di=(function(m){function s(){return S(this,s),E(this,s,arguments)}return V(s,m),o(s)})(de),Nn=(function(m){function s(l){var p;return S(this,s),(p=E(this,s)).array=[],l instanceof $n&&p.addAll(l),p}return V(s,m),o(s,[{key:"contains",value:function(l){var p,w=N(this.array);try{for(w.s();!(p=w.n()).done;)if(p.value.compareTo(l)===0)return!0}catch(D){w.e(D)}finally{w.f()}return!1}},{key:"add",value:function(l){if(this.contains(l))return!1;for(var p=0,w=this.array.length;p<w;p++)if(this.array[p].compareTo(l)===1)return!!this.array.splice(p,0,l);return this.array.push(l),!0}},{key:"addAll",value:function(l){var p,w=N(l);try{for(w.s();!(p=w.n()).done;){var D=p.value;this.add(D)}}catch(B){w.e(B)}finally{w.f()}return!0}},{key:"remove",value:function(){throw new fe}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new ke(this.array)}}])})(di),ke=(function(){return o((function m(s){S(this,m),this.array=s,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new et;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new fe}}])})(),je=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"computeEnvelopeInternal",value:function(){for(var l=new sn,p=0;p<this._geometries.length;p++)l.expandToInclude(this._geometries[p].getEnvelopeInternal());return l}},{key:"getGeometryN",value:function(l){return this._geometries[l]}},{key:"getCoordinates",value:function(){for(var l=new Array(this.getNumPoints()).fill(null),p=-1,w=0;w<this._geometries.length;w++)for(var D=this._geometries[w].getCoordinates(),B=0;B<D.length;B++)l[++p]=D[B];return l}},{key:"getArea",value:function(){for(var l=0,p=0;p<this._geometries.length;p++)l+=this._geometries[p].getArea();return l}},{key:"copyInternal",value:function(){for(var l=new Array(this._geometries.length).fill(null),p=0;p<l.length;p++)l[p]=this._geometries[p].copy();return new s(l,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];if(!this.isEquivalentClass(l))return!1;var w=l;if(this._geometries.length!==w._geometries.length)return!1;for(var D=0;D<this._geometries.length;D++)if(!this._geometries[D].equalsExact(w._geometries[D],p))return!1;return!0}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var l=0;l<this._geometries.length;l++)this._geometries[l].normalize();we.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var l=se.FALSE,p=0;p<this._geometries.length;p++)l=Math.max(l,this._geometries[p].getBoundaryDimension());return l}},{key:"reverseInternal",value:function(){for(var l=this._geometries.length,p=new wt(l),w=0;w<l;w++)p.add(this._geometries[w].reverse());return this.getFactory().buildGeometry(p)}},{key:"getTypeCode",value:function(){return Be.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var l=se.FALSE,p=0;p<this._geometries.length;p++)l=Math.max(l,this._geometries[p].getDimension());return l}},{key:"getLength",value:function(){for(var l=0,p=0;p<this._geometries.length;p++)l+=this._geometries[p].getLength();return l}},{key:"getNumPoints",value:function(){for(var l=0,p=0;p<this._geometries.length;p++)l+=this._geometries[p].getNumPoints();return l}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var l=arguments[0],p=new Nn(we.asList(this._geometries)),w=new Nn(we.asList(l._geometries));return this.compare(p,w)}if(arguments.length===2){for(var D=arguments[1],B=arguments[0],Q=this.getNumGeometries(),ht=B.getNumGeometries(),vt=0;vt<Q&&vt<ht;){var Yt=this.getGeometryN(vt),ne=B.getGeometryN(vt),Se=Yt.compareToSameClass(ne,D);if(Se!==0)return Se;vt++}return vt<Q?1:vt<ht?-1:0}}},{key:"apply",value:function(){if(be(arguments[0],Ut))for(var l=arguments[0],p=0;p<this._geometries.length;p++)this._geometries[p].apply(l);else if(be(arguments[0],an)){var w=arguments[0];if(this._geometries.length===0)return null;for(var D=0;D<this._geometries.length&&(this._geometries[D].apply(w),!w.isDone());D++);w.isGeometryChanged()&&this.geometryChanged()}else if(be(arguments[0],Xe)){var B=arguments[0];B.filter(this);for(var Q=0;Q<this._geometries.length;Q++)this._geometries[Q].apply(B)}else if(be(arguments[0],jt)){var ht=arguments[0];ht.filter(this);for(var vt=0;vt<this._geometries.length;vt++)this._geometries[vt].apply(ht)}}},{key:"getBoundary",value:function(){return Be.checkNotGeometryCollection(this),ye.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Be.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var l=0;l<this._geometries.length;l++)if(!this._geometries[l].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var l=arguments[0],p=arguments[1];if(Be.constructor_.call(this,p),l===null&&(l=[]),Be.hasNullElements(l))throw new kt("geometries must not contain null elements");this._geometries=l}}}}])})(Be),Qe=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"copyInternal",value:function(){for(var l=new Array(this._geometries.length).fill(null),p=0;p<l.length;p++)l[p]=this._geometries[p].copy();return new s(l,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];return!!this.isEquivalentClass(l)&&Y(s,"equalsExact",this,1).call(this,l,p)}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var l=arguments[0];return this._geometries[l].getCoordinate()}return Y(s,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return se.FALSE}},{key:"getTypeCode",value:function(){return Be.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Be.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[vn]}}],[{key:"constructor_",value:function(){var l=arguments[0],p=arguments[1];je.constructor_.call(this,l,p)}}])})(je),Pi=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"copyInternal",value:function(){return new s(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return se.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||Y(s,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var l=this._points.copy();return ce.reverse(l),this.getFactory().createLinearRing(l)}},{key:"getTypeCode",value:function(){return Be.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!Y(s,"isClosed",this,1).call(this))throw new kt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<s.MINIMUM_VALID_SIZE)throw new kt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Be.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var l=arguments[0],p=arguments[1];jn.constructor_.call(this,l,p),this.validateConstruction()}}])})(jn);Pi.MINIMUM_VALID_SIZE=4;var or=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"setOrdinate",value:function(l,p){switch(l){case s.X:this.x=p;break;case s.Y:this.y=p;break;default:throw new kt("Invalid ordinate index: "+l)}}},{key:"getZ",value:function(){return Gt.NULL_ORDINATE}},{key:"getOrdinate",value:function(l){switch(l){case s.X:return this.x;case s.Y:return this.y}throw new kt("Invalid ordinate index: "+l)}},{key:"setZ",value:function(l){throw new kt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(l){this.x=l.x,this.y=l.y,this.z=l.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Gt.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof s){var l=arguments[0];Gt.constructor_.call(this,l.x,l.y)}else if(arguments[0]instanceof Gt){var p=arguments[0];Gt.constructor_.call(this,p.x,p.y)}}else if(arguments.length===2){var w=arguments[0],D=arguments[1];Gt.constructor_.call(this,w,D,Gt.NULL_ORDINATE)}}}])})(Gt);or.X=0,or.Y=1,or.Z=-1,or.M=-1;var Kn=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(l,p){switch(l){case s.X:this.x=p;break;case s.Y:this.y=p;break;case s.M:this._m=p;break;default:throw new kt("Invalid ordinate index: "+l)}}},{key:"setM",value:function(l){this._m=l}},{key:"getZ",value:function(){return Gt.NULL_ORDINATE}},{key:"getOrdinate",value:function(l){switch(l){case s.X:return this.x;case s.Y:return this.y;case s.M:return this._m}throw new kt("Invalid ordinate index: "+l)}},{key:"setZ",value:function(l){throw new kt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(l){this.x=l.x,this.y=l.y,this.z=l.getZ(),this._m=l.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Gt.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof s){var l=arguments[0];Gt.constructor_.call(this,l.x,l.y),this._m=l._m}else if(arguments[0]instanceof Gt){var p=arguments[0];Gt.constructor_.call(this,p.x,p.y),this._m=this.getM()}}else if(arguments.length===3){var w=arguments[0],D=arguments[1],B=arguments[2];Gt.constructor_.call(this,w,D,Gt.NULL_ORDINATE),this._m=B}}}])})(Gt);Kn.X=0,Kn.Y=1,Kn.Z=-1,Kn.M=2;var rn=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(l,p){switch(l){case Gt.X:this.x=p;break;case Gt.Y:this.y=p;break;case Gt.Z:this.z=p;break;case Gt.M:this._m=p;break;default:throw new kt("Invalid ordinate index: "+l)}}},{key:"setM",value:function(l){this._m=l}},{key:"getOrdinate",value:function(l){switch(l){case Gt.X:return this.x;case Gt.Y:return this.y;case Gt.Z:return this.getZ();case Gt.M:return this.getM()}throw new kt("Invalid ordinate index: "+l)}},{key:"copy",value:function(){return new s(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(l){this.x=l.x,this.y=l.y,this.z=l.getZ(),this._m=l.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Gt.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof s){var l=arguments[0];Gt.constructor_.call(this,l),this._m=l._m}else if(arguments[0]instanceof Gt){var p=arguments[0];Gt.constructor_.call(this,p),this._m=this.getM()}}else if(arguments.length===4){var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3];Gt.constructor_.call(this,w,D,B),this._m=Q}}}])})(Gt),mr=(function(){function m(){S(this,m)}return o(m,null,[{key:"measures",value:function(s){return s instanceof or?0:s instanceof Kn||s instanceof rn?1:0}},{key:"dimension",value:function(s){return s instanceof or?2:s instanceof Kn?3:s instanceof rn?4:3}},{key:"create",value:function(){if(arguments.length===1){var s=arguments[0];return m.create(s,0)}if(arguments.length===2){var l=arguments[0],p=arguments[1];return l===2?new or:l===3&&p===0?new Gt:l===3&&p===1?new Kn:l===4&&p===1?new rn:new Gt}}}])})(),Fr=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"getCoordinate",value:function(l){return this.get(l)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&be(arguments[0],$n)){for(var l=arguments[1],p=!1,w=arguments[0].iterator();w.hasNext();)this.add(w.next(),l),p=!0;return p}return Y(s,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var l=Y(s,"clone",this,1).call(this),p=0;p<this.size();p++)l.add(p,this.get(p).clone());return l}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(s.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(s.coordArrayType);for(var l=this.size(),p=new Array(l).fill(null),w=0;w<l;w++)p[w]=this.get(l-w-1);return p}}},{key:"add",value:function(){if(arguments.length===1){var l=arguments[0];return Y(s,"add",this,1).call(this,l)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var p=arguments[0],w=arguments[1];return this.add(p,w,!0),!0}if(arguments[0]instanceof Gt&&typeof arguments[1]=="boolean"){var D=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(D))return null;Y(s,"add",this,1).call(this,D)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var B=arguments[0],Q=arguments[1];return this.add(B,Q),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var ht=arguments[0],vt=arguments[1];if(arguments[2])for(var Yt=0;Yt<ht.length;Yt++)this.add(ht[Yt],vt);else for(var ne=ht.length-1;ne>=0;ne--)this.add(ht[ne],vt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Gt){var Se=arguments[0],Ve=arguments[1];if(!arguments[2]){var $e=this.size();if($e>0&&(Se>0&&this.get(Se-1).equals2D(Ve)||Se<$e&&this.get(Se).equals2D(Ve)))return null}Y(s,"add",this,1).call(this,Se,Ve)}}else if(arguments.length===4){var tn=arguments[0],fn=arguments[1],Sn=arguments[2],Bn=arguments[3],wi=1;Sn>Bn&&(wi=-1);for(var ni=Sn;ni!==Bn;ni+=wi)this.add(tn[ni],fn);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var l=this.get(0).copy();this.add(l,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var l=arguments[0];this.ensureCapacity(l.length),this.add(l,!0)}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this.ensureCapacity(p.length),this.add(p,w)}}}}])})(wt);Fr.coordArrayType=new Array(0).fill(null);var Jn=(function(){function m(){S(this,m)}return o(m,null,[{key:"isRing",value:function(s){return!(s.length<4)&&!!s[0].equals2D(s[s.length-1])}},{key:"ptNotInList",value:function(s,l){for(var p=0;p<s.length;p++){var w=s[p];if(m.indexOf(w,l)<0)return w}return null}},{key:"scroll",value:function(s,l){var p=m.indexOf(l,s);if(p<0)return null;var w=new Array(s.length).fill(null);xt.arraycopy(s,p,w,0,s.length-p),xt.arraycopy(s,0,w,s.length-p,p),xt.arraycopy(w,0,s,0,s.length)}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],l=arguments[1];if(s===l)return!0;if(s===null||l===null||s.length!==l.length)return!1;for(var p=0;p<s.length;p++)if(!s[p].equals(l[p]))return!1;return!0}if(arguments.length===3){var w=arguments[0],D=arguments[1],B=arguments[2];if(w===D)return!0;if(w===null||D===null||w.length!==D.length)return!1;for(var Q=0;Q<w.length;Q++)if(B.compare(w[Q],D[Q])!==0)return!1;return!0}}},{key:"intersection",value:function(s,l){for(var p=new Fr,w=0;w<s.length;w++)l.intersects(s[w])&&p.add(s[w],!0);return p.toCoordinateArray()}},{key:"measures",value:function(s){if(s===null||s.length===0)return 0;var l,p=0,w=N(s);try{for(w.s();!(l=w.n()).done;){var D=l.value;p=Math.max(p,mr.measures(D))}}catch(B){w.e(B)}finally{w.f()}return p}},{key:"hasRepeatedPoints",value:function(s){for(var l=1;l<s.length;l++)if(s[l-1].equals(s[l]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(s){return m.hasRepeatedPoints(s)?new Fr(s,!1).toCoordinateArray():s}},{key:"reverse",value:function(s){for(var l=s.length-1,p=Math.trunc(l/2),w=0;w<=p;w++){var D=s[w];s[w]=s[l-w],s[l-w]=D}}},{key:"removeNull",value:function(s){for(var l=0,p=0;p<s.length;p++)s[p]!==null&&l++;var w=new Array(l).fill(null);if(l===0)return w;for(var D=0,B=0;B<s.length;B++)s[B]!==null&&(w[D++]=s[B]);return w}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var s=arguments[0],l=new Array(s.length).fill(null),p=0;p<s.length;p++)l[p]=s[p].copy();return l}if(arguments.length===5)for(var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3],ht=arguments[4],vt=0;vt<ht;vt++)B[Q+vt]=w[D+vt].copy()}},{key:"isEqualReversed",value:function(s,l){for(var p=0;p<s.length;p++){var w=s[p],D=l[s.length-p-1];if(w.compareTo(D)!==0)return!1}return!0}},{key:"envelope",value:function(s){for(var l=new sn,p=0;p<s.length;p++)l.expandToInclude(s[p]);return l}},{key:"toCoordinateArray",value:function(s){return s.toArray(m.coordArrayType)}},{key:"dimension",value:function(s){if(s===null||s.length===0)return 3;var l,p=0,w=N(s);try{for(w.s();!(l=w.n()).done;){var D=l.value;p=Math.max(p,mr.dimension(D))}}catch(B){w.e(B)}finally{w.f()}return p}},{key:"atLeastNCoordinatesOrNothing",value:function(s,l){return l.length>=s?l:[]}},{key:"indexOf",value:function(s,l){for(var p=0;p<l.length;p++)if(s.equals(l[p]))return p;return-1}},{key:"increasingDirection",value:function(s){for(var l=0;l<Math.trunc(s.length/2);l++){var p=s.length-1-l,w=s[l].compareTo(s[p]);if(w!==0)return w}return 1}},{key:"compare",value:function(s,l){for(var p=0;p<s.length&&p<l.length;){var w=s[p].compareTo(l[p]);if(w!==0)return w;p++}return p<l.length?-1:p<s.length?1:0}},{key:"minCoordinate",value:function(s){for(var l=null,p=0;p<s.length;p++)(l===null||l.compareTo(s[p])>0)&&(l=s[p]);return l}},{key:"extract",value:function(s,l,p){l=Rt.clamp(l,0,s.length);var w=(p=Rt.clamp(p,-1,s.length))-l+1;p<0&&(w=0),l>=s.length&&(w=0),p<l&&(w=0);var D=new Array(w).fill(null);if(w===0)return D;for(var B=0,Q=l;Q<=p;Q++)D[B++]=s[Q];return D}}])})(),Tr=(function(){return o((function m(){S(this,m)}),[{key:"compare",value:function(m,s){var l=m,p=s;return Jn.compare(l,p)}},{key:"interfaces_",get:function(){return[Zt]}}])})(),Is=(function(){return o((function m(){S(this,m)}),[{key:"compare",value:function(m,s){var l=m,p=s;if(l.length<p.length)return-1;if(l.length>p.length)return 1;if(l.length===0)return 0;var w=Jn.compare(l,p);return Jn.isEqualReversed(l,p)?0:w}},{key:"OLDcompare",value:function(m,s){var l=m,p=s;if(l.length<p.length)return-1;if(l.length>p.length)return 1;if(l.length===0)return 0;for(var w=Jn.increasingDirection(l),D=Jn.increasingDirection(p),B=w>0?0:l.length-1,Q=D>0?0:l.length-1,ht=0;ht<l.length;ht++){var vt=l[B].compareTo(p[Q]);if(vt!==0)return vt;B+=w,Q+=D}return 0}},{key:"interfaces_",get:function(){return[Zt]}}])})();Jn.ForwardComparator=Tr,Jn.BidirectionalComparator=Is,Jn.coordArrayType=new Array(0).fill(null);var es=(function(){return o((function m(s){S(this,m),this.str=s}),[{key:"append",value:function(m){this.str+=m}},{key:"setCharAt",value:function(m,s){this.str=this.str.substr(0,m)+s+this.str.substr(m+1)}},{key:"toString",value:function(){return this.str}}])})(),Br=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getM",value:function(s){return this.hasM()?this._coordinates[s].getM():_e.NaN}},{key:"setOrdinate",value:function(s,l,p){switch(l){case ln.X:this._coordinates[s].x=p;break;case ln.Y:this._coordinates[s].y=p;break;default:this._coordinates[s].setOrdinate(l,p)}}},{key:"getZ",value:function(s){return this.hasZ()?this._coordinates[s].getZ():_e.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(s,l){switch(l){case ln.X:return this._coordinates[s].x;case ln.Y:return this._coordinates[s].y;default:return this._coordinates[s].getOrdinate(l)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var s=arguments[0];return this._coordinates[s]}if(arguments.length===2){var l=arguments[0];arguments[1].setCoordinate(this._coordinates[l])}}},{key:"getCoordinateCopy",value:function(s){var l=this.createCoordinate();return l.setCoordinate(this._coordinates[s]),l}},{key:"createCoordinate",value:function(){return mr.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(s){return this._coordinates[s].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(s){for(var l=0;l<this._coordinates.length;l++)s.expandToInclude(this._coordinates[l]);return s}},{key:"copy",value:function(){for(var s=new Array(this.size()).fill(null),l=0;l<this._coordinates.length;l++){var p=this.createCoordinate();p.setCoordinate(this._coordinates[l]),s[l]=p}return new m(s,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var s=new es(17*this._coordinates.length);s.append("("),s.append(this._coordinates[0]);for(var l=1;l<this._coordinates.length;l++)s.append(", "),s.append(this._coordinates[l]);return s.append(")"),s.toString()}return"()"}},{key:"getY",value:function(s){return this._coordinates[s].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[ln,Ot]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];m.constructor_.call(this,s,Jn.dimension(s),Jn.measures(s))}else if(Number.isInteger(arguments[0])){var l=arguments[0];this._coordinates=new Array(l).fill(null);for(var p=0;p<l;p++)this._coordinates[p]=new Gt}else if(be(arguments[0],ln)){var w=arguments[0];if(w===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=w.getDimension(),this._measures=w.getMeasures(),this._coordinates=new Array(w.size()).fill(null);for(var D=0;D<this._coordinates.length;D++)this._coordinates[D]=w.getCoordinateCopy(D)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var B=arguments[0],Q=arguments[1];m.constructor_.call(this,B,Q,Jn.measures(B))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var ht=arguments[0],vt=arguments[1];this._coordinates=new Array(ht).fill(null),this._dimension=vt;for(var Yt=0;Yt<ht;Yt++)this._coordinates[Yt]=mr.create(vt)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var ne=arguments[0],Se=arguments[1],Ve=arguments[2];this._dimension=Se,this._measures=Ve,this._coordinates=ne===null?new Array(0).fill(null):ne}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var $e=arguments[0],tn=arguments[1],fn=arguments[2];this._coordinates=new Array($e).fill(null),this._dimension=tn,this._measures=fn;for(var Sn=0;Sn<$e;Sn++)this._coordinates[Sn]=this.createCoordinate()}}}}])})(),qi=(function(){function m(){S(this,m)}return o(m,[{key:"readResolve",value:function(){return m.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Br(arguments[0]);if(be(arguments[0],ln))return new Br(arguments[0])}else{if(arguments.length===2){var s=arguments[1];return s>3&&(s=3),s<2&&(s=2),new Br(arguments[0],s)}if(arguments.length===3){var l=arguments[2],p=arguments[1]-l;return l>1&&(l=1),p>3&&(p=3),p<2&&(p=2),new Br(arguments[0],p+l,l)}}}},{key:"interfaces_",get:function(){return[pt,Ot]}}],[{key:"instance",value:function(){return m.instanceObject}}])})();qi.instanceObject=new qi;var Dn=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"copyInternal",value:function(){for(var l=new Array(this._geometries.length).fill(null),p=0;p<l.length;p++)l[p]=this._geometries[p].copy();return new s(l,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];return!!this.isEquivalentClass(l)&&Y(s,"equalsExact",this,1).call(this,l,p)}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Be.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var l=new wt,p=0;p<this._geometries.length;p++)for(var w=this._geometries[p].getBoundary(),D=0;D<w.getNumGeometries();D++)l.add(w.getGeometryN(D));var B=new Array(l.size()).fill(null);return this.getFactory().createMultiLineString(l.toArray(B))}},{key:"getGeometryType",value:function(){return Be.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Gn]}}],[{key:"constructor_",value:function(){var l=arguments[0],p=arguments[1];je.constructor_.call(this,l,p)}}])})(je),sl=(function(){return o((function m(){S(this,m)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),Vr=(function(m){function s(){var l;return S(this,s),(l=E(this,s)).map=new Map,l}return V(s,m),o(s,[{key:"get",value:function(l){return this.map.get(l)||null}},{key:"put",value:function(l,p){return this.map.set(l,p),p}},{key:"values",value:function(){for(var l=new wt,p=this.map.values(),w=p.next();!w.done;)l.add(w.value),w=p.next();return l}},{key:"entrySet",value:function(){var l=new Pt;return this.map.entries().forEach((function(p){return l.add(p)})),l}},{key:"size",value:function(){return this.map.size()}}])})(sl),Zi=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"equals",value:function(s){if(!(s instanceof m))return!1;var l=s;return this._modelType===l._modelType&&this._scale===l._scale}},{key:"compareTo",value:function(s){var l=s,p=this.getMaximumSignificantDigits(),w=l.getMaximumSignificantDigits();return Je.compare(p,w)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===m.FLOATING||this._modelType===m.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var s="UNKNOWN";return this._modelType===m.FLOATING?s="Floating":this._modelType===m.FLOATING_SINGLE?s="Floating-Single":this._modelType===m.FIXED&&(s="Fixed (Scale="+this.getScale()+")"),s}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var s=arguments[0];return _e.isNaN(s)||this._modelType===m.FLOATING_SINGLE?s:this._modelType===m.FIXED?Math.round(s*this._scale)/this._scale:s}if(arguments[0]instanceof Gt){var l=arguments[0];if(this._modelType===m.FLOATING)return null;l.x=this.makePrecise(l.x),l.y=this.makePrecise(l.y)}}},{key:"getMaximumSignificantDigits",value:function(){var s=16;return this._modelType===m.FLOATING?s=16:this._modelType===m.FLOATING_SINGLE?s=6:this._modelType===m.FIXED&&(s=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),s}},{key:"setScale",value:function(s){this._scale=Math.abs(s)}},{key:"interfaces_",get:function(){return[Ot,Mt]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=m.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Rn){var s=arguments[0];this._modelType=s,s===m.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var l=arguments[0];this._modelType=m.FIXED,this.setScale(l)}else if(arguments[0]instanceof m){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}}},{key:"mostPrecise",value:function(s,l){return s.compareTo(l)>=0?s:l}}])})(),Rn=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"readResolve",value:function(){return m.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[Ot]}}],[{key:"constructor_",value:function(){this._name=null;var s=arguments[0];this._name=s,m.nameToTypeMap.put(s,this)}}])})();Rn.nameToTypeMap=new Vr,Zi.Type=Rn,Zi.FIXED=new Rn("FIXED"),Zi.FLOATING=new Rn("FLOATING"),Zi.FLOATING_SINGLE=new Rn("FLOATING SINGLE"),Zi.maximumPreciseValue=9007199254740992;var jr=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"copyInternal",value:function(){for(var l=new Array(this._geometries.length).fill(null),p=0;p<l.length;p++)l[p]=this._geometries[p].copy();return new s(l,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Be){var l=arguments[0],p=arguments[1];return!!this.isEquivalentClass(l)&&Y(s,"equalsExact",this,1).call(this,l,p)}return Y(s,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?se.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var l=0;l<this._geometries.length;l++)if(!this._geometries[l].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Be.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new fe}},{key:"getGeometryType",value:function(){return Be.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[ue]}}],[{key:"constructor_",value:function(){var l=arguments[0],p=arguments[1];je.constructor_.call(this,l,p)}}])})(je),ds=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"createEmpty",value:function(s){switch(s){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new kt("Invalid dimension: "+s)}}},{key:"toGeometry",value:function(s){return s.isNull()?this.createPoint():s.getMinX()===s.getMaxX()&&s.getMinY()===s.getMaxY()?this.createPoint(new Gt(s.getMinX(),s.getMinY())):s.getMinX()===s.getMaxX()||s.getMinY()===s.getMaxY()?this.createLineString([new Gt(s.getMinX(),s.getMinY()),new Gt(s.getMaxX(),s.getMaxY())]):this.createPolygon(this.createLinearRing([new Gt(s.getMinX(),s.getMinY()),new Gt(s.getMinX(),s.getMaxY()),new Gt(s.getMaxX(),s.getMaxY()),new Gt(s.getMaxX(),s.getMinY()),new Gt(s.getMinX(),s.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLineString(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(be(arguments[0],ln))return new jn(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new jr(null,this):arguments.length===1?new jr(arguments[0],this):void 0}},{key:"buildGeometry",value:function(s){for(var l=null,p=!1,w=!1,D=s.iterator();D.hasNext();){var B=D.next(),Q=B.getTypeCode();l===null&&(l=Q),Q!==l&&(p=!0),B instanceof je&&(w=!0)}if(l===null)return this.createGeometryCollection();if(p||w)return this.createGeometryCollection(m.toGeometryArray(s));var ht=s.iterator().next();if(s.size()>1){if(ht instanceof An)return this.createMultiPolygon(m.toPolygonArray(s));if(ht instanceof jn)return this.createMultiLineString(m.toLineStringArray(s));if(ht instanceof En)return this.createMultiPoint(m.toPointArray(s));ye.shouldNeverReachHere("Unhandled geometry type: "+ht.getGeometryType())}return ht}},{key:"createMultiPointFromCoords",value:function(s){return this.createMultiPoint(s!==null?this.getCoordinateSequenceFactory().create(s):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Gt){var s=arguments[0];return this.createPoint(s!==null?this.getCoordinateSequenceFactory().create([s]):null)}if(be(arguments[0],ln))return new En(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(be(arguments[0],ln)){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof Array){var l=arguments[0];return this.createPolygon(this.createLinearRing(l))}if(arguments[0]instanceof Pi){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2)return new An(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new je(null,this):arguments.length===1?new je(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLinearRing(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(be(arguments[0],ln))return new Pi(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Dn(null,this):arguments.length===1?new Dn(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Qe(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Qe(arguments[0],this);if(be(arguments[0],ln)){var s=arguments[0];if(s===null)return this.createMultiPoint(new Array(0).fill(null));for(var l=new Array(s.size()).fill(null),p=0;p<s.size();p++){var w=this.getCoordinateSequenceFactory().create(1,s.getDimension(),s.getMeasures());ce.copy(s,p,w,0,1),l[p]=this.createPoint(w)}return this.createMultiPoint(l)}}}},{key:"interfaces_",get:function(){return[Ot]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)m.constructor_.call(this,new Zi,0);else if(arguments.length===1){if(be(arguments[0],pt)){var s=arguments[0];m.constructor_.call(this,new Zi,0,s)}else if(arguments[0]instanceof Zi){var l=arguments[0];m.constructor_.call(this,l,0,m.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];m.constructor_.call(this,p,w,m.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var D=arguments[0],B=arguments[1],Q=arguments[2];this._precisionModel=D,this._coordinateSequenceFactory=Q,this._SRID=B}}},{key:"toMultiPolygonArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"toGeometryArray",value:function(s){if(s===null)return null;var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return qi.instance()}},{key:"toMultiLineStringArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"toLineStringArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"toMultiPointArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"toLinearRingArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"toPointArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"toPolygonArray",value:function(s){var l=new Array(s.size()).fill(null);return s.toArray(l)}},{key:"createPointFromInternalCoord",value:function(s,l){return l.getPrecisionModel().makePrecise(s),l.getFactory().createPoint(s)}}])})(),fs="XY",ao="XYZ",Us="XYM",al="XYZM",oo={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},ol="EMPTY",ua=1,Gr=2,ns=3,Oa=4,ps=5,ll=6;for(var lo in oo)oo[lo].toUpperCase();var uo=(function(){return o((function m(s){S(this,m),this.wkt=s,this.index_=-1}),[{key:"isAlpha_",value:function(m){return m>="a"&&m<="z"||m>="A"&&m<="Z"}},{key:"isNumeric_",value:function(m,s){return m>="0"&&m<="9"||m=="."&&!(s!==void 0&&s)}},{key:"isWhiteSpace_",value:function(m){return m==" "||m=="	"||m=="\r"||m==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var m,s=this.nextChar_(),l=this.index_,p=s;if(s=="(")m=Gr;else if(s==",")m=ps;else if(s==")")m=ns;else if(this.isNumeric_(s)||s=="-")m=Oa,p=this.readNumber_();else if(this.isAlpha_(s))m=ua,p=this.readText_();else{if(this.isWhiteSpace_(s))return this.nextToken();if(s!=="")throw new Error("Unexpected character: "+s);m=ll}return{position:l,value:p,type:m}}},{key:"readNumber_",value:function(){var m,s=this.index_,l=!1,p=!1;do m=="."?l=!0:m!="e"&&m!="E"||(p=!0),m=this.nextChar_();while(this.isNumeric_(m,l)||!p&&(m=="e"||m=="E")||p&&(m=="-"||m=="+"));return parseFloat(this.wkt.substring(s,this.index_--))}},{key:"readText_",value:function(){var m,s=this.index_;do m=this.nextChar_();while(this.isAlpha_(m));return this.wkt.substring(s,this.index_--).toUpperCase()}}])})(),ul=(function(){return o((function m(s,l){S(this,m),this.lexer_=s,this.token_,this.layout_=fs,this.factory=l}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(m){return this.token_.type==m}},{key:"match",value:function(m){var s=this.isTokenType(m);return s&&this.consume_(),s}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var m=fs,s=this.token_;if(this.isTokenType(ua)){var l=s.value;l==="Z"?m=ao:l==="M"?m=Us:l==="ZM"&&(m=al),m!==fs&&this.consume_()}return m}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Gr)){var m=[];do m.push(this.parseGeometry_());while(this.match(ps));if(this.match(ns))return m}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Gr)){var m=this.parsePoint_();if(this.match(ns))return m}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Gr)){var m=this.parsePointList_();if(this.match(ns))return m}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Gr)){var m=this.parseLineStringTextList_();if(this.match(ns))return m}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var m;if(this.match(Gr)){if(m=this.token_.type==Gr?this.parsePointTextList_():this.parsePointList_(),this.match(ns))return m}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Gr)){var m=this.parseLineStringTextList_();if(this.match(ns))return m}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Gr)){var m=this.parsePolygonTextList_();if(this.match(ns))return m}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var m=[],s=this.layout_.length,l=0;l<s;++l){var p=this.token_;if(!this.match(Oa))break;m.push(p.value)}if(m.length==s)return m;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var m=[this.parsePoint_()];this.match(ps);)m.push(this.parsePoint_());return m}},{key:"parsePointTextList_",value:function(){for(var m=[this.parsePointText_()];this.match(ps);)m.push(this.parsePointText_());return m}},{key:"parseLineStringTextList_",value:function(){for(var m=[this.parseLineStringText_()];this.match(ps);)m.push(this.parseLineStringText_());return m}},{key:"parsePolygonTextList_",value:function(){for(var m=[this.parsePolygonText_()];this.match(ps);)m.push(this.parsePolygonText_());return m}},{key:"isEmptyGeometry_",value:function(){var m=this.isTokenType(ua)&&this.token_.value==ol;return m&&this.consume_(),m}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var m=this.factory,s=function(tn){return P(Gt,J(tn))},l=function(tn){var fn=tn.map((function(Sn){return m.createLinearRing(Sn.map(s))}));return fn.length>1?m.createPolygon(fn[0],fn.slice(1)):m.createPolygon(fn[0])},p=this.token_;if(this.match(ua)){var w=p.value;if(this.layout_=this.parseGeometryLayout_(),w=="GEOMETRYCOLLECTION"){var D=this.parseGeometryCollectionText_();return m.createGeometryCollection(D)}switch(w){case"POINT":var B=this.parsePointText_();return B?m.createPoint(P(Gt,J(B))):m.createPoint();case"LINESTRING":var Q=this.parseLineStringText_().map(s);return m.createLineString(Q);case"LINEARRING":var ht=this.parseLineStringText_().map(s);return m.createLinearRing(ht);case"POLYGON":var vt=this.parsePolygonText_();return vt&&vt.length!==0?l(vt):m.createPolygon();case"MULTIPOINT":var Yt=this.parseMultiPointText_();if(!Yt||Yt.length===0)return m.createMultiPoint();var ne=Yt.map(s).map((function(tn){return m.createPoint(tn)}));return m.createMultiPoint(ne);case"MULTILINESTRING":var Se=this.parseMultiLineStringText_().map((function(tn){return m.createLineString(tn.map(s))}));return m.createMultiLineString(Se);case"MULTIPOLYGON":var Ve=this.parseMultiPolygonText_();if(!Ve||Ve.length===0)return m.createMultiPolygon();var $e=Ve.map(l);return m.createMultiPolygon($e);default:throw new Error("Invalid geometry type: "+w)}}throw new Error(this.formatErrorMessage_())}}])})();function Ur(m){if(m.isEmpty())return"";var s=m.getCoordinate(),l=[s.x,s.y];return s.z===void 0||Number.isNaN(s.z)||l.push(s.z),s.m===void 0||Number.isNaN(s.m)||l.push(s.m),l.join(" ")}function ms(m){for(var s=m.getCoordinates().map((function(D){var B=[D.x,D.y];return D.z===void 0||Number.isNaN(D.z)||B.push(D.z),D.m===void 0||Number.isNaN(D.m)||B.push(D.m),B})),l=[],p=0,w=s.length;p<w;++p)l.push(s[p].join(" "));return l.join(", ")}function co(m){var s=[];s.push("("+ms(m.getExteriorRing())+")");for(var l=0,p=m.getNumInteriorRing();l<p;++l)s.push("("+ms(m.getInteriorRingN(l))+")");return s.join(", ")}var qr={Point:Ur,LineString:ms,LinearRing:ms,Polygon:co,MultiPoint:function(m){for(var s=[],l=0,p=m.getNumGeometries();l<p;++l)s.push("("+Ur(m.getGeometryN(l))+")");return s.join(", ")},MultiLineString:function(m){for(var s=[],l=0,p=m.getNumGeometries();l<p;++l)s.push("("+ms(m.getGeometryN(l))+")");return s.join(", ")},MultiPolygon:function(m){for(var s=[],l=0,p=m.getNumGeometries();l<p;++l)s.push("("+co(m.getGeometryN(l))+")");return s.join(", ")},GeometryCollection:function(m){for(var s=[],l=0,p=m.getNumGeometries();l<p;++l)s.push(ho(m.getGeometryN(l)));return s.join(", ")}};function ho(m){var s=m.getGeometryType(),l=qr[s];s=s.toUpperCase();var p=(function(w){var D="";if(w.isEmpty())return D;var B=w.getCoordinate();return B.z===void 0||Number.isNaN(B.z)||(D+="Z"),B.m===void 0||Number.isNaN(B.m)||(D+="M"),D})(m);return p.length>0&&(s+=" "+p),m.isEmpty()?s+" "+ol:s+" ("+l(m)+")"}var hu=(function(){return o((function m(s){S(this,m),this.geometryFactory=s||new ds,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(m){var s=new uo(m);return new ul(s,this.geometryFactory).parse()}},{key:"write",value:function(m){return ho(m)}}])})(),Zr=(function(){return o((function m(s){S(this,m),this.parser=new hu(s)}),[{key:"write",value:function(m){return this.parser.write(m)}}],[{key:"toLineString",value:function(m,s){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+m.x+" "+m.y+", "+s.x+" "+s.y+" )"}}])})(),Ln=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getIndexAlongSegment",value:function(s,l){return this.computeIntLineIndex(),this._intLineIndex[s][l]}},{key:"getTopologySummary",value:function(){var s=new es;return this.isEndPoint()&&s.append(" endpoint"),this._isProper&&s.append(" proper"),this.isCollinear()&&s.append(" collinear"),s.toString()}},{key:"computeIntersection",value:function(s,l,p,w){this._inputLines[0][0]=s,this._inputLines[0][1]=l,this._inputLines[1][0]=p,this._inputLines[1][1]=w,this._result=this.computeIntersect(s,l,p,w)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var s=arguments[0];this.getEdgeDistance(s,0)>this.getEdgeDistance(s,1)?(this._intLineIndex[s][0]=0,this._intLineIndex[s][1]=1):(this._intLineIndex[s][0]=1,this._intLineIndex[s][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var s=arguments[0],l=0;l<this._result;l++)if(!this._intPt[l].equals2D(this._inputLines[s][0])&&!this._intPt[l].equals2D(this._inputLines[s][1]))return!0;return!1}}},{key:"getIntersection",value:function(s){return this._intPt[s]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==m.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(s,l){return m.computeEdgeDistance(this._intPt[l],this._inputLines[s][0],this._inputLines[s][1])}},{key:"isCollinear",value:function(){return this._result===m.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Zr.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Zr.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(s,l){return this._inputLines[s][l]}},{key:"isIntersection",value:function(s){for(var l=0;l<this._result;l++)if(this._intPt[l].equals2D(s))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(s,l){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[s][l]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Gt,this._intPt[1]=new Gt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(s,l,p){var w=Math.abs(p.x-l.x),D=Math.abs(p.y-l.y),B=-1;if(s.equals(l))B=0;else if(s.equals(p))B=w>D?w:D;else{var Q=Math.abs(s.x-l.x),ht=Math.abs(s.y-l.y);(B=w>D?Q:ht)!==0||s.equals(l)||(B=Math.max(Q,ht))}return ye.isTrue(!(B===0&&!s.equals(l)),"Bad distance calculation"),B}},{key:"nonRobustComputeEdgeDistance",value:function(s,l,p){var w=s.x-l.x,D=s.y-l.y,B=Math.sqrt(w*w+D*D);return ye.isTrue(!(B===0&&!s.equals(l)),"Invalid distance calculation"),B}}])})();Ln.DONT_INTERSECT=0,Ln.DO_INTERSECT=1,Ln.COLLINEAR=2,Ln.NO_INTERSECTION=0,Ln.POINT_INTERSECTION=1,Ln.COLLINEAR_INTERSECTION=2;var un=(function(m){function s(){return S(this,s),E(this,s)}return V(s,m),o(s,[{key:"isInSegmentEnvelopes",value:function(l){var p=new sn(this._inputLines[0][0],this._inputLines[0][1]),w=new sn(this._inputLines[1][0],this._inputLines[1][1]);return p.contains(l)&&w.contains(l)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return Y(s,"computeIntersection",this,1).apply(this,arguments);var l=arguments[0],p=arguments[1],w=arguments[2];if(this._isProper=!1,sn.intersects(p,w,l)&&Ye.index(p,w,l)===0&&Ye.index(w,p,l)===0)return this._isProper=!0,(l.equals(p)||l.equals(w))&&(this._isProper=!1),this._result=Ln.POINT_INTERSECTION,null;this._result=Ln.NO_INTERSECTION}},{key:"intersection",value:function(l,p,w,D){var B=this.intersectionSafe(l,p,w,D);return this.isInSegmentEnvelopes(B)||(B=new Gt(s.nearestEndpoint(l,p,w,D))),this._precisionModel!==null&&this._precisionModel.makePrecise(B),B}},{key:"checkDD",value:function(l,p,w,D,B){var Q=li.intersection(l,p,w,D),ht=this.isInSegmentEnvelopes(Q);xt.out.println("DD in env = "+ht+"  --------------------- "+Q),B.distance(Q)>1e-4&&xt.out.println("Distance = "+B.distance(Q))}},{key:"intersectionSafe",value:function(l,p,w,D){var B=lt.intersection(l,p,w,D);return B===null&&(B=s.nearestEndpoint(l,p,w,D)),B}},{key:"computeCollinearIntersection",value:function(l,p,w,D){var B=sn.intersects(l,p,w),Q=sn.intersects(l,p,D),ht=sn.intersects(w,D,l),vt=sn.intersects(w,D,p);return B&&Q?(this._intPt[0]=w,this._intPt[1]=D,Ln.COLLINEAR_INTERSECTION):ht&&vt?(this._intPt[0]=l,this._intPt[1]=p,Ln.COLLINEAR_INTERSECTION):B&&ht?(this._intPt[0]=w,this._intPt[1]=l,!w.equals(l)||Q||vt?Ln.COLLINEAR_INTERSECTION:Ln.POINT_INTERSECTION):B&&vt?(this._intPt[0]=w,this._intPt[1]=p,!w.equals(p)||Q||ht?Ln.COLLINEAR_INTERSECTION:Ln.POINT_INTERSECTION):Q&&ht?(this._intPt[0]=D,this._intPt[1]=l,!D.equals(l)||B||vt?Ln.COLLINEAR_INTERSECTION:Ln.POINT_INTERSECTION):Q&&vt?(this._intPt[0]=D,this._intPt[1]=p,!D.equals(p)||B||ht?Ln.COLLINEAR_INTERSECTION:Ln.POINT_INTERSECTION):Ln.NO_INTERSECTION}},{key:"computeIntersect",value:function(l,p,w,D){if(this._isProper=!1,!sn.intersects(l,p,w,D))return Ln.NO_INTERSECTION;var B=Ye.index(l,p,w),Q=Ye.index(l,p,D);if(B>0&&Q>0||B<0&&Q<0)return Ln.NO_INTERSECTION;var ht=Ye.index(w,D,l),vt=Ye.index(w,D,p);return ht>0&&vt>0||ht<0&&vt<0?Ln.NO_INTERSECTION:B===0&&Q===0&&ht===0&&vt===0?this.computeCollinearIntersection(l,p,w,D):(B===0||Q===0||ht===0||vt===0?(this._isProper=!1,l.equals2D(w)||l.equals2D(D)?this._intPt[0]=l:p.equals2D(w)||p.equals2D(D)?this._intPt[0]=p:B===0?this._intPt[0]=new Gt(w):Q===0?this._intPt[0]=new Gt(D):ht===0?this._intPt[0]=new Gt(l):vt===0&&(this._intPt[0]=new Gt(p))):(this._isProper=!0,this._intPt[0]=this.intersection(l,p,w,D)),Ln.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(l,p,w,D){var B=l,Q=$t.pointToSegment(l,w,D),ht=$t.pointToSegment(p,w,D);return ht<Q&&(Q=ht,B=p),(ht=$t.pointToSegment(w,l,p))<Q&&(Q=ht,B=w),(ht=$t.pointToSegment(D,l,p))<Q&&(Q=ht,B=D),B}}])})(Ln),gr=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"countSegment",value:function(s,l){if(s.x<this._p.x&&l.x<this._p.x)return null;if(this._p.x===l.x&&this._p.y===l.y)return this._isPointOnSegment=!0,null;if(s.y===this._p.y&&l.y===this._p.y){var p=s.x,w=l.x;return p>w&&(p=l.x,w=s.x),this._p.x>=p&&this._p.x<=w&&(this._isPointOnSegment=!0),null}if(s.y>this._p.y&&l.y<=this._p.y||l.y>this._p.y&&s.y<=this._p.y){var D=Ye.index(s,l,this._p);if(D===Ye.COLLINEAR)return this._isPointOnSegment=!0,null;l.y<s.y&&(D=-D),D===Ye.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Dt.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Dt.BOUNDARY:this._crossingCount%2==1?Dt.INTERIOR:Dt.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var s=arguments[0];this._p=s}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Gt&&be(arguments[1],ln)){for(var s=arguments[1],l=new m(arguments[0]),p=new Gt,w=new Gt,D=1;D<s.size();D++)if(s.getCoordinate(D,p),s.getCoordinate(D-1,w),l.countSegment(p,w),l.isOnSegment())return l.getLocation();return l.getLocation()}if(arguments[0]instanceof Gt&&arguments[1]instanceof Array){for(var B=arguments[1],Q=new m(arguments[0]),ht=1;ht<B.length;ht++){var vt=B[ht],Yt=B[ht-1];if(Q.countSegment(vt,Yt),Q.isOnSegment())return Q.getLocation()}return Q.getLocation()}}}])})(),wn=(function(){function m(){S(this,m)}return o(m,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Gt&&be(arguments[1],ln)){for(var s=arguments[0],l=arguments[1],p=new un,w=new Gt,D=new Gt,B=l.size(),Q=1;Q<B;Q++)if(l.getCoordinate(Q-1,w),l.getCoordinate(Q,D),p.computeIntersection(s,w,D),p.hasIntersection())return!0;return!1}if(arguments[0]instanceof Gt&&arguments[1]instanceof Array){for(var ht=arguments[0],vt=arguments[1],Yt=new un,ne=1;ne<vt.length;ne++){var Se=vt[ne-1],Ve=vt[ne];if(Yt.computeIntersection(ht,Se,Ve),Yt.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(s,l){return gr.locatePointInRing(s,l)}},{key:"isInRing",value:function(s,l){return m.locateInRing(s,l)!==Dt.EXTERIOR}}])})(),_i=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"setAllLocations",value:function(s){for(var l=0;l<this.location.length;l++)this.location[l]=s}},{key:"isNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]!==Dt.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(s){for(var l=0;l<this.location.length;l++)this.location[l]===Dt.NONE&&(this.location[l]=s)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(s){if(s.location.length>this.location.length){var l=new Array(3).fill(null);l[Tt.ON]=this.location[Tt.ON],l[Tt.LEFT]=Dt.NONE,l[Tt.RIGHT]=Dt.NONE,this.location=l}for(var p=0;p<this.location.length;p++)this.location[p]===Dt.NONE&&p<s.location.length&&(this.location[p]=s.location[p])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var s=this.location[Tt.LEFT];this.location[Tt.LEFT]=this.location[Tt.RIGHT],this.location[Tt.RIGHT]=s}},{key:"toString",value:function(){var s=new Ce;return this.location.length>1&&s.append(Dt.toLocationSymbol(this.location[Tt.LEFT])),s.append(Dt.toLocationSymbol(this.location[Tt.ON])),this.location.length>1&&s.append(Dt.toLocationSymbol(this.location[Tt.RIGHT])),s.toString()}},{key:"setLocations",value:function(s,l,p){this.location[Tt.ON]=s,this.location[Tt.LEFT]=l,this.location[Tt.RIGHT]=p}},{key:"get",value:function(s){return s<this.location.length?this.location[s]:Dt.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]===Dt.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var s=arguments[0];this.setLocation(Tt.ON,s)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];this.location[l]=p}}},{key:"init",value:function(s){this.location=new Array(s).fill(null),this.setAllLocations(Dt.NONE)}},{key:"isEqualOnSide",value:function(s,l){return this.location[l]===s.location[l]}},{key:"allPositionsEqual",value:function(s){for(var l=0;l<this.location.length;l++)if(this.location[l]!==s)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];this.init(s.length)}else if(Number.isInteger(arguments[0])){var l=arguments[0];this.init(1),this.location[Tt.ON]=l}else if(arguments[0]instanceof m){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var w=0;w<this.location.length;w++)this.location[w]=p.location[w]}}else if(arguments.length===3){var D=arguments[0],B=arguments[1],Q=arguments[2];this.init(3),this.location[Tt.ON]=D,this.location[Tt.LEFT]=B,this.location[Tt.RIGHT]=Q}}}])})(),Cn=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getGeometryCount",value:function(){var s=0;return this.elt[0].isNull()||s++,this.elt[1].isNull()||s++,s}},{key:"setAllLocations",value:function(s,l){this.elt[s].setAllLocations(l)}},{key:"isNull",value:function(s){return this.elt[s].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var s=arguments[0];this.setAllLocationsIfNull(0,s),this.setAllLocationsIfNull(1,s)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];this.elt[l].setAllLocationsIfNull(p)}}},{key:"isLine",value:function(s){return this.elt[s].isLine()}},{key:"merge",value:function(s){for(var l=0;l<2;l++)this.elt[l]===null&&s.elt[l]!==null?this.elt[l]=new _i(s.elt[l]):this.elt[l].merge(s.elt[l])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var s=arguments[0];return this.elt[s].get(Tt.ON)}if(arguments.length===2){var l=arguments[0],p=arguments[1];return this.elt[l].get(p)}}},{key:"toString",value:function(){var s=new Ce;return this.elt[0]!==null&&(s.append("A:"),s.append(this.elt[0].toString())),this.elt[1]!==null&&(s.append(" B:"),s.append(this.elt[1].toString())),s.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var s=arguments[0];return this.elt[s].isArea()}}},{key:"isAnyNull",value:function(s){return this.elt[s].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var s=arguments[0],l=arguments[1];this.elt[s].setLocation(Tt.ON,l)}else if(arguments.length===3){var p=arguments[0],w=arguments[1],D=arguments[2];this.elt[p].setLocation(w,D)}}},{key:"isEqualOnSide",value:function(s,l){return this.elt[0].isEqualOnSide(s.elt[0],l)&&this.elt[1].isEqualOnSide(s.elt[1],l)}},{key:"allPositionsEqual",value:function(s,l){return this.elt[s].allPositionsEqual(l)}},{key:"toLine",value:function(s){this.elt[s].isArea()&&(this.elt[s]=new _i(this.elt[s].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var s=arguments[0];this.elt[0]=new _i(s),this.elt[1]=new _i(s)}else if(arguments[0]instanceof m){var l=arguments[0];this.elt[0]=new _i(l.elt[0]),this.elt[1]=new _i(l.elt[1])}}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this.elt[0]=new _i(Dt.NONE),this.elt[1]=new _i(Dt.NONE),this.elt[p].setLocation(w)}else if(arguments.length===3){var D=arguments[0],B=arguments[1],Q=arguments[2];this.elt[0]=new _i(D,B,Q),this.elt[1]=new _i(D,B,Q)}else if(arguments.length===4){var ht=arguments[0],vt=arguments[1],Yt=arguments[2],ne=arguments[3];this.elt[0]=new _i(Dt.NONE,Dt.NONE,Dt.NONE),this.elt[1]=new _i(Dt.NONE,Dt.NONE,Dt.NONE),this.elt[ht].setLocations(vt,Yt,ne)}}},{key:"toLineLabel",value:function(s){for(var l=new m(Dt.NONE),p=0;p<2;p++)l.setLocation(p,s.getLocation(p));return l}}])})(),yi=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var m=new Array(this._pts.size()).fill(null),s=0;s<this._pts.size();s++)m[s]=this._pts.get(s);this._ring=this._geometryFactory.createLinearRing(m),this._isHole=Ye.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(m){this._startDe=m;var s=m,l=!0;do{if(s===null)throw new yn("Found null DirectedEdge");if(s.getEdgeRing()===this)throw new yn("Directed Edge visited twice during ring-building at "+s.getCoordinate());this._edges.add(s);var p=s.getLabel();ye.isTrue(p.isArea()),this.mergeLabel(p),this.addPoints(s.getEdge(),s.isForward(),l),l=!1,this.setEdgeRing(s,this),s=this.getNext(s)}while(s!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(m){return this._pts.get(m)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var m=this._startDe;do{var s=m.getNode().getEdges().getOutgoingDegree(this);s>this._maxNodeDegree&&(this._maxNodeDegree=s),m=this.getNext(m)}while(m!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(m,s,l){var p=m.getCoordinates();if(s){var w=1;l&&(w=0);for(var D=w;D<p.length;D++)this._pts.add(p[D])}else{var B=p.length-2;l&&(B=p.length-1);for(var Q=B;Q>=0;Q--)this._pts.add(p[Q])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var m=this._startDe;do m.getEdge().setInResult(!0),m=m.getNext();while(m!==this._startDe)}},{key:"containsPoint",value:function(m){var s=this.getLinearRing();if(!s.getEnvelopeInternal().contains(m)||!wn.isInRing(m,s.getCoordinates()))return!1;for(var l=this._holes.iterator();l.hasNext();)if(l.next().containsPoint(m))return!1;return!0}},{key:"addHole",value:function(m){this._holes.add(m)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var m=arguments[0];this.mergeLabel(m,0),this.mergeLabel(m,1)}else if(arguments.length===2){var s=arguments[1],l=arguments[0].getLocation(s,Tt.RIGHT);if(l===Dt.NONE)return null;if(this._label.getLocation(s)===Dt.NONE)return this._label.setLocation(s,l),null}}},{key:"setShell",value:function(m){this._shell=m,m!==null&&m.addHole(this)}},{key:"toPolygon",value:function(m){for(var s=new Array(this._holes.size()).fill(null),l=0;l<this._holes.size();l++)s[l]=this._holes.get(l).getLinearRing();return m.createPolygon(this.getLinearRing(),s)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new wt,this._pts=new wt,this._label=new Cn(Dt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new wt,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var m=arguments[0],s=arguments[1];this._geometryFactory=s,this.computePoints(m),this.computeRing()}}}}])})(),Oi=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"setEdgeRing",value:function(l,p){l.setMinEdgeRing(p)}},{key:"getNext",value:function(l){return l.getNextMin()}}],[{key:"constructor_",value:function(){var l=arguments[0],p=arguments[1];yi.constructor_.call(this,l,p)}}])})(yi),vi=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"buildMinimalRings",value:function(){var l=new wt,p=this._startDe;do{if(p.getMinEdgeRing()===null){var w=new Oi(p,this._geometryFactory);l.add(w)}p=p.getNext()}while(p!==this._startDe);return l}},{key:"setEdgeRing",value:function(l,p){l.setEdgeRing(p)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var l=this._startDe;do l.getNode().getEdges().linkMinimalDirectedEdges(this),l=l.getNext();while(l!==this._startDe)}},{key:"getNext",value:function(l){return l.getNext()}}],[{key:"constructor_",value:function(){var l=arguments[0],p=arguments[1];yi.constructor_.call(this,l,p)}}])})(yi),On=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(m){this._isVisited=m}},{key:"setInResult",value:function(m){this._isInResult=m}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(m){this._label=m}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(m){this._isCovered=m,this._isCoveredSet=!0}},{key:"updateIM",value:function(m){ye.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(m)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var m=arguments[0];this._label=m}}}}])})(),Ts=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"isIncidentEdgeInResult",value:function(){for(var l=this.getEdges().getEdges().iterator();l.hasNext();)if(l.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(l){l.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(l){}},{key:"computeMergedLocation",value:function(l,p){var w=Dt.NONE;if(w=this._label.getLocation(p),!l.isNull(p)){var D=l.getLocation(p);w!==Dt.BOUNDARY&&(w=D)}return w}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return Y(s,"setLabel",this,1).apply(this,arguments);var l=arguments[0],p=arguments[1];this._label===null?this._label=new Cn(l,p):this._label.setLocation(l,p)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof s){var l=arguments[0];this.mergeLabel(l._label)}else if(arguments[0]instanceof Cn)for(var p=arguments[0],w=0;w<2;w++){var D=this.computeMergedLocation(p,w);this._label.getLocation(w)===Dt.NONE&&this._label.setLocation(w,D)}}},{key:"add",value:function(l){this._edges.insert(l),l.setNode(this)}},{key:"setLabelBoundary",value:function(l){if(this._label===null)return null;var p=Dt.NONE;this._label!==null&&(p=this._label.getLocation(l));var w=null;switch(p){case Dt.BOUNDARY:w=Dt.INTERIOR;break;case Dt.INTERIOR:default:w=Dt.BOUNDARY}this._label.setLocation(l,w)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var l=arguments[0],p=arguments[1];this._coord=l,this._edges=p,this._label=new Cn(0,Dt.NONE)}}])})(On),$i=(function(m){function s(){return S(this,s),E(this,s,arguments)}return V(s,m),o(s)})(sl);function Wi(m){return m==null?0:m.color}function cn(m){return m==null?null:m.parent}function Sr(m,s){m!==null&&(m.color=s)}function $r(m){return m==null?null:m.left}function Un(m){return m==null?null:m.right}var Wr=(function(m){function s(){var l;return S(this,s),(l=E(this,s)).root_=null,l.size_=0,l}return V(s,m),o(s,[{key:"get",value:function(l){for(var p=this.root_;p!==null;){var w=l.compareTo(p.key);if(w<0)p=p.left;else{if(!(w>0))return p.value;p=p.right}}return null}},{key:"put",value:function(l,p){if(this.root_===null)return this.root_={key:l,value:p,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var w,D,B=this.root_;do if(w=B,(D=l.compareTo(B.key))<0)B=B.left;else{if(!(D>0)){var Q=B.value;return B.value=p,Q}B=B.right}while(B!==null);var ht={key:l,left:null,right:null,value:p,parent:w,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return D<0?w.left=ht:w.right=ht,this.fixAfterInsertion(ht),this.size_++,null}},{key:"fixAfterInsertion",value:function(l){var p;for(l.color=1;l!=null&&l!==this.root_&&l.parent.color===1;)cn(l)===$r(cn(cn(l)))?Wi(p=Un(cn(cn(l))))===1?(Sr(cn(l),0),Sr(p,0),Sr(cn(cn(l)),1),l=cn(cn(l))):(l===Un(cn(l))&&(l=cn(l),this.rotateLeft(l)),Sr(cn(l),0),Sr(cn(cn(l)),1),this.rotateRight(cn(cn(l)))):Wi(p=$r(cn(cn(l))))===1?(Sr(cn(l),0),Sr(p,0),Sr(cn(cn(l)),1),l=cn(cn(l))):(l===$r(cn(l))&&(l=cn(l),this.rotateRight(l)),Sr(cn(l),0),Sr(cn(cn(l)),1),this.rotateLeft(cn(cn(l))));this.root_.color=0}},{key:"values",value:function(){var l=new wt,p=this.getFirstEntry();if(p!==null)for(l.add(p.value);(p=s.successor(p))!==null;)l.add(p.value);return l}},{key:"entrySet",value:function(){var l=new Pt,p=this.getFirstEntry();if(p!==null)for(l.add(p);(p=s.successor(p))!==null;)l.add(p);return l}},{key:"rotateLeft",value:function(l){if(l!=null){var p=l.right;l.right=p.left,p.left!=null&&(p.left.parent=l),p.parent=l.parent,l.parent==null?this.root_=p:l.parent.left===l?l.parent.left=p:l.parent.right=p,p.left=l,l.parent=p}}},{key:"rotateRight",value:function(l){if(l!=null){var p=l.left;l.left=p.right,p.right!=null&&(p.right.parent=l),p.parent=l.parent,l.parent==null?this.root_=p:l.parent.right===l?l.parent.right=p:l.parent.left=p,p.right=l,l.parent=p}}},{key:"getFirstEntry",value:function(){var l=this.root_;if(l!=null)for(;l.left!=null;)l=l.left;return l}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(l){for(var p=this.root_;p!==null;){var w=l.compareTo(p.key);if(w<0)p=p.left;else{if(!(w>0))return!0;p=p.right}}return!1}}],[{key:"successor",value:function(l){var p;if(l===null)return null;if(l.right!==null){for(p=l.right;p.left!==null;)p=p.left;return p}p=l.parent;for(var w=l;p!==null&&w===p.right;)w=p,p=p.parent;return p}}])})($i),is=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"find",value:function(m){return this.nodeMap.get(m)}},{key:"addNode",value:function(){if(arguments[0]instanceof Gt){var m=arguments[0],s=this.nodeMap.get(m);return s===null&&(s=this.nodeFact.createNode(m),this.nodeMap.put(m,s)),s}if(arguments[0]instanceof Ts){var l=arguments[0],p=this.nodeMap.get(l.getCoordinate());return p===null?(this.nodeMap.put(l.getCoordinate(),l),l):(p.mergeLabel(l),p)}}},{key:"print",value:function(m){for(var s=this.iterator();s.hasNext();)s.next().print(m)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(m){for(var s=new wt,l=this.iterator();l.hasNext();){var p=l.next();p.getLabel().getLocation(m)===Dt.BOUNDARY&&s.add(p)}return s}},{key:"add",value:function(m){var s=m.getCoordinate();this.addNode(s).add(m)}}],[{key:"constructor_",value:function(){this.nodeMap=new Wr,this.nodeFact=null;var m=arguments[0];this.nodeFact=m}}])})(),xi=(function(){function m(){S(this,m)}return o(m,null,[{key:"isNorthern",value:function(s){return s===m.NE||s===m.NW}},{key:"isOpposite",value:function(s,l){return s!==l&&(s-l+4)%4===2}},{key:"commonHalfPlane",value:function(s,l){if(s===l)return s;if((s-l+4)%4===2)return-1;var p=s<l?s:l;return p===0&&(s>l?s:l)===3?3:p}},{key:"isInHalfPlane",value:function(s,l){return l===m.SE?s===m.SE||s===m.SW:s===l||s===l+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],l=arguments[1];if(s===0&&l===0)throw new kt("Cannot compute the quadrant for point ( "+s+", "+l+" )");return s>=0?l>=0?m.NE:m.SE:l>=0?m.NW:m.SW}if(arguments[0]instanceof Gt&&arguments[1]instanceof Gt){var p=arguments[0],w=arguments[1];if(w.x===p.x&&w.y===p.y)throw new kt("Cannot compute the quadrant for two identical points "+p);return w.x>=p.x?w.y>=p.y?m.NE:m.SE:w.y>=p.y?m.NW:m.SW}}}])})();xi.NE=0,xi.NW=1,xi.SW=2,xi.SE=3;var Xi=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"compareDirection",value:function(s){return this._dx===s._dx&&this._dy===s._dy?0:this._quadrant>s._quadrant?1:this._quadrant<s._quadrant?-1:Ye.index(s._p0,s._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(s){this._node=s}},{key:"print",value:function(s){var l=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),w=p.lastIndexOf("."),D=p.substring(w+1);s.print("  "+D+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+l+"   "+this._label)}},{key:"compareTo",value:function(s){var l=s;return this.compareDirection(l)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var s=Math.atan2(this._dy,this._dx),l=this.getClass().getName(),p=l.lastIndexOf(".");return"  "+l.substring(p+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label}},{key:"computeLabel",value:function(s){}},{key:"init",value:function(s,l){this._p0=s,this._p1=l,this._dx=l.x-s.x,this._dy=l.y-s.y,this._quadrant=xi.quadrant(this._dx,this._dy),ye.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var s=arguments[0];this._edge=s}else if(arguments.length===3){var l=arguments[0],p=arguments[1],w=arguments[2];m.constructor_.call(this,l,p,w,null)}else if(arguments.length===4){var D=arguments[0],B=arguments[1],Q=arguments[2],ht=arguments[3];m.constructor_.call(this,D),this.init(B,Q),this._label=ht}}}])})(),Fn=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(l){return this._depth[l]}},{key:"setVisited",value:function(l){this._isVisited=l}},{key:"computeDirectedLabel",value:function(){this._label=new Cn(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(l,p){if(this._depth[l]!==-999&&this._depth[l]!==p)throw new yn("assigned depths do not match",this.getCoordinate());this._depth[l]=p}},{key:"isInteriorAreaEdge",value:function(){for(var l=!0,p=0;p<2;p++)this._label.isArea(p)&&this._label.getLocation(p,Tt.LEFT)===Dt.INTERIOR&&this._label.getLocation(p,Tt.RIGHT)===Dt.INTERIOR||(l=!1);return l}},{key:"setNextMin",value:function(l){this._nextMin=l}},{key:"print",value:function(l){Y(s,"print",this,1).call(this,l),l.print(" "+this._depth[Tt.LEFT]+"/"+this._depth[Tt.RIGHT]),l.print(" ("+this.getDepthDelta()+")"),this._isInResult&&l.print(" inResult")}},{key:"setMinEdgeRing",value:function(l){this._minEdgeRing=l}},{key:"isLineEdge",value:function(){var l=this._label.isLine(0)||this._label.isLine(1),p=!this._label.isArea(0)||this._label.allPositionsEqual(0,Dt.EXTERIOR),w=!this._label.isArea(1)||this._label.allPositionsEqual(1,Dt.EXTERIOR);return l&&p&&w}},{key:"setEdgeRing",value:function(l){this._edgeRing=l}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var l=this._edge.getDepthDelta();return this._isForward||(l=-l),l}},{key:"setInResult",value:function(l){this._isInResult=l}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(l){this.print(l),l.print(" "),this._isForward?this._edge.print(l):this._edge.printReverse(l)}},{key:"setSym",value:function(l){this._sym=l}},{key:"setVisitedEdge",value:function(l){this.setVisited(l),this._sym.setVisited(l)}},{key:"setEdgeDepths",value:function(l,p){var w=this.getEdge().getDepthDelta();this._isForward||(w=-w);var D=1;l===Tt.LEFT&&(D=-1);var B=Tt.opposite(l),Q=p+w*D;this.setDepth(l,p),this.setDepth(B,Q)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(l){this._next=l}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var l=arguments[0],p=arguments[1];if(Xi.constructor_.call(this,l),this._isForward=p,p)this.init(l.getCoordinate(0),l.getCoordinate(1));else{var w=l.getNumPoints()-1;this.init(l.getCoordinate(w),l.getCoordinate(w-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(l,p){return l===Dt.EXTERIOR&&p===Dt.INTERIOR?1:l===Dt.INTERIOR&&p===Dt.EXTERIOR?-1:0}}])})(Xi),Er=(function(){return o((function m(){S(this,m)}),[{key:"createNode",value:function(m){return new Ts(m,null)}}])})(),Tn=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(m){m.println("Edges:");for(var s=0;s<this._edges.size();s++){m.println("edge "+s+":");var l=this._edges.get(s);l.print(m),l.eiList.print(m)}}},{key:"find",value:function(m){return this._nodes.find(m)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ts){var m=arguments[0];return this._nodes.addNode(m)}if(arguments[0]instanceof Gt){var s=arguments[0];return this._nodes.addNode(s)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var m=this._nodes.iterator();m.hasNext();)m.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(m){xt.out.println(m)}},{key:"isBoundaryNode",value:function(m,s){var l=this._nodes.find(s);if(l===null)return!1;var p=l.getLabel();return p!==null&&p.getLocation(m)===Dt.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var m=this._nodes.iterator();m.hasNext();)m.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(m,s,l,p){return!!m.equals(l)&&Ye.index(m,s,p)===Ye.COLLINEAR&&xi.quadrant(m,s)===xi.quadrant(l,p)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(m){xt.out.print(m)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(m,s){for(var l=0;l<this._edges.size();l++){var p=this._edges.get(l),w=p.getCoordinates();if(this.matchInSameDirection(m,s,w[0],w[1])||this.matchInSameDirection(m,s,w[w.length-1],w[w.length-2]))return p}return null}},{key:"insertEdge",value:function(m){this._edges.add(m)}},{key:"findEdgeEnd",value:function(m){for(var s=this.getEdgeEnds().iterator();s.hasNext();){var l=s.next();if(l.getEdge()===m)return l}return null}},{key:"addEdges",value:function(m){for(var s=m.iterator();s.hasNext();){var l=s.next();this._edges.add(l);var p=new Fn(l,!0),w=new Fn(l,!1);p.setSym(w),w.setSym(p),this.add(p),this.add(w)}}},{key:"add",value:function(m){this._nodes.add(m),this._edgeEndList.add(m)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(m,s){for(var l=0;l<this._edges.size();l++){var p=this._edges.get(l),w=p.getCoordinates();if(m.equals(w[0])&&s.equals(w[1]))return p}return null}}],[{key:"constructor_",value:function(){if(this._edges=new wt,this._nodes=null,this._edgeEndList=new wt,arguments.length===0)this._nodes=new is(new Er);else if(arguments.length===1){var m=arguments[0];this._nodes=new is(m)}}},{key:"linkResultDirectedEdges",value:function(m){for(var s=m.iterator();s.hasNext();)s.next().getEdges().linkResultDirectedEdges()}}])})(),mn=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"sortShellsAndHoles",value:function(s,l,p){for(var w=s.iterator();w.hasNext();){var D=w.next();D.isHole()?p.add(D):l.add(D)}}},{key:"computePolygons",value:function(s){for(var l=new wt,p=s.iterator();p.hasNext();){var w=p.next().toPolygon(this._geometryFactory);l.add(w)}return l}},{key:"placeFreeHoles",value:function(s,l){for(var p=l.iterator();p.hasNext();){var w=p.next();if(w.getShell()===null){var D=m.findEdgeRingContaining(w,s);if(D===null)throw new yn("unable to assign hole to a shell",w.getCoordinate(0));w.setShell(D)}}}},{key:"buildMinimalEdgeRings",value:function(s,l,p){for(var w=new wt,D=s.iterator();D.hasNext();){var B=D.next();if(B.getMaxNodeDegree()>2){B.linkDirectedEdgesForMinimalEdgeRings();var Q=B.buildMinimalRings(),ht=this.findShell(Q);ht!==null?(this.placePolygonHoles(ht,Q),l.add(ht)):p.addAll(Q)}else w.add(B)}return w}},{key:"buildMaximalEdgeRings",value:function(s){for(var l=new wt,p=s.iterator();p.hasNext();){var w=p.next();if(w.isInResult()&&w.getLabel().isArea()&&w.getEdgeRing()===null){var D=new vi(w,this._geometryFactory);l.add(D),D.setInResult()}}return l}},{key:"placePolygonHoles",value:function(s,l){for(var p=l.iterator();p.hasNext();){var w=p.next();w.isHole()&&w.setShell(s)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(s){for(var l=0,p=null,w=s.iterator();w.hasNext();){var D=w.next();D.isHole()||(p=D,l++)}return ye.isTrue(l<=1,"found two shells in MinimalEdgeRing list"),p}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];this.add(s.getEdgeEnds(),s.getNodes())}else if(arguments.length===2){var l=arguments[0],p=arguments[1];Tn.linkResultDirectedEdges(p);var w=this.buildMaximalEdgeRings(l),D=new wt,B=this.buildMinimalEdgeRings(w,this._shellList,D);this.sortShellsAndHoles(B,this._shellList,D),this.placeFreeHoles(this._shellList,D)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new wt;var s=arguments[0];this._geometryFactory=s}},{key:"findEdgeRingContaining",value:function(s,l){for(var p=s.getLinearRing(),w=p.getEnvelopeInternal(),D=p.getCoordinateN(0),B=null,Q=null,ht=l.iterator();ht.hasNext();){var vt=ht.next(),Yt=vt.getLinearRing(),ne=Yt.getEnvelopeInternal();if(!ne.equals(w)&&ne.contains(w)){D=Jn.ptNotInList(p.getCoordinates(),Yt.getCoordinates());var Se=!1;wn.isInRing(D,Yt.getCoordinates())&&(Se=!0),Se&&(B===null||Q.contains(ne))&&(Q=(B=vt).getLinearRing().getEnvelopeInternal())}}return B}}])})(),Ss=(function(){return o((function m(){S(this,m)}),[{key:"getBounds",value:function(){}}])})(),dn=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ss,Ot]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var m=arguments[0],s=arguments[1];this._bounds=m,this._item=s}}])})(),rs=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var m=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),m}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(m){for(var s=null,l=this._items.get(m);2*m<=this._size&&((s=2*m)!==this._size&&this._items.get(s+1).compareTo(this._items.get(s))<0&&s++,this._items.get(s).compareTo(l)<0);m=s)this._items.set(m,this._items.get(s));this._items.set(m,l)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(m){this._items.add(null),this._size+=1;var s=this._size;for(this._items.set(0,m);m.compareTo(this._items.get(Math.trunc(s/2)))<0;s/=2)this._items.set(s,this._items.get(Math.trunc(s/2)));this._items.set(s,m)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new wt,this._items.add(null)}}])})(),kr=(function(){return o((function m(){S(this,m)}),[{key:"insert",value:function(m,s){}},{key:"remove",value:function(m,s){}},{key:"query",value:function(){}}])})(),Fi=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(m){ye.isTrue(this._bounds===null),this._childBoundables.add(m)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ss,Ot]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new wt,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var m=arguments[0];this._level=m}}}}])})(),_r={reverseOrder:function(){return{compare:function(m,s){return s.compareTo(m)}}},min:function(m){return _r.sort(m),m.get(0)},sort:function(m,s){var l=m.toArray();s?we.sort(l,s):we.sort(l);for(var p=m.iterator(),w=0,D=l.length;w<D;w++)p.next(),p.set(l[w])},singletonList:function(m){var s=new wt;return s.add(m),s}},Fa=(function(){function m(){S(this,m)}return o(m,null,[{key:"maxDistance",value:function(s,l,p,w,D,B,Q,ht){var vt=m.distance(s,l,D,B);return vt=Math.max(vt,m.distance(s,l,Q,ht)),vt=Math.max(vt,m.distance(p,w,D,B)),vt=Math.max(vt,m.distance(p,w,Q,ht))}},{key:"distance",value:function(s,l,p,w){var D=p-s,B=w-l;return Math.sqrt(D*D+B*B)}},{key:"maximumDistance",value:function(s,l){var p=Math.min(s.getMinX(),l.getMinX()),w=Math.min(s.getMinY(),l.getMinY()),D=Math.max(s.getMaxX(),l.getMaxX()),B=Math.max(s.getMaxY(),l.getMaxY());return m.distance(p,w,D,B)}},{key:"minMaxDistance",value:function(s,l){var p=s.getMinX(),w=s.getMinY(),D=s.getMaxX(),B=s.getMaxY(),Q=l.getMinX(),ht=l.getMinY(),vt=l.getMaxX(),Yt=l.getMaxY(),ne=m.maxDistance(p,w,p,B,Q,ht,Q,Yt);return ne=Math.min(ne,m.maxDistance(p,w,p,B,Q,ht,vt,ht)),ne=Math.min(ne,m.maxDistance(p,w,p,B,vt,Yt,Q,Yt)),ne=Math.min(ne,m.maxDistance(p,w,p,B,vt,Yt,vt,ht)),ne=Math.min(ne,m.maxDistance(p,w,D,w,Q,ht,Q,Yt)),ne=Math.min(ne,m.maxDistance(p,w,D,w,Q,ht,vt,ht)),ne=Math.min(ne,m.maxDistance(p,w,D,w,vt,Yt,Q,Yt)),ne=Math.min(ne,m.maxDistance(p,w,D,w,vt,Yt,vt,ht)),ne=Math.min(ne,m.maxDistance(D,B,p,B,Q,ht,Q,Yt)),ne=Math.min(ne,m.maxDistance(D,B,p,B,Q,ht,vt,ht)),ne=Math.min(ne,m.maxDistance(D,B,p,B,vt,Yt,Q,Yt)),ne=Math.min(ne,m.maxDistance(D,B,p,B,vt,Yt,vt,ht)),ne=Math.min(ne,m.maxDistance(D,B,D,w,Q,ht,Q,Yt)),ne=Math.min(ne,m.maxDistance(D,B,D,w,Q,ht,vt,ht)),ne=Math.min(ne,m.maxDistance(D,B,D,w,vt,Yt,Q,Yt)),ne=Math.min(ne,m.maxDistance(D,B,D,w,vt,Yt,vt,ht))}}])})(),Xr=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"maximumDistance",value:function(){return Fa.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(s,l){var p=m.isComposite(this._boundable1),w=m.isComposite(this._boundable2);if(p&&w)return m.area(this._boundable1)>m.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,s,l),null):(this.expand(this._boundable2,this._boundable1,!0,s,l),null);if(p)return this.expand(this._boundable1,this._boundable2,!1,s,l),null;if(w)return this.expand(this._boundable2,this._boundable1,!0,s,l),null;throw new kt("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(m.isComposite(this._boundable1)||m.isComposite(this._boundable2))}},{key:"compareTo",value:function(s){var l=s;return this._distance<l._distance?-1:this._distance>l._distance?1:0}},{key:"expand",value:function(s,l,p,w,D){for(var B=s.getChildBoundables().iterator();B.hasNext();){var Q=B.next(),ht=null;(ht=p?new m(l,Q,this._itemDistance):new m(Q,l,this._itemDistance)).getDistance()<D&&w.add(ht)}}},{key:"getBoundable",value:function(s){return s===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var s=arguments[0],l=arguments[1],p=arguments[2];this._boundable1=s,this._boundable2=l,this._itemDistance=p,this._distance=this.distance()}},{key:"area",value:function(s){return s.getBounds().getArea()}},{key:"isComposite",value:function(s){return s instanceof Fi}}])})(),qs=(function(){return o((function m(){S(this,m)}),[{key:"visitItem",value:function(m){}}])})(),ss=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"queryInternal",value:function(){if(be(arguments[2],qs)&&arguments[0]instanceof Object&&arguments[1]instanceof Fi)for(var s=arguments[0],l=arguments[2],p=arguments[1].getChildBoundables(),w=0;w<p.size();w++){var D=p.get(w);this.getIntersectsOp().intersects(D.getBounds(),s)&&(D instanceof Fi?this.queryInternal(s,D,l):D instanceof dn?l.visitItem(D.getItem()):ye.shouldNeverReachHere())}else if(be(arguments[2],Qt)&&arguments[0]instanceof Object&&arguments[1]instanceof Fi)for(var B=arguments[0],Q=arguments[2],ht=arguments[1].getChildBoundables(),vt=0;vt<ht.size();vt++){var Yt=ht.get(vt);this.getIntersectsOp().intersects(Yt.getBounds(),B)&&(Yt instanceof Fi?this.queryInternal(B,Yt,Q):Yt instanceof dn?Q.add(Yt.getItem()):ye.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(s){return s.get(s.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var s=0,l=arguments[0].getChildBoundables().iterator();l.hasNext();){var p=l.next();p instanceof Fi?s+=this.size(p):p instanceof dn&&(s+=1)}return s}}},{key:"removeItem",value:function(s,l){for(var p=null,w=s.getChildBoundables().iterator();w.hasNext();){var D=w.next();D instanceof dn&&D.getItem()===l&&(p=D)}return p!==null&&(s.getChildBoundables().remove(p),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var s=this.itemsTree(this._root);return s===null?new wt:s}if(arguments.length===1){for(var l=arguments[0],p=new wt,w=l.getChildBoundables().iterator();w.hasNext();){var D=w.next();if(D instanceof Fi){var B=this.itemsTree(D);B!==null&&p.add(B)}else D instanceof dn?p.add(D.getItem()):ye.shouldNeverReachHere()}return p.size()<=0?null:p}}},{key:"insert",value:function(s,l){ye.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new dn(s,l))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var s=arguments[0],l=new wt;return this.boundablesAtLevel(s,this._root,l),l}if(arguments.length===3){var p=arguments[0],w=arguments[1],D=arguments[2];if(ye.isTrue(p>-2),w.getLevel()===p)return D.add(w),null;for(var B=w.getChildBoundables().iterator();B.hasNext();){var Q=B.next();Q instanceof Fi?this.boundablesAtLevel(p,Q,D):(ye.isTrue(Q instanceof dn),p===-1&&D.add(Q))}return null}}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];this.build();var l=new wt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.queryInternal(s,this._root,l),l}if(arguments.length===2){var p=arguments[0],w=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.queryInternal(p,this._root,w)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var s=arguments[0],l=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.remove(s,this._root,l)}if(arguments.length===3){var p=arguments[0],w=arguments[1],D=arguments[2],B=this.removeItem(w,D);if(B)return!0;for(var Q=null,ht=w.getChildBoundables().iterator();ht.hasNext();){var vt=ht.next();if(this.getIntersectsOp().intersects(vt.getBounds(),p)&&vt instanceof Fi&&(B=this.remove(p,vt,D))){Q=vt;break}}return Q!==null&&Q.getChildBoundables().isEmpty()&&w.getChildBoundables().remove(Q),B}}},{key:"createHigherLevels",value:function(s,l){ye.isTrue(!s.isEmpty());var p=this.createParentBoundables(s,l+1);return p.size()===1?p.get(0):this.createHigherLevels(p,l+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var s=0,l=arguments[0].getChildBoundables().iterator();l.hasNext();){var p=l.next();if(p instanceof Fi){var w=this.depth(p);w>s&&(s=w)}}return s+1}}},{key:"createParentBoundables",value:function(s,l){ye.isTrue(!s.isEmpty());var p=new wt;p.add(this.createNode(l));var w=new wt(s);_r.sort(w,this.getComparator());for(var D=w.iterator();D.hasNext();){var B=D.next();this.lastNode(p).getChildBoundables().size()===this.getNodeCapacity()&&p.add(this.createNode(l)),this.lastNode(p).addChildBoundable(B)}return p}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[Ot]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new wt,this._nodeCapacity=null,arguments.length===0)m.constructor_.call(this,m.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];ye.isTrue(s>1,"Node capacity must be greater than 1"),this._nodeCapacity=s}}},{key:"compareDoubles",value:function(s,l){return s>l?1:s<l?-1:0}}])})();ss.IntersectsOp=function(){},ss.DEFAULT_NODE_CAPACITY=10;var Zs=(function(){return o((function m(){S(this,m)}),[{key:"distance",value:function(m,s){}}])})(),Mr=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"createParentBoundablesFromVerticalSlices",value:function(l,p){ye.isTrue(l.length>0);for(var w=new wt,D=0;D<l.length;D++)w.addAll(this.createParentBoundablesFromVerticalSlice(l[D],p));return w}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var l=arguments[0],p=arguments[1];return this.nearestNeighbourK(l,_e.POSITIVE_INFINITY,p)}if(arguments.length===3){var w=arguments[0],D=arguments[2],B=arguments[1],Q=new rs;Q.add(w);for(var ht=new rs;!Q.isEmpty()&&B>=0;){var vt=Q.poll(),Yt=vt.getDistance();if(Yt>=B)break;vt.isLeaves()?ht.size()<D?ht.add(vt):(ht.peek().getDistance()>Yt&&(ht.poll(),ht.add(vt)),B=ht.peek().getDistance()):vt.expandToQueue(Q,B)}return s.getItems(ht)}}},{key:"createNode",value:function(l){return new Pr(l)}},{key:"size",value:function(){return arguments.length===0?Y(s,"size",this,1).call(this):Y(s,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof sn))return Y(s,"insert",this,1).apply(this,arguments);var l=arguments[0],p=arguments[1];if(l.isNull())return null;Y(s,"insert",this,1).call(this,l,p)}},{key:"getIntersectsOp",value:function(){return s.intersectsOp}},{key:"verticalSlices",value:function(l,p){for(var w=Math.trunc(Math.ceil(l.size()/p)),D=new Array(p).fill(null),B=l.iterator(),Q=0;Q<p;Q++){D[Q]=new wt;for(var ht=0;B.hasNext()&&ht<w;){var vt=B.next();D[Q].add(vt),ht++}}return D}},{key:"query",value:function(){if(arguments.length===1){var l=arguments[0];return Y(s,"query",this,1).call(this,l)}if(arguments.length===2){var p=arguments[0],w=arguments[1];Y(s,"query",this,1).call(this,p,w)}}},{key:"getComparator",value:function(){return s.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(l,p){return Y(s,"createParentBoundables",this,1).call(this,l,p)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof sn){var l=arguments[0],p=arguments[1];return Y(s,"remove",this,1).call(this,l,p)}return Y(s,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?Y(s,"depth",this,1).call(this):Y(s,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(l,p){ye.isTrue(!l.isEmpty());var w=Math.trunc(Math.ceil(l.size()/this.getNodeCapacity())),D=new wt(l);_r.sort(D,s.xComparator);var B=this.verticalSlices(D,Math.trunc(Math.ceil(Math.sqrt(w))));return this.createParentBoundablesFromVerticalSlices(B,p)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(be(arguments[0],Zs)){var l=arguments[0];if(this.isEmpty())return null;var p=new Xr(this.getRoot(),this.getRoot(),l);return this.nearestNeighbour(p)}if(arguments[0]instanceof Xr){var w=arguments[0],D=_e.POSITIVE_INFINITY,B=null,Q=new rs;for(Q.add(w);!Q.isEmpty()&&D>0;){var ht=Q.poll(),vt=ht.getDistance();if(vt>=D)break;ht.isLeaves()?(D=vt,B=ht):ht.expandToQueue(Q,D)}return B===null?null:[B.getBoundable(0).getItem(),B.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Yt=arguments[0],ne=arguments[1];if(this.isEmpty()||Yt.isEmpty())return null;var Se=new Xr(this.getRoot(),Yt.getRoot(),ne);return this.nearestNeighbour(Se)}if(arguments.length===3){var Ve=arguments[2],$e=new dn(arguments[0],arguments[1]),tn=new Xr(this.getRoot(),$e,Ve);return this.nearestNeighbour(tn)[0]}if(arguments.length===4){var fn=arguments[2],Sn=arguments[3],Bn=new dn(arguments[0],arguments[1]),wi=new Xr(this.getRoot(),Bn,fn);return this.nearestNeighbourK(wi,Sn)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var l=arguments[0],p=arguments[1],w=_e.POSITIVE_INFINITY,D=new rs;for(D.add(l);!D.isEmpty();){var B=D.poll(),Q=B.getDistance();if(Q>p)return!1;if(B.maximumDistance()<=p)return!0;if(B.isLeaves()){if((w=Q)<=p)return!0}else B.expandToQueue(D,w)}return!1}if(arguments.length===3){var ht=arguments[0],vt=arguments[1],Yt=arguments[2],ne=new Xr(this.getRoot(),ht.getRoot(),vt);return this.isWithinDistance(ne,Yt)}}},{key:"interfaces_",get:function(){return[kr,Ot]}}],[{key:"constructor_",value:function(){if(arguments.length===0)s.constructor_.call(this,s.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var l=arguments[0];ss.constructor_.call(this,l)}}},{key:"centreX",value:function(l){return s.avg(l.getMinX(),l.getMaxX())}},{key:"avg",value:function(l,p){return(l+p)/2}},{key:"getItems",value:function(l){for(var p=new Array(l.size()).fill(null),w=0;!l.isEmpty();){var D=l.poll();p[w]=D.getBoundable(0).getItem(),w++}return p}},{key:"centreY",value:function(l){return s.avg(l.getMinY(),l.getMaxY())}}])})(ss),Pr=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"computeBounds",value:function(){for(var l=null,p=this.getChildBoundables().iterator();p.hasNext();){var w=p.next();l===null?l=new sn(w.getBounds()):l.expandToInclude(w.getBounds())}return l}}],[{key:"constructor_",value:function(){var l=arguments[0];Fi.constructor_.call(this,l)}}])})(Fi);Mr.STRtreeNode=Pr,Mr.xComparator=new((function(){return o((function m(){S(this,m)}),[{key:"interfaces_",get:function(){return[Zt]}},{key:"compare",value:function(m,s){return ss.compareDoubles(Mr.centreX(m.getBounds()),Mr.centreX(s.getBounds()))}}])})()),Mr.yComparator=new((function(){return o((function m(){S(this,m)}),[{key:"interfaces_",get:function(){return[Zt]}},{key:"compare",value:function(m,s){return ss.compareDoubles(Mr.centreY(m.getBounds()),Mr.centreY(s.getBounds()))}}])})()),Mr.intersectsOp=new((function(){return o((function m(){S(this,m)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(m,s){return m.intersects(s)}}])})()),Mr.DEFAULT_NODE_CAPACITY=10;var Ri=(function(){function m(){S(this,m)}return o(m,null,[{key:"relativeSign",value:function(s,l){return s<l?-1:s>l?1:0}},{key:"compare",value:function(s,l,p){if(l.equals2D(p))return 0;var w=m.relativeSign(l.x,p.x),D=m.relativeSign(l.y,p.y);switch(s){case 0:return m.compareValue(w,D);case 1:return m.compareValue(D,w);case 2:return m.compareValue(D,-w);case 3:return m.compareValue(-w,D);case 4:return m.compareValue(-w,-D);case 5:return m.compareValue(-D,-w);case 6:return m.compareValue(-D,w);case 7:return m.compareValue(w,-D)}return ye.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(s,l){return s<0?-1:s>0?1:l<0?-1:l>0?1:0}}])})(),Ba=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(m){m.print(this.coord),m.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(m){var s=m;return this.segmentIndex<s.segmentIndex?-1:this.segmentIndex>s.segmentIndex?1:this.coord.equals2D(s.coord)?0:this._isInterior?s._isInterior?Ri.compare(this._segmentOctant,this.coord,s.coord):1:-1}},{key:"isEndPoint",value:function(m){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===m}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var m=arguments[0],s=arguments[1],l=arguments[2],p=arguments[3];this._segString=m,this.coord=new Gt(s),this.segmentIndex=l,this._segmentOctant=p,this._isInterior=!s.equals2D(m.getCoordinate(l))}}])})(),cl=(function(){return o((function m(){S(this,m)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),zi=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var m=new Fr;this.addEndpoints();for(var s=this.iterator(),l=s.next();s.hasNext();){var p=s.next();this.addEdgeCoordinates(l,p,m),l=p}return m.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var m=new wt;this.findCollapsesFromInsertedNodes(m),this.findCollapsesFromExistingVertices(m);for(var s=m.iterator();s.hasNext();){var l=s.next().intValue();this.add(this._edge.getCoordinate(l),l)}}},{key:"createSplitEdgePts",value:function(m,s){var l=s.segmentIndex-m.segmentIndex+2;if(l===2)return[new Gt(m.coord),new Gt(s.coord)];var p=this._edge.getCoordinate(s.segmentIndex),w=s.isInterior()||!s.coord.equals2D(p);w||l--;var D=new Array(l).fill(null),B=0;D[B++]=new Gt(m.coord);for(var Q=m.segmentIndex+1;Q<=s.segmentIndex;Q++)D[B++]=this._edge.getCoordinate(Q);return w&&(D[B]=new Gt(s.coord)),D}},{key:"print",value:function(m){m.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(m)}},{key:"findCollapsesFromExistingVertices",value:function(m){for(var s=0;s<this._edge.size()-2;s++){var l=this._edge.getCoordinate(s);this._edge.getCoordinate(s+1);var p=this._edge.getCoordinate(s+2);l.equals2D(p)&&m.add(Je.valueOf(s+1))}}},{key:"addEdgeCoordinates",value:function(m,s,l){var p=this.createSplitEdgePts(m,s);l.add(p,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(m){this.addEndpoints(),this.addCollapsedNodes();for(var s=this.iterator(),l=s.next();s.hasNext();){var p=s.next(),w=this.createSplitEdge(l,p);m.add(w),l=p}}},{key:"findCollapseIndex",value:function(m,s,l){if(!m.coord.equals2D(s.coord))return!1;var p=s.segmentIndex-m.segmentIndex;return s.isInterior()||p--,p===1&&(l[0]=m.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(m){for(var s=new Array(1).fill(null),l=this.iterator(),p=l.next();l.hasNext();){var w=l.next();this.findCollapseIndex(p,w,s)&&m.add(Je.valueOf(s[0])),p=w}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var m=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(m),m)}},{key:"createSplitEdge",value:function(m,s){var l=this.createSplitEdgePts(m,s);return new as(l,this._edge.getData())}},{key:"add",value:function(m,s){var l=new Ba(this._edge,m,s,this._edge.getSegmentOctant(s)),p=this._nodeMap.get(l);return p!==null?(ye.isTrue(p.coord.equals2D(m),"Found equal nodes with different coordinates"),p):(this._nodeMap.put(l,l),l)}},{key:"checkSplitEdgesCorrectness",value:function(m){var s=this._edge.getCoordinates(),l=m.get(0).getCoordinate(0);if(!l.equals2D(s[0]))throw new Xt("bad split edge start point at "+l);var p=m.get(m.size()-1).getCoordinates(),w=p[p.length-1];if(!w.equals2D(s[s.length-1]))throw new Xt("bad split edge end point at "+w)}}],[{key:"constructor_",value:function(){this._nodeMap=new Wr,this._edge=null;var m=arguments[0];this._edge=m}}])})(),fi=(function(){function m(){S(this,m)}return o(m,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],l=arguments[1];if(s===0&&l===0)throw new kt("Cannot compute the octant for point ( "+s+", "+l+" )");var p=Math.abs(s),w=Math.abs(l);return s>=0?l>=0?p>=w?0:1:p>=w?7:6:l>=0?p>=w?3:2:p>=w?4:5}if(arguments[0]instanceof Gt&&arguments[1]instanceof Gt){var D=arguments[0],B=arguments[1],Q=B.x-D.x,ht=B.y-D.y;if(Q===0&&ht===0)throw new kt("Cannot compute the octant for two identical points "+D);return m.octant(Q,ht)}}}])})(),Cr=(function(){return o((function m(){S(this,m)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(m){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(m){}},{key:"getData",value:function(){}}])})(),$s=(function(){return o((function m(){S(this,m)}),[{key:"addIntersection",value:function(m,s){}},{key:"interfaces_",get:function(){return[Cr]}}])})(),as=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(s){return this._pts[s]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(s){return s===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(s),this.getCoordinate(s+1))}},{key:"setData",value:function(s){this._data=s}},{key:"safeOctant",value:function(s,l){return s.equals2D(l)?0:fi.octant(s,l)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var s=arguments[0],l=arguments[1];this.addIntersectionNode(s,l)}else if(arguments.length===4){var p=arguments[1],w=arguments[3],D=new Gt(arguments[0].getIntersection(w));this.addIntersection(D,p)}}},{key:"toString",value:function(){return Zr.toLineString(new Br(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(s,l){var p=l,w=p+1;if(w<this._pts.length){var D=this._pts[w];s.equals2D(D)&&(p=w)}return this._nodeList.add(s,p)}},{key:"addIntersections",value:function(s,l,p){for(var w=0;w<s.getIntersectionNum();w++)this.addIntersection(s,l,p,w)}},{key:"interfaces_",get:function(){return[$s]}}],[{key:"constructor_",value:function(){this._nodeList=new zi(this),this._pts=null,this._data=null;var s=arguments[0],l=arguments[1];this._pts=s,this._data=l}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var s=arguments[0],l=new wt;return m.getNodedSubstrings(s,l),l}if(arguments.length===2)for(var p=arguments[1],w=arguments[0].iterator();w.hasNext();)w.next().getNodeList().addSplitEdges(p)}}])})(),Ki=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof m){var s=arguments[0],l=Ye.index(this.p0,this.p1,s.p0),p=Ye.index(this.p0,this.p1,s.p1);return l>=0&&p>=0||l<=0&&p<=0?Math.max(l,p):0}if(arguments[0]instanceof Gt){var w=arguments[0];return Ye.index(this.p0,this.p1,w)}}},{key:"toGeometry",value:function(s){return s.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(s){if(!(s instanceof m))return!1;var l=s;return this.p0.equals(l.p0)&&this.p1.equals(l.p1)}},{key:"intersection",value:function(s){var l=new un;return l.computeIntersection(this.p0,this.p1,s.p0,s.p1),l.hasIntersection()?l.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Gt){var s=arguments[0];if(s.equals(this.p0)||s.equals(this.p1))return new Gt(s);var l=this.projectionFactor(s),p=new Gt;return p.x=this.p0.x+l*(this.p1.x-this.p0.x),p.y=this.p0.y+l*(this.p1.y-this.p0.y),p}if(arguments[0]instanceof m){var w=arguments[0],D=this.projectionFactor(w.p0),B=this.projectionFactor(w.p1);if(D>=1&&B>=1||D<=0&&B<=0)return null;var Q=this.project(w.p0);D<0&&(Q=this.p0),D>1&&(Q=this.p1);var ht=this.project(w.p1);return B<0&&(ht=this.p0),B>1&&(ht=this.p1),new m(Q,ht)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(s){return s===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(s){return $t.pointToLinePerpendicular(s,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return m.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(s){if(s.equals(this.p0))return 0;if(s.equals(this.p1))return 1;var l=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,w=l*l+p*p;return w<=0?_e.NaN:((s.x-this.p0.x)*l+(s.y-this.p0.y)*p)/w}},{key:"closestPoints",value:function(s){var l=this.intersection(s);if(l!==null)return[l,l];var p=new Array(2).fill(null),w=_e.MAX_VALUE,D=null,B=this.closestPoint(s.p0);w=B.distance(s.p0),p[0]=B,p[1]=s.p0;var Q=this.closestPoint(s.p1);(D=Q.distance(s.p1))<w&&(w=D,p[0]=Q,p[1]=s.p1);var ht=s.closestPoint(this.p0);(D=ht.distance(this.p0))<w&&(w=D,p[0]=this.p0,p[1]=ht);var vt=s.closestPoint(this.p1);return(D=vt.distance(this.p1))<w&&(w=D,p[0]=this.p1,p[1]=vt),p}},{key:"closestPoint",value:function(s){var l=this.projectionFactor(s);return l>0&&l<1?this.project(s):this.p0.distance(s)<this.p1.distance(s)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(s){var l=s,p=this.p0.compareTo(l.p0);return p!==0?p:this.p1.compareTo(l.p1)}},{key:"reverse",value:function(){var s=this.p0;this.p0=this.p1,this.p1=s}},{key:"equalsTopo",value:function(s){return this.p0.equals(s.p0)&&this.p1.equals(s.p1)||this.p0.equals(s.p1)&&this.p1.equals(s.p0)}},{key:"lineIntersection",value:function(s){return lt.intersection(this.p0,this.p1,s.p0,s.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(s,l){var p=this.p0.x+s*(this.p1.x-this.p0.x),w=this.p0.y+s*(this.p1.y-this.p0.y),D=this.p1.x-this.p0.x,B=this.p1.y-this.p0.y,Q=Math.sqrt(D*D+B*B),ht=0,vt=0;if(l!==0){if(Q<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");ht=l*D/Q,vt=l*B/Q}return new Gt(p-vt,w+ht)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var s=arguments[0];this.setCoordinates(s.p0,s.p1)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];this.p0.x=l.x,this.p0.y=l.y,this.p1.x=p.x,this.p1.y=p.y}}},{key:"segmentFraction",value:function(s){var l=this.projectionFactor(s);return l<0?l=0:(l>1||_e.isNaN(l))&&(l=1),l}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(s){var l=this.p1.getY()-this.p0.getY(),p=this.p0.getX()-this.p1.getX(),w=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),D=l*l+p*p,B=l*l-p*p,Q=s.getX(),ht=s.getY();return new Gt((-B*Q-2*l*p*ht-2*l*w)/D,(B*ht-2*l*p*Q-2*p*w)/D)}},{key:"distance",value:function(){if(arguments[0]instanceof m){var s=arguments[0];return $t.segmentToSegment(this.p0,this.p1,s.p0,s.p1)}if(arguments[0]instanceof Gt){var l=arguments[0];return $t.pointToSegment(l,this.p0,this.p1)}}},{key:"pointAlong",value:function(s){var l=new Gt;return l.x=this.p0.x+s*(this.p1.x-this.p0.x),l.y=this.p0.y+s*(this.p1.y-this.p0.y),l}},{key:"hashCode",value:function(){var s=_e.doubleToLongBits(this.p0.x);s^=31*_e.doubleToLongBits(this.p0.y);var l=Math.trunc(s)^Math.trunc(s>>32),p=_e.doubleToLongBits(this.p1.x);return p^=31*_e.doubleToLongBits(this.p1.y),l^(Math.trunc(p)^Math.trunc(p>>32))}},{key:"interfaces_",get:function(){return[Mt,Ot]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)m.constructor_.call(this,new Gt,new Gt);else if(arguments.length===1){var s=arguments[0];m.constructor_.call(this,s.p0,s.p1)}else if(arguments.length===2){var l=arguments[0],p=arguments[1];this.p0=l,this.p1=p}else if(arguments.length===4){var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3];m.constructor_.call(this,new Gt(w,D),new Gt(B,Q))}}},{key:"midPoint",value:function(s,l){return new Gt((s.x+l.x)/2,(s.y+l.y)/2)}}])})(),Ar=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var m=arguments[1],s=arguments[2],l=arguments[3];arguments[0].getLineSegment(m,this._overlapSeg1),s.getLineSegment(l,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Ki,this._overlapSeg2=new Ki}}])})(),ca=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(m,s){s.p0=this._pts[m],s.p1=this._pts[m+1]}},{key:"computeSelect",value:function(m,s,l,p){var w=this._pts[s],D=this._pts[l];if(l-s==1)return p.select(this,s),null;if(!m.intersects(w,D))return null;var B=Math.trunc((s+l)/2);s<B&&this.computeSelect(m,s,B,p),B<l&&this.computeSelect(m,B,l,p)}},{key:"getCoordinates",value:function(){for(var m=new Array(this._end-this._start+1).fill(null),s=0,l=this._start;l<=this._end;l++)m[s++]=this._pts[l];return m}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var m=arguments[0],s=arguments[1];this.computeOverlaps(this._start,this._end,m,m._start,m._end,s)}else if(arguments.length===6){var l=arguments[0],p=arguments[1],w=arguments[2],D=arguments[3],B=arguments[4],Q=arguments[5];if(p-l==1&&B-D==1)return Q.overlap(this,l,w,D),null;if(!this.overlaps(l,p,w,D,B))return null;var ht=Math.trunc((l+p)/2),vt=Math.trunc((D+B)/2);l<ht&&(D<vt&&this.computeOverlaps(l,ht,w,D,vt,Q),vt<B&&this.computeOverlaps(l,ht,w,vt,B,Q)),ht<p&&(D<vt&&this.computeOverlaps(ht,p,w,D,vt,Q),vt<B&&this.computeOverlaps(ht,p,w,vt,B,Q))}}},{key:"setId",value:function(m){this._id=m}},{key:"select",value:function(m,s){this.computeSelect(m,this._start,this._end,s)}},{key:"getEnvelope",value:function(){if(this._env===null){var m=this._pts[this._start],s=this._pts[this._end];this._env=new sn(m,s)}return this._env}},{key:"overlaps",value:function(m,s,l,p,w){return sn.intersects(this._pts[m],this._pts[s],l._pts[p],l._pts[w])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var m=arguments[0],s=arguments[1],l=arguments[2],p=arguments[3];this._pts=m,this._start=s,this._end=l,this._context=p}}])})(),fo=(function(){function m(){S(this,m)}return o(m,null,[{key:"findChainEnd",value:function(s,l){for(var p=l;p<s.length-1&&s[p].equals2D(s[p+1]);)p++;if(p>=s.length-1)return s.length-1;for(var w=xi.quadrant(s[p],s[p+1]),D=l+1;D<s.length&&!(!s[D-1].equals2D(s[D])&&xi.quadrant(s[D-1],s[D])!==w);)D++;return D-1}},{key:"getChains",value:function(){if(arguments.length===1){var s=arguments[0];return m.getChains(s,null)}if(arguments.length===2){var l=arguments[0],p=arguments[1],w=new wt,D=0;do{var B=m.findChainEnd(l,D),Q=new ca(l,D,B,p);w.add(Q),D=B}while(D<l.length-1);return w}}}])})(),po=(function(){return o((function m(){S(this,m)}),[{key:"computeNodes",value:function(m){}},{key:"getNodedSubstrings",value:function(){}}])})(),mo=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(m){this._segInt=m}},{key:"interfaces_",get:function(){return[po]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var m=arguments[0];this.setSegmentIntersector(m)}}}}])})(),Ws=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return as.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(l){for(var p=fo.getChains(l.getCoordinates(),l).iterator();p.hasNext();){var w=p.next();w.setId(this._idCounter++),this._index.insert(w.getEnvelope(),w),this._monoChains.add(w)}}},{key:"computeNodes",value:function(l){this._nodedSegStrings=l;for(var p=l.iterator();p.hasNext();)this.add(p.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var l=new ha(this._segInt),p=this._monoChains.iterator();p.hasNext();)for(var w=p.next(),D=this._index.query(w.getEnvelope()).iterator();D.hasNext();){var B=D.next();if(B.getId()>w.getId()&&(w.computeOverlaps(B,l),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new wt,this._index=new Mr,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var l=arguments[0];mo.constructor_.call(this,l)}}}}])})(mo),ha=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"overlap",value:function(){if(arguments.length!==4)return Y(s,"overlap",this,1).apply(this,arguments);var l=arguments[1],p=arguments[2],w=arguments[3],D=arguments[0].getContext(),B=p.getContext();this._si.processIntersections(D,l,B,w)}}],[{key:"constructor_",value:function(){this._si=null;var l=arguments[0];this._si=l}}])})(Ar);Ws.SegmentOverlapAction=ha;var Qn=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"isDeletable",value:function(s,l,p,w){var D=this._inputLine[s],B=this._inputLine[l],Q=this._inputLine[p];return!!this.isConcave(D,B,Q)&&!!this.isShallow(D,B,Q,w)&&this.isShallowSampled(D,B,s,p,w)}},{key:"deleteShallowConcavities",value:function(){for(var s=1,l=this.findNextNonDeletedIndex(s),p=this.findNextNonDeletedIndex(l),w=!1;p<this._inputLine.length;){var D=!1;this.isDeletable(s,l,p,this._distanceTol)&&(this._isDeleted[l]=m.DELETE,D=!0,w=!0),s=D?p:l,l=this.findNextNonDeletedIndex(s),p=this.findNextNonDeletedIndex(l)}return w}},{key:"isShallowConcavity",value:function(s,l,p,w){return Ye.index(s,l,p)===this._angleOrientation&&$t.pointToSegment(l,s,p)<w}},{key:"isShallowSampled",value:function(s,l,p,w,D){var B=Math.trunc((w-p)/m.NUM_PTS_TO_CHECK);B<=0&&(B=1);for(var Q=p;Q<w;Q+=B)if(!this.isShallow(s,l,this._inputLine[Q],D))return!1;return!0}},{key:"isConcave",value:function(s,l,p){var w=Ye.index(s,l,p)===this._angleOrientation;return w}},{key:"simplify",value:function(s){this._distanceTol=Math.abs(s),s<0&&(this._angleOrientation=Ye.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var l=!1;do l=this.deleteShallowConcavities();while(l);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(s){for(var l=s+1;l<this._inputLine.length&&this._isDeleted[l]===m.DELETE;)l++;return l}},{key:"isShallow",value:function(s,l,p,w){return $t.pointToSegment(l,s,p)<w}},{key:"collapseLine",value:function(){for(var s=new Fr,l=0;l<this._inputLine.length;l++)this._isDeleted[l]!==m.DELETE&&s.add(this._inputLine[l]);return s.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ye.COUNTERCLOCKWISE;var s=arguments[0];this._inputLine=s}},{key:"simplify",value:function(s,l){return new m(s).simplify(l)}}])})();Qn.INIT=0,Qn.DELETE=1,Qn.KEEP=1,Qn.NUM_PTS_TO_CHECK=10;var da=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getCoordinates",value:function(){return this._ptList.toArray(m.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"addPt",value:function(s){var l=new Gt(s);if(this._precisionModel.makePrecise(l),this.isRedundant(l))return null;this._ptList.add(l)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(s,l){if(l)for(var p=0;p<s.length;p++)this.addPt(s[p]);else for(var w=s.length-1;w>=0;w--)this.addPt(s[w])}},{key:"isRedundant",value:function(s){if(this._ptList.size()<1)return!1;var l=this._ptList.get(this._ptList.size()-1);return s.distance(l)<this._minimimVertexDistance}},{key:"toString",value:function(){return new ds().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var s=new Gt(this._ptList.get(0)),l=this._ptList.get(this._ptList.size()-1);if(s.equals(l))return null;this._ptList.add(s)}},{key:"setMinimumVertexDistance",value:function(s){this._minimimVertexDistance=s}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new wt}}])})();da.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var bi=(function(){function m(){S(this,m)}return o(m,null,[{key:"toDegrees",value:function(s){return 180*s/Math.PI}},{key:"normalize",value:function(s){for(;s>Math.PI;)s-=m.PI_TIMES_2;for(;s<=-Math.PI;)s+=m.PI_TIMES_2;return s}},{key:"angle",value:function(){if(arguments.length===1){var s=arguments[0];return Math.atan2(s.y,s.x)}if(arguments.length===2){var l=arguments[0],p=arguments[1],w=p.x-l.x,D=p.y-l.y;return Math.atan2(D,w)}}},{key:"isAcute",value:function(s,l,p){var w=s.x-l.x,D=s.y-l.y;return w*(p.x-l.x)+D*(p.y-l.y)>0}},{key:"isObtuse",value:function(s,l,p){var w=s.x-l.x,D=s.y-l.y;return w*(p.x-l.x)+D*(p.y-l.y)<0}},{key:"interiorAngle",value:function(s,l,p){var w=m.angle(l,s),D=m.angle(l,p);return Math.abs(D-w)}},{key:"normalizePositive",value:function(s){if(s<0){for(;s<0;)s+=m.PI_TIMES_2;s>=m.PI_TIMES_2&&(s=0)}else{for(;s>=m.PI_TIMES_2;)s-=m.PI_TIMES_2;s<0&&(s=0)}return s}},{key:"angleBetween",value:function(s,l,p){var w=m.angle(l,s),D=m.angle(l,p);return m.diff(w,D)}},{key:"diff",value:function(s,l){var p=null;return(p=s<l?l-s:s-l)>Math.PI&&(p=2*Math.PI-p),p}},{key:"toRadians",value:function(s){return s*Math.PI/180}},{key:"getTurn",value:function(s,l){var p=Math.sin(l-s);return p>0?m.COUNTERCLOCKWISE:p<0?m.CLOCKWISE:m.NONE}},{key:"angleBetweenOriented",value:function(s,l,p){var w=m.angle(l,s),D=m.angle(l,p)-w;return D<=-Math.PI?D+m.PI_TIMES_2:D>Math.PI?D-m.PI_TIMES_2:D}}])})();bi.PI_TIMES_2=2*Math.PI,bi.PI_OVER_2=Math.PI/2,bi.PI_OVER_4=Math.PI/4,bi.COUNTERCLOCKWISE=Ye.COUNTERCLOCKWISE,bi.CLOCKWISE=Ye.CLOCKWISE,bi.NONE=Ye.COLLINEAR;var Es=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"addNextSegment",value:function(s,l){if(this._s0=this._s1,this._s1=this._s2,this._s2=s,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=Ye.index(this._s0,this._s1,this._s2),w=p===Ye.CLOCKWISE&&this._side===Tt.LEFT||p===Ye.COUNTERCLOCKWISE&&this._side===Tt.RIGHT;p===0?this.addCollinear(l):w?this.addOutsideTurn(p,l):this.addInsideTurn(p,l)}},{key:"addLineEndCap",value:function(s,l){var p=new Ki(s,l),w=new Ki;this.computeOffsetSegment(p,Tt.LEFT,this._distance,w);var D=new Ki;this.computeOffsetSegment(p,Tt.RIGHT,this._distance,D);var B=l.x-s.x,Q=l.y-s.y,ht=Math.atan2(Q,B);switch(this._bufParams.getEndCapStyle()){case dt.CAP_ROUND:this._segList.addPt(w.p1),this.addDirectedFillet(l,ht+Math.PI/2,ht-Math.PI/2,Ye.CLOCKWISE,this._distance),this._segList.addPt(D.p1);break;case dt.CAP_FLAT:this._segList.addPt(w.p1),this._segList.addPt(D.p1);break;case dt.CAP_SQUARE:var vt=new Gt;vt.x=Math.abs(this._distance)*Math.cos(ht),vt.y=Math.abs(this._distance)*Math.sin(ht);var Yt=new Gt(w.p1.x+vt.x,w.p1.y+vt.y),ne=new Gt(D.p1.x+vt.x,D.p1.y+vt.y);this._segList.addPt(Yt),this._segList.addPt(ne)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(s,l,p,w){var D=lt.intersection(l.p0,l.p1,p.p0,p.p1);if(D!==null&&(w<=0?1:D.distance(s)/Math.abs(w))<=this._bufParams.getMitreLimit())return this._segList.addPt(D),null;this.addLimitedMitreJoin(l,p,w,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(s,l){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*m.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===dt.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===dt.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(l&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,s,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(s){this._segList.addPt(new Gt(s.x+this._distance,s.y+this._distance)),this._segList.addPt(new Gt(s.x+this._distance,s.y-this._distance)),this._segList.addPt(new Gt(s.x-this._distance,s.y-this._distance)),this._segList.addPt(new Gt(s.x-this._distance,s.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(s,l){this._segList.addPts(s,l)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(s,l,p,w,D){var B=l.x-s.x,Q=l.y-s.y,ht=Math.atan2(Q,B),vt=p.x-s.x,Yt=p.y-s.y,ne=Math.atan2(Yt,vt);w===Ye.CLOCKWISE?ht<=ne&&(ht+=2*Math.PI):ht>=ne&&(ht-=2*Math.PI),this._segList.addPt(l),this.addDirectedFillet(s,ht,ne,w,D),this._segList.addPt(p)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(s,l,p){this._s1=s,this._s2=l,this._side=p,this._seg1.setCoordinates(s,l),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(s,l,p,w){var D=this._seg0.p1,B=bi.angle(D,this._seg0.p0),Q=bi.angleBetweenOriented(this._seg0.p0,D,this._seg1.p1)/2,ht=bi.normalize(B+Q),vt=bi.normalize(ht+Math.PI),Yt=w*p,ne=p-Yt*Math.abs(Math.sin(Q)),Se=D.x+Yt*Math.cos(vt),Ve=D.y+Yt*Math.sin(vt),$e=new Gt(Se,Ve),tn=new Ki(D,$e),fn=tn.pointAlongOffset(1,ne),Sn=tn.pointAlongOffset(1,-ne);this._side===Tt.LEFT?(this._segList.addPt(fn),this._segList.addPt(Sn)):(this._segList.addPt(Sn),this._segList.addPt(fn))}},{key:"addDirectedFillet",value:function(s,l,p,w,D){var B=w===Ye.CLOCKWISE?-1:1,Q=Math.abs(l-p),ht=Math.trunc(Q/this._filletAngleQuantum+.5);if(ht<1)return null;for(var vt=Q/ht,Yt=new Gt,ne=0;ne<ht;ne++){var Se=l+B*ne*vt;Yt.x=s.x+D*Math.cos(Se),Yt.y=s.y+D*Math.sin(Se),this._segList.addPt(Yt)}}},{key:"computeOffsetSegment",value:function(s,l,p,w){var D=l===Tt.LEFT?1:-1,B=s.p1.x-s.p0.x,Q=s.p1.y-s.p0.y,ht=Math.sqrt(B*B+Q*Q),vt=D*p*B/ht,Yt=D*p*Q/ht;w.p0.x=s.p0.x-Yt,w.p0.y=s.p0.y+vt,w.p1.x=s.p1.x-Yt,w.p1.y=s.p1.y+vt}},{key:"addInsideTurn",value:function(s,l){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*m.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new Gt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var w=new Gt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(w)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(s){var l=new Gt(s.x+this._distance,s.y);this._segList.addPt(l),this.addDirectedFillet(s,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(s,l){this._segList.addPt(s.p1),this._segList.addPt(l.p0)}},{key:"init",value:function(s){this._distance=s,this._maxCurveSegmentError=s*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new da,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(s*m.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(s){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===dt.JOIN_BEVEL||this._bufParams.getJoinStyle()===dt.JOIN_MITRE?(s&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Ye.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ki,this._seg1=new Ki,this._offset0=new Ki,this._offset1=new Ki,this._side=0,this._hasNarrowConcaveAngle=!1;var s=arguments[0],l=arguments[1],p=arguments[2];this._precisionModel=s,this._bufParams=l,this._li=new un,this._filletAngleQuantum=Math.PI/2/l.getQuadrantSegments(),l.getQuadrantSegments()>=8&&l.getJoinStyle()===dt.JOIN_ROUND&&(this._closingSegLengthFactor=m.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)}}])})();Es.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Es.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Es.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Es.MAX_CLOSING_SEG_LEN_FACTOR=80;var fa=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getOffsetCurve",value:function(s,l){if(this._distance=l,l===0)return null;var p=l<0,w=Math.abs(l),D=this.getSegGen(w);s.length<=1?this.computePointCurve(s[0],D):this.computeOffsetCurve(s,p,D);var B=D.getCoordinates();return p&&Jn.reverse(B),B}},{key:"computeSingleSidedBufferCurve",value:function(s,l,p){var w=this.simplifyTolerance(this._distance);if(l){p.addSegments(s,!0);var D=Qn.simplify(s,-w),B=D.length-1;p.initSideSegments(D[B],D[B-1],Tt.LEFT),p.addFirstSegment();for(var Q=B-2;Q>=0;Q--)p.addNextSegment(D[Q],!0)}else{p.addSegments(s,!1);var ht=Qn.simplify(s,w),vt=ht.length-1;p.initSideSegments(ht[0],ht[1],Tt.LEFT),p.addFirstSegment();for(var Yt=2;Yt<=vt;Yt++)p.addNextSegment(ht[Yt],!0)}p.addLastSegment(),p.closeRing()}},{key:"computeRingBufferCurve",value:function(s,l,p){var w=this.simplifyTolerance(this._distance);l===Tt.RIGHT&&(w=-w);var D=Qn.simplify(s,w),B=D.length-1;p.initSideSegments(D[B-1],D[0],l);for(var Q=1;Q<=B;Q++){var ht=Q!==1;p.addNextSegment(D[Q],ht)}p.closeRing()}},{key:"computeLineBufferCurve",value:function(s,l){var p=this.simplifyTolerance(this._distance),w=Qn.simplify(s,p),D=w.length-1;l.initSideSegments(w[0],w[1],Tt.LEFT);for(var B=2;B<=D;B++)l.addNextSegment(w[B],!0);l.addLastSegment(),l.addLineEndCap(w[D-1],w[D]);var Q=Qn.simplify(s,-p),ht=Q.length-1;l.initSideSegments(Q[ht],Q[ht-1],Tt.LEFT);for(var vt=ht-2;vt>=0;vt--)l.addNextSegment(Q[vt],!0);l.addLastSegment(),l.addLineEndCap(Q[1],Q[0]),l.closeRing()}},{key:"computePointCurve",value:function(s,l){switch(this._bufParams.getEndCapStyle()){case dt.CAP_ROUND:l.createCircle(s);break;case dt.CAP_SQUARE:l.createSquare(s)}}},{key:"getLineCurve",value:function(s,l){if(this._distance=l,this.isLineOffsetEmpty(l))return null;var p=Math.abs(l),w=this.getSegGen(p);if(s.length<=1)this.computePointCurve(s[0],w);else if(this._bufParams.isSingleSided()){var D=l<0;this.computeSingleSidedBufferCurve(s,D,w)}else this.computeLineBufferCurve(s,w);return w.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(s){return s*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(s,l,p){if(this._distance=p,s.length<=2)return this.getLineCurve(s,p);if(p===0)return m.copyCoordinates(s);var w=this.getSegGen(p);return this.computeRingBufferCurve(s,l,w),w.getCoordinates()}},{key:"computeOffsetCurve",value:function(s,l,p){var w=this.simplifyTolerance(this._distance);if(l){var D=Qn.simplify(s,-w),B=D.length-1;p.initSideSegments(D[B],D[B-1],Tt.LEFT),p.addFirstSegment();for(var Q=B-2;Q>=0;Q--)p.addNextSegment(D[Q],!0)}else{var ht=Qn.simplify(s,w),vt=ht.length-1;p.initSideSegments(ht[0],ht[1],Tt.LEFT),p.addFirstSegment();for(var Yt=2;Yt<=vt;Yt++)p.addNextSegment(ht[Yt],!0)}p.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(s){return s===0||s<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(s){return new Es(this._precisionModel,this._bufParams,s)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var s=arguments[0],l=arguments[1];this._precisionModel=s,this._bufParams=l}},{key:"copyCoordinates",value:function(s){for(var l=new Array(s.length).fill(null),p=0;p<l.length;p++)l[p]=new Gt(s[p]);return l}}])})(),Lr=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var m=arguments[0],s=new wt,l=this._subgraphs.iterator();l.hasNext();){var p=l.next(),w=p.getEnvelope();m.y<w.getMinY()||m.y>w.getMaxY()||this.findStabbedSegments(m,p.getDirectedEdges(),s)}return s}if(arguments.length===3){if(be(arguments[2],Qt)&&arguments[0]instanceof Gt&&arguments[1]instanceof Fn){for(var D=arguments[0],B=arguments[1],Q=arguments[2],ht=B.getEdge().getCoordinates(),vt=0;vt<ht.length-1;vt++)if(this._seg.p0=ht[vt],this._seg.p1=ht[vt+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<D.x||this._seg.isHorizontal()||D.y<this._seg.p0.y||D.y>this._seg.p1.y||Ye.index(this._seg.p0,this._seg.p1,D)===Ye.RIGHT)){var Yt=B.getDepth(Tt.LEFT);this._seg.p0.equals(ht[vt])||(Yt=B.getDepth(Tt.RIGHT));var ne=new hl(this._seg,Yt);Q.add(ne)}}else if(be(arguments[2],Qt)&&arguments[0]instanceof Gt&&be(arguments[1],Qt))for(var Se=arguments[0],Ve=arguments[2],$e=arguments[1].iterator();$e.hasNext();){var tn=$e.next();tn.isForward()&&this.findStabbedSegments(Se,tn,Ve)}}}},{key:"getDepth",value:function(m){var s=this.findStabbedSegments(m);return s.size()===0?0:_r.min(s)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Ki;var m=arguments[0];this._subgraphs=m}}])})(),hl=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(m){var s=m;if(this._upwardSeg.minX()>=s._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=s._upwardSeg.minX())return-1;var l=this._upwardSeg.orientationIndex(s._upwardSeg);return l!==0||(l=-1*s._upwardSeg.orientationIndex(this._upwardSeg))!==0?l:this._upwardSeg.compareTo(s._upwardSeg)}},{key:"compareX",value:function(m,s){var l=m.p0.compareTo(s.p0);return l!==0?l:m.p1.compareTo(s.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var m=arguments[0],s=arguments[1];this._upwardSeg=new Ki(m),this._leftDepth=s}}])})();Lr.DepthSegment=hl;var Va=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,null,[{key:"constructor_",value:function(){Lt.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(Lt),ks=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getY",value:function(){var s=this.y/this.w;if(_e.isNaN(s)||_e.isInfinite(s))throw new Va;return s}},{key:"getX",value:function(){var s=this.x/this.w;if(_e.isNaN(s)||_e.isInfinite(s))throw new Va;return s}},{key:"getCoordinate",value:function(){var s=new Gt;return s.x=this.getX(),s.y=this.getY(),s}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var s=arguments[0];this.x=s.x,this.y=s.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var l=arguments[0],p=arguments[1];this.x=l,this.y=p,this.w=1}else if(arguments[0]instanceof m&&arguments[1]instanceof m){var w=arguments[0],D=arguments[1];this.x=w.y*D.w-D.y*w.w,this.y=D.x*w.w-w.x*D.w,this.w=w.x*D.y-D.x*w.y}else if(arguments[0]instanceof Gt&&arguments[1]instanceof Gt){var B=arguments[0],Q=arguments[1];this.x=B.y-Q.y,this.y=Q.x-B.x,this.w=B.x*Q.y-Q.x*B.y}}else if(arguments.length===3){var ht=arguments[0],vt=arguments[1],Yt=arguments[2];this.x=ht,this.y=vt,this.w=Yt}else if(arguments.length===4){var ne=arguments[0],Se=arguments[1],Ve=arguments[2],$e=arguments[3],tn=ne.y-Se.y,fn=Se.x-ne.x,Sn=ne.x*Se.y-Se.x*ne.y,Bn=Ve.y-$e.y,wi=$e.x-Ve.x,ni=Ve.x*$e.y-$e.x*Ve.y;this.x=fn*ni-wi*Sn,this.y=Bn*Sn-tn*ni,this.w=tn*wi-Bn*fn}}}])})(),gs=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"area",value:function(){return m.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return m.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(s){if(s===null)throw new kt("Supplied point is null.");return m.interpolateZ(s,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return m.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return m.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return m.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return m.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return m.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return m.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var s=arguments[0],l=arguments[1],p=arguments[2];this.p0=s,this.p1=l,this.p2=p}},{key:"area",value:function(s,l,p){return Math.abs(((p.x-s.x)*(l.y-s.y)-(l.x-s.x)*(p.y-s.y))/2)}},{key:"signedArea",value:function(s,l,p){return((p.x-s.x)*(l.y-s.y)-(l.x-s.x)*(p.y-s.y))/2}},{key:"det",value:function(s,l,p,w){return s*w-l*p}},{key:"interpolateZ",value:function(s,l,p,w){var D=l.x,B=l.y,Q=p.x-D,ht=w.x-D,vt=p.y-B,Yt=w.y-B,ne=Q*Yt-ht*vt,Se=s.x-D,Ve=s.y-B,$e=(Yt*Se-ht*Ve)/ne,tn=(-vt*Se+Q*Ve)/ne;return l.getZ()+$e*(p.getZ()-l.getZ())+tn*(w.getZ()-l.getZ())}},{key:"longestSideLength",value:function(s,l,p){var w=s.distance(l),D=l.distance(p),B=p.distance(s),Q=w;return D>Q&&(Q=D),B>Q&&(Q=B),Q}},{key:"circumcentreDD",value:function(s,l,p){var w=Oe.valueOf(s.x).subtract(p.x),D=Oe.valueOf(s.y).subtract(p.y),B=Oe.valueOf(l.x).subtract(p.x),Q=Oe.valueOf(l.y).subtract(p.y),ht=Oe.determinant(w,D,B,Q).multiply(2),vt=w.sqr().add(D.sqr()),Yt=B.sqr().add(Q.sqr()),ne=Oe.determinant(D,vt,Q,Yt),Se=Oe.determinant(w,vt,B,Yt),Ve=Oe.valueOf(p.x).subtract(ne.divide(ht)).doubleValue(),$e=Oe.valueOf(p.y).add(Se.divide(ht)).doubleValue();return new Gt(Ve,$e)}},{key:"isAcute",value:function(s,l,p){return!!bi.isAcute(s,l,p)&&!!bi.isAcute(l,p,s)&&!!bi.isAcute(p,s,l)}},{key:"circumcentre",value:function(s,l,p){var w=p.x,D=p.y,B=s.x-w,Q=s.y-D,ht=l.x-w,vt=l.y-D,Yt=2*m.det(B,Q,ht,vt),ne=m.det(Q,B*B+Q*Q,vt,ht*ht+vt*vt),Se=m.det(B,B*B+Q*Q,ht,ht*ht+vt*vt);return new Gt(w-ne/Yt,D+Se/Yt)}},{key:"perpendicularBisector",value:function(s,l){var p=l.x-s.x,w=l.y-s.y,D=new ks(s.x+p/2,s.y+w/2,1),B=new ks(s.x-w+p/2,s.y+p+w/2,1);return new ks(D,B)}},{key:"angleBisector",value:function(s,l,p){var w=l.distance(s),D=w/(w+l.distance(p)),B=p.x-s.x,Q=p.y-s.y;return new Gt(s.x+D*B,s.y+D*Q)}},{key:"area3D",value:function(s,l,p){var w=l.x-s.x,D=l.y-s.y,B=l.getZ()-s.getZ(),Q=p.x-s.x,ht=p.y-s.y,vt=p.getZ()-s.getZ(),Yt=D*vt-B*ht,ne=B*Q-w*vt,Se=w*ht-D*Q,Ve=Yt*Yt+ne*ne+Se*Se,$e=Math.sqrt(Ve)/2;return $e}},{key:"centroid",value:function(s,l,p){var w=(s.x+l.x+p.x)/3,D=(s.y+l.y+p.y)/3;return new Gt(w,D)}},{key:"inCentre",value:function(s,l,p){var w=l.distance(p),D=s.distance(p),B=s.distance(l),Q=w+D+B,ht=(w*s.x+D*l.x+B*p.x)/Q,vt=(w*s.y+D*l.y+B*p.y)/Q;return new Gt(ht,vt)}}])})(),du=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(m,s,l,p,w){if(s===0&&m.length<Pi.MINIMUM_VALID_SIZE)return null;var D=p,B=w;m.length>=Pi.MINIMUM_VALID_SIZE&&Ye.isCCW(m)&&(D=w,B=p,l=Tt.opposite(l));var Q=this._curveBuilder.getRingCurve(m,l,s);this.addCurve(Q,D,B)}},{key:"addRingBothSides",value:function(m,s){this.addRingSide(m,s,Tt.LEFT,Dt.EXTERIOR,Dt.INTERIOR),this.addRingSide(m,s,Tt.RIGHT,Dt.INTERIOR,Dt.EXTERIOR)}},{key:"addPoint",value:function(m){if(this._distance<=0)return null;var s=m.getCoordinates(),l=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(l,Dt.EXTERIOR,Dt.INTERIOR)}},{key:"addPolygon",value:function(m){var s=this._distance,l=Tt.LEFT;this._distance<0&&(s=-this._distance,l=Tt.RIGHT);var p=m.getExteriorRing(),w=Jn.removeRepeatedPoints(p.getCoordinates());if(this._distance<0&&this.isErodedCompletely(p,this._distance)||this._distance<=0&&w.length<3)return null;this.addRingSide(w,s,l,Dt.EXTERIOR,Dt.INTERIOR);for(var D=0;D<m.getNumInteriorRing();D++){var B=m.getInteriorRingN(D),Q=Jn.removeRepeatedPoints(B.getCoordinates());this._distance>0&&this.isErodedCompletely(B,-this._distance)||this.addRingSide(Q,s,Tt.opposite(l),Dt.INTERIOR,Dt.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(m,s){var l=new gs(m[0],m[1],m[2]),p=l.inCentre();return $t.pointToSegment(p,l.p0,l.p1)<Math.abs(s)}},{key:"addLineString",value:function(m){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var s=Jn.removeRepeatedPoints(m.getCoordinates());if(Jn.isRing(s)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(s,this._distance);else{var l=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(l,Dt.EXTERIOR,Dt.INTERIOR)}}},{key:"addCurve",value:function(m,s,l){if(m===null||m.length<2)return null;var p=new as(m,new Cn(0,Dt.BOUNDARY,s,l));this._curveList.add(p)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(m){if(m.isEmpty())return null;if(m instanceof An)this.addPolygon(m);else if(m instanceof jn)this.addLineString(m);else if(m instanceof En)this.addPoint(m);else if(m instanceof Qe)this.addCollection(m);else if(m instanceof jr)this.addCollection(m);else if(m instanceof Dn)this.addCollection(m);else{if(!(m instanceof je))throw new fe(m.getGeometryType());this.addCollection(m)}}},{key:"isErodedCompletely",value:function(m,s){var l=m.getCoordinates();if(l.length<4)return s<0;if(l.length===4)return this.isTriangleErodedCompletely(l,s);var p=m.getEnvelopeInternal(),w=Math.min(p.getHeight(),p.getWidth());return s<0&&2*Math.abs(s)>w}},{key:"addCollection",value:function(m){for(var s=0;s<m.getNumGeometries();s++){var l=m.getGeometryN(s);this.add(l)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new wt;var m=arguments[0],s=arguments[1],l=arguments[2];this._inputGeom=m,this._distance=s,this._curveBuilder=l}}])})(),pa=(function(){return o((function m(){S(this,m)}),[{key:"locate",value:function(m){}}])})(),dl=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,m.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new et;var s=this._parent.getGeometryN(this._index++);return s instanceof je?(this._subcollectionIterator=new m(s),this._subcollectionIterator.next()):s}},{key:"remove",value:function(){throw new fe(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[cl]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var s=arguments[0];this._parent=s,this._atStart=!0,this._index=0,this._max=s.getNumGeometries()}},{key:"isAtomic",value:function(s){return!(s instanceof je)}}])})(),Xs=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"locate",value:function(s){return m.locate(s,this._geom)}},{key:"interfaces_",get:function(){return[pa]}}],[{key:"constructor_",value:function(){this._geom=null;var s=arguments[0];this._geom=s}},{key:"locatePointInPolygon",value:function(s,l){if(l.isEmpty())return Dt.EXTERIOR;var p=l.getExteriorRing(),w=m.locatePointInRing(s,p);if(w!==Dt.INTERIOR)return w;for(var D=0;D<l.getNumInteriorRing();D++){var B=l.getInteriorRingN(D),Q=m.locatePointInRing(s,B);if(Q===Dt.BOUNDARY)return Dt.BOUNDARY;if(Q===Dt.INTERIOR)return Dt.EXTERIOR}return Dt.INTERIOR}},{key:"locatePointInRing",value:function(s,l){return l.getEnvelopeInternal().intersects(s)?wn.locateInRing(s,l.getCoordinates()):Dt.EXTERIOR}},{key:"containsPointInPolygon",value:function(s,l){return Dt.EXTERIOR!==m.locatePointInPolygon(s,l)}},{key:"locateInGeometry",value:function(s,l){if(l instanceof An)return m.locatePointInPolygon(s,l);if(l instanceof je)for(var p=new dl(l);p.hasNext();){var w=p.next();if(w!==l){var D=m.locateInGeometry(s,w);if(D!==Dt.EXTERIOR)return D}}return Dt.EXTERIOR}},{key:"isContained",value:function(s,l){return Dt.EXTERIOR!==m.locate(s,l)}},{key:"locate",value:function(s,l){return l.isEmpty()?Dt.EXTERIOR:l.getEnvelopeInternal().intersects(s)?m.locateInGeometry(s,l):Dt.EXTERIOR}}])})(),fl=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(m){this.getEdges();var s=this._edgeList.indexOf(m),l=s-1;return s===0&&(l=this._edgeList.size()-1),this._edgeList.get(l)}},{key:"propagateSideLabels",value:function(m){for(var s=Dt.NONE,l=this.iterator();l.hasNext();){var p=l.next().getLabel();p.isArea(m)&&p.getLocation(m,Tt.LEFT)!==Dt.NONE&&(s=p.getLocation(m,Tt.LEFT))}if(s===Dt.NONE)return null;for(var w=s,D=this.iterator();D.hasNext();){var B=D.next(),Q=B.getLabel();if(Q.getLocation(m,Tt.ON)===Dt.NONE&&Q.setLocation(m,Tt.ON,w),Q.isArea(m)){var ht=Q.getLocation(m,Tt.LEFT),vt=Q.getLocation(m,Tt.RIGHT);if(vt!==Dt.NONE){if(vt!==w)throw new yn("side location conflict",B.getCoordinate());ht===Dt.NONE&&ye.shouldNeverReachHere("found single null side (at "+B.getCoordinate()+")"),w=ht}else ye.isTrue(Q.getLocation(m,Tt.LEFT)===Dt.NONE,"found single null side"),Q.setLocation(m,Tt.RIGHT,w),Q.setLocation(m,Tt.LEFT,w)}}}},{key:"getCoordinate",value:function(){var m=this.iterator();return m.hasNext()?m.next().getCoordinate():null}},{key:"print",value:function(m){xt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var s=this.iterator();s.hasNext();)s.next().print(m)}},{key:"isAreaLabelsConsistent",value:function(m){return this.computeEdgeEndLabels(m.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(m){var s=this.getEdges();if(s.size()<=0)return!0;var l=s.size()-1,p=s.get(l).getLabel().getLocation(m,Tt.LEFT);ye.isTrue(p!==Dt.NONE,"Found unlabelled area edge");for(var w=p,D=this.iterator();D.hasNext();){var B=D.next().getLabel();ye.isTrue(B.isArea(m),"Found non-area edge");var Q=B.getLocation(m,Tt.LEFT),ht=B.getLocation(m,Tt.RIGHT);if(Q===ht||ht!==w)return!1;w=Q}return!0}},{key:"findIndex",value:function(m){this.iterator();for(var s=0;s<this._edgeList.size();s++)if(this._edgeList.get(s)===m)return s;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new wt(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(m,s,l){return this._ptInAreaLocation[m]===Dt.NONE&&(this._ptInAreaLocation[m]=Xs.locate(s,l[m].getGeometry())),this._ptInAreaLocation[m]}},{key:"toString",value:function(){var m=new Ce;m.append("EdgeEndStar:   "+this.getCoordinate()),m.append(`
`);for(var s=this.iterator();s.hasNext();){var l=s.next();m.append(l),m.append(`
`)}return m.toString()}},{key:"computeEdgeEndLabels",value:function(m){for(var s=this.iterator();s.hasNext();)s.next().computeLabel(m)}},{key:"computeLabelling",value:function(m){this.computeEdgeEndLabels(m[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var s=[!1,!1],l=this.iterator();l.hasNext();)for(var p=l.next().getLabel(),w=0;w<2;w++)p.isLine(w)&&p.getLocation(w)===Dt.BOUNDARY&&(s[w]=!0);for(var D=this.iterator();D.hasNext();)for(var B=D.next(),Q=B.getLabel(),ht=0;ht<2;ht++)if(Q.isAnyNull(ht)){var vt=Dt.NONE;if(s[ht])vt=Dt.EXTERIOR;else{var Yt=B.getCoordinate();vt=this.getLocation(ht,Yt,m)}Q.setAllLocationsIfNull(ht,vt)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(m,s){this._edgeMap.put(m,s),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Wr,this._edgeList=null,this._ptInAreaLocation=[Dt.NONE,Dt.NONE]}}])})(),pl=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var l=null,p=null,w=this._SCANNING_FOR_INCOMING,D=0;D<this._resultAreaEdgeList.size();D++){var B=this._resultAreaEdgeList.get(D),Q=B.getSym();if(B.getLabel().isArea())switch(l===null&&B.isInResult()&&(l=B),w){case this._SCANNING_FOR_INCOMING:if(!Q.isInResult())continue;p=Q,w=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!B.isInResult())continue;p.setNext(B),w=this._SCANNING_FOR_INCOMING}}if(w===this._LINKING_TO_OUTGOING){if(l===null)throw new yn("no outgoing dirEdge found",this.getCoordinate());ye.isTrue(l.isInResult(),"unable to link last incoming dirEdge"),p.setNext(l)}}},{key:"insert",value:function(l){var p=l;this.insertEdgeEnd(p,p)}},{key:"getRightmostEdge",value:function(){var l=this.getEdges(),p=l.size();if(p<1)return null;var w=l.get(0);if(p===1)return w;var D=l.get(p-1),B=w.getQuadrant(),Q=D.getQuadrant();return xi.isNorthern(B)&&xi.isNorthern(Q)?w:xi.isNorthern(B)||xi.isNorthern(Q)?w.getDy()!==0?w:D.getDy()!==0?D:(ye.shouldNeverReachHere("found two horizontal edges incident on node"),null):D}},{key:"print",value:function(l){xt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var p=this.iterator();p.hasNext();){var w=p.next();l.print("out "),w.print(l),l.println(),l.print("in "),w.getSym().print(l),l.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new wt;for(var l=this.iterator();l.hasNext();){var p=l.next();(p.isInResult()||p.getSym().isInResult())&&this._resultAreaEdgeList.add(p)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(l){for(var p=this.iterator();p.hasNext();){var w=p.next().getLabel();w.setAllLocationsIfNull(0,l.getLocation(0)),w.setAllLocationsIfNull(1,l.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var l=null,p=null,w=this._edgeList.size()-1;w>=0;w--){var D=this._edgeList.get(w),B=D.getSym();p===null&&(p=B),l!==null&&B.setNext(l),l=D}p.setNext(l)}},{key:"computeDepths",value:function(){if(arguments.length===1){var l=arguments[0],p=this.findIndex(l),w=l.getDepth(Tt.LEFT),D=l.getDepth(Tt.RIGHT),B=this.computeDepths(p+1,this._edgeList.size(),w);if(this.computeDepths(0,p,B)!==D)throw new yn("depth mismatch at "+l.getCoordinate())}else if(arguments.length===3){for(var Q=arguments[1],ht=arguments[2],vt=arguments[0];vt<Q;vt++){var Yt=this._edgeList.get(vt);Yt.setEdgeDepths(Tt.RIGHT,ht),ht=Yt.getDepth(Tt.LEFT)}return ht}}},{key:"mergeSymLabels",value:function(){for(var l=this.iterator();l.hasNext();){var p=l.next();p.getLabel().merge(p.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(l){for(var p=null,w=null,D=this._SCANNING_FOR_INCOMING,B=this._resultAreaEdgeList.size()-1;B>=0;B--){var Q=this._resultAreaEdgeList.get(B),ht=Q.getSym();switch(p===null&&Q.getEdgeRing()===l&&(p=Q),D){case this._SCANNING_FOR_INCOMING:if(ht.getEdgeRing()!==l)continue;w=ht,D=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(Q.getEdgeRing()!==l)continue;w.setNextMin(Q),D=this._SCANNING_FOR_INCOMING}}D===this._LINKING_TO_OUTGOING&&(ye.isTrue(p!==null,"found null for first outgoing dirEdge"),ye.isTrue(p.getEdgeRing()===l,"unable to link last incoming dirEdge"),w.setNextMin(p))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var l=0,p=this.iterator();p.hasNext();)p.next().isInResult()&&l++;return l}if(arguments.length===1){for(var w=arguments[0],D=0,B=this.iterator();B.hasNext();)B.next().getEdgeRing()===w&&D++;return D}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var l=Dt.NONE,p=this.iterator();p.hasNext();){var w=p.next(),D=w.getSym();if(!w.isLineEdge()){if(w.isInResult()){l=Dt.INTERIOR;break}if(D.isInResult()){l=Dt.EXTERIOR;break}}}if(l===Dt.NONE)return null;for(var B=l,Q=this.iterator();Q.hasNext();){var ht=Q.next(),vt=ht.getSym();ht.isLineEdge()?ht.getEdge().setCovered(B===Dt.INTERIOR):(ht.isInResult()&&(B=Dt.EXTERIOR),vt.isInResult()&&(B=Dt.INTERIOR))}}},{key:"computeLabelling",value:function(l){Y(s,"computeLabelling",this,1).call(this,l),this._label=new Cn(Dt.NONE);for(var p=this.iterator();p.hasNext();)for(var w=p.next().getEdge().getLabel(),D=0;D<2;D++){var B=w.getLocation(D);B!==Dt.INTERIOR&&B!==Dt.BOUNDARY||this._label.setLocation(D,Dt.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(fl),fu=(function(m){function s(){return S(this,s),E(this,s)}return V(s,m),o(s,[{key:"createNode",value:function(l){return new Ts(l,new pl)}}])})(Er),go=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"compareTo",value:function(s){var l=s;return m.compareOriented(this._pts,this._orientation,l._pts,l._orientation)}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var s=arguments[0];this._pts=s,this._orientation=m.orientation(s)}},{key:"orientation",value:function(s){return Jn.increasingDirection(s)===1}},{key:"compareOriented",value:function(s,l,p,w){for(var D=l?1:-1,B=w?1:-1,Q=l?s.length:-1,ht=w?p.length:-1,vt=l?0:s.length-1,Yt=w?0:p.length-1;;){var ne=s[vt].compareTo(p[Yt]);if(ne!==0)return ne;var Se=(vt+=D)===Q,Ve=(Yt+=B)===ht;if(Se&&!Ve)return-1;if(!Se&&Ve)return 1;if(Se&&Ve)return 0}}}])})(),_o=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"print",value:function(m){m.print("MULTILINESTRING ( ");for(var s=0;s<this._edges.size();s++){var l=this._edges.get(s);s>0&&m.print(","),m.print("(");for(var p=l.getCoordinates(),w=0;w<p.length;w++)w>0&&m.print(","),m.print(p[w].x+" "+p[w].y);m.println(")")}m.print(")  ")}},{key:"addAll",value:function(m){for(var s=m.iterator();s.hasNext();)this.add(s.next())}},{key:"findEdgeIndex",value:function(m){for(var s=0;s<this._edges.size();s++)if(this._edges.get(s).equals(m))return s;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(m){return this._edges.get(m)}},{key:"findEqualEdge",value:function(m){var s=new go(m.getCoordinates());return this._ocaMap.get(s)}},{key:"add",value:function(m){this._edges.add(m);var s=new go(m.getCoordinates());this._ocaMap.put(s,m)}}],[{key:"constructor_",value:function(){this._edges=new wt,this._ocaMap=new Wr}}])})(),yo=(function(){return o((function m(){S(this,m)}),[{key:"processIntersections",value:function(m,s,l,p){}},{key:"isDone",value:function(){}}])})(),vo=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"isTrivialIntersection",value:function(s,l,p,w){if(s===p&&this._li.getIntersectionNum()===1){if(m.isAdjacentSegments(l,w))return!0;if(s.isClosed()){var D=s.size()-1;if(l===0&&w===D||w===0&&l===D)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(s,l,p,w){if(s===p&&l===w)return null;this.numTests++;var D=s.getCoordinates()[l],B=s.getCoordinates()[l+1],Q=p.getCoordinates()[w],ht=p.getCoordinates()[w+1];this._li.computeIntersection(D,B,Q,ht),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(s,l,p,w)||(this._hasIntersection=!0,s.addIntersections(this._li,l,0),p.addIntersections(this._li,w,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[yo]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var s=arguments[0];this._li=s}},{key:"isAdjacentSegments",value:function(s,l){return Math.abs(s-l)===1}}])})(),xo=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(m){m.print(this.coord),m.print(" seg # = "+this.segmentIndex),m.println(" dist = "+this.dist)}},{key:"compareTo",value:function(m){var s=m;return this.compare(s.segmentIndex,s.dist)}},{key:"isEndPoint",value:function(m){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===m}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(m,s){return this.segmentIndex<m?-1:this.segmentIndex>m?1:this.dist<s?-1:this.dist>s?1:0}},{key:"interfaces_",get:function(){return[Mt]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var m=arguments[0],s=arguments[1],l=arguments[2];this.coord=new Gt(m),this.segmentIndex=s,this.dist=l}}])})(),bo=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"print",value:function(m){m.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(m)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(m){this.addEndpoints();for(var s=this.iterator(),l=s.next();s.hasNext();){var p=s.next(),w=this.createSplitEdge(l,p);m.add(w),l=p}}},{key:"addEndpoints",value:function(){var m=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[m],m,0)}},{key:"createSplitEdge",value:function(m,s){var l=s.segmentIndex-m.segmentIndex+2,p=this.edge.pts[s.segmentIndex],w=s.dist>0||!s.coord.equals2D(p);w||l--;var D=new Array(l).fill(null),B=0;D[B++]=new Gt(m.coord);for(var Q=m.segmentIndex+1;Q<=s.segmentIndex;Q++)D[B++]=this.edge.pts[Q];return w&&(D[B]=s.coord),new Ys(D,new Cn(this.edge._label))}},{key:"add",value:function(m,s,l){var p=new xo(m,s,l),w=this._nodeMap.get(p);return w!==null?w:(this._nodeMap.put(p,p),p)}},{key:"isIntersection",value:function(m){for(var s=this.iterator();s.hasNext();)if(s.next().coord.equals(m))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Wr,this.edge=null;var m=arguments[0];this.edge=m}}])})(),Ms=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])||m.isTrue(this._matrix[Dt.INTERIOR][Dt.BOUNDARY])||m.isTrue(this._matrix[Dt.BOUNDARY][Dt.INTERIOR])||m.isTrue(this._matrix[Dt.BOUNDARY][Dt.BOUNDARY]))&&this._matrix[Dt.EXTERIOR][Dt.INTERIOR]===se.FALSE&&this._matrix[Dt.EXTERIOR][Dt.BOUNDARY]===se.FALSE}},{key:"isCoveredBy",value:function(){return(m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])||m.isTrue(this._matrix[Dt.INTERIOR][Dt.BOUNDARY])||m.isTrue(this._matrix[Dt.BOUNDARY][Dt.INTERIOR])||m.isTrue(this._matrix[Dt.BOUNDARY][Dt.BOUNDARY]))&&this._matrix[Dt.INTERIOR][Dt.EXTERIOR]===se.FALSE&&this._matrix[Dt.BOUNDARY][Dt.EXTERIOR]===se.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var s=arguments[0],l=0;l<s.length;l++){var p=Math.trunc(l/3),w=l%3;this._matrix[p][w]=se.toDimensionValue(s.charAt(l))}else if(arguments.length===3){var D=arguments[0],B=arguments[1],Q=arguments[2];this._matrix[D][B]=Q}}},{key:"isContains",value:function(){return m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])&&this._matrix[Dt.EXTERIOR][Dt.INTERIOR]===se.FALSE&&this._matrix[Dt.EXTERIOR][Dt.BOUNDARY]===se.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var s=arguments[0],l=0;l<s.length;l++){var p=Math.trunc(l/3),w=l%3;this.setAtLeast(p,w,se.toDimensionValue(s.charAt(l)))}else if(arguments.length===3){var D=arguments[0],B=arguments[1],Q=arguments[2];this._matrix[D][B]<Q&&(this._matrix[D][B]=Q)}}},{key:"setAtLeastIfValid",value:function(s,l,p){s>=0&&l>=0&&this.setAtLeast(s,l,p)}},{key:"isWithin",value:function(){return m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])&&this._matrix[Dt.INTERIOR][Dt.EXTERIOR]===se.FALSE&&this._matrix[Dt.BOUNDARY][Dt.EXTERIOR]===se.FALSE}},{key:"isTouches",value:function(s,l){return s>l?this.isTouches(l,s):(s===se.A&&l===se.A||s===se.L&&l===se.L||s===se.L&&l===se.A||s===se.P&&l===se.A||s===se.P&&l===se.L)&&this._matrix[Dt.INTERIOR][Dt.INTERIOR]===se.FALSE&&(m.isTrue(this._matrix[Dt.INTERIOR][Dt.BOUNDARY])||m.isTrue(this._matrix[Dt.BOUNDARY][Dt.INTERIOR])||m.isTrue(this._matrix[Dt.BOUNDARY][Dt.BOUNDARY]))}},{key:"isOverlaps",value:function(s,l){return s===se.P&&l===se.P||s===se.A&&l===se.A?m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])&&m.isTrue(this._matrix[Dt.INTERIOR][Dt.EXTERIOR])&&m.isTrue(this._matrix[Dt.EXTERIOR][Dt.INTERIOR]):s===se.L&&l===se.L&&this._matrix[Dt.INTERIOR][Dt.INTERIOR]===1&&m.isTrue(this._matrix[Dt.INTERIOR][Dt.EXTERIOR])&&m.isTrue(this._matrix[Dt.EXTERIOR][Dt.INTERIOR])}},{key:"isEquals",value:function(s,l){return s===l&&m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])&&this._matrix[Dt.INTERIOR][Dt.EXTERIOR]===se.FALSE&&this._matrix[Dt.BOUNDARY][Dt.EXTERIOR]===se.FALSE&&this._matrix[Dt.EXTERIOR][Dt.INTERIOR]===se.FALSE&&this._matrix[Dt.EXTERIOR][Dt.BOUNDARY]===se.FALSE}},{key:"toString",value:function(){for(var s=new es("123456789"),l=0;l<3;l++)for(var p=0;p<3;p++)s.setCharAt(3*l+p,se.toDimensionSymbol(this._matrix[l][p]));return s.toString()}},{key:"setAll",value:function(s){for(var l=0;l<3;l++)for(var p=0;p<3;p++)this._matrix[l][p]=s}},{key:"get",value:function(s,l){return this._matrix[s][l]}},{key:"transpose",value:function(){var s=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=s,s=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=s,s=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=s,this}},{key:"matches",value:function(s){if(s.length!==9)throw new kt("Should be length 9: "+s);for(var l=0;l<3;l++)for(var p=0;p<3;p++)if(!m.matches(this._matrix[l][p],s.charAt(3*l+p)))return!1;return!0}},{key:"add",value:function(s){for(var l=0;l<3;l++)for(var p=0;p<3;p++)this.setAtLeast(l,p,s.get(l,p))}},{key:"isDisjoint",value:function(){return this._matrix[Dt.INTERIOR][Dt.INTERIOR]===se.FALSE&&this._matrix[Dt.INTERIOR][Dt.BOUNDARY]===se.FALSE&&this._matrix[Dt.BOUNDARY][Dt.INTERIOR]===se.FALSE&&this._matrix[Dt.BOUNDARY][Dt.BOUNDARY]===se.FALSE}},{key:"isCrosses",value:function(s,l){return s===se.P&&l===se.L||s===se.P&&l===se.A||s===se.L&&l===se.A?m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])&&m.isTrue(this._matrix[Dt.INTERIOR][Dt.EXTERIOR]):s===se.L&&l===se.P||s===se.A&&l===se.P||s===se.A&&l===se.L?m.isTrue(this._matrix[Dt.INTERIOR][Dt.INTERIOR])&&m.isTrue(this._matrix[Dt.EXTERIOR][Dt.INTERIOR]):s===se.L&&l===se.L&&this._matrix[Dt.INTERIOR][Dt.INTERIOR]===0}},{key:"interfaces_",get:function(){return[Wt]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(se.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var s=arguments[0];m.constructor_.call(this),this.set(s)}else if(arguments[0]instanceof m){var l=arguments[0];m.constructor_.call(this),this._matrix[Dt.INTERIOR][Dt.INTERIOR]=l._matrix[Dt.INTERIOR][Dt.INTERIOR],this._matrix[Dt.INTERIOR][Dt.BOUNDARY]=l._matrix[Dt.INTERIOR][Dt.BOUNDARY],this._matrix[Dt.INTERIOR][Dt.EXTERIOR]=l._matrix[Dt.INTERIOR][Dt.EXTERIOR],this._matrix[Dt.BOUNDARY][Dt.INTERIOR]=l._matrix[Dt.BOUNDARY][Dt.INTERIOR],this._matrix[Dt.BOUNDARY][Dt.BOUNDARY]=l._matrix[Dt.BOUNDARY][Dt.BOUNDARY],this._matrix[Dt.BOUNDARY][Dt.EXTERIOR]=l._matrix[Dt.BOUNDARY][Dt.EXTERIOR],this._matrix[Dt.EXTERIOR][Dt.INTERIOR]=l._matrix[Dt.EXTERIOR][Dt.INTERIOR],this._matrix[Dt.EXTERIOR][Dt.BOUNDARY]=l._matrix[Dt.EXTERIOR][Dt.BOUNDARY],this._matrix[Dt.EXTERIOR][Dt.EXTERIOR]=l._matrix[Dt.EXTERIOR][Dt.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var s=arguments[0],l=arguments[1];return l===se.SYM_DONTCARE||l===se.SYM_TRUE&&(s>=0||s===se.TRUE)||l===se.SYM_FALSE&&s===se.FALSE||l===se.SYM_P&&s===se.P||l===se.SYM_L&&s===se.L||l===se.SYM_A&&s===se.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var p=arguments[1];return new m(arguments[0]).matches(p)}}},{key:"isTrue",value:function(s){return s>=0||s===se.TRUE}}])})(),ml=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(s){return s===null||s.length===0?null:(this.ensureCapacity(this._size+s.length),xt.arraycopy(s,0,this._data,this._size,s.length),void(this._size+=s.length))}},{key:"ensureCapacity",value:function(s){if(s<=this._data.length)return null;var l=Math.max(s,2*this._data.length);this._data=we.copyOf(this._data,l)}},{key:"toArray",value:function(){var s=new Array(this._size).fill(null);return xt.arraycopy(this._data,0,s,0,this._size),s}},{key:"add",value:function(s){this.ensureCapacity(this._size+1),this._data[this._size]=s,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)m.constructor_.call(this,10);else if(arguments.length===1){var s=arguments[0];this._data=new Array(s).fill(null)}}}])})(),gl=(function(){function m(){S(this,m)}return o(m,[{key:"getChainStartIndices",value:function(s){var l=0,p=new ml(Math.trunc(s.length/2));p.add(l);do{var w=this.findChainEnd(s,l);p.add(w),l=w}while(l<s.length-1);return p.toArray()}},{key:"findChainEnd",value:function(s,l){for(var p=xi.quadrant(s[l],s[l+1]),w=l+1;w<s.length&&xi.quadrant(s[w-1],s[w])===p;)w++;return w-1}},{key:"OLDgetChainStartIndices",value:function(s){var l=0,p=new wt;p.add(l);do{var w=this.findChainEnd(s,l);p.add(w),l=w}while(l<s.length-1);return m.toIntArray(p)}}],[{key:"toIntArray",value:function(s){for(var l=new Array(s.size()).fill(null),p=0;p<l.length;p++)l[p]=s.get(p).intValue();return l}}])})(),ma=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(m){var s=this.pts[this.startIndex[m]].x,l=this.pts[this.startIndex[m+1]].x;return s>l?s:l}},{key:"getMinX",value:function(m){var s=this.pts[this.startIndex[m]].x,l=this.pts[this.startIndex[m+1]].x;return s<l?s:l}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var m=arguments[0],s=arguments[1],l=arguments[2],p=arguments[3];this.computeIntersectsForChain(this.startIndex[m],this.startIndex[m+1],s,s.startIndex[l],s.startIndex[l+1],p)}else if(arguments.length===6){var w=arguments[0],D=arguments[1],B=arguments[2],Q=arguments[3],ht=arguments[4],vt=arguments[5];if(D-w==1&&ht-Q==1)return vt.addIntersections(this.e,w,B.e,Q),null;if(!this.overlaps(w,D,B,Q,ht))return null;var Yt=Math.trunc((w+D)/2),ne=Math.trunc((Q+ht)/2);w<Yt&&(Q<ne&&this.computeIntersectsForChain(w,Yt,B,Q,ne,vt),ne<ht&&this.computeIntersectsForChain(w,Yt,B,ne,ht,vt)),Yt<D&&(Q<ne&&this.computeIntersectsForChain(Yt,D,B,Q,ne,vt),ne<ht&&this.computeIntersectsForChain(Yt,D,B,ne,ht,vt))}}},{key:"overlaps",value:function(m,s,l,p,w){return sn.intersects(this.pts[m],this.pts[s],l.pts[p],l.pts[w])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(m,s){for(var l=0;l<this.startIndex.length-1;l++)for(var p=0;p<m.startIndex.length-1;p++)this.computeIntersectsForChain(l,m,p,s)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var m=arguments[0];this.e=m,this.pts=m.getCoordinates();var s=new gl;this.startIndex=s.getChainStartIndices(this.pts)}}])})(),ga=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"getDepth",value:function(s,l){return this._depth[s][l]}},{key:"setDepth",value:function(s,l,p){this._depth[s][l]=p}},{key:"isNull",value:function(){if(arguments.length===0){for(var s=0;s<2;s++)for(var l=0;l<3;l++)if(this._depth[s][l]!==m.NULL_VALUE)return!1;return!0}if(arguments.length===1){var p=arguments[0];return this._depth[p][1]===m.NULL_VALUE}if(arguments.length===2){var w=arguments[0],D=arguments[1];return this._depth[w][D]===m.NULL_VALUE}}},{key:"normalize",value:function(){for(var s=0;s<2;s++)if(!this.isNull(s)){var l=this._depth[s][1];this._depth[s][2]<l&&(l=this._depth[s][2]),l<0&&(l=0);for(var p=1;p<3;p++){var w=0;this._depth[s][p]>l&&(w=1),this._depth[s][p]=w}}}},{key:"getDelta",value:function(s){return this._depth[s][Tt.RIGHT]-this._depth[s][Tt.LEFT]}},{key:"getLocation",value:function(s,l){return this._depth[s][l]<=0?Dt.EXTERIOR:Dt.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var s=arguments[0],l=0;l<2;l++)for(var p=1;p<3;p++){var w=s.getLocation(l,p);w!==Dt.EXTERIOR&&w!==Dt.INTERIOR||(this.isNull(l,p)?this._depth[l][p]=m.depthAtLocation(w):this._depth[l][p]+=m.depthAtLocation(w))}else if(arguments.length===3){var D=arguments[0],B=arguments[1];arguments[2]===Dt.INTERIOR&&this._depth[D][B]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var s=0;s<2;s++)for(var l=0;l<3;l++)this._depth[s][l]=m.NULL_VALUE}},{key:"depthAtLocation",value:function(s){return s===Dt.EXTERIOR?0:s===Dt.INTERIOR?1:m.NULL_VALUE}}])})();ga.NULL_VALUE=-1;var Ys=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var l=new Array(2).fill(null);return l[0]=this.pts[0],l[1]=this.pts[1],new s(l,Cn.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(l){this._isIsolated=l}},{key:"setName",value:function(l){this._name=l}},{key:"equals",value:function(l){if(!(l instanceof s))return!1;var p=l;if(this.pts.length!==p.pts.length)return!1;for(var w=!0,D=!0,B=this.pts.length,Q=0;Q<this.pts.length;Q++)if(this.pts[Q].equals2D(p.pts[Q])||(w=!1),this.pts[Q].equals2D(p.pts[--B])||(D=!1),!w&&!D)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var l=arguments[0];return this.pts[l]}}},{key:"print",value:function(l){l.print("edge "+this._name+": "),l.print("LINESTRING (");for(var p=0;p<this.pts.length;p++)p>0&&l.print(","),l.print(this.pts[p].x+" "+this.pts[p].y);l.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(l){s.updateIM(this._label,l)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(l){l.print("edge "+this._name+": ");for(var p=this.pts.length-1;p>=0;p--)l.print(this.pts[p]+" ");l.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new ma(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new sn;for(var l=0;l<this.pts.length;l++)this._env.expandToInclude(this.pts[l])}return this._env}},{key:"addIntersection",value:function(l,p,w,D){var B=new Gt(l.getIntersection(D)),Q=p,ht=l.getEdgeDistance(w,D),vt=Q+1;if(vt<this.pts.length){var Yt=this.pts[vt];B.equals2D(Yt)&&(Q=vt,ht=0)}this.eiList.add(B,Q,ht)}},{key:"toString",value:function(){var l=new es;l.append("edge "+this._name+": "),l.append("LINESTRING (");for(var p=0;p<this.pts.length;p++)p>0&&l.append(","),l.append(this.pts[p].x+" "+this.pts[p].y);return l.append(")  "+this._label+" "+this._depthDelta),l.toString()}},{key:"isPointwiseEqual",value:function(l){if(this.pts.length!==l.pts.length)return!1;for(var p=0;p<this.pts.length;p++)if(!this.pts[p].equals2D(l.pts[p]))return!1;return!0}},{key:"setDepthDelta",value:function(l){this._depthDelta=l}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(l,p,w){for(var D=0;D<l.getIntersectionNum();D++)this.addIntersection(l,p,w,D)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new bo(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ga,this._depthDelta=0,arguments.length===1){var l=arguments[0];s.constructor_.call(this,l,null)}else if(arguments.length===2){var p=arguments[0],w=arguments[1];this.pts=p,this._label=w}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Ms&&arguments[0]instanceof Cn))return Y(s,"updateIM",this).apply(this,arguments);var l=arguments[0],p=arguments[1];p.setAtLeastIfValid(l.getLocation(0,Tt.ON),l.getLocation(1,Tt.ON),1),l.isArea()&&(p.setAtLeastIfValid(l.getLocation(0,Tt.LEFT),l.getLocation(1,Tt.LEFT),2),p.setAtLeastIfValid(l.getLocation(0,Tt.RIGHT),l.getLocation(1,Tt.RIGHT),2))}}])})(On),_l=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"setWorkingPrecisionModel",value:function(s){this._workingPrecisionModel=s}},{key:"insertUniqueEdge",value:function(s){var l=this._edgeList.findEqualEdge(s);if(l!==null){var p=l.getLabel(),w=s.getLabel();l.isPointwiseEqual(s)||(w=new Cn(s.getLabel())).flip(),p.merge(w);var D=m.depthDelta(w),B=l.getDepthDelta()+D;l.setDepthDelta(B)}else this._edgeList.add(s),s.setDepthDelta(m.depthDelta(s.getLabel()))}},{key:"buildSubgraphs",value:function(s,l){for(var p=new wt,w=s.iterator();w.hasNext();){var D=w.next(),B=D.getRightmostCoordinate(),Q=new Lr(p).getDepth(B);D.computeDepth(Q),D.findResultEdges(),p.add(D),l.add(D.getDirectedEdges(),D.getNodes())}}},{key:"createSubgraphs",value:function(s){for(var l=new wt,p=s.getNodes().iterator();p.hasNext();){var w=p.next();if(!w.isVisited()){var D=new st;D.create(w),l.add(D)}}return _r.sort(l,_r.reverseOrder()),l}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(s){if(this._workingNoder!==null)return this._workingNoder;var l=new Ws,p=new un;return p.setPrecisionModel(s),l.setSegmentIntersector(new vo(p)),l}},{key:"buffer",value:function(s,l){var p=this._workingPrecisionModel;p===null&&(p=s.getPrecisionModel()),this._geomFact=s.getFactory();var w=new fa(p,this._bufParams),D=new du(s,l,w).getCurves();if(D.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(D,p),this._graph=new Tn(new fu),this._graph.addEdges(this._edgeList.getEdges());var B=this.createSubgraphs(this._graph),Q=new mn(this._geomFact);this.buildSubgraphs(B,Q);var ht=Q.getPolygons();return ht.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(ht)}},{key:"computeNodedEdges",value:function(s,l){var p=this.getNoder(l);p.computeNodes(s);for(var w=p.getNodedSubstrings().iterator();w.hasNext();){var D=w.next(),B=D.getCoordinates();if(B.length!==2||!B[0].equals2D(B[1])){var Q=D.getData(),ht=new Ys(D.getCoordinates(),new Cn(Q));this.insertUniqueEdge(ht)}}}},{key:"setNoder",value:function(s){this._workingNoder=s}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new _o;var s=arguments[0];this._bufParams=s}},{key:"depthDelta",value:function(s){var l=s.getLocation(0,Tt.LEFT),p=s.getLocation(0,Tt.RIGHT);return l===Dt.INTERIOR&&p===Dt.EXTERIOR?1:l===Dt.EXTERIOR&&p===Dt.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(s){for(var l=new ds,p=new wt;s.hasNext();){var w=s.next(),D=l.createLineString(w.getCoordinates());p.add(D)}return l.buildGeometry(p)}}])})(),pu=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"rescale",value:function(){if(be(arguments[0],$n))for(var s=arguments[0].iterator();s.hasNext();){var l=s.next();this.rescale(l.getCoordinates())}else if(arguments[0]instanceof Array){for(var p=arguments[0],w=0;w<p.length;w++)p[w].x=p[w].x/this._scaleFactor+this._offsetX,p[w].y=p[w].y/this._scaleFactor+this._offsetY;p.length===2&&p[0].equals2D(p[1])&&xt.out.println(p)}}},{key:"scale",value:function(){if(be(arguments[0],$n)){for(var s=arguments[0],l=new wt(s.size()),p=s.iterator();p.hasNext();){var w=p.next();l.add(new as(this.scale(w.getCoordinates()),w.getData()))}return l}if(arguments[0]instanceof Array){for(var D=arguments[0],B=new Array(D.length).fill(null),Q=0;Q<D.length;Q++)B[Q]=new Gt(Math.round((D[Q].x-this._offsetX)*this._scaleFactor),Math.round((D[Q].y-this._offsetY)*this._scaleFactor),D[Q].getZ());return Jn.removeRepeatedPoints(B)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var s=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(s),s}},{key:"computeNodes",value:function(s){var l=s;this._isScaled&&(l=this.scale(s)),this._noder.computeNodes(l)}},{key:"interfaces_",get:function(){return[po]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var s=arguments[0],l=arguments[1];m.constructor_.call(this,s,l,0,0)}else if(arguments.length===4){var p=arguments[0],w=arguments[1];this._noder=p,this._scaleFactor=w,this._isScaled=!this.isIntegerPrecision()}}}])})(),wo=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var l=s.next().getCoordinates();this.checkEndPtVertexIntersections(l[0],this._segStrings),this.checkEndPtVertexIntersections(l[l.length-1],this._segStrings)}else if(arguments.length===2){for(var p=arguments[0],w=arguments[1].iterator();w.hasNext();)for(var D=w.next().getCoordinates(),B=1;B<D.length-1;B++)if(D[B].equals(p))throw new Xt("found endpt/interior pt intersection at index "+B+" :pt "+p)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();)for(var l=s.next(),p=this._segStrings.iterator();p.hasNext();){var w=p.next();this.checkInteriorIntersections(l,w)}else if(arguments.length===2)for(var D=arguments[0],B=arguments[1],Q=D.getCoordinates(),ht=B.getCoordinates(),vt=0;vt<Q.length-1;vt++)for(var Yt=0;Yt<ht.length-1;Yt++)this.checkInteriorIntersections(D,vt,B,Yt);else if(arguments.length===4){var ne=arguments[0],Se=arguments[1],Ve=arguments[2],$e=arguments[3];if(ne===Ve&&Se===$e)return null;var tn=ne.getCoordinates()[Se],fn=ne.getCoordinates()[Se+1],Sn=Ve.getCoordinates()[$e],Bn=Ve.getCoordinates()[$e+1];if(this._li.computeIntersection(tn,fn,Sn,Bn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,tn,fn)||this.hasInteriorIntersection(this._li,Sn,Bn)))throw new Xt("found non-noded intersection at "+tn+"-"+fn+" and "+Sn+"-"+Bn)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var l=s.next();this.checkCollapses(l)}else if(arguments.length===1)for(var p=arguments[0].getCoordinates(),w=0;w<p.length-2;w++)this.checkCollapse(p[w],p[w+1],p[w+2])}},{key:"hasInteriorIntersection",value:function(s,l,p){for(var w=0;w<s.getIntersectionNum();w++){var D=s.getIntersection(w);if(!D.equals(l)&&!D.equals(p))return!0}return!1}},{key:"checkCollapse",value:function(s,l,p){if(s.equals(p))throw new Xt("found non-noded collapse at "+m.fact.createLineString([s,l,p]))}}],[{key:"constructor_",value:function(){this._li=new un,this._segStrings=null;var s=arguments[0];this._segStrings=s}}])})();wo.fact=new ds;var Hs=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"intersectsScaled",value:function(s,l){var p=Math.min(s.x,l.x),w=Math.max(s.x,l.x),D=Math.min(s.y,l.y),B=Math.max(s.y,l.y),Q=this._maxx<p||this._minx>w||this._maxy<D||this._miny>B;if(Q)return!1;var ht=this.intersectsToleranceSquare(s,l);return ye.isTrue(!(Q&&ht),"Found bad envelope test"),ht}},{key:"initCorners",value:function(s){var l=.5;this._minx=s.x-l,this._maxx=s.x+l,this._miny=s.y-l,this._maxy=s.y+l,this._corner[0]=new Gt(this._maxx,this._maxy),this._corner[1]=new Gt(this._minx,this._maxy),this._corner[2]=new Gt(this._minx,this._miny),this._corner[3]=new Gt(this._maxx,this._miny)}},{key:"intersects",value:function(s,l){return this._scaleFactor===1?this.intersectsScaled(s,l):(this.copyScaled(s,this._p0Scaled),this.copyScaled(l,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(s){return Math.round(s*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(s,l){l.x=this.scale(s.x),l.y=this.scale(s.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var s=m.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new sn(this._originalPt.x-s,this._originalPt.x+s,this._originalPt.y-s,this._originalPt.y+s)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(s,l){return this._li.computeIntersection(s,l,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,l,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,l,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,l,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(s,l){var p=!1,w=!1;return this._li.computeIntersection(s,l,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(s,l,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(s,l,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(w=!0),this._li.computeIntersection(s,l,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!p||!w)||!!s.equals(this._pt)||!!l.equals(this._pt))))}},{key:"addSnappedNode",value:function(s,l){var p=s.getCoordinate(l),w=s.getCoordinate(l+1);return!!this.intersects(p,w)&&(s.addIntersection(this.getCoordinate(),l),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var s=arguments[0],l=arguments[1],p=arguments[2];if(this._originalPt=s,this._pt=s,this._scaleFactor=l,this._li=p,l<=0)throw new kt("Scale factor must be non-zero");l!==1&&(this._pt=new Gt(this.scale(s.x),this.scale(s.y)),this._p0Scaled=new Gt,this._p1Scaled=new Gt),this.initCorners(this._pt)}}])})();Hs.SAFE_ENV_EXPANSION_FACTOR=.75;var Io=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var m=arguments[1];arguments[0].getLineSegment(m,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Ki}}])})(),ja=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var m=arguments[0];return this.snap(m,null,-1)}if(arguments.length===3){var s=arguments[0],l=arguments[1],p=arguments[2],w=s.getSafeEnvelope(),D=new To(s,l,p);return this._index.query(w,new((function(){return o((function B(){S(this,B)}),[{key:"interfaces_",get:function(){return[qs]}},{key:"visitItem",value:function(B){B.select(w,D)}}])})())),D.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var m=arguments[0];this._index=m}}])})(),To=(function(m){function s(){var l;return S(this,s),l=E(this,s),s.constructor_.apply(l,arguments),l}return V(s,m),o(s,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof ca))return Y(s,"select",this,1).apply(this,arguments);var l=arguments[1],p=arguments[0].getContext();if(this._parentEdge===p&&(l===this._hotPixelVertexIndex||l+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(p,l)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var l=arguments[0],p=arguments[1],w=arguments[2];this._hotPixel=l,this._parentEdge=p,this._hotPixelVertexIndex=w}}])})(Io);ja.HotPixelSnapAction=To;var _a=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(m,s,l,p){if(m===l&&s===p)return null;var w=m.getCoordinates()[s],D=m.getCoordinates()[s+1],B=l.getCoordinates()[p],Q=l.getCoordinates()[p+1];if(this._li.computeIntersection(w,D,B,Q),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var ht=0;ht<this._li.getIntersectionNum();ht++)this._interiorIntersections.add(this._li.getIntersection(ht));m.addIntersections(this._li,s,0),l.addIntersections(this._li,p,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[yo]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var m=arguments[0];this._li=m,this._interiorIntersections=new wt}}])})(),Yr=(function(){return o((function m(){S(this,m),m.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(m){var s=as.getNodedSubstrings(m),l=new wo(s);try{l.checkValid()}catch(p){if(!(p instanceof Lt))throw p;p.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return as.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(m,s){var l=this.findInteriorIntersections(m,s);this.computeIntersectionSnaps(l),this.computeVertexSnaps(m)}},{key:"findInteriorIntersections",value:function(m,s){var l=new _a(s);return this._noder.setSegmentIntersector(l),this._noder.computeNodes(m),l.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(be(arguments[0],$n))for(var m=arguments[0].iterator();m.hasNext();){var s=m.next();this.computeVertexSnaps(s)}else if(arguments[0]instanceof as)for(var l=arguments[0],p=l.getCoordinates(),w=0;w<p.length;w++){var D=new Hs(p[w],this._scaleFactor,this._li);this._pointSnapper.snap(D,l,w)&&l.addIntersection(p[w],w)}}},{key:"computeNodes",value:function(m){this._nodedSegStrings=m,this._noder=new Ws,this._pointSnapper=new ja(this._noder.getIndex()),this.snapRound(m,this._li)}},{key:"computeIntersectionSnaps",value:function(m){for(var s=m.iterator();s.hasNext();){var l=s.next(),p=new Hs(l,this._scaleFactor,this._li);this._pointSnapper.snap(p)}}},{key:"interfaces_",get:function(){return[po]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var m=arguments[0];this._pm=m,this._li=new un,this._li.setPrecisionModel(m),this._scaleFactor=m.getScale()}}])})(),_s=(function(){function m(){S(this,m),m.constructor_.apply(this,arguments)}return o(m,[{key:"bufferFixedPrecision",value:function(s){var l=new pu(new Yr(new Zi(1)),s.getScale()),p=new _l(this._bufParams);p.setWorkingPrecisionModel(s),p.setNoder(l),this._resultGeometry=p.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var s=m.MAX_PRECISION_DIGITS;s>=0;s--){try{this.bufferReducedPrecision(s)}catch(D){if(!(D instanceof yn))throw D;this._saveException=D}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var l=arguments[0],p=m.precisionScaleFactor(this._argGeom,this._distance,l),w=new Zi(p);this.bufferFixedPrecision(w)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var s=this._argGeom.getFactory().getPrecisionModel();s.getType()===Zi.FIXED?this.bufferFixedPrecision(s):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(s){this._bufParams.setQuadrantSegments(s)}},{key:"bufferOriginalPrecision",value:function(){try{var s=new _l(this._bufParams);this._resultGeometry=s.buffer(this._argGeom,this._distance)}catch(l){if(!(l instanceof Xt))throw l;this._saveException=l}}},{key:"getResultGeometry",value:function(s){return this._distance=s,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(s){this._bufParams.setEndCapStyle(s)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new dt,this._resultGeometry=null,this._saveException=null,arguments.length===1){var s=arguments[0];this._argGeom=s}else if(arguments.length===2){var l=arguments[0],p=arguments[1];this._argGeom=l,this._bufParams=p}}},{key:"bufferOp",value:function(){if(arguments.length===2){var s=arguments[1];return new m(arguments[0]).getResultGeometry(s)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Be&&typeof arguments[1]=="number"){var l=arguments[1],p=arguments[2],w=new m(arguments[0]);return w.setQuadrantSegments(p),w.getResultGeometry(l)}if(arguments[2]instanceof dt&&arguments[0]instanceof Be&&typeof arguments[1]=="number"){var D=arguments[1];return new m(arguments[0],arguments[2]).getResultGeometry(D)}}else if(arguments.length===4){var B=arguments[1],Q=arguments[2],ht=arguments[3],vt=new m(arguments[0]);return vt.setQuadrantSegments(Q),vt.setEndCapStyle(ht),vt.getResultGeometry(B)}}},{key:"precisionScaleFactor",value:function(s,l,p){var w=s.getEnvelopeInternal(),D=Rt.max(Math.abs(w.getMaxX()),Math.abs(w.getMaxY()),Math.abs(w.getMinX()),Math.abs(w.getMinY()))+2*(l>0?l:0),B=p-Math.trunc(Math.log(D)/Math.log(10)+1);return Math.pow(10,B)}}])})();_s.CAP_ROUND=dt.CAP_ROUND,_s.CAP_BUTT=dt.CAP_FLAT,_s.CAP_FLAT=dt.CAP_FLAT,_s.CAP_SQUARE=dt.CAP_SQUARE,_s.MAX_PRECISION_DIGITS=12;var So=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ga=(function(){return o((function m(s){S(this,m),this.geometryFactory=s||new ds}),[{key:"read",value:function(m){var s,l=(s=typeof m=="string"?JSON.parse(m):m).type;if(!Ji[l])throw new Error("Unknown GeoJSON type: "+s.type);return So.indexOf(l)!==-1?Ji[l].call(this,s.coordinates):l==="GeometryCollection"?Ji[l].call(this,s.geometries):Ji[l].call(this,s)}},{key:"write",value:function(m){var s=m.getGeometryType();if(!yr[s])throw new Error("Geometry is not supported");return yr[s].call(this,m)}}])})(),Ji={Feature:function(m){var s={};for(var l in m)s[l]=m[l];if(m.geometry){var p=m.geometry.type;if(!Ji[p])throw new Error("Unknown GeoJSON type: "+m.type);s.geometry=this.read(m.geometry)}return m.bbox&&(s.bbox=Ji.bbox.call(this,m.bbox)),s},FeatureCollection:function(m){var s={};if(m.features){s.features=[];for(var l=0;l<m.features.length;++l)s.features.push(this.read(m.features[l]))}return m.bbox&&(s.bbox=this.parse.bbox.call(this,m.bbox)),s},coordinates:function(m){for(var s=[],l=0;l<m.length;++l){var p=m[l];s.push(P(Gt,J(p)))}return s},bbox:function(m){return this.geometryFactory.createLinearRing([new Gt(m[0],m[1]),new Gt(m[2],m[1]),new Gt(m[2],m[3]),new Gt(m[0],m[3]),new Gt(m[0],m[1])])},Point:function(m){var s=P(Gt,J(m));return this.geometryFactory.createPoint(s)},MultiPoint:function(m){for(var s=[],l=0;l<m.length;++l)s.push(Ji.Point.call(this,m[l]));return this.geometryFactory.createMultiPoint(s)},LineString:function(m){var s=Ji.coordinates.call(this,m);return this.geometryFactory.createLineString(s)},MultiLineString:function(m){for(var s=[],l=0;l<m.length;++l)s.push(Ji.LineString.call(this,m[l]));return this.geometryFactory.createMultiLineString(s)},Polygon:function(m){for(var s=Ji.coordinates.call(this,m[0]),l=this.geometryFactory.createLinearRing(s),p=[],w=1;w<m.length;++w){var D=m[w],B=Ji.coordinates.call(this,D),Q=this.geometryFactory.createLinearRing(B);p.push(Q)}return this.geometryFactory.createPolygon(l,p)},MultiPolygon:function(m){for(var s=[],l=0;l<m.length;++l){var p=m[l];s.push(Ji.Polygon.call(this,p))}return this.geometryFactory.createMultiPolygon(s)},GeometryCollection:function(m){for(var s=[],l=0;l<m.length;++l){var p=m[l];s.push(this.read(p))}return this.geometryFactory.createGeometryCollection(s)}},yr={coordinate:function(m){var s=[m.x,m.y];return m.z&&s.push(m.z),m.m&&s.push(m.m),s},Point:function(m){return{type:"Point",coordinates:yr.coordinate.call(this,m.getCoordinate())}},MultiPoint:function(m){for(var s=[],l=0;l<m._geometries.length;++l){var p=m._geometries[l],w=yr.Point.call(this,p);s.push(w.coordinates)}return{type:"MultiPoint",coordinates:s}},LineString:function(m){for(var s=[],l=m.getCoordinates(),p=0;p<l.length;++p){var w=l[p];s.push(yr.coordinate.call(this,w))}return{type:"LineString",coordinates:s}},MultiLineString:function(m){for(var s=[],l=0;l<m._geometries.length;++l){var p=m._geometries[l],w=yr.LineString.call(this,p);s.push(w.coordinates)}return{type:"MultiLineString",coordinates:s}},Polygon:function(m){var s=[],l=yr.LineString.call(this,m._shell);s.push(l.coordinates);for(var p=0;p<m._holes.length;++p){var w=m._holes[p],D=yr.LineString.call(this,w);s.push(D.coordinates)}return{type:"Polygon",coordinates:s}},MultiPolygon:function(m){for(var s=[],l=0;l<m._geometries.length;++l){var p=m._geometries[l],w=yr.Polygon.call(this,p);s.push(w.coordinates)}return{type:"MultiPolygon",coordinates:s}},GeometryCollection:function(m){for(var s=[],l=0;l<m._geometries.length;++l){var p=m._geometries[l],w=p.getGeometryType();s.push(yr[w].call(this,p))}return{type:"GeometryCollection",geometries:s}}};return{BufferOp:_s,GeoJSONReader:(function(){return o((function m(s){S(this,m),this.parser=new Ga(s||new ds)}),[{key:"read",value:function(m){return this.parser.read(m)}}])})(),GeoJSONWriter:(function(){return o((function m(){S(this,m),this.parser=new Ga(this.geometryFactory)}),[{key:"write",value:function(m){return this.parser.write(m)}}])})()}}))})(Ah)),Ah.exports}var Hv=Yv();const Kv=pf(Hv);function so(){return new zh}function zh(){this.reset()}zh.prototype={constructor:zh,reset:function(){this.s=this.t=0},add:function(A){Um(Sh,A,this.t),Um(this,Sh.s,this.s),this.s?this.t+=Sh.t:this.s=Sh.t},valueOf:function(){return this.s}};var Sh=new zh;function Um(A,I,T){var E=A.s=I+T,S=E-I,P=E-S;A.t=I-P+(T-S)}var oi=1e-6,Vn=Math.PI,aa=Vn/2,qm=Vn/4,la=Vn*2,io=180/Vn,ws=Vn/180,sr=Math.abs,Jv=Math.atan,ou=Math.atan2,Ei=Math.cos,ki=Math.sin,cu=Math.sqrt;function yg(A){return A>1?0:A<-1?Vn:Math.acos(A)}function rl(A){return A>1?aa:A<-1?-aa:Math.asin(A)}function hc(){}function Nh(A,I){A&&$m.hasOwnProperty(A.type)&&$m[A.type](A,I)}var Zm={Feature:function(A,I){Nh(A.geometry,I)},FeatureCollection:function(A,I){for(var T=A.features,E=-1,S=T.length;++E<S;)Nh(T[E].geometry,I)}},$m={Sphere:function(A,I){I.sphere()},Point:function(A,I){A=A.coordinates,I.point(A[0],A[1],A[2])},MultiPoint:function(A,I){for(var T=A.coordinates,E=-1,S=T.length;++E<S;)A=T[E],I.point(A[0],A[1],A[2])},LineString:function(A,I){lf(A.coordinates,I,0)},MultiLineString:function(A,I){for(var T=A.coordinates,E=-1,S=T.length;++E<S;)lf(T[E],I,0)},Polygon:function(A,I){Wm(A.coordinates,I)},MultiPolygon:function(A,I){for(var T=A.coordinates,E=-1,S=T.length;++E<S;)Wm(T[E],I)},GeometryCollection:function(A,I){for(var T=A.geometries,E=-1,S=T.length;++E<S;)Nh(T[E],I)}};function lf(A,I,T){var E=-1,S=A.length-T,P;for(I.lineStart();++E<S;)P=A[E],I.point(P[0],P[1],P[2]);I.lineEnd()}function Wm(A,I){var T=-1,E=A.length;for(I.polygonStart();++T<E;)lf(A[T],I,1);I.polygonEnd()}function Qv(A,I){A&&Zm.hasOwnProperty(A.type)?Zm[A.type](A,I):Nh(A,I)}so();so();function uf(A){return[ou(A[1],A[0]),rl(A[2])]}function lu(A){var I=A[0],T=A[1],E=Ei(T);return[E*Ei(I),E*ki(I),ki(T)]}function Eh(A,I){return A[0]*I[0]+A[1]*I[1]+A[2]*I[2]}function Oh(A,I){return[A[1]*I[2]-A[2]*I[1],A[2]*I[0]-A[0]*I[2],A[0]*I[1]-A[1]*I[0]]}function nf(A,I){A[0]+=I[0],A[1]+=I[1],A[2]+=I[2]}function kh(A,I){return[A[0]*I,A[1]*I,A[2]*I]}function cf(A){var I=cu(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]/=I,A[1]/=I,A[2]/=I}so();function vg(A,I){function T(E,S){return E=A(E,S),I(E[0],E[1])}return A.invert&&I.invert&&(T.invert=function(E,S){return E=I.invert(E,S),E&&A.invert(E[0],E[1])}),T}function hf(A,I){return[A>Vn?A-la:A<-Vn?A+la:A,I]}hf.invert=hf;function t0(A,I,T){return(A%=la)?I||T?vg(Ym(A),Hm(I,T)):Ym(A):I||T?Hm(I,T):hf}function Xm(A){return function(I,T){return I+=A,[I>Vn?I-la:I<-Vn?I+la:I,T]}}function Ym(A){var I=Xm(A);return I.invert=Xm(-A),I}function Hm(A,I){var T=Ei(A),E=ki(A),S=Ei(I),P=ki(I);function b(o,N){var $=Ei(N),G=Ei(o)*$,V=ki(o)*$,K=ki(N),q=K*T+G*E;return[ou(V*S-q*P,G*T-K*E),rl(q*S+V*P)]}return b.invert=function(o,N){var $=Ei(N),G=Ei(o)*$,V=ki(o)*$,K=ki(N),q=K*S-V*P;return[ou(V*S+K*P,G*T+q*E),rl(q*T-G*E)]},b}function e0(A,I,T,E,S,P){if(T){var b=Ei(I),o=ki(I),N=E*T;S==null?(S=I+E*la,P=I-N/2):(S=Km(b,S),P=Km(b,P),(E>0?S<P:S>P)&&(S+=E*la));for(var $,G=S;E>0?G>P:G<P;G-=N)$=uf([b,-o*Ei(G),-o*ki(G)]),A.point($[0],$[1])}}function Km(A,I){I=lu(I),I[0]-=A,cf(I);var T=yg(-I[1]);return((-I[2]<0?-T:T)+la-oi)%la}function xg(){var A=[],I;return{point:function(T,E){I.push([T,E])},lineStart:function(){A.push(I=[])},lineEnd:hc,rejoin:function(){A.length>1&&A.push(A.pop().concat(A.shift()))},result:function(){var T=A;return A=[],I=null,T}}}function n0(A,I,T,E,S,P){var b=A[0],o=A[1],N=I[0],$=I[1],G=0,V=1,K=N-b,q=$-o,Y;if(Y=T-b,!(!K&&Y>0)){if(Y/=K,K<0){if(Y<G)return;Y<V&&(V=Y)}else if(K>0){if(Y>V)return;Y>G&&(G=Y)}if(Y=S-b,!(!K&&Y<0)){if(Y/=K,K<0){if(Y>V)return;Y>G&&(G=Y)}else if(K>0){if(Y<G)return;Y<V&&(V=Y)}if(Y=E-o,!(!q&&Y>0)){if(Y/=q,q<0){if(Y<G)return;Y<V&&(V=Y)}else if(q>0){if(Y>V)return;Y>G&&(G=Y)}if(Y=P-o,!(!q&&Y<0)){if(Y/=q,q<0){if(Y>V)return;Y>G&&(G=Y)}else if(q>0){if(Y<G)return;Y<V&&(V=Y)}return G>0&&(A[0]=b+G*K,A[1]=o+G*q),V<1&&(I[0]=b+V*K,I[1]=o+V*q),!0}}}}}function Lh(A,I){return sr(A[0]-I[0])<oi&&sr(A[1]-I[1])<oi}function Mh(A,I,T,E){this.x=A,this.z=I,this.o=T,this.e=E,this.v=!1,this.n=this.p=null}function bg(A,I,T,E,S){var P=[],b=[],o,N;if(A.forEach(function(Y){if(!((J=Y.length-1)<=0)){var J,W=Y[0],at=Y[J],ut;if(Lh(W,at)){for(S.lineStart(),o=0;o<J;++o)S.point((W=Y[o])[0],W[1]);S.lineEnd();return}P.push(ut=new Mh(W,Y,null,!0)),b.push(ut.o=new Mh(W,null,ut,!1)),P.push(ut=new Mh(at,Y,null,!1)),b.push(ut.o=new Mh(at,null,ut,!0))}}),!!P.length){for(b.sort(I),Jm(P),Jm(b),o=0,N=b.length;o<N;++o)b[o].e=T=!T;for(var $=P[0],G,V;;){for(var K=$,q=!0;K.v;)if((K=K.n)===$)return;G=K.z,S.lineStart();do{if(K.v=K.o.v=!0,K.e){if(q)for(o=0,N=G.length;o<N;++o)S.point((V=G[o])[0],V[1]);else E(K.x,K.n.x,1,S);K=K.n}else{if(q)for(G=K.p.z,o=G.length-1;o>=0;--o)S.point((V=G[o])[0],V[1]);else E(K.x,K.p.x,-1,S);K=K.p}K=K.o,G=K.z,q=!q}while(!K.v);S.lineEnd()}}}function Jm(A){if(I=A.length){for(var I,T=0,E=A[0],S;++T<I;)E.n=S=A[T],S.p=E,E=S;E.n=S=A[0],S.p=E}}function wg(A,I){return A<I?-1:A>I?1:A>=I?0:NaN}function i0(A){return A.length===1&&(A=r0(A)),{left:function(I,T,E,S){for(E==null&&(E=0),S==null&&(S=I.length);E<S;){var P=E+S>>>1;A(I[P],T)<0?E=P+1:S=P}return E},right:function(I,T,E,S){for(E==null&&(E=0),S==null&&(S=I.length);E<S;){var P=E+S>>>1;A(I[P],T)>0?S=P:E=P+1}return E}}}function r0(A){return function(I,T){return wg(A(I),T)}}i0(wg);function Ig(A){for(var I=A.length,T,E=-1,S=0,P,b;++E<I;)S+=A[E].length;for(P=new Array(S);--I>=0;)for(b=A[I],T=b.length;--T>=0;)P[--S]=b[T];return P}var dc=1e9,Ph=-dc;function s0(A,I,T,E){function S($,G){return A<=$&&$<=T&&I<=G&&G<=E}function P($,G,V,K){var q=0,Y=0;if($==null||(q=b($,V))!==(Y=b(G,V))||N($,G)<0^V>0)do K.point(q===0||q===3?A:T,q>1?E:I);while((q=(q+V+4)%4)!==Y);else K.point(G[0],G[1])}function b($,G){return sr($[0]-A)<oi?G>0?0:3:sr($[0]-T)<oi?G>0?2:1:sr($[1]-I)<oi?G>0?1:0:G>0?3:2}function o($,G){return N($.x,G.x)}function N($,G){var V=b($,1),K=b(G,1);return V!==K?V-K:V===0?G[1]-$[1]:V===1?$[0]-G[0]:V===2?$[1]-G[1]:G[0]-$[0]}return function($){var G=$,V=xg(),K,q,Y,J,W,at,ut,dt,Lt,kt,jt,Mt={point:Wt,lineStart:Et,lineEnd:Ht,polygonStart:Kt,polygonEnd:ge};function Wt(Jt,ze){S(Jt,ze)&&G.point(Jt,ze)}function Ot(){for(var Jt=0,ze=0,te=q.length;ze<te;++ze)for(var Ne=q[ze],he=1,_e=Ne.length,Zt=Ne[0],Xt,Ge,ye=Zt[0],Pe=Zt[1];he<_e;++he)Xt=ye,Ge=Pe,Zt=Ne[he],ye=Zt[0],Pe=Zt[1],Ge<=E?Pe>E&&(ye-Xt)*(E-Ge)>(Pe-Ge)*(A-Xt)&&++Jt:Pe<=E&&(ye-Xt)*(E-Ge)<(Pe-Ge)*(A-Xt)&&--Jt;return Jt}function Kt(){G=V,K=[],q=[],jt=!0}function ge(){var Jt=Ot(),ze=jt&&Jt,te=(K=Ig(K)).length;(ze||te)&&($.polygonStart(),ze&&($.lineStart(),P(null,null,1,$),$.lineEnd()),te&&bg(K,o,Jt,P,$),$.polygonEnd()),G=$,K=q=Y=null}function Et(){Mt.point=tt,q&&q.push(Y=[]),kt=!0,Lt=!1,ut=dt=NaN}function Ht(){K&&(tt(J,W),at&&Lt&&V.rejoin(),K.push(V.result())),Mt.point=Wt,Lt&&G.lineEnd()}function tt(Jt,ze){var te=S(Jt,ze);if(q&&Y.push([Jt,ze]),kt)J=Jt,W=ze,at=te,kt=!1,te&&(G.lineStart(),G.point(Jt,ze));else if(te&&Lt)G.point(Jt,ze);else{var Ne=[ut=Math.max(Ph,Math.min(dc,ut)),dt=Math.max(Ph,Math.min(dc,dt))],he=[Jt=Math.max(Ph,Math.min(dc,Jt)),ze=Math.max(Ph,Math.min(dc,ze))];n0(Ne,he,A,I,T,E)?(Lt||(G.lineStart(),G.point(Ne[0],Ne[1])),G.point(he[0],he[1]),te||G.lineEnd(),jt=!1):te&&(G.lineStart(),G.point(Jt,ze),jt=!1)}ut=Jt,dt=ze,Lt=te}return Mt}}var rf=so();function a0(A,I){var T=I[0],E=I[1],S=[ki(T),-Ei(T),0],P=0,b=0;rf.reset();for(var o=0,N=A.length;o<N;++o)if(G=($=A[o]).length)for(var $,G,V=$[G-1],K=V[0],q=V[1]/2+qm,Y=ki(q),J=Ei(q),W=0;W<G;++W,K=ut,Y=Lt,J=kt,V=at){var at=$[W],ut=at[0],dt=at[1]/2+qm,Lt=ki(dt),kt=Ei(dt),jt=ut-K,Mt=jt>=0?1:-1,Wt=Mt*jt,Ot=Wt>Vn,Kt=Y*Lt;if(rf.add(ou(Kt*Mt*ki(Wt),J*kt+Kt*Ei(Wt))),P+=Ot?jt+Mt*la:jt,Ot^K>=T^ut>=T){var ge=Oh(lu(V),lu(at));cf(ge);var Et=Oh(S,ge);cf(Et);var Ht=(Ot^jt>=0?-1:1)*rl(Et[2]);(E>Ht||E===Ht&&(ge[0]||ge[1]))&&(b+=Ot^jt>=0?1:-1)}}return(P<-oi||P<oi&&rf<-oi)^b&1}so();function Qm(A){return A}so();so();var uu=1/0,Fh=uu,mc=-uu,Bh=mc,tg={point:o0,lineStart:hc,lineEnd:hc,polygonStart:hc,polygonEnd:hc,result:function(){var A=[[uu,Fh],[mc,Bh]];return mc=Bh=-(Fh=uu=1/0),A}};function o0(A,I){A<uu&&(uu=A),A>mc&&(mc=A),I<Fh&&(Fh=I),I>Bh&&(Bh=I)}so();function Tg(A,I,T,E){return function(S,P){var b=I(P),o=S.invert(E[0],E[1]),N=xg(),$=I(N),G=!1,V,K,q,Y={point:J,lineStart:at,lineEnd:ut,polygonStart:function(){Y.point=dt,Y.lineStart=Lt,Y.lineEnd=kt,K=[],V=[]},polygonEnd:function(){Y.point=J,Y.lineStart=at,Y.lineEnd=ut,K=Ig(K);var jt=a0(V,o);K.length?(G||(P.polygonStart(),G=!0),bg(K,u0,jt,T,P)):jt&&(G||(P.polygonStart(),G=!0),P.lineStart(),T(null,null,1,P),P.lineEnd()),G&&(P.polygonEnd(),G=!1),K=V=null},sphere:function(){P.polygonStart(),P.lineStart(),T(null,null,1,P),P.lineEnd(),P.polygonEnd()}};function J(jt,Mt){var Wt=S(jt,Mt);A(jt=Wt[0],Mt=Wt[1])&&P.point(jt,Mt)}function W(jt,Mt){var Wt=S(jt,Mt);b.point(Wt[0],Wt[1])}function at(){Y.point=W,b.lineStart()}function ut(){Y.point=J,b.lineEnd()}function dt(jt,Mt){q.push([jt,Mt]);var Wt=S(jt,Mt);$.point(Wt[0],Wt[1])}function Lt(){$.lineStart(),q=[]}function kt(){dt(q[0][0],q[0][1]),$.lineEnd();var jt=$.clean(),Mt=N.result(),Wt,Ot=Mt.length,Kt,ge,Et;if(q.pop(),V.push(q),q=null,!!Ot){if(jt&1){if(ge=Mt[0],(Kt=ge.length-1)>0){for(G||(P.polygonStart(),G=!0),P.lineStart(),Wt=0;Wt<Kt;++Wt)P.point((Et=ge[Wt])[0],Et[1]);P.lineEnd()}return}Ot>1&&jt&2&&Mt.push(Mt.pop().concat(Mt.shift())),K.push(Mt.filter(l0))}}return Y}}function l0(A){return A.length>1}function u0(A,I){return((A=A.x)[0]<0?A[1]-aa-oi:aa-A[1])-((I=I.x)[0]<0?I[1]-aa-oi:aa-I[1])}const eg=Tg(function(){return!0},c0,d0,[-Vn,-aa]);function c0(A){var I=NaN,T=NaN,E=NaN,S;return{lineStart:function(){A.lineStart(),S=1},point:function(P,b){var o=P>0?Vn:-Vn,N=sr(P-I);sr(N-Vn)<oi?(A.point(I,T=(T+b)/2>0?aa:-aa),A.point(E,T),A.lineEnd(),A.lineStart(),A.point(o,T),A.point(P,T),S=0):E!==o&&N>=Vn&&(sr(I-E)<oi&&(I-=E*oi),sr(P-o)<oi&&(P-=o*oi),T=h0(I,T,P,b),A.point(E,T),A.lineEnd(),A.lineStart(),A.point(o,T),S=0),A.point(I=P,T=b),E=o},lineEnd:function(){A.lineEnd(),I=T=NaN},clean:function(){return 2-S}}}function h0(A,I,T,E){var S,P,b=ki(A-T);return sr(b)>oi?Jv((ki(I)*(P=Ei(E))*ki(T)-ki(E)*(S=Ei(I))*ki(A))/(S*P*b)):(I+E)/2}function d0(A,I,T,E){var S;if(A==null)S=T*aa,E.point(-Vn,S),E.point(0,S),E.point(Vn,S),E.point(Vn,0),E.point(Vn,-S),E.point(0,-S),E.point(-Vn,-S),E.point(-Vn,0),E.point(-Vn,S);else if(sr(A[0]-I[0])>oi){var P=A[0]<I[0]?Vn:-Vn;S=T*P/2,E.point(-P,S),E.point(0,S),E.point(P,S)}else E.point(I[0],I[1])}function f0(A,I){var T=Ei(A),E=T>0,S=sr(T)>oi;function P(G,V,K,q){e0(q,A,I,K,G,V)}function b(G,V){return Ei(G)*Ei(V)>T}function o(G){var V,K,q,Y,J;return{lineStart:function(){Y=q=!1,J=1},point:function(W,at){var ut=[W,at],dt,Lt=b(W,at),kt=E?Lt?0:$(W,at):Lt?$(W+(W<0?Vn:-Vn),at):0;if(!V&&(Y=q=Lt)&&G.lineStart(),Lt!==q&&(dt=N(V,ut),(!dt||Lh(V,dt)||Lh(ut,dt))&&(ut[0]+=oi,ut[1]+=oi,Lt=b(ut[0],ut[1]))),Lt!==q)J=0,Lt?(G.lineStart(),dt=N(ut,V),G.point(dt[0],dt[1])):(dt=N(V,ut),G.point(dt[0],dt[1]),G.lineEnd()),V=dt;else if(S&&V&&E^Lt){var jt;!(kt&K)&&(jt=N(ut,V,!0))&&(J=0,E?(G.lineStart(),G.point(jt[0][0],jt[0][1]),G.point(jt[1][0],jt[1][1]),G.lineEnd()):(G.point(jt[1][0],jt[1][1]),G.lineEnd(),G.lineStart(),G.point(jt[0][0],jt[0][1])))}Lt&&(!V||!Lh(V,ut))&&G.point(ut[0],ut[1]),V=ut,q=Lt,K=kt},lineEnd:function(){q&&G.lineEnd(),V=null},clean:function(){return J|(Y&&q)<<1}}}function N(G,V,K){var q=lu(G),Y=lu(V),J=[1,0,0],W=Oh(q,Y),at=Eh(W,W),ut=W[0],dt=at-ut*ut;if(!dt)return!K&&G;var Lt=T*at/dt,kt=-T*ut/dt,jt=Oh(J,W),Mt=kh(J,Lt),Wt=kh(W,kt);nf(Mt,Wt);var Ot=jt,Kt=Eh(Mt,Ot),ge=Eh(Ot,Ot),Et=Kt*Kt-ge*(Eh(Mt,Mt)-1);if(!(Et<0)){var Ht=cu(Et),tt=kh(Ot,(-Kt-Ht)/ge);if(nf(tt,Mt),tt=uf(tt),!K)return tt;var Jt=G[0],ze=V[0],te=G[1],Ne=V[1],he;ze<Jt&&(he=Jt,Jt=ze,ze=he);var _e=ze-Jt,Zt=sr(_e-Vn)<oi,Xt=Zt||_e<oi;if(!Zt&&Ne<te&&(he=te,te=Ne,Ne=he),Xt?Zt?te+Ne>0^tt[1]<(sr(tt[0]-Jt)<oi?te:Ne):te<=tt[1]&&tt[1]<=Ne:_e>Vn^(Jt<=tt[0]&&tt[0]<=ze)){var Ge=kh(Ot,(-Kt+Ht)/ge);return nf(Ge,Mt),[tt,uf(Ge)]}}}function $(G,V){var K=E?A:Vn-A,q=0;return G<-K?q|=1:G>K&&(q|=2),V<-K?q|=4:V>K&&(q|=8),q}return Tg(b,o,P,E?[0,-A]:[-Vn,A-Vn])}function Sg(A){return function(I){var T=new df;for(var E in A)T[E]=A[E];return T.stream=I,T}}function df(){}df.prototype={constructor:df,point:function(A,I){this.stream.point(A,I)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Eg(A,I,T){var E=I[1][0]-I[0][0],S=I[1][1]-I[0][1],P=A.clipExtent&&A.clipExtent();A.scale(150).translate([0,0]),P!=null&&A.clipExtent(null),Qv(T,A.stream(tg));var b=tg.result(),o=Math.min(E/(b[1][0]-b[0][0]),S/(b[1][1]-b[0][1])),N=+I[0][0]+(E-o*(b[1][0]+b[0][0]))/2,$=+I[0][1]+(S-o*(b[1][1]+b[0][1]))/2;return P!=null&&A.clipExtent(P),A.scale(o*150).translate([N,$])}function p0(A,I,T){return Eg(A,[[0,0],I],T)}var ng=16,m0=Ei(30*ws);function ig(A,I){return+I?_0(A,I):g0(A)}function g0(A){return Sg({point:function(I,T){I=A(I,T),this.stream.point(I[0],I[1])}})}function _0(A,I){function T(E,S,P,b,o,N,$,G,V,K,q,Y,J,W){var at=$-E,ut=G-S,dt=at*at+ut*ut;if(dt>4*I&&J--){var Lt=b+K,kt=o+q,jt=N+Y,Mt=cu(Lt*Lt+kt*kt+jt*jt),Wt=rl(jt/=Mt),Ot=sr(sr(jt)-1)<oi||sr(P-V)<oi?(P+V)/2:ou(kt,Lt),Kt=A(Ot,Wt),ge=Kt[0],Et=Kt[1],Ht=ge-E,tt=Et-S,Jt=ut*Ht-at*tt;(Jt*Jt/dt>I||sr((at*Ht+ut*tt)/dt-.5)>.3||b*K+o*q+N*Y<m0)&&(T(E,S,P,b,o,N,ge,Et,Ot,Lt/=Mt,kt/=Mt,jt,J,W),W.point(ge,Et),T(ge,Et,Ot,Lt,kt,jt,$,G,V,K,q,Y,J,W))}}return function(E){var S,P,b,o,N,$,G,V,K,q,Y,J,W={point:at,lineStart:ut,lineEnd:Lt,polygonStart:function(){E.polygonStart(),W.lineStart=kt},polygonEnd:function(){E.polygonEnd(),W.lineStart=ut}};function at(Wt,Ot){Wt=A(Wt,Ot),E.point(Wt[0],Wt[1])}function ut(){V=NaN,W.point=dt,E.lineStart()}function dt(Wt,Ot){var Kt=lu([Wt,Ot]),ge=A(Wt,Ot);T(V,K,G,q,Y,J,V=ge[0],K=ge[1],G=Wt,q=Kt[0],Y=Kt[1],J=Kt[2],ng,E),E.point(V,K)}function Lt(){W.point=at,E.lineEnd()}function kt(){ut(),W.point=jt,W.lineEnd=Mt}function jt(Wt,Ot){dt(S=Wt,Ot),P=V,b=K,o=q,N=Y,$=J,W.point=dt}function Mt(){T(V,K,G,q,Y,J,P,b,S,o,N,$,ng,E),W.lineEnd=Lt,Lt()}return W}}var y0=Sg({point:function(A,I){this.stream.point(A*ws,I*ws)}});function v0(A){return x0(function(){return A})()}function x0(A){var I,T=150,E=480,S=250,P,b,o=0,N=0,$=0,G=0,V=0,K,q,Y=null,J=eg,W=null,at,ut,dt,Lt=Qm,kt=.5,jt=ig(ge,kt),Mt,Wt;function Ot(tt){return tt=q(tt[0]*ws,tt[1]*ws),[tt[0]*T+P,b-tt[1]*T]}function Kt(tt){return tt=q.invert((tt[0]-P)/T,(b-tt[1])/T),tt&&[tt[0]*io,tt[1]*io]}function ge(tt,Jt){return tt=I(tt,Jt),[tt[0]*T+P,b-tt[1]*T]}Ot.stream=function(tt){return Mt&&Wt===tt?Mt:Mt=y0(J(K,jt(Lt(Wt=tt))))},Ot.clipAngle=function(tt){return arguments.length?(J=+tt?f0(Y=tt*ws,6*ws):(Y=null,eg),Ht()):Y*io},Ot.clipExtent=function(tt){return arguments.length?(Lt=tt==null?(W=at=ut=dt=null,Qm):s0(W=+tt[0][0],at=+tt[0][1],ut=+tt[1][0],dt=+tt[1][1]),Ht()):W==null?null:[[W,at],[ut,dt]]},Ot.scale=function(tt){return arguments.length?(T=+tt,Et()):T},Ot.translate=function(tt){return arguments.length?(E=+tt[0],S=+tt[1],Et()):[E,S]},Ot.center=function(tt){return arguments.length?(o=tt[0]%360*ws,N=tt[1]%360*ws,Et()):[o*io,N*io]},Ot.rotate=function(tt){return arguments.length?($=tt[0]%360*ws,G=tt[1]%360*ws,V=tt.length>2?tt[2]%360*ws:0,Et()):[$*io,G*io,V*io]},Ot.precision=function(tt){return arguments.length?(jt=ig(ge,kt=tt*tt),Ht()):cu(kt)},Ot.fitExtent=function(tt,Jt){return Eg(Ot,tt,Jt)},Ot.fitSize=function(tt,Jt){return p0(Ot,tt,Jt)};function Et(){q=vg(K=t0($,G,V),I);var tt=I(o,N);return P=E-tt[0]*T,b=S+tt[1]*T,Ht()}function Ht(){return Mt=Wt=null,Ot}return function(){return I=A.apply(this,arguments),Ot.invert=I.invert&&Kt,Et()}}function kg(A){return function(I,T){var E=Ei(I),S=Ei(T),P=A(E*S);return[P*S*ki(I),P*ki(T)]}}function Mg(A){return function(I,T){var E=cu(I*I+T*T),S=A(E),P=ki(S),b=Ei(S);return[ou(I*P,E*b),rl(E&&T*P/E)]}}var b0=kg(function(A){return cu(2/(1+A))});b0.invert=Mg(function(A){return 2*rl(A/2)});var Pg=kg(function(A){return(A=yg(A))&&A/ki(A)});Pg.invert=Mg(function(A){return A});function w0(){return v0(Pg).scale(79.4188).clipAngle(180-.001)}function rg(A,I){return[A,I]}rg.invert=rg;var{BufferOp:I0,GeoJSONReader:T0,GeoJSONWriter:S0}=Kv;function fc(A,I,T){T=T||{};var E=T.units||"kilometers",S=T.steps||8;if(!A)throw new Error("geojson is required");if(typeof T!="object")throw new Error("options must be an object");if(typeof S!="number")throw new Error("steps must be an number");if(I===void 0)throw new Error("radius is required");if(S<=0)throw new Error("steps must be greater than 0");var P=[];switch(A.type){case"GeometryCollection":return gc(A,function(b){var o=Dh(b,I,E,S);o&&P.push(o)}),pc(P);case"FeatureCollection":return km(A,function(b){var o=Dh(b,I,E,S);o&&km(o,function(N){N&&P.push(N)})}),pc(P)}return Dh(A,I,E,S)}function Dh(A,I,T,E){var S=A.properties||{},P=A.type==="Feature"?A.geometry:A;if(P.type==="GeometryCollection"){var b=[];return gc(A,function(J){var W=Dh(J,I,T,E);W&&b.push(W)}),pc(b)}var o=E0(P),N={type:P.type,coordinates:Ag(P.coordinates,o)},$=new T0,G=$.read(N),V=mf(dg(I,T),"meters"),K=I0.bufferOp(G,V,E),q=new S0;if(K=q.write(K),!Cg(K.coordinates)){var Y={type:K.type,coordinates:Lg(K.coordinates,o)};return oa(Y,S)}}function Cg(A){return Array.isArray(A[0])?Cg(A[0]):isNaN(A[0])}function Ag(A,I){return typeof A[0]!="object"?I(A):A.map(function(T){return Ag(T,I)})}function Lg(A,I){return typeof A[0]!="object"?I.invert(A):A.map(function(T){return Lg(T,I)})}function E0(A){var I=Wv(A).geometry.coordinates,T=[-I[0],-I[1]];return w0().rotate(T).scale(fr)}function k0(A,I={}){let T=0,E=0,S=0;return jh(A,function(P){T+=P[0],E+=P[1],S++},!0),Mn([T/S,E/S],I.properties)}function M0(A){if(!A)throw new Error("geojson is required");switch(A.type){case"Feature":return Dg(A);case"FeatureCollection":return P0(A);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return _f(A);default:throw new Error("unknown GeoJSON type")}}function Dg(A){const I={type:"Feature"};return Object.keys(A).forEach(T=>{switch(T){case"type":case"properties":case"geometry":return;default:I[T]=A[T]}}),I.properties=Rg(A.properties),A.geometry==null?I.geometry=null:I.geometry=_f(A.geometry),I}function Rg(A){const I={};return A&&Object.keys(A).forEach(T=>{const E=A[T];typeof E=="object"?E===null?I[T]=null:Array.isArray(E)?I[T]=E.map(S=>S):I[T]=Rg(E):I[T]=E}),I}function P0(A){const I={type:"FeatureCollection"};return Object.keys(A).forEach(T=>{switch(T){case"type":case"features":return;default:I[T]=A[T]}}),I.features=A.features.map(T=>Dg(T)),I}function _f(A){const I={type:A.type};return A.bbox&&(I.bbox=A.bbox),A.type==="GeometryCollection"?(I.geometries=A.geometries.map(T=>_f(T)),I):(I.coordinates=zg(A.coordinates),I)}function zg(A){const I=A;return typeof I[0]!="object"?I.slice():I.map(T=>zg(T))}function sf(A,I,T={}){const E=Ra(A),S=Ra(I);S[0]+=S[0]-E[0]>180?-360:E[0]-S[0]>180?360:0;const P=C0(E,S);return fg(P,"meters",T.units)}function C0(A,I,T){T=T===void 0?fr:Number(T);const E=T,S=A[1]*Math.PI/180,P=I[1]*Math.PI/180,b=P-S;let o=Math.abs(I[0]-A[0])*Math.PI/180;o>Math.PI&&(o-=2*Math.PI);const N=Math.log(Math.tan(P/2+Math.PI/4)/Math.tan(S/2+Math.PI/4)),$=Math.abs(N)>1e-11?b/N:Math.cos(S);return Math.sqrt(b*b+$*$*o*o)*E}function A0(A,I,T={}){var E,S;const P=(E=T.method)!=null?E:"geodesic",b=(S=T.units)!=null?S:"kilometers";if(!A)throw new Error("pt is required");if(Array.isArray(A)?A=Mn(A):A.type==="Point"?A=oa(A):Em(A,"Point","point"),!I)throw new Error("line is required");Array.isArray(I)?I=Na(I):I.type==="LineString"?I=oa(I):Em(I,"LineString","line");let o=1/0;const N=A.geometry.coordinates;return cv(I,$=>{if($){const G=$.geometry.coordinates[0],V=$.geometry.coordinates[1],K=L0(N,G,V,{method:P});K<o&&(o=K)}}),fg(o,"degrees",b)}function L0(A,I,T,E){if(E.method==="geodesic")return Uv(Na([I,T]).geometry,A,{units:"degrees"}).properties.dist;const S=[T[0]-I[0],T[1]-I[1]],P=[A[0]-I[0],A[1]-I[1]],b=sg(P,S);if(b<=0)return sf(A,I,{units:"degrees"});const o=sg(S,S);if(o<=b)return sf(A,T,{units:"degrees"});const N=b/o,$=[I[0]+N*S[0],I[1]+N*S[1]];return sf(A,$,{units:"degrees"})}function sg(A,I){return A[0]*I[0]+A[1]*I[1]}function D0(A,I){var T=A[0]-I[0],E=A[1]-I[1];return T*T+E*E}function R0(A,I,T){var E=I[0],S=I[1],P=T[0]-E,b=T[1]-S;if(P!==0||b!==0){var o=((A[0]-E)*P+(A[1]-S)*b)/(P*P+b*b);o>1?(E=T[0],S=T[1]):o>0&&(E+=P*o,S+=b*o)}return P=A[0]-E,b=A[1]-S,P*P+b*b}function z0(A,I){for(var T=A[0],E=[T],S,P=1,b=A.length;P<b;P++)S=A[P],D0(S,T)>I&&(E.push(S),T=S);return T!==S&&E.push(S),E}function ff(A,I,T,E,S){for(var P=E,b,o=I+1;o<T;o++){var N=R0(A[o],A[I],A[T]);N>P&&(b=o,P=N)}P>E&&(b-I>1&&ff(A,I,b,E,S),S.push(A[b]),T-b>1&&ff(A,b,T,E,S))}function N0(A,I){var T=A.length-1,E=[A[0]];return ff(A,0,T,I,E),E.push(A[T]),E}function Vh(A,I,T){if(A.length<=2)return A;var E=I!==void 0?I*I:1;return A=T?A:z0(A,E),A=N0(A,E),A}function O0(A,I={}){var T,E,S;if(I=I??{},!ov(I))throw new Error("options is invalid");const P=(T=I.tolerance)!=null?T:1,b=(E=I.highQuality)!=null?E:!1,o=(S=I.mutate)!=null?S:!1;if(!A)throw new Error("geojson is required");if(P&&P<0)throw new Error("invalid tolerance");return o!==!0&&(A=M0(A)),gc(A,function(N){F0(N,P,b)}),A}function F0(A,I,T){const E=A.type;if(E==="Point"||E==="MultiPoint")return A;if(Ov(A,{mutate:!0}),E!=="GeometryCollection")switch(E){case"LineString":A.coordinates=Vh(A.coordinates,I,T);break;case"MultiLineString":A.coordinates=A.coordinates.map(S=>Vh(S,I,T));break;case"Polygon":A.coordinates=ag(A.coordinates,I,T);break;case"MultiPolygon":A.coordinates=A.coordinates.map(S=>ag(S,I,T))}return A}function ag(A,I,T){return A.map(function(E){if(E.length<4)throw new Error("invalid polygon");let S=I,P=Vh(E,S,T);for(;!og(P)&&S>=Number.EPSILON;)S-=S*.01,P=Vh(E,S,T);return og(P)?((P[P.length-1][0]!==P[0][0]||P[P.length-1][1]!==P[0][1])&&P.push(P[0]),P):E})}function og(A){return A.length<3?!1:!(A.length===3&&A[2][0]===A[0][0]&&A[2][1]===A[0][1])}function lg(A){if(A.type==="Point")return A.coordinates;if(A.type==="Polygon"){let I=0,T=0,E=0;return A.coordinates[0].forEach(S=>{I+=S[0],T+=S[1],E++}),[I/E,T/E]}if(A.type==="LineString"){const I=Math.floor(A.coordinates.length/2);return A.coordinates[I]}return null}const B0={ensureGeometryIndex(A){this.geometryIndex||(this.geometryIndex=new Map,!(!A||!Array.isArray(A.features))&&A.features.forEach(I=>{const T=I?.properties?.id;T&&this.geometryIndex.set(T,I)}))},addBuildingShell(A){if(A.length>0){const I=A[0],T=A.length*3;this.map.addSource("building-shell",{type:"geojson",data:I}),this.locationMap=new Map,this.roomStateMap=new Map,this.map.addLayer({id:"building-shell",type:"fill-extrusion",source:"building-shell",maxzoom:this.MIN_ZOOM_INDOOR,paint:{"fill-extrusion-color":this.themeColors.ExteriorWalls,"fill-extrusion-height":T,"fill-extrusion-base":0,"fill-extrusion-opacity":.9,"fill-extrusion-vertical-gradient":!0}}),this.map.on("click","building-shell",E=>{this.map.flyTo({center:E.lngLat,zoom:this.MIN_ZOOM_INDOOR+1,pitch:60,bearing:-17,essential:!0})}),this.map.on("mouseenter","building-shell",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","building-shell",()=>{this.map.getCanvas().style.cursor=""})}},processStyles(A,I,T){this.ensureGeometryIndex(I);const E=[];Object.entries(A).forEach(([P,b])=>{const o=b.geometryAnchors||[];if(!o.length)return;const N=[],$=new Set;o.forEach(G=>{const V=G.geometryId;if(!V||T.has(V)||$.has(V))return;$.add(V);const K=this.geometryIndex.get(V);K&&N.push({...K,properties:{...K.properties,floorId:G.floorId||K.properties?.floorId}})}),N.length!==0&&E.push({styleName:P,style:b,features:N})});const S=P=>{const{styleName:b,style:o,features:N}=P,$=(o.height||0)*3,G=N[0].geometry.type==="LineString"||N[0].geometry.type==="MultiLineString";return!!(b.includes("Walls")&&G&&$>0||(N[0].geometry.type==="Polygon"||N[0].geometry.type==="MultiPolygon")&&$>0)};E.sort((P,b)=>{const o=S(P),N=S(b);return o===N?0:o?1:-1}),this.first3DLayerId=null,this.hoveredStateId=null,this.selectedStateId=null,E.forEach(P=>{this.createStyleLayer(P.styleName,P.style,P.features),S(P)&&!this.first3DLayerId&&(this.first3DLayerId=P.styleName)})},createStyleLayer(A,I,T){let E=T[0].geometry.type==="Polygon"||T[0].geometry.type==="MultiPolygon",S=T[0].geometry.type==="LineString"||T[0].geometry.type==="MultiLineString",P;this.themeColors[A]?P=this.themeColors[A]:I.color?["#ffffff","#FFFFFF","#fcfcfc","#f5f5f5","#E6F4FB","#DCDCDC","#F5EFE0"].some(K=>K.toLowerCase()===I.color.toLowerCase())?P="#2A2D35":P=I.color:P=this.themeColors.Default;let b=A.includes("Walls")?1:1.8;const o=(I.height||0)*b;A.includes("Walls")&&S&&o>0&&(T=T.map(V=>{try{const K=fc(V,.15,{units:"meters"});return K.properties=V.properties,K}catch{return V}}),E=!0,S=!1),T=T.map((V,K)=>({...V,id:K})),T.forEach(V=>{V.properties&&V.properties.id&&this.roomStateMap.set(V.properties.id,{source:A,id:V.id})}),this.map.addSource(A,{type:"geojson",data:{type:"FeatureCollection",features:T}});const N=A==="ExteriorWalls"?15:this.MIN_ZOOM_INDOOR,$=A.includes("Walls"),G=$?1:I.opacity||1;if(E&&o>0&&(this.map.addLayer({id:A,type:"fill-extrusion",source:A,minzoom:N,paint:{"fill-extrusion-color":["case",["boolean",["feature-state","selected"],!1],"rgba(123, 97, 255, 1)",["boolean",["feature-state","hover"],!1],"rgba(157, 137, 255, 1)",P],"fill-extrusion-height":o,"fill-extrusion-base":0,"fill-extrusion-opacity":G,"fill-extrusion-vertical-gradient":!0,"fill-extrusion-color-transition":{duration:300}}}),this.mvfLayerIds.add(A),$)){const V=`${A}-stroke`,K=`${A}-stroke-source`,q=.1,Y=.005,J=T.map(at=>{try{const ut=fc(at,.05,{units:"meters",steps:32});return ut.properties=at.properties,ut}catch{return at}});this.map.addSource(K,{type:"geojson",data:{type:"FeatureCollection",features:J}}),this.map.addLayer({id:V,type:"fill-extrusion",source:K,minzoom:N,paint:{"fill-extrusion-color":"#1A1A1A","fill-extrusion-height":o+q+Y,"fill-extrusion-base":o,"fill-extrusion-opacity":1,"fill-extrusion-vertical-gradient":!1}}),this.mvfLayerIds.add(V)}!$&&!A.includes("Walls")&&(this.map.on("click",A,V=>{if(V.features.length>0){const K=V.features[0],q=K.id,Y=K.properties.id;if(!this.locationMap||!this.locationMap.has(Y))return;if(this.selectedStateId&&this.selectedStateId.id===q&&this.selectedStateId.source===A){this.map.setFeatureState({source:A,id:q},{selected:!1}),this.selectedStateId=null,window.dispatchEvent(new CustomEvent("location-deselected"));return}else this.selectedStateId&&this.map.setFeatureState({source:this.selectedStateId.source,id:this.selectedStateId.id},{selected:!1}),this.selectedStateId={source:A,id:q},this.map.setFeatureState({source:A,id:q},{selected:!0});if(this.locationMap&&this.locationMap.has(Y)){const J=this.locationMap.get(Y);window.dispatchEvent(new CustomEvent("location-clicked",{detail:{name:J.name,coords:J.coords,floorId:J.floorId,locationId:Y}}))}}}),this.map.on("mousemove",A,V=>{if(V.features.length>0){const K=V.features[0],q=K.id,Y=K.properties.id;if(!this.locationMap||!this.locationMap.has(Y)){this.hoveredStateId&&(this.map.setFeatureState({source:this.hoveredStateId.source,id:this.hoveredStateId.id},{hover:!1}),this.hoveredStateId=null),this.map.getCanvas().style.cursor="";return}this.hoveredStateId&&(this.hoveredStateId.id!==q||this.hoveredStateId.source!==A)&&this.map.setFeatureState({source:this.hoveredStateId.source,id:this.hoveredStateId.id},{hover:!1}),this.hoveredStateId={source:A,id:q},this.map.setFeatureState({source:A,id:q},{hover:!0}),this.locationMap&&this.locationMap.has(Y)&&(this.map.getCanvas().style.cursor="pointer")}}),this.map.on("mouseleave",A,()=>{this.hoveredStateId&&this.map.setFeatureState({source:this.hoveredStateId.source,id:this.hoveredStateId.id},{hover:!1}),this.hoveredStateId=null,this.map.getCanvas().style.cursor=""}))},addDoors(A,I,T){this.ensureGeometryIndex(A);const E=[];I.forEach(P=>{const b=this.geometryIndex.get(P);if(!b)return;const o=T.get(P)||b.properties?.floorId;E.push({...b,properties:{...b.properties,floorId:o}})});const S=E.map(P=>{if(P.geometry.type==="LineString")try{const b=fc(P,.05,{units:"meters"});return b.properties=P.properties,b}catch{return P}return P});S.length>0&&(this.map.addSource("doors",{type:"geojson",data:{type:"FeatureCollection",features:S}}),this.map.addLayer({id:"doors",type:"fill-extrusion",source:"doors",minzoom:this.MIN_ZOOM_INDOOR,paint:{"fill-extrusion-color":this.themeColors.Doors,"fill-extrusion-height":.6,"fill-extrusion-base":0,"fill-extrusion-opacity":.4,"fill-extrusion-vertical-gradient":!0}}),this.mvfLayerIds.add("doors"))},addLabels(A,I){const T=[];this.ensureGeometryIndex(I),this.locationMap||(this.locationMap=new Map),A.forEach(E=>{if(E.details&&E.details.name&&E.geometryAnchors&&E.geometryAnchors.length>0){const S=E.geometryAnchors[0].geometryId,P=E.geometryAnchors[0].floorId,b=this.geometryIndex.get(S);if(b){const o=lg(b.geometry);o&&(T.push({type:"Feature",geometry:{type:"Point",coordinates:o},properties:{name:E.details.name,floorId:P,id:S}}),this.locationMap.set(S,{name:E.details.name,coords:o,floorId:P}))}}}),T.length>0&&(this.map.addSource("labels",{type:"geojson",data:{type:"FeatureCollection",features:T}}),this.map.addLayer({id:"labels",type:"symbol",source:"labels",minzoom:this.MIN_ZOOM_INDOOR,layout:{"text-field":["get","name"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12,"text-anchor":"center","text-offset":[0,-1.5]},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":1}}),this.mvfLayerIds.add("labels"),this.map.on("click","labels",E=>{const S=E.features[0],P=S.geometry.coordinates.slice(),b=S.properties.name,o=S.properties.floorId,N=S.properties.id;if(N&&this.roomStateMap.has(N)){const $=this.roomStateMap.get(N),G=$.source,V=$.id;if(this.selectedStateId&&this.selectedStateId.id===V&&this.selectedStateId.source===G){this.map.setFeatureState({source:G,id:V},{selected:!1}),this.selectedStateId=null,window.dispatchEvent(new CustomEvent("location-deselected"));return}else this.selectedStateId&&this.map.setFeatureState({source:this.selectedStateId.source,id:this.selectedStateId.id},{selected:!1}),this.selectedStateId={source:G,id:V},this.map.setFeatureState({source:G,id:V},{selected:!0})}window.dispatchEvent(new CustomEvent("location-clicked",{detail:{name:b,coords:P,floorId:o,locationId:N}}))}),this.map.on("mouseenter","labels",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","labels",()=>{this.map.getCanvas().style.cursor=""}))},addNodes(A){},addDebugNodes(A,I){Object.entries(A).forEach(([T,E])=>{const S=[],{ids:P,color:b}=E;if(I.features.forEach(o=>{if(P.has(o.properties.id)){const N=lg(o.geometry);N&&S.push({type:"Feature",geometry:{type:"Point",coordinates:N},properties:{id:o.properties.id,floorId:o.properties.floorId}})}}),S.length>0){const o=`debug-${T}-source`,N=`debug-${T}-layer`;this.map.getSource(o)?this.map.getSource(o).setData({type:"FeatureCollection",features:S}):(this.map.addSource(o,{type:"geojson",data:{type:"FeatureCollection",features:S}}),this.map.addLayer({id:N,type:"circle",source:o,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":3,"circle-color":b,"circle-stroke-width":1,"circle-stroke-color":"#ffffff","circle-opacity":.8}}),this.mvfLayerIds.add(N),this.map.on("click",N,$=>{const G=$.features[0],V=G.properties,K=G.geometry.coordinates.slice();new pr.Popup().setLngLat(K).setHTML(`
                                <strong>Category:</strong> ${T}<br>
                                <strong>ID:</strong> ${V.id}<br>
                                <strong>Floor:</strong> ${V.floorId}
                            `).addTo(this.map)}),this.map.on("mouseenter",N,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",N,()=>{this.map.getCanvas().style.cursor=""}))}})}},V0={addWallNodes(A){const I="wall-nodes-source",T="wall-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":3,"circle-color":"#FF0000","circle-stroke-width":1,"circle-stroke-color":"#ffffff","circle-opacity":.8}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Wall Node<br>
                        <strong>Original ID:</strong> ${P.originalId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},addStairsNodes(A){const I="stairs-nodes-source",T="stairs-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":3,"circle-color":"#FF00FF","circle-stroke-width":1.5,"circle-stroke-color":"#ffffff","circle-opacity":.9}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Stairs <br>
                        <strong>Geometry ID:</strong> ${P.geometryId}<br>
                        <strong>Connection ID:</strong> ${P.connectionId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},addElevatorNodes(A){const I="elevator-nodes-source",T="elevator-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":3,"circle-color":"#00FFFF","circle-stroke-width":1.5,"circle-stroke-color":"#ffffff","circle-opacity":.9}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Elevator <br>
                        <strong>Geometry ID:</strong> ${P.geometryId}<br>
                        <strong>Connection ID:</strong> ${P.connectionId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},async addAnnotationNodes(A){this.annotationMarkers||(this.annotationMarkers=[]);const I=async E=>await(await fetch(`/assets/icons/${E}.svg`)).text();for(const E of A.features){const{coordinates:S}=E.geometry,{iconType:P,entranceType:b,annotationId:o,floorId:N}=E.properties,$=await I(P),G=document.createElement("div");G.className=`annotation-marker ${P}`,G.innerHTML=`<div class="annotation-icon">${$}</div>`,G.style.width="14px",G.style.height="14px";const V=new pr.Marker({element:G,anchor:"center"}).setLngLat(S).setPopup(new pr.Popup({offset:25}).setHTML(`
                            <strong>Type:</strong> ${b}<br>
                            <strong>Annotation ID:</strong> ${o}<br>
                            <strong>Floor:</strong> ${N}
                        `)).addTo(this.map);this.annotationMarkers.push({marker:V,floorId:N,layerId:"annotation-nodes-layer"})}this.mvfLayerIds.add("annotation-nodes-layer"),this.map.on("zoom",()=>{const S=this.map.getZoom()>=this.MIN_ZOOM_INDOOR;this.annotationMarkers.forEach(P=>{const b=P.marker.getElement();b.style.display=S?"block":"none"})}),this.map.getZoom()<this.MIN_ZOOM_INDOOR&&this.annotationMarkers.forEach(E=>{E.marker.getElement().style.display="none"})}},j0={addWalkableAreas(A){const I="walkable-areas-source",T="walkable-areas-layer",E="walkable-areas-outline-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"fill",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"fill-color":"#4f7cff","fill-opacity":.12}}),this.map.addLayer({id:E,type:"line",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"line-color":"#4f7cff","line-width":1.2,"line-opacity":.5}}),this.mvfLayerIds.add(T),this.mvfLayerIds.add(E))},addWalkableNodes(A){const I="walkable-nodes-source",T="walkable-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":2.5,"circle-color":"#00FF00","circle-stroke-width":1,"circle-stroke-color":"#ffffff","circle-opacity":.7}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Walkable Area<br>
                        <strong>Geometry ID:</strong> ${P.geometryId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},addNonwalkableNodes(A){const I="nonwalkable-nodes-source",T="nonwalkable-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":2.5,"circle-color":"#FFA500","circle-stroke-width":1,"circle-stroke-color":"#ffffff","circle-opacity":.7}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Nonwalkable Area<br>
                        <strong>Geometry ID:</strong> ${P.geometryId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},addKindsNodes(A){const I="kinds-nodes-source",T="kinds-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":2.5,"circle-color":["match",["get","kind"],"wall","#0000FF","room","#9400D3","object","#FFD700","#808080"],"circle-stroke-width":1,"circle-stroke-color":"#ffffff","circle-opacity":.7}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Semantic Classification<br>
                        <strong>Kind:</strong> ${P.kind}<br>
                        <strong>Geometry ID:</strong> ${P.geometryId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},addEntranceAestheticNodes(A){const I="entrance-aesthetic-nodes-source",T="entrance-aesthetic-nodes-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":3,"circle-color":"#2E8B57","circle-stroke-width":1.5,"circle-stroke-color":"#ffffff","circle-opacity":.9}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();new pr.Popup().setLngLat(b).setHTML(`
                        <strong>Type:</strong> Outdoor Entrance<br>
                        <strong>Kind:</strong> ${P.kind}<br>
                        <strong>Entrance ID:</strong> ${P.entranceId}<br>
                        <strong>Geometry ID:</strong> ${P.geometryId}<br>
                        <strong>Floor:</strong> ${P.floorId}
                    `).addTo(this.map)}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))},addLocationMarkers(A){const I="location-markers-source",T="location-markers-layer";this.map.getSource(I)?this.map.getSource(I).setData(A):(this.map.addSource(I,{type:"geojson",data:A}),this.map.addLayer({id:T,type:"circle",source:I,minzoom:this.MIN_ZOOM_INDOOR,paint:{"circle-radius":3,"circle-color":"#FFD700","circle-stroke-width":1.5,"circle-stroke-color":"#ffffff","circle-opacity":.9}}),this.mvfLayerIds.add(T),this.map.on("click",T,E=>{const S=E.features[0],P=S.properties,b=S.geometry.coordinates.slice();window.dispatchEvent(new CustomEvent("location-clicked",{detail:{name:P.name,coords:b,floorId:P.floorId,locationId:P.locationId}}))}),this.map.on("mouseenter",T,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",T,()=>{this.map.getCanvas().style.cursor=""}))}},G0={updateFloorVisibility(A){this.currentFloorId=A,this.mvfLayerIds.forEach(I=>{if(this.map.getLayer(I)){if(I==="building-shell"||I==="annotation-nodes-layer")return;this.map.setFilter(I,["==",["get","floorId"],A])}}),this.annotationMarkers&&this.annotationMarkers.forEach(({marker:I,floorId:T})=>{T===A?I.getElement().style.display="block":I.getElement().style.display="none"})},updateMultiFloorVisibility(A){this.currentFloorId=Array.from(A)[0],this.mvfLayerIds.forEach(I=>{if(this.map.getLayer(I)){if(I==="building-shell")return;this.map.setFilter(I,["in",["get","floorId"],["literal",Array.from(A)]])}})},toggleLayerVisibility(A){const I={"walkable-areas-layer":["walkable-areas-outline-layer"]};if(A==="annotation-nodes-layer"&&this.annotationMarkers){const E=!(this.annotationMarkers[0]?.marker.getElement().style.display!=="none");return this.annotationMarkers.forEach(({marker:S,floorId:P})=>{P===this.currentFloorId&&(S.getElement().style.display=E?"block":"none")}),E}if(this.map.getLayer(A)){const E=this.map.getLayoutProperty(A,"visibility")==="visible"?"none":"visible";return this.map.setLayoutProperty(A,"visibility",E),I[A]&&I[A].forEach(S=>{this.map.getLayer(S)&&this.map.setLayoutProperty(S,"visibility",E)}),E==="visible"}return!1},setLayerVisibility(A,I){const T={"walkable-areas-layer":["walkable-areas-outline-layer"]};if(A==="annotation-nodes-layer"&&this.annotationMarkers){this.annotationMarkers.forEach(({marker:E,floorId:S})=>{S===this.currentFloorId&&(E.getElement().style.display=I?"block":"none")});return}this.map.getLayer(A)&&this.map.setLayoutProperty(A,"visibility",I?"visible":"none"),T[A]&&T[A].forEach(E=>{this.map.getLayer(E)&&this.map.setLayoutProperty(E,"visibility",I?"visible":"none")})},isLayerVisible(A){if(A==="annotation-nodes-layer"&&this.annotationMarkers&&this.annotationMarkers.length>0)return this.annotationMarkers[0].marker.getElement().style.display!=="none";if(this.map.getLayer(A)){const I=this.map.getLayoutProperty(A,"visibility");return I==="visible"||I===void 0}return!1}};class Ng{constructor(I,T){this.map=I,this.themeColors=T,this.mvfLayerIds=new Set,this.MIN_ZOOM_INDOOR=19}}Object.assign(Ng.prototype,B0,V0,j0,G0);class U0{constructor(I,T,E){this.map=I,this.layerManager=T,this.floors=E,this.currentFloorId=E[0]?.properties.id,this.MIN_ZOOM_INDOOR=19}getCurrentFloorId(){return this.currentFloorId}init(){this.createFloorControls(),this.setupZoomListener(),this.setupExternalListeners(),this.layerManager.updateFloorVisibility(this.currentFloorId)}createFloorControls(){const I=document.getElementById("floor-controls");I.innerHTML="";const T=document.createElement("select");T.className="floor-select",this.floors.forEach(E=>{const S=document.createElement("option");S.value=E.properties.id,S.textContent=E.properties.details.name||`Level ${E.properties.elevation}`,E.properties.id===this.currentFloorId&&(S.selected=!0),T.appendChild(S)}),T.addEventListener("change",()=>{const E=T.value;this.currentFloorId!==E&&(this.currentFloorId=E,this.layerManager.updateFloorVisibility(this.currentFloorId),window.dispatchEvent(new CustomEvent("floor-changed",{detail:{floorId:E}})))}),I.appendChild(T),this.floorSelect=T}setupZoomListener(){const I=document.getElementById("floor-controls"),T=document.getElementById("view-indicator"),E=()=>{this.map.getZoom()<this.MIN_ZOOM_INDOOR?(I.style.display="none",T&&(T.textContent="Outdoor View - Zoom in for indoor",T.classList.remove("is-hidden"))):(I.style.display="block",T&&(T.textContent="Indoor View",T.classList.add("is-hidden")))};this.map.on("zoom",E),E();const S=()=>{this.map.getZoom()<this.MIN_ZOOM_INDOOR?this.map.getPitch()>15&&this.map.easeTo({pitch:0,bearing:0,duration:600}):this.map.getPitch()<40&&this.map.easeTo({pitch:60,bearing:-17,duration:600})};this.map.on("zoomend",S)}setupExternalListeners(){window.addEventListener("floor-changed",I=>{const T=I.detail.floorId;T&&T!==this.currentFloorId&&(this.currentFloorId=T,this.floorSelect&&(this.floorSelect.value=T),this.layerManager.updateFloorVisibility(this.currentFloorId))})}}const ug="mappedin_layer_visibility";class q0{constructor(I){this.layerManager=I,this.layerStates=this.loadLayerStates()}init(){document.querySelectorAll(".legend-item.toggleable").forEach(T=>{const E=T.dataset.layer,S=this.layerStates[E]!==!1;this.updateLegendItem(T,S),this.layerManager.setLayerVisibility(E,S),T.addEventListener("click",()=>{this.toggleLayer(E,T)})})}toggleLayer(I,T){const E=this.layerManager.toggleLayerVisibility(I);this.updateLegendItem(T,E),this.layerStates[I]=E,this.saveLayerStates()}updateLegendItem(I,T){T?I.classList.add("active"):I.classList.remove("active")}loadLayerStates(){try{const I=localStorage.getItem(ug);return I?JSON.parse(I):{}}catch(I){return console.warn("Failed to load layer states from localStorage:",I),{}}}saveLayerStates(){try{localStorage.setItem(ug,JSON.stringify(this.layerStates))}catch(I){console.warn("Failed to save layer states to localStorage:",I)}}getLayerState(I){return this.layerStates[I]!==!1}setLayerState(I,T){const E=document.querySelector(`.legend-item[data-layer="${I}"]`);E&&(this.layerManager.setLayerVisibility(I,T),this.updateLegendItem(E,T),this.layerStates[I]=T,this.saveLayerStates())}resetAll(){document.querySelectorAll(".legend-item.toggleable").forEach(T=>{const E=T.dataset.layer;this.setLayerState(E,!0)})}}class su{constructor(I,T=4,E=8,S=0){this.bounds=I,this.capacity=T,this.maxDepth=E,this.depth=S,this.nodes=[],this.divided=!1,this.northwest=null,this.northeast=null,this.southwest=null,this.southeast=null}insert(I){return this.contains(I.coords)?this.nodes.length<this.capacity||this.depth>=this.maxDepth?(this.nodes.push(I),!0):(this.divided||this.subdivide(),this.northwest.insert(I)||this.northeast.insert(I)||this.southwest.insert(I)||this.southeast.insert(I)):!1}contains(I){const[T,E]=I;return T>=this.bounds.minX&&T<=this.bounds.maxX&&E>=this.bounds.minY&&E<=this.bounds.maxY}subdivide(){const{minX:I,minY:T,maxX:E,maxY:S}=this.bounds,P=(I+E)/2,b=(T+S)/2;this.northwest=new su({minX:I,minY:b,maxX:P,maxY:S},this.capacity,this.maxDepth,this.depth+1),this.northeast=new su({minX:P,minY:b,maxX:E,maxY:S},this.capacity,this.maxDepth,this.depth+1),this.southwest=new su({minX:I,minY:T,maxX:P,maxY:b},this.capacity,this.maxDepth,this.depth+1),this.southeast=new su({minX:P,minY:T,maxX:E,maxY:b},this.capacity,this.maxDepth,this.depth+1),this.divided=!0}query(I,T=[]){if(!this.intersects(I))return T;for(const E of this.nodes)this.inRange(E.coords,I)&&T.push(E);return this.divided&&(this.northwest.query(I,T),this.northeast.query(I,T),this.southwest.query(I,T),this.southeast.query(I,T)),T}intersects(I){return!(I.maxX<this.bounds.minX||I.minX>this.bounds.maxX||I.maxY<this.bounds.minY||I.minY>this.bounds.maxY)}inRange(I,T){const[E,S]=I;return E>=T.minX&&E<=T.maxX&&S>=T.minY&&S<=T.maxY}}class Z0{constructor(){this.nodes=new Map,this.edges=new Map,this.spatialIndex=new Map,this.geometryToNodeMap=new Map}addNode(I,T,E,S={}){const P={id:I,coords:T,floorId:E,type:S.type||"waypoint",metadata:S};return this.nodes.set(I,P),this.edges.has(I)||this.edges.set(I,[]),this.spatialIndex.has(E)||this.spatialIndex.set(E,{quadTree:null,nodes:[]}),this.spatialIndex.get(E).nodes.push(P),S.geometryIds&&S.geometryIds.forEach(b=>{this.geometryToNodeMap.set(b,I)}),P}buildSpatialIndexes(){this.spatialIndex.forEach((I,T)=>{if(I.nodes.length===0)return;let E=1/0,S=1/0,P=-1/0,b=-1/0;I.nodes.forEach(G=>{const[V,K]=G.coords;E=Math.min(E,V),S=Math.min(S,K),P=Math.max(P,V),b=Math.max(b,K)});const o=1e-4,N={minX:E-o,minY:S-o,maxX:P+o,maxY:b+o},$=new su(N);I.nodes.forEach(G=>$.insert(G)),I.quadTree=$})}getNode(I){return this.nodes.get(I)}addEdge(I,T,E,S={}){const P={target:T,weight:E,type:S.type||"walkable",accessible:S.accessible!==!1,...S},b=this.edges.get(I);b&&b.push(P)}addBidirectionalEdge(I,T,E,S={}){this.addEdge(I,T,E,S),this.addEdge(T,I,E,S)}getEdges(I){return this.edges.get(I)||[]}getNodesOnFloor(I){const T=this.spatialIndex.get(I);return T?T.nodes:[]}findNearestNode(I,T,E=5e-4){const S=this.spatialIndex.get(T);if(!S||!S.quadTree)return null;const[P,b]=I,o={minX:P-E,minY:b-E,maxX:P+E,maxY:b+E},N=S.quadTree.query(o);if(N.length===0)return null;let $=null,G=1/0;return N.forEach(V=>{const[K,q]=V.coords,Y=K-P,J=q-b,W=Math.sqrt(Y*Y+J*J);W<G&&(G=W,$=V)}),$}findNearestNodeExpanded(I,T,E=5){const S=[5e-4,.001,.002,.005,.01];for(let P=0;P<Math.min(E,S.length);P++){const b=this.findNearestNode(I,T,S[P]);if(b)return console.log(`  Found node at radius ${P+1} (${S[P]})`),b}return console.warn("No node found even with expanded search"),null}findNearestNodesInRadius(I,T,E=.001,S=5){const P=this.spatialIndex.get(T);if(!P||!P.quadTree)return[];const[b,o]=I,N={minX:b-E,minY:o-E,maxX:b+E,maxY:o+E},$=P.quadTree.query(N);return $.length===0?[]:$.map(G=>{const[V,K]=G.coords,q=V-b,Y=K-o;return{node:G,dist:Math.sqrt(q*q+Y*Y)}}).sort((G,V)=>G.dist-V.dist).slice(0,S).map(G=>G.node)}getNodeByGeometryId(I){const T=this.geometryToNodeMap.get(I);return T?this.nodes.get(T):null}getStats(){let I=0;return this.edges.forEach(T=>{I+=T.length}),{nodeCount:this.nodes.size,edgeCount:I,floors:this.spatialIndex.size,avgEdgesPerNode:I/this.nodes.size}}}class $0{constructor(){this.obstacles=new Map,this.walkableAreas=new Map,this.doorSegments=new Map,this.doorToleranceMeters=.6}initialize(I,T,E){console.log("Initializing CollisionDetector..."),I.features.forEach(S=>{const P=S.properties.floorId,b=S.properties.id;if(!P)return;const o=E&&E[b]==="wall",N=T&&T.has(b);if(o||N){this.obstacles.has(P)||this.obstacles.set(P,[]);let $=S;if(S.geometry.type==="LineString")try{$=fc(S,.5,{units:"meters"})}catch(G){console.warn("Failed to buffer line geometry:",G);return}if($.geometry.type==="Polygon"||$.geometry.type==="MultiPolygon"){let G=null;try{G=Rh($)}catch{G=null}this.obstacles.get(P).push({feature:$,bbox:G})}}}),console.log(`built obstacle map for ${this.obstacles.size} floors`),this.obstacles.forEach((S,P)=>{console.log(`  Floor ${P}: ${S.length} obstacles`)})}setDoorSegments(I){this.doorSegments=I||new Map}lineIntersectsObstacle(I,T,E){const S=this.obstacles.get(E);if(!S||S.length===0)return!1;try{const P=Na([I,T]);let b=null;try{b=Rh(P)}catch{b=null}for(const o of S){if(b&&o.bbox){const[$,G,V,K]=b,[q,Y,J,W]=o.bbox;if(J<$||q>V||W<G||Y>K)continue}const N=Nv(P,o.feature);if(N.features.length>0&&!N.features.every(G=>this.isIntersectionAtDoor(G,E)))return!0}return!1}catch(P){return console.warn("Error checking line intersection:",P),!1}}isIntersectionAtDoor(I,T){const E=this.doorSegments.get(T);if(!E||E.length===0)return!1;try{return E.some(S=>A0(I,S,{units:"meters"})<=this.doorToleranceMeters)}catch{return!1}}pointInObstacle(I,T){const E=this.obstacles.get(T);if(!E)return!1;try{const S=Mn(I);if(this.isIntersectionAtDoor(S,T))return!1;for(const P of E)if(gf(S,P.feature))return!0;return!1}catch(S){return console.warn("Error checking point in obstacle:",S),!1}}getObstaclesOnFloor(I){return(this.obstacles.get(I)||[]).map(E=>E.feature)}isPathClear(I,T,E){return this.pointInObstacle(I,E)||this.pointInObstacle(T,E)?!1:!this.lineIntersectsObstacle(I,T,E)}isPathClearRelaxed(I,T,E){const S=T[0]-I[0],P=T[1]-I[1],o=Math.sqrt(S*S+P*P)*111320;return o<2?!0:o<10?!this.lineIntersectsObstacle(I,T,E):this.isPathClear(I,T,E)}validatePath(I,T){for(let E=0;E<I.length-1;E++){const S=I[E],P=I[E+1],b=T[E];if(!this.isPathClear(S,P,b))return{valid:!1,failureIndex:E,segment:{start:S,end:P}}}return{valid:!0}}}class W0{constructor(I){this.collisionDetector=I}async buildEdgesForFloor(I,T,E=15,S=null,P=null,b=null){const o=[];console.log(`Building edges for floor ${T} with ${I.length} nodes (maxDist: ${E}m)...`);const N=E/111320;for(let $=0;$<I.length;$++){const G=I[$],[V,K]=G.coords;let q;if(S&&S.quadTree){const Y={minX:V-N,minY:K-N,maxX:V+N,maxY:K+N};q=S.quadTree.query(Y)}else q=I.filter(Y=>{const[J,W]=Y.coords;return Math.abs(J-V)<=N&&Math.abs(W-K)<=N});P&&q.length>P&&(q=q.map(Y=>{const[J,W]=Y.coords,at=J-V,ut=W-K;return{candidate:Y,distSq:at*at+ut*ut}}).sort((Y,J)=>Y.distSq-J.distSq).slice(0,P).map(Y=>Y.candidate));for(const Y of q){if(Y.id<=G.id)continue;const J=this.calculateDistance(G.coords,Y.coords);J>E||this.hasLineOfSight(G.coords,Y.coords,T)&&(o.push({from:G.id,to:Y.id,weight:J,type:"walkable"}),o.push({from:Y.id,to:G.id,weight:J,type:"walkable"}))}b&&$%b===0&&await new Promise(Y=>setTimeout(Y,0))}return console.log(`  Created ${o.length} edges`),o}hasLineOfSight(I,T,E){return this.collisionDetector.isPathClear(I,T,E)}calculateDistance(I,T){try{return Ir(Mn(I),Mn(T),{units:"meters"})}catch{const[S,P]=I,[b,o]=T,N=b-S,$=o-P;return Math.sqrt(N*N+$*$)*111320}}async buildAllEdges(I,T=15,E=null,S=null){let P=0;const b=new Set;I.nodes.forEach(o=>b.add(o.floorId));for(const o of b){const N=I.getNodesOnFloor(o),$=I.spatialIndex.get(o),G=await this.buildEdgesForFloor(N,o,T,$,E,S);G.forEach(V=>{I.addEdge(V.from,V.to,V.weight,{type:V.type})}),P+=G.length}return console.log(`Total edges built: ${P}`),P}}class af{constructor(){this.heap=[]}push(I){this.heap.push(I),this.bubbleUp(this.heap.length-1)}pop(){if(this.heap.length===0)return null;if(this.heap.length===1)return this.heap.pop();const I=this.heap[0];return this.heap[0]=this.heap.pop(),this.bubbleDown(0),I}bubbleUp(I){for(;I>0;){const T=Math.floor((I-1)/2);if(this.heap[I].priority>=this.heap[T].priority)break;[this.heap[I],this.heap[T]]=[this.heap[T],this.heap[I]],I=T}}bubbleDown(I){for(;;){const T=2*I+1,E=2*I+2;let S=I;if(T<this.heap.length&&this.heap[T].priority<this.heap[S].priority&&(S=T),E<this.heap.length&&this.heap[E].priority<this.heap[S].priority&&(S=E),S===I)break;[this.heap[I],this.heap[S]]=[this.heap[S],this.heap[I]],I=S}}isEmpty(){return this.heap.length===0}}class X0{constructor(I){this.graph=I}findPath(I,T,E={}){const{accessibleOnly:S=!1,avoidStairs:P=!1,heuristicWeight:b=1,allowedRoomIds:o=null,disallowOtherRooms:N=!1,nodeFilter:$=null}=E,G=this.graph.getNode(I),V=this.graph.getNode(T);if(!G||!V)return console.error("Start or end node not found"),null;const K=new af,q=new Set,Y=new Map,J=new Map,W=new Map;Y.set(I,0);const at=this.heuristic(G,V);J.set(I,at),K.push({nodeId:I,priority:at});const ut=o?o instanceof Set?o:new Set(o):null,dt=kt=>{if(!N)return!0;const jt=kt?.metadata||{};if(jt.isElevator||jt.isStairs||jt.isDoor)return!0;const Mt=jt.roomIds||(jt.roomId?[jt.roomId]:[]);return!Mt||Mt.length===0||!ut||ut.size===0?!0:Mt.some(Wt=>ut.has(Wt))},Lt=kt=>!kt||$&&!$(kt)?!1:dt(kt);for(;!K.isEmpty();){const jt=K.pop().nodeId;if(jt===T)return this.reconstructPath(W,jt,Y);if(q.has(jt))continue;q.add(jt);const Mt=this.graph.getEdges(jt),Wt=this.graph.getNode(jt);for(const Ot of Mt){if(S&&!Ot.accessible||P&&Ot.type==="stairs")continue;const Kt=Ot.target;if(q.has(Kt))continue;const ge=this.graph.getNode(Kt);if(!ge||!Lt(ge))continue;const Et=Ot.weight??Ir(Mn(Wt.coords),Mn(ge.coords),{units:"meters"}),Ht=Y.get(jt)+Et;if(Ht<(Y.get(Kt)||1/0)){W.set(Kt,jt),Y.set(Kt,Ht);const tt=this.heuristic(ge,V)*b,Jt=Ht+tt;J.set(Kt,Jt),K.push({nodeId:Kt,priority:Jt})}}}return console.warn("No path found between nodes"),null}findPathBidirectional(I,T,E={}){const{accessibleOnly:S=!1,avoidStairs:P=!1,heuristicWeight:b=1,allowedRoomIds:o=null,disallowOtherRooms:N=!1,nodeFilter:$=null}=E,G=this.graph.getNode(I),V=this.graph.getNode(T);if(!G||!V)return console.error("Start or end node not found"),null;const K=new af,q=new Set,Y=new Map,J=new Map,W=new af,at=new Set,ut=new Map,dt=new Map;Y.set(I,0),K.push({nodeId:I,priority:this.heuristic(G,V)}),ut.set(T,0),W.push({nodeId:T,priority:this.heuristic(V,G)});const Lt=o?o instanceof Set?o:new Set(o):null,kt=Ot=>{if(!N)return!0;const Kt=Ot?.metadata||{},ge=Kt.roomIds||(Kt.roomId?[Kt.roomId]:[]);return!ge||ge.length===0?!0:!Lt||Lt.size===0?!1:ge.some(Et=>Lt.has(Et))},jt=Ot=>!Ot||$&&!$(Ot)?!1:kt(Ot);let Mt=1/0,Wt=null;for(;!K.isEmpty()||!W.isEmpty();){if(!K.isEmpty()){const Kt=K.pop().nodeId;if(!q.has(Kt)){if(q.add(Kt),at.has(Kt)){const Ht=Y.get(Kt)+ut.get(Kt);Ht<Mt&&(Mt=Ht,Wt=Kt)}const ge=this.graph.getEdges(Kt),Et=this.graph.getNode(Kt);for(const Ht of ge){if(S&&!Ht.accessible||P&&Ht.type==="stairs")continue;const tt=Ht.target;if(q.has(tt))continue;const Jt=this.graph.getNode(tt);if(!Jt||!jt(Jt))continue;const ze=Ht.weight??Ir(Mn(Et.coords),Mn(Jt.coords),{units:"meters"}),te=Y.get(Kt)+ze;if(te<(Y.get(tt)||1/0)){J.set(tt,Kt),Y.set(tt,te);const Ne=this.heuristic(Jt,V)*b;K.push({nodeId:tt,priority:te+Ne})}}}}if(!W.isEmpty()){const Kt=W.pop().nodeId;if(!at.has(Kt)){if(at.add(Kt),q.has(Kt)){const Ht=Y.get(Kt)+ut.get(Kt);Ht<Mt&&(Mt=Ht,Wt=Kt)}const ge=this.graph.getEdges(Kt),Et=this.graph.getNode(Kt);for(const Ht of ge){if(S&&!Ht.accessible||P&&Ht.type==="stairs")continue;const tt=Ht.target;if(at.has(tt))continue;const Jt=this.graph.getNode(tt);if(!Jt||!jt(Jt))continue;const ze=Ht.weight??Ir(Mn(Et.coords),Mn(Jt.coords),{units:"meters"}),te=ut.get(Kt)+ze;if(te<(ut.get(tt)||1/0)){dt.set(tt,Kt),ut.set(tt,te);const Ne=this.heuristic(Jt,G)*b;W.push({nodeId:tt,priority:te+Ne})}}}}if(Wt&&Mt<1/0){const Ot=K.isEmpty()?1/0:K.heap[0]?.priority||1/0,Kt=W.isEmpty()?1/0:W.heap[0]?.priority||1/0;if(Mt<=Ot+Kt)break}}return Wt?this.reconstructBidirectionalPath(J,dt,Wt,I,T,Mt):(console.warn("No path found between nodes (bidirectional)"),null)}reconstructBidirectionalPath(I,T,E,S,P,b){const o=[];let N=E;for(;N!==S&&I.has(N);)o.unshift(N),N=I.get(N);o.unshift(S);const $=[];for(N=E;N!==P&&T.has(N);)N=T.get(N),$.push(N);const G=[...o,...$],V=G.map(Y=>this.graph.getNode(Y)),K=V.map(Y=>Y.coords),q=V.map(Y=>Y.floorId);return{nodeIds:G,nodes:V,coords:K,floors:q,distance:b,segments:this.buildSegments(V)}}heuristic(I,T){const E=Ir(Mn(I.coords),Mn(T.coords),{units:"meters"}),S=I.floorId!==T.floorId?10:0;return E+S}reconstructPath(I,T,E){const S=[T];let P=T;for(;I.has(P);)P=I.get(P),S.unshift(P);const b=S.map(G=>this.graph.getNode(G)),o=b.map(G=>G.coords),N=b.map(G=>G.floorId),$=E.get(T);return{nodeIds:S,nodes:b,coords:o,floors:N,distance:$,segments:this.buildSegments(b)}}buildSegments(I){const T=[];for(let E=0;E<I.length-1;E++){const S=I[E],P=I[E+1],b=Ir(Mn(S.coords),Mn(P.coords),{units:"meters"});T.push({from:S.id,to:P.id,fromCoords:S.coords,toCoords:P.coords,distance:b,floorChange:S.floorId!==P.floorId,fromFloor:S.floorId,toFloor:P.floorId})}return T}}class Y0{constructor(I){this.graph=I}processConnections(I){console.log(`Processing ${I.length} connections...`);let T=0,E=0,S=0;I.forEach(P=>{P.type==="elevator"?(this.addElevatorConnection(P),T++):P.type==="stairs"?(this.addStairConnection(P),E++):P.type==="door"&&(this.addDoorConnection(P),S++)}),console.log(`  Elevators: ${T}`),console.log(`  Stairs: ${E}`),console.log(`  Doors: ${S}`)}addElevatorConnection(I){const T=this.getNodesFromConnection(I);if(!(T.length<2))for(let E=0;E<T.length;E++)for(let S=E+1;S<T.length;S++){const P=T[E],b=T[S],o=I.entryCost||3e3;this.graph.addBidirectionalEdge(P.id,b.id,o,{type:"elevator",accessible:!0,connectionId:I.id})}}addStairConnection(I){const T=this.getNodesFromConnection(I);if(!(T.length<2))for(let E=0;E<T.length;E++)for(let S=E+1;S<T.length;S++){const P=T[E],b=T[S],o=I.entryCost||1e3;this.graph.addBidirectionalEdge(P.id,b.id,o,{type:"stairs",accessible:!1,connectionId:I.id})}}addDoorConnection(I){const T=this.getNodesFromConnection(I);if(T.length<1)return;const E=I.entryCost||100;if(T.length>=2)for(let S=0;S<T.length;S++)for(let P=S+1;P<T.length;P++){const b=T[S],o=T[P];this.graph.addBidirectionalEdge(b.id,o.id,E,{type:"door",accessible:!0,connectionId:I.id})}}getNodesFromConnection(I){const T=[],E=new Set;return I.entrances&&I.entrances.forEach(S=>{E.add(S.geometryId)}),I.exits&&I.exits.forEach(S=>{E.add(S.geometryId)}),E.forEach(S=>{const P=this.graph.getNodeByGeometryId(S);P&&T.push(P)}),T}tagNodes(I){I.forEach(T=>{this.getNodesFromConnection(T).forEach(S=>{S.metadata.connections||(S.metadata.connections=[]),S.metadata.connections.push({id:T.id,type:T.type}),T.type==="elevator"?S.metadata.isElevator=!0:T.type==="stairs"?S.metadata.isStairs=!0:T.type==="door"&&(S.metadata.isDoor=!0)})})}}class H0{constructor(I=100){this.cache=new Map,this.maxSize=I}generateKey(I,T,E,S,P={}){const b=Y=>Math.round(Y*1e4)/1e4,o=`${b(I[0])},${b(I[1])},${E}`,N=`${b(T[0])},${b(T[1])},${S}`,$=P.accessibleOnly?"acc":"std",G=P.roomTraversalMode||(P.disallowOtherRooms?"strict":"all"),V=Number.isFinite(P.publicRoomDoorCount)?P.publicRoomDoorCount:"",K=Number.isFinite(P.publicRoomArea)?P.publicRoomArea:"",q=`${$}:${G}:${V}:${K}`;return`${o}|${N}|${q}`}get(I,T,E,S,P={}){const b=this.generateKey(I,T,E,S,P);if(this.cache.has(b)){const o=this.cache.get(b);return this.cache.delete(b),this.cache.set(b,o),console.log(" Path cache HIT"),o}return null}set(I,T,E,S,P,b){const o=this.generateKey(I,T,E,S,P);if(this.cache.size>=this.maxSize){const N=this.cache.keys().next().value;this.cache.delete(N)}this.cache.set(o,b)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,maxSize:this.maxSize}}}class K0{generateInstructions(I){if(!I||!I.path||I.path.length<2)return[];const T=[],E=I.path,S=I.segments||[];T.push({type:"start",text:"Start navigation",distance:0,icon:""});let P=0;for(let b=1;b<E.length;b++){const o=E[b-1],N=E[b],$=E[b+1],G=this.calculateDistance(o,N),V=S[b-1];if(V&&V.floorChange){P>5&&(T.push({type:"straight",text:`Continue straight for ${Math.round(P)} meters`,distance:P,icon:""}),P=0);const K=this.getFloorChangeType(V);T.push({type:"floor-change",text:`Take the ${K} to ${V.toFloor}`,distance:0,icon:K==="elevator"?"":"",fromFloor:V.fromFloor,toFloor:V.toFloor});continue}if($){const K=this.calculateBearing(o,N),q=this.calculateBearing(N,$),Y=this.getTurnInfo(K,q);Y.type!=="straight"?(P>5&&(T.push({type:"straight",text:`Continue straight for ${Math.round(P)} meters`,distance:P,icon:""}),P=0),T.push({type:Y.type,text:Y.text,distance:G,icon:Y.icon,angle:Y.angle})):P+=G}else P+=G}return P>5&&T.push({type:"straight",text:`Continue straight for ${Math.round(P)} meters`,distance:P,icon:""}),T.push({type:"destination",text:"Arrive at your destination",distance:I.distance,icon:"",totalDistance:Math.round(I.distance)}),T}calculateBearing(I,T){const E=this.toRad(I[1]),S=this.toRad(I[0]),P=this.toRad(T[1]),b=this.toRad(T[0]),o=Math.sin(b-S)*Math.cos(P),N=Math.cos(E)*Math.sin(P)-Math.sin(E)*Math.cos(P)*Math.cos(b-S);return(this.toDeg(Math.atan2(o,N))+360)%360}getTurnInfo(I,T){let E=T-I;E<-180&&(E+=360),E>180&&(E-=360);const S=Math.abs(E);return S<20?{type:"straight",text:"Continue straight",icon:"",angle:S}:S<45?E>0?{type:"slight-right",text:"Bear slightly right",icon:"",angle:S}:{type:"slight-left",text:"Bear slightly left",icon:"",angle:S}:S<135?E>0?{type:"right",text:"Turn right",icon:"",angle:S}:{type:"left",text:"Turn left",icon:"",angle:S}:E>0?{type:"sharp-right",text:"Make a sharp right turn",icon:"",angle:S}:{type:"sharp-left",text:"Make a sharp left turn",icon:"",angle:S}}getFloorChangeType(I){return I.type==="elevator"?"elevator":I.type==="escalator"?"escalator":"stairs"}calculateDistance(I,T){try{return Ir(Mn(I),Mn(T),{units:"meters"})}catch{const P=I[1]*Math.PI/180,b=T[1]*Math.PI/180,o=(T[1]-I[1])*Math.PI/180,N=(T[0]-I[0])*Math.PI/180,$=Math.sin(o/2)*Math.sin(o/2)+Math.cos(P)*Math.cos(b)*Math.sin(N/2)*Math.sin(N/2);return 6371e3*2*Math.atan2(Math.sqrt($),Math.sqrt(1-$))}}toRad(I){return I*Math.PI/180}toDeg(I){return I*180/Math.PI}formatAsText(I){return I.map((T,E)=>`${E+1}. ${T.icon} ${T.text}`).join(`
`)}}class J0{constructor(){this.graph=new Z0,this.collisionDetector=new $0,this.aStar=null,this.initialized=!1,this.geometryIndex=new Map,this.roomIndex=new Map,this.roomDoorIndex=new Map,this.roomMeta=new Map,this.doorNodes=[],this.doorNodesByFloor=new Map,this.doorSegmentsByFloor=new Map,this.walkableNodesByFloor=new Map,this.navigationFlags=null,this.lastRouteError=null,this.pathCache=new H0(100),this.instructionGenerator=new K0}async initialize(I,T,E,S,P,b,o=null,N=null,$={}){console.log(" Initializing Pathfinding Engine..."),this.navigationFlags=N,this.lastRouteError=null;const G=Number.isFinite($.edgeMaxDistanceMeters)?$.edgeMaxDistanceMeters:15,V=Number.isFinite($.edgeMaxNeighbors)?$.edgeMaxNeighbors:null,K=Number.isFinite($.edgeBuildYieldEvery)?$.edgeBuildYieldEvery:null;this.walkableNodesByFloor.clear(),this.buildGeometryIndex(T),this.roomIndex=this.buildRoomIndex(T,b),console.log("Step 1: Building collision detector..."),this.collisionDetector.initialize(T,P,b),console.log("Step 2: Loading nodes into graph..."),I.forEach(W=>{const at=W?.properties||{},ut=at.id,dt=W?.geometry?.coordinates,Lt=at.floorId;if(!ut||!dt||!Lt)return;const kt=at.nodeType||"waypoint",jt=this.graph.addNode(ut,dt,Lt,{geometryIds:at.geometryIds||[],type:kt});kt==="walkable"&&(this.walkableNodesByFloor.has(Lt)||this.walkableNodesByFloor.set(Lt,[]),this.walkableNodesByFloor.get(Lt).push(jt))}),o&&o.features&&(console.log(`  Loading ${o.features.length} entrance nodes...`),o.features.forEach(W=>{const at=W.properties.geometryId||W.id||`entrance_${Math.random().toString(36).substr(2,9)}`,ut=W.geometry.coordinates,dt=W.properties.floorId;dt&&this.graph.addNode(at,ut,dt,{type:"entrance",...W.properties})})),this.addDoorNodes(E,N),this.collisionDetector.setDoorSegments(this.doorSegmentsByFloor),console.log(`  Loaded ${this.graph.nodes.size} nodes`),console.log("Step 3: Building spatial indexes..."),this.graph.buildSpatialIndexes(),console.log("Step 4: Building visibility graph edges..."),await new W0(this.collisionDetector).buildAllEdges(this.graph,G,V,K),console.log("Step 5: Processing multi-floor connections...");const Y=new Y0(this.graph);Y.processConnections(E),Y.tagNodes(E),this.roomDoorIndex=this.buildRoomDoorIndex(),this.tagNodesWithRooms(),this.roomMeta=this.buildRoomMeta(),this.connectOrphanDoors(),console.log("Step 6: Initializing A* pathfinder..."),this.aStar=new X0(this.graph);const J=this.graph.getStats();return console.log(" Pathfinding Engine Initialized!"),console.log("Graph Statistics:"),console.log(`  Nodes: ${J.nodeCount}`),console.log(`  Edges: ${J.edgeCount}`),console.log(`  Floors: ${J.floors}`),console.log(`  Avg Edges/Node: ${J.avgEdgesPerNode.toFixed(2)}`),this.initialized=!0,!0}findRoute(I,T,E,S,P={}){if(!this.initialized)throw new Error("PathfindingEngine not initialized. Call initialize() first.");if(P.useCache!==!1){const Zt=this.pathCache.get(I,T,E,S,P);if(Zt)return Zt}console.log(`Finding route from ${E} to ${S}...`),this.lastRouteError=null;const b=P.snapToDoors!==!1,o=P.allowLockedDoors===!0,N=P.roomTraversalMode||"public",$=Number.isFinite(P.publicRoomDoorCount)?P.publicRoomDoorCount:2,G=Number.isFinite(P.publicRoomArea)?P.publicRoomArea:80,V=b?this.findRoomAtPoint(I,E):null,K=b?this.findRoomAtPoint(T,S):null,q=V&&K&&V.geometryId===K.geometryId,Y=Zt=>Zt?Zt.publicDoorCount>=$||Zt.doorCount>=Math.max(2,$)?!0:Zt.area>=G:!1,J=Zt=>{const Xt=new Set;V&&Xt.add(V.geometryId),K&&Xt.add(K.geometryId),Zt==="public"&&this.roomMeta.forEach((ye,Pe)=>{Y(ye)&&Xt.add(Pe)});const Ge=P.allowedRoomIds;return Ge&&(Ge instanceof Set?Array.from(Ge):Ge).forEach(Pe=>Xt.add(Pe)),Xt},W=N!=="all",at=W?J(N):null,ut=at&&at.size>0,dt=W&&ut,Lt={...P,disallowOtherRooms:dt,allowedRoomIds:dt?Array.from(at):null};if(q){if(this.collisionDetector.isPathClear(I,T,E)){const Zt=Ir(Mn(I),Mn(T),{units:"meters"});return{path:[I,T],nodeIds:[],distance:Zt,floors:[E,S],segments:[{from:"start",to:"end",fromCoords:I,toCoords:T,distance:Zt,floorChange:!1,fromFloor:E,toFloor:S}],startNode:null,endNode:null,meta:{startCoords:I,endCoords:T,startFloorId:E,endFloorId:S,startRoomId:V.geometryId,endRoomId:K.geometryId,sameRoom:!0}}}return this.setRouteError("no-path","No clear path inside this room."),null}let kt=null,jt=null;V||(kt=this.findNearestWalkableNode(I,E)||this.graph.findNearestNode(I,E)),K||(jt=this.findNearestWalkableNode(T,S)||this.graph.findNearestNode(T,S));const Mt=V?this.getRoomDoorCandidates(V,o):null,Wt=K?this.getRoomDoorCandidates(K,o):null;if(V&&Mt&&Mt.available.length===0){const Zt=Mt.total>0?"All doors are locked for the start room.":"No doors found for the start room.";return this.setRouteError("no-door",Zt),null}if(K&&Wt&&Wt.available.length===0){const Zt=Wt.total>0?"All doors are locked for the destination room.":"No doors found for the destination room.";return this.setRouteError("no-door",Zt),null}let Ot=[],Kt=[];V&&Mt&&Mt.available.length>0?Ot=Mt.available:kt&&(Ot=[kt]),K&&Wt&&Wt.available.length>0?Kt=Wt.available:jt&&(Kt=[jt]);let ge=Ot.filter(Zt=>this.isConnectorClear(I,Zt.coords,E)),Et=Kt.filter(Zt=>this.isConnectorClear(T,Zt.coords,S));if(ge.length===0&&Ot.length>0&&(console.log("  Fallback 1: Trying relaxed collision check for start..."),ge=Ot.filter(Zt=>this.collisionDetector.isPathClearRelaxed(I,Zt.coords,E))),Et.length===0&&Kt.length>0&&(console.log("  Fallback 1: Trying relaxed collision check for end..."),Et=Kt.filter(Zt=>this.collisionDetector.isPathClearRelaxed(T,Zt.coords,S))),ge.length===0&&V&&Ot.length>0&&(console.log("  Fallback 1b: Using door candidates inside the start room (no line-of-sight)."),ge=Ot),Et.length===0&&K&&Kt.length>0&&(console.log("  Fallback 1b: Using door candidates inside the destination room (no line-of-sight)."),Et=Kt),ge.length===0&&!V&&(console.log("  Fallback 2: Finding nearest walkable nodes for start..."),ge=this.graph.findNearestNodesInRadius(I,E,.002,10).filter(Xt=>this.collisionDetector.isPathClearRelaxed(I,Xt.coords,E)),ge.length===0)){console.log("  Fallback 3: Using expanded search for start (no collision check)...");const Xt=this.graph.findNearestNodeExpanded(I,E);Xt&&(ge=[Xt])}if(Et.length===0&&!K&&(console.log("  Fallback 2: Finding nearest walkable nodes for end..."),Et=this.graph.findNearestNodesInRadius(T,S,.002,10).filter(Xt=>this.collisionDetector.isPathClearRelaxed(T,Xt.coords,S)),Et.length===0)){console.log("  Fallback 3: Using expanded search for end (no collision check)...");const Xt=this.graph.findNearestNodeExpanded(T,S);Xt&&(Et=[Xt])}if(ge.length===0)return this.setRouteError("blocked","Cannot find a path from this location. Try clicking closer to a walkable area."),null;if(Et.length===0)return this.setRouteError("blocked","Cannot find a path to this destination. Try clicking closer to a walkable area."),null;const Ht=Zt=>{let Xt=null,Ge=null,ye=null,Pe=1/0;return ge.forEach(_n=>{Et.forEach(Pn=>{const Gt=this.aStar.findPath(_n.id,Pn.id,Zt);if(!Gt)return;const bn=Ir(Mn(I),Mn(_n.coords),{units:"meters"}),sn=Ir(Mn(T),Mn(Pn.coords),{units:"meters"}),Be=Gt.distance+bn+sn;Be<Pe&&(Xt=Gt,Ge=_n,ye=Pn,Pe=Be)})}),Xt?{best:Xt,bestStart:Ge,bestEnd:ye,bestDistance:Pe}:null};let tt=Ht(Lt),Jt=dt?N:"all";if(!tt&&dt){const Zt={...Lt,disallowOtherRooms:!1,allowedRoomIds:null};tt=Ht(Zt),tt&&(Jt="all")}if(!tt)return this.setRouteError("no-path","No path available from this location."),null;const{best:ze,bestStart:te,bestEnd:Ne,bestDistance:he}=tt;te&&console.log(`  Start node: ${te.id}`),Ne&&console.log(`  End node: ${Ne.id}`),console.log(`  Path found: ${ze.nodeIds.length} nodes, ${he.toFixed(2)}m`);const _e={path:ze.coords,nodeIds:ze.nodeIds,distance:he,floors:ze.floors,segments:ze.segments,startNode:te,endNode:Ne,meta:{startCoords:I,endCoords:T,startFloorId:E,endFloorId:S,startRoomId:V?.geometryId||null,endRoomId:K?.geometryId||null,startDoorId:te?.metadata?.isDoor?te.id:null,endDoorId:Ne?.metadata?.isDoor?Ne.id:null,roomTraversalMode:Jt}};return P.useCache!==!1&&this.pathCache.set(I,T,E,S,P,_e),_e}generateInstructions(I){return this.instructionGenerator.generateInstructions(I)}getTextInstructions(I){const T=this.generateInstructions(I);return this.instructionGenerator.formatAsText(T)}clearCache(){this.pathCache.clear()}getCacheStats(){return this.pathCache.getStats()}findAccessibleRoute(I,T,E,S){return this.findRoute(I,T,E,S,{accessibleOnly:!0,avoidStairs:!0})}getGraph(){return this.graph}getCollisionDetector(){return this.collisionDetector}findNearestWalkableNode(I,T){const E=this.walkableNodesByFloor.get(T);if(!E||E.length===0)return null;let S=null,P=1/0;const[b,o]=I;return E.forEach(N=>{const $=N.coords[0]-b,G=N.coords[1]-o,V=$*$+G*G;V<P&&(P=V,S=N)}),S}snapToWalkableNode(I,T,E=6){const S=this.findNearestWalkableNode(I,T);if(!S)return null;const P=S.coords[0]-I[0],b=S.coords[1]-I[1],o=Math.sqrt(P*P+b*b)*111320;return o>E?null:{node:S,coords:S.coords,distanceMeters:o}}getLastRouteError(){return this.lastRouteError}setRouteError(I,T){this.lastRouteError={code:I,message:T}}buildGeometryIndex(I){this.geometryIndex.clear(),I.features.forEach(T=>{const E=T.properties?.id;E&&this.geometryIndex.set(E,T)})}buildRoomIndex(I,T){const E=new Map;return T&&I.features.forEach(S=>{const P=S.properties?.id,b=S.properties?.floorId,o=P?T[P]:null;if(!b||o!=="room"||S.geometry.type!=="Polygon"&&S.geometry.type!=="MultiPolygon")return;let N=null;try{N=fc(S,.3,{units:"meters"})}catch{N=null}E.has(b)||E.set(b,[]);const $=N||S;E.get(b).push({geometryId:P,floorId:b,feature:S,buffer:N,bbox:Rh($)})}),E}addDoorNodes(I,T){const E=new Map,S=T?.public?.bit??null;I.forEach(P=>{P.type==="door"&&(P.entrances||[]).forEach(b=>{if(!b?.geometryId)return;const o=Array.isArray(b.flags)?b.flags[0]??0:b.flags??0,N=S==null?!0:(o&1<<S)!==0,$=E.get(b.geometryId);$?($.isPublic=$.isPublic||N,$.flagValue=$.flagValue|o,!$.floorId&&b.floorId&&($.floorId=b.floorId)):E.set(b.geometryId,{floorId:b.floorId||null,isPublic:N,flagValue:o})})}),E.forEach((P,b)=>{const o=this.geometryIndex.get(b),N=P.floorId||o?.properties?.floorId,$=o?this.getFeatureCenter(o):null;if(!$||!N)return;const G=`door_${b}`,V=this.graph.addNode(G,$,N,{geometryIds:[b],type:"door",isDoor:!0,isPublic:P.isPublic,isLocked:!P.isPublic,flags:P.flagValue});this.doorNodes.push(V),this.doorNodesByFloor.has(N)||this.doorNodesByFloor.set(N,[]),this.doorNodesByFloor.get(N).push(V),o&&(o.geometry.type==="LineString"||o.geometry.type==="MultiLineString")&&(this.doorSegmentsByFloor.has(N)||this.doorSegmentsByFloor.set(N,[]),this.doorSegmentsByFloor.get(N).push(o))})}getFeatureCenter(I){const T=I.geometry;if(!T)return null;if(T.type==="Point")return T.coordinates;if(T.type==="LineString"){const E=Math.floor(T.coordinates.length/2);return T.coordinates[E]}if(T.type==="MultiLineString"){const E=(void 0)(I);if(E.geometry.type==="LineString"){const S=Math.floor(E.geometry.coordinates.length/2);return E.geometry.coordinates[S]}}return T.type==="Polygon"||T.type==="MultiPolygon"?k0(I).geometry.coordinates:null}buildRoomDoorIndex(){const I=new Map;return this.doorNodes.forEach(T=>{const E=this.roomIndex.get(T.floorId)||[];if(E.length===0)return;const S=Mn(T.coords),P=[];E.forEach(b=>{this.isPointInRoom(S,b)&&(I.has(b.geometryId)||I.set(b.geometryId,[]),I.get(b.geometryId).push(T),P.push(b.geometryId))}),P.length&&(T.metadata.roomIds=P,T.metadata.roomId=P[0])}),I}buildRoomMeta(){const I=new Map;return this.roomIndex.forEach(T=>{T.forEach(E=>{const S=E.geometryId,P=this.roomDoorIndex.get(S)||[],b=P.filter(N=>N.metadata?.isPublic);let o=0;try{o=hv(E.feature)}catch{o=0}I.set(S,{area:o,doorCount:P.length,publicDoorCount:b.length})})}),I}tagNodesWithRooms(){this.graph.nodes.forEach(I=>{if(I.metadata?.roomIds?.length)return;const T=this.findRoomAtPoint(I.coords,I.floorId);T&&(I.metadata.roomIds=[T.geometryId],I.metadata.roomId=T.geometryId)})}isPointInRoom(I,T){const E=T.buffer||T.feature;if(!E)return!1;try{return gf(I,E)}catch{return!1}}findRoomAtPoint(I,T){const E=this.roomIndex.get(T);if(!E||E.length===0)return null;const[S,P]=I,b=Mn(I);for(const o of E){const[N,$,G,V]=o.bbox;if(!(S<N||S>G||P<$||P>V)&&this.isPointInRoom(b,o))return o}return null}getRoomDoorCandidates(I,T){const E=this.roomDoorIndex.get(I.geometryId)||[],S=E.filter(b=>T||!b.metadata.isLocked),P=E.filter(b=>b.metadata.isLocked);return{available:S,locked:P,total:E.length}}isConnectorClear(I,T,E){return this.collisionDetector.isPathClear(I,T,E)}connectOrphanDoors(I=6){this.doorNodes.forEach(T=>{const E=this.graph.getEdges(T.id);if(E&&E.length>0)return;const S=this.graph.getNodesOnFloor(T.floorId).filter(o=>o.id!==T.id);let P=null,b=1/0;S.forEach(o=>{const N=Ir(Mn(T.coords),Mn(o.coords),{units:"meters"});N>I||this.collisionDetector.isPathClear(T.coords,o.coords,T.floorId)&&N<b&&(b=N,P=o)}),P||S.forEach(o=>{const N=Ir(Mn(T.coords),Mn(o.coords),{units:"meters"});N<b&&N<=I&&(b=N,P=o)}),P&&this.graph.addBidirectionalEdge(T.id,P.id,b,{type:"door-link",accessible:!0})})}}class Q0{constructor(I,T){this.map=I,this.layerManager=T,this.currentRoute=null}renderRoute(I,T={}){const{startColor:E="#4f7cff",endColor:S="#f0b45a",width:P=5,showWaypoints:b=!0,animated:o=!0,showTurnIndicators:N=!0,showDistanceMarkers:$=!0}=T,G=T.color||E;this.clearRoute(),this.currentRoute=I;const V="route-line-source",K="route-line-layer";this.map.addSource(V,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:I.path}},lineMetrics:!0}),this.map.addLayer({id:`${K}-shadow`,type:"line",source:V,paint:{"line-color":"#000000","line-width":P+4,"line-opacity":.15,"line-blur":4,"line-translate":[2,2]}}),this.map.addLayer({id:`${K}-glow`,type:"line",source:V,paint:{"line-color":E,"line-width":P*2.5,"line-opacity":.25,"line-blur":5}}),o&&(this.map.addLayer({id:`${K}-animated`,type:"line",source:V,paint:{"line-color":"#FFFFFF","line-width":P,"line-dasharray":[0,4,3],"line-opacity":.85}}),this.animateDashArray(`${K}-animated`)),this.map.addLayer({id:K,type:"line",source:V,paint:{"line-color":G,"line-width":P,"line-opacity":.9,"line-gradient":["interpolate",["linear"],["line-progress"],0,E,.5,"#7c5ce8",1,S]}}),N&&this.renderTurnIndicators(I,E),$&&I.distance>20&&this.renderDistanceMarkers(I,E),this.renderDirectionalArrows(I,G),b&&I.segments&&this.renderWaypoints(I,G),this.renderStartEndMarkers(I,G)}renderDistanceMarkers(I,T){const E=I.path,S=I.distance,P=S>100?50:20;let b=0,o=P;for(let N=1;N<E.length;N++){const $=E[N-1],G=E[N],V=this.haversineDistance($,G);if(b+=V,b>=o){const K=Math.round(S-b),q=document.createElement("div");q.className="route-distance-marker",q.innerHTML=`${K}m`,q.style.cssText=`
                    padding: 2px 6px;
                    background: rgba(0, 0, 0, 0.7);
                    color: white;
                    border-radius: 8px;
                    font-size: 10px;
                    font-weight: 500;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
                    pointer-events: none;
                `,new pr.Marker({element:q}).setLngLat(G).addTo(this.map),o+=P}}}haversineDistance(I,T){const S=I[1]*Math.PI/180,P=T[1]*Math.PI/180,b=(T[1]-I[1])*Math.PI/180,o=(T[0]-I[0])*Math.PI/180,N=Math.sin(b/2)*Math.sin(b/2)+Math.cos(S)*Math.cos(P)*Math.sin(o/2)*Math.sin(o/2);return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}renderTurnIndicators(I,T){const E=I.path;if(E.length<3)return;const S=30,P=[];for(let b=1;b<E.length-1;b++){const o=E[b-1],N=E[b],$=E[b+1],G=this.calculateBearing(o,N),V=this.calculateBearing(N,$);let K=Math.abs(V-G);K>180&&(K=360-K),K>S&&P.push({coords:N,angle:K,turnDirection:this.getTurnDirection(G,V)})}P.forEach(b=>{const o=document.createElement("div");o.className="route-turn-indicator";const N=b.angle>70,$=b.turnDirection==="left"?"":"";o.innerHTML=N?$:"",o.style.cssText=`
                width: 18px;
                height: 18px;
                background: rgba(255, 255, 255, 0.95);
                border: 2px solid ${T};
                color: ${T};
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: ${N?"14px":"10px"};
                font-weight: bold;
                box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            `,new pr.Marker({element:o}).setLngLat(b.coords).addTo(this.map)})}getTurnDirection(I,T){let E=T-I;return E<-180&&(E+=360),E>180&&(E-=360),E>0?"right":"left"}renderDirectionalArrows(I,T){const E=I.path;if(E.length<2)return;const S=E[E.length-1],P=E[E.length-10]||E[E.length-2];if(!P)return;const b=this.calculateBearing(P,S),o=document.createElement("div");o.className="route-arrow-marker",o.innerHTML=`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: rotate(${b}deg); filter: drop-shadow(0 0 5px ${T});">
                <path d="M12 2L2 22L12 18L22 22L12 2Z" fill="${T}" stroke="white" stroke-width="2"/>
            </svg>
        `,o.style.cssText=`
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        `,new pr.Marker({element:o,rotationAlignment:"map",pitchAlignment:"map"}).setLngLat(S).addTo(this.map);const N=Math.floor(E.length/2);if(N>0&&N<E.length-1){const $=E[N],G=E[N+5]||E[N+1],V=this.calculateBearing($,G),K=o.cloneNode(!0);K.innerHTML=`
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="transform: rotate(${V}deg); opacity: 0.8;">
                    <path d="M12 2L2 22L12 18L22 22L12 2Z" fill="${T}" stroke="white" stroke-width="2"/>
                </svg>
             `,new pr.Marker({element:K,rotationAlignment:"map",pitchAlignment:"map"}).setLngLat($).addTo(this.map)}}calculateBearing(I,T){const E=this.toRad(I[1]),S=this.toRad(I[0]),P=this.toRad(T[1]),b=this.toRad(T[0]),o=Math.sin(b-S)*Math.cos(P),N=Math.cos(E)*Math.sin(P)-Math.sin(E)*Math.cos(P)*Math.cos(b-S);return(this.toDeg(Math.atan2(o,N))+360)%360}toRad(I){return I*Math.PI/180}toDeg(I){return I*180/Math.PI}animateDashArray(I){let T=0;const E=[[0,4,3],[.5,4,2.5],[1,4,2],[1.5,4,1.5],[2,4,1],[2.5,4,.5],[3,4,0],[0,.5,3,3.5],[0,1,3,3],[0,1.5,3,2.5],[0,2,3,2],[0,2.5,3,1.5],[0,3,3,1]],S=()=>{this.map.getLayer(I)&&(T=(T+1)%E.length,this.map.setPaintProperty(I,"line-dasharray",E[T]),requestAnimationFrame(S))};S()}renderWaypoints(I,T){I.segments.forEach((E,S)=>{if(E.floorChange){const P=document.createElement("div");P.className="route-waypoint",P.innerHTML=E.fromFloor!==E.toFloor?"":"",P.style.cssText=`
                    width: 24px;
                    height: 24px;
                    background: #292929;
                    border: 2px solid ${T};
                    color: #fff;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    box-shadow: 0 0 8px ${T};
                `,new pr.Marker(P).setLngLat(E.fromCoords).addTo(this.map)}})}renderStartEndMarkers(I,T){this.injectStyles();const E="#f0b45a",S=document.createElement("div");S.className="route-start-marker",S.innerHTML=`<div style="background: ${T}; width: 12px; height: 12px; border-radius: 50%;"></div>`,S.style.cssText=`
            width: 24px;
            height: 24px;
            background: rgba(79, 124, 255, 0.2);
            border: 2px solid ${T};
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px ${T};
        `,new pr.Marker(S).setLngLat(I.path[0]).addTo(this.map);const P=document.createElement("div");P.className="route-end-marker pulsing-marker",P.innerHTML="",P.style.cssText=`
            font-size: 24px;
            color: ${E};
            filter: drop-shadow(0 0 10px ${E});
        `,new pr.Marker(P).setLngLat(I.path[I.path.length-1]).addTo(this.map)}injectStyles(){if(!document.getElementById("path-renderer-styles")){const I=document.createElement("style");I.id="path-renderer-styles",I.innerHTML=`
                @keyframes pulse-ring {
                    0% { transform: scale(0.33); opacity: 1; }
                    80%, 100% { opacity: 0; }
                }
                .pulsing-marker::before {
                    content: '';
                    position: absolute;
                    left: 50%; top: 50%;
                    transform: translate(-50%, -50%);
                    width: 30px; height: 30px;
                    border: 3px solid currentColor;
                    border-radius: 50%;
                    animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
                    pointer-events: none;
                }
            `,document.head.appendChild(I)}}clearRoute(){["route-line-layer","route-line-layer-animated","route-line-layer-glow","route-line-layer-shadow"].forEach(I=>{this.map.getLayer(I)&&this.map.removeLayer(I)}),this.map.getSource("route-line-source")&&this.map.removeSource("route-line-source"),document.querySelectorAll(".route-waypoint, .route-start-marker, .route-end-marker, .route-arrow-marker, .route-turn-indicator, .route-distance-marker").forEach(I=>I.remove()),this.currentRoute=null}getCurrentRoute(){return this.currentRoute}}class tx{smoothPath(I,T={}){const{resolution:E=2e4,sharpness:S=.4}=T;if(I.length<2||I.length===2)return I;try{const P=Na(I);return _v(P,{resolution:E,sharpness:S}).geometry.coordinates}catch(P){return console.warn("Failed to smooth path:",P),I}}simplifyPath(I,T=1e-5){if(I.length<3)return I;try{const E=Na(I);return O0(E,{tolerance:T,highQuality:!0}).geometry.coordinates}catch(E){return console.warn("Failed to simplify path:",E),I}}smoothPathWithFloors(I,T){if(I.length<2)return I;const E=[];let S=[I[0]],P=T[0];for(let o=1;o<I.length;o++)T[o]!==P?(S.push(I[o]),E.push({coords:S,floor:P}),S=[I[o]],P=T[o]):S.push(I[o]);S.length>0&&E.push({coords:S,floor:P});const b=[];return E.forEach((o,N)=>{const $=this.smoothPath(o.coords);N===0?b.push(...$):b.push(...$.slice(1))}),b}}async function ex(A,I){console.group(" Loading Navigation Data");const T=await nx(A,I);console.log(`Loaded kinds: ${Object.keys(T).length} geometry entries`);const E=await ix(A,I),S=await rx(A,I);console.log(`Loaded walkable: ${E.size}, nonwalkable: ${S.size}`);const P=await sx(A);console.log(`Loaded walkable nodes: ${P.features.length} nodes`);const b=await ro(`${A}/walkable_areas.geojson`);console.log(`Loaded walkable areas: ${b?.features?.length||0} areas`);const o=await ro(`${A}/connections.json`)||[],N=await ro(`${A}/navigationFlags.json`)||{};console.log(`Loaded connections: ${o.length} (doors/stairs/elevators)`);const $=await ro(`${A}/entrance_aesthetic_nodes.geojson`);return console.log(`Loaded entrance nodes: ${$?.features?.length||0}`),console.groupEnd(),{kindsData:T,walkableSet:E,nonwalkableSet:S,walkableNodes:P,walkableAreas:b,connections:o,navigationFlags:N,entranceNodes:$}}async function nx(A,I){const T={};for(const E of I){const S=await ro(`${A}/kinds/${E}.json`);S&&Object.assign(T,S)}return T}async function ix(A,I){const T=new Set;for(const E of I){const S=await ro(`${A}/walkable/${E}.json`);S&&Object.keys(S).forEach(P=>T.add(P))}return T}async function rx(A,I){const T=new Set;for(const E of I){const S=await ro(`${A}/nonwalkable/${E}.json`);S&&Object.keys(S).forEach(P=>T.add(P))}return T}async function sx(A){const I=await ro(`${A}/walkable_nodes.geojson`);return!I||!I.features?(console.warn("No walkable nodes found"),{type:"FeatureCollection",features:[]}):{type:"FeatureCollection",features:I.features.map((E,S)=>{const P=E.properties||{};return{...E,properties:{...P,id:P.id||`wn_${S}`,geometryIds:P.geometryId?[P.geometryId]:[],nodeType:P.type||"walkable"}}})}}async function ro(A){try{const I=await fetch(A);return I.ok?I.json():null}catch(I){return console.warn(`Failed to load ${A}:`,I.message),null}}function ax(A){return!A||!A.features?[]:A.features.map(I=>I.properties?.id).filter(Boolean)}class ox{constructor(I,T){this.map=I,this.layerManager=T,this.engine=new J0,this.renderer=new Q0(I,T),this.smoother=new tx,this.initialized=!1,this.currentRoute=null,this.userLocation=null,this.destination=null,this.walkableAreas=null,this.userMarker=null,this.animationFrameId=null}async initialize(I,T="/assets"){console.group(" Initializing Navigation Controller");const{geometry:E,floors:S}=I,P=ax(S);if(P.length===0)return console.error("No floors found in MVF data"),console.groupEnd(),!1;console.log(`Found ${P.length} floors:`,P);const b=await ex(T,P);return this.walkableAreas=b.walkableAreas,await this.engine.initialize(b.walkableNodes.features,E,b.connections,b.walkableSet,b.nonwalkableSet,b.kindsData,b.entranceNodes,b.navigationFlags,{edgeMaxDistanceMeters:15,edgeMaxNeighbors:8}),this.initialized=!0,console.log(" Navigation Controller Ready!"),console.groupEnd(),!0}isInsideWalkableArea(I){if(!this.walkableAreas||!this.walkableAreas.features)return!1;const T=Mn(I);for(const E of this.walkableAreas.features)if((E.geometry.type==="Polygon"||E.geometry.type==="MultiPolygon")&&gf(T,E))return!0;return!1}setUserLocation(I,T){if(this.userLocation={coords:I,floorId:T},this.isInsideWalkableArea(I)){const E=this.engine.snapToWalkableNode(I,T);E&&(console.log(`User snapped to node at ${E.distanceMeters.toFixed(2)}m`),this.userLocation.snappedCoords=E.coords,this.userLocation.snappedNode=E.node)}return this.userLocation}setDestination(I){return this.destination=I,this.destination}setDestinationByGeometryId(I,T){const E=this.engine.getGraph().getNodeByGeometryId(I);return E?this.destination={coords:E.coords,floorId:E.floorId,geometryId:I,node:E}:(console.warn(`No node found for geometryId: ${I}`),this.destination={geometryId:I,floorId:T}),this.destination}computeRoute(I={}){if(!this.initialized)return console.error("Navigation not initialized"),null;if(!this.userLocation||!this.destination)return console.error("Both user location and destination must be set"),null;const T=this.userLocation.snappedCoords||this.userLocation.coords,E=this.userLocation.floorId,S=this.destination.coords,P=this.destination.floorId;if(!S)return console.error("Destination coordinates not available"),null;const b=this.engine.findRoute(T,S,E,P,I);if(b){const o=[this.userLocation.coords,...b.path,this.destination.coords];b.fullPath=o,b.startCoords=this.userLocation.coords,b.endCoords=this.destination.coords,this.currentRoute=b}else{const o=this.engine.getLastRouteError();console.error("Route not found:",o?.message||"Unknown error")}return b}renderRoute(I={}){if(!this.currentRoute){console.warn("No route to render");return}const T=this.smoother.smoothPathWithFloors(this.currentRoute.path,this.currentRoute.floors),E={...this.currentRoute,path:T};this.renderer.renderRoute(E,{animated:!0,showWaypoints:!0,showDirections:!0,...I})}clearRoute(){this.renderer.clearRoute(),this.currentRoute=null}navigateTo(I,T,E={}){return this.setDestination({coords:I,floorId:T}),this.computeRoute(E)}navigateToGeometry(I,T,E={}){return this.setDestinationByGeometryId(I,T),this.computeRoute(E)}getInstructions(){return this.currentRoute?this.engine.getTextInstructions(this.currentRoute):null}startSimulation(I=1.5){if(!this.currentRoute||!this.currentRoute.path){console.warn("No route for simulation");return}this.stopSimulation();const T=this.currentRoute.path,E=this._computeCumulativeDistances(T),S=E[E.length-1];let P=0,b=performance.now();this.userMarker||(this.userMarker=document.createElement("div"),this.userMarker.className="navigation-user-marker",this.userMarker.style.cssText=`
                width: 20px;
                height: 20px;
                background: #3B82F6;
                border: 3px solid white;
                border-radius: 50%;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            `);const o=new(window.maplibregl||{}).Marker({element:this.userMarker}).setLngLat(T[0]).addTo(this.map),N=()=>{const $=performance.now(),G=($-b)/1e3;if(b=$,P+=I*G,P>=S){o.setLngLat(T[T.length-1]),this.stopSimulation(),console.log(" Arrived at destination!");return}const V=this._interpolatePosition(T,E,P);o.setLngLat(V),this.animationFrameId=requestAnimationFrame(N)};this.animationFrameId=requestAnimationFrame(N)}stopSimulation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}_computeCumulativeDistances(I){const T=[0];for(let E=1;E<I.length;E++){const S=Ir(Mn(I[E-1]),Mn(I[E]),{units:"meters"});T.push(T[E-1]+S)}return T}_interpolatePosition(I,T,E){for(let S=1;S<T.length;S++)if(T[S]>=E){const P=T[S-1],o=T[S]-P,N=o>0?(E-P)/o:0,$=I[S-1],G=I[S];return[$[0]+N*(G[0]-$[0]),$[1]+N*(G[1]-$[1])]}return I[I.length-1]}getEngine(){return this.engine}isReady(){return this.initialized}}async function lx(A){console.group(" Running Pathfinding Verification Suite");const I=A.getGraph(),T=Array.from(I.nodes.values());if(T.length===0){console.error(" Verification Failed: No nodes in graph"),console.groupEnd();return}console.log(`Graph contains ${T.length} nodes across ${new Set(T.map(o=>o.floorId)).size} floors.`),console.log("Test 1: Random Connectivity Stress Test (50 samples)...");let E=0;const S=50;for(let o=0;o<S;o++){const N=T[Math.floor(Math.random()*T.length)],$=T[Math.floor(Math.random()*T.length)];if(N.id===$.id){o--;continue}if(A.findRoute(N.coords,$.coords,N.floorId,$.floorId))E++;else{const V=A.lastRouteError,K=V?`${V.code}: ${V.message}`:"Unknown error";console.warn(`   Failed to find path from ${N.floorId} to ${$.floorId} | ${K}`)}}const P=E/S*100;console.log(`Connectivity Result: ${E}/${S} (${P}%)`),P<90?console.error(" Connectivity is low! Check for graph islands."):console.log(" Connectivity looks good."),console.log("Test 2: Cross-Floor Verification...");const b=Array.from(new Set(T.map(o=>o.floorId)));if(b.length>1){const o=b[0],N=b[1],$=T.find(V=>V.floorId===o),G=T.find(V=>V.floorId===N);if($&&G){console.log(`  Testing route from ${o} to ${N}...`);const V=A.findRoute($.coords,G.coords,o,N);V?(console.log("   Cross-floor path found!"),console.log(`     Distance: ${V.distance.toFixed(1)}m, Nodes: ${V.nodeIds.length}`),console.log(`     Floors traversed: ${V.floors.length}`)):console.error("   Failed to find cross-floor path!")}}else console.log("  Skipping (only 1 floor found)");return console.groupEnd(),{successRate:P}}const ux=()=>new Promise(A=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(A,{timeout:200}):setTimeout(A,0)}),cx=async A=>{const I=await fetch(A);return I.ok?I.json():null};async function hx(){const A="/assets",I=await av(`${A}/my_data.zip`),{manifest:T,styles:E,locations:S,floors:P,entranceIds:b,entranceGeometryToFloorMap:o,geometry:N}=I,$=document.getElementById("map-title");$&&T?.properties?.name&&($.textContent=T.properties.name);const G=document.getElementById("back-button");G&&G.addEventListener("click",()=>{window.history.back()});const V=T.features?.[0]?.geometry?.coordinates||[0,0],K=wm.colors,q=new of.Map({container:"map",style:wm.mapStyle,center:V,zoom:19,pitch:60,bearing:-17,minZoom:15,maxPitch:85,antialias:!0});q.addControl(new of.NavigationControl,"top-right"),q.on("style.load",()=>{q.getStyle().layers.forEach(J=>{J.type==="background"&&q.setPaintProperty(J.id,"background-color",K.background),J.id.includes("water")&&J.type==="fill"&&q.setPaintProperty(J.id,"fill-color",K.Restrooms),(J.id.includes("road")||J.id.includes("transportation"))&&J.type==="line"&&(J.id.includes("major")||J.id.includes("primary")||J.id.includes("trunk")||J.id.includes("motorway")?(q.setPaintProperty(J.id,"line-color","#D97706"),q.setPaintProperty(J.id,"line-opacity",.8)):(q.setPaintProperty(J.id,"line-color","#2A2D35"),q.setPaintProperty(J.id,"line-opacity",.6))),J.id.includes("building")&&q.setLayoutProperty(J.id,"visibility","none")})}),q.on("load",async()=>{const Y=new Ng(q,K);Y.addBuildingShell(P),Y.processStyles(E,N,b),Y.addDoors(N,b,o),Y.addLabels(S,N);try{const Mt=await fetch(`${A}/address.json`);if(Mt.ok){const Wt=await Mt.json(),Ot=document.getElementById("map-address");Ot&&Wt.primary?.display?.displayAddress&&(Ot.textContent=Wt.primary.display.displayAddress)}}catch(Mt){console.warn("Failed to load building address:",Mt)}const J=new U0(q,Y,P);J.init(),tv(async()=>{const{SearchBox:Mt}=await import("./SearchBox-DKH0hsRy.js");return{SearchBox:Mt}},[]).then(({SearchBox:Mt})=>{new Mt(q,Y,S,P).init()});const W=new ox(q,Y);await W.initialize(I,A),window.navigationController=W;const at=P?.[0]?.properties?.id||null;q.on("click",Mt=>{if(Mt.originalEvent.shiftKey){const Wt=[Mt.lngLat.lng,Mt.lngLat.lat],Ot=J.getCurrentFloorId()||at;W.setUserLocation(Wt,Ot),console.log(" User location set:",Wt,Ot)}}),window.addEventListener("location-clicked",Mt=>{const{coords:Wt,floorId:Ot,locationId:Kt}=Mt.detail;if(W.setDestination({coords:Wt,floorId:Ot,geometryId:Kt}),W.userLocation){const ge=W.computeRoute();ge&&(W.renderRoute(),console.log(" Route rendered:",ge.distance.toFixed(1)+"m"))}else console.log(" Shift+click on map to set your starting location, then select a destination")}),setTimeout(async()=>{await lx(W.getEngine())},2e3);const ut=new q0(Y);ut.init();const dt=document.getElementById("layers-toggle"),Lt=document.getElementById("developer-legend");dt&&Lt&&(dt.addEventListener("click",()=>{const Mt=Lt.classList.toggle("is-open");dt.classList.toggle("is-active",Mt)}),document.addEventListener("click",Mt=>{!Lt.contains(Mt.target)&&!dt.contains(Mt.target)&&(Lt.classList.remove("is-open"),dt.classList.remove("is-active"))}),document.addEventListener("keydown",Mt=>{Mt.key==="Escape"&&(Lt.classList.remove("is-open"),dt.classList.remove("is-active"))}));const kt=[{layerId:"wall-nodes-layer",url:"/assets/wall_nodes.geojson",add:Mt=>Y.addWallNodes(Mt)},{layerId:"stairs-nodes-layer",url:"/assets/stairs_nodes.geojson",add:Mt=>Y.addStairsNodes(Mt)},{layerId:"elevator-nodes-layer",url:"/assets/elevator_nodes.geojson",add:Mt=>Y.addElevatorNodes(Mt)},{layerId:"annotation-nodes-layer",url:"/assets/annotation_nodes.geojson",add:Mt=>Y.addAnnotationNodes(Mt)},{layerId:"walkable-nodes-layer",url:"/assets/walkable_nodes.geojson",add:Mt=>Y.addWalkableNodes(Mt)},{layerId:"walkable-areas-layer",url:"/assets/walkable_areas.geojson",add:Mt=>Y.addWalkableAreas(Mt)},{layerId:"nonwalkable-nodes-layer",url:"/assets/nonwalkable_nodes.geojson",add:Mt=>Y.addNonwalkableNodes(Mt)},{layerId:"kinds-nodes-layer",url:"/assets/kinds_nodes.geojson",add:Mt=>Y.addKindsNodes(Mt)},{layerId:"entrance-aesthetic-nodes-layer",url:"/assets/entrance_aesthetic_nodes.geojson",add:Mt=>Y.addEntranceAestheticNodes(Mt)},{layerId:"location-markers-layer",url:"/assets/location_markers.geojson",add:Mt=>Y.addLocationMarkers(Mt)}],jt=async()=>{for(const Mt of kt){await ux();try{const Wt=await cx(Mt.url);if(!Wt){console.warn(`Failed to load ${Mt.url}`);continue}await Mt.add(Wt),Y.updateFloorVisibility(J.getCurrentFloorId());const Ot=ut.getLayerState(Mt.layerId);Y.setLayerVisibility(Mt.layerId,Ot)}catch(Wt){console.error(`Error loading ${Mt.url}:`,Wt)}}};setTimeout(()=>{jt()},0)})}hx().catch(console.error);
